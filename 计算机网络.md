# 分层

## 应用层
> 最上层的应用就是应用层
- 我们直接接触的就是应用层,电脑或手机使用的`应用软件`就是在应用层实现
- 应用层只需要专注于为用户提供应用功能,如:`HTTP` `FTP` `DNS`等
- 应用层不用关系数据是如何传输的,应用层工作在操作系统中的用户态,传输层及以下工作在内核态
## 传输层
> 传输层并不直接负责将数据从一个设备传到另一个设备,因为实际的网络传输环节是错综复杂的,中间有很多线路和选择,传输层的设计理念是简单、高效和专注,传输层只需要服务好应用即可.
- 传输层用于处理应用层的数据包,为应用层提供网络支持
- 传输层有两个协议: `TCP`和`UDP`
> UDP(用户数据报协议)，是无连接的不可靠服务
- UDP只负责发送数据包,不保证数据包的可靠性,因此它的`实时性更好`,`传输效率更高`
> TCP(传输控制协议)，面向连接的可靠服务
- TCP在传输数据之前，要先进行`三次握手`建立连接，`最少三次握手才能保证接收方和发送方具有正常的收发能力`
- TCP在断开连接时，要进行`四次挥手`断开连接，`断开时，发送方会先发送数据，然后再发送一个断开的消息，这两次不能合并的原因就是：一旦接收方返回的数据包丢失，就会导致接收方认为连接断开，而发送方还要发送数据，从而导致半开连接的状态`
- TCP相比于UDP多了: `流量控制`、`超时重传`、`拥塞控制`等特性,目的是保证数据包能可靠的传输给对方
- 当传输层的数据包大小超过`TCP最大报文段`时,就要重新`进行数据包分块`,这样即使中途有一个分块丢失了,也只需要重新发送这一个分块,而不必重新发送整个数据包.其中的每个分块被成为`TCP段`
- 设备作为接收方时,传输层要负责将数据包传给应用,但是一台设备上可能有很多应用在接收或者传输数据,因此需要一个编号进行区分,这个编号就是`端口`
- 传输层并不直接负责传输,他只负责处理好应用数据的传输功能,作为应用数据的传输媒介,实际的传输功能由下一层网络层来处理
## 网络层
> 网络层负责将数据从一个设备传输到另一个设备
- 网络层最常用的协议是IP`协议`,用于得到一个发送到网络的IP报文
- IP协议会将`传输层的报文`作为`数据部分`,再加上`IP包头`组成`IP报文`,如果IP报文大小超过MTU,就会再次进行分片,得到一个即将发送到网络的IP报文
> ip地址寻址(选择方向)
- 由于设备太多,因此网络层需要有一个区分设备的编号,即`ip地址`
- ip地址通过子网掩码被分为两种意义:`网络号`和`主机号`
- `网络号`标识该ip地址属于哪个子网
- `主机号`标识同一子网下的不同主机
- 区分ip地址时需要子网掩码才能计算出ip地址的网络号和主机号,`网络号 = IP地址 & 子网掩码`,`主机号 = IP地址 & ~子网掩码`
> ip地址路由(选择路径)
- 两台设备不是直接通过网线相连的,而是通过很多网关、路由器、交换机等多种网络连接起来的,从而形成了很多网络路径,当数据包到达一个网络节点,就需要通过路由算法决定下一步走哪一条路径
- ip地址路由就是先找到目标地址的子网,再将数据包转发到对应的网络中
## 网络接口层(物理层和数据链路层)
> 在IP头部的前面加上MAC头部,并封装成数据帧发送到网络上
> 以太网
- 以太网就是一种在局域网内,将附近的设备连接起来,使他们之间可以进行通讯的技术
- 常见的以太网有: `wifi接口` `以太网交换机` `路由器以太网接口`
- `MAC地址`用于标识以太网上的设备,`它和网络接口卡相绑定`
- 以太网在判断网络包的目的地时,必须采用相匹配的方式才能在以太网中将包发往目的地,而`MAC地址`就是这个作用
- 通过`ARP地址解析协议`就可以获得到`MAC地址`
> 无线局域网WLAN
- 和以太网的工作大致相同,不同在于`无线局域网使用无线电波进行数据传输`
# url输入网址后,发生了什么
1. 解析url
> 补全url协议、端口号和默认文件名,http默认80端口,https默认443端口,index.html
2. 生成http请求
3. DNS查询
生成http请求之后，如果浏览器中没有相应的缓存，就会通过本地DNS服务器进行请求，询问域名对应的ip地址。
> DNS用于查询域名对应的ip地址，在域名中，越靠右其层级越高，实际上域名末尾还有一个 . ，他表示根域名，.com表示顶级域名，dmqweb表示权威域名
- 跟DNS服务器（.）
- 顶级DNS服务器（.com）
- 权威DNS服务器（dmqweb.com）
- 本地DNS服务器
4. 得到IP地址后，将传输工作交给`操作系统协议栈`，找到其使用的协议为`TCP协议`
> 操作系统协议栈就是一组网络通信协议的集合，用于标准化通信，分层处理，模块化设计，网络管理和接口定义等
5. 封装为TCP报文
6. 封装为IP数据报
7. 加上MAC地址，封装为网络包
8. 交给网卡，网卡驱动程序将网络包转为电信号，通过网线发送出去
9. 交换机中转，用于将网络包转发到目的ip地址对应的路由器
10. 路由器通过MAC地址找到对应的设备
11. 设备（服务器）通过端口号找到对应的服务
11. 服务端处理请求的数据，通过相同的方式，返回html给请求方的浏览器
12. 浏览器解析html为DOM树，解析css为CSSOM树，两者不冲突，当遇到js文件就会去请求并执行js文件，js文件由于会操作DOM树，因此和渲染主线程互斥。
13. 将DOM树和CSSOM树合并为渲染树
14. 浏览器进行分层、布局和光栅化
15. 调用GPU的能力渲染像素点

# HTTP
## 概念
> 超文本传输协议，计算机世界里专门在「两点」之间「传输」文字、图片、音频、视频等「超文本」数据的「约定和规范」。
## 常见状态码
> 1xx提示信息，表示协议处理的中间状态
> 2xx成功
- 200 OK
- 204 无内容
- 206 分块下载或断点上传 
> 3xx资源变动
- 301 永久重定向
- 302 临时重定向
> 4xx请求有误
- 400 请求有误（笼统）
- 403 禁止访问
- 404 未找到资源
> 5xx服务器错误
- 500 服务器错误（笼统）
- 501 不支持该请求
- 502 网关或代理错误
- 503 服务器繁忙
## HTTP字段
- Host，指定服务器域名
- Content-Length数据长度
- Connection连接机制
- Content-Type数据类型
- Content-Encoding、Accept-Encoding压缩方法
## 安全与幂等
安全是指是否会修改服务器资源，幂等是指是否每次请求返回都相同
> get请求安全并幂等，post请求既不安全也不幂等。
## HTTP缓存
> 强制缓存，用于长时间不会变化的资源
通过资源的Cache-Control响应头和Expires字段来判断资源是否过期
> 协商缓存，用于不定时变化，但不会经常变化的资源
通过服务端返回的304状态码，表示浏览器可以使用本地缓存的资源

## HTTP版本
> HTTP2
- 头部压缩，多个请求时相同时，协议会帮助消除重复的部分
- 二进制格式，增加了数据传输效率
- 并发传输，HTTP1最大连接数为6
- 服务端主动推送资源
> HTTP3
- HTTP3将下层的TCP协议改成了UDP，同时使用QUIC协议保证可靠性，使其无队头阻塞问题，并且可以更快的建立连接
## HTTPS和HTTP的不同
> HTTPS就是在HTTP的基础之上，进行了TLS加密（前身是SSL），进行信息加密和身份验证。
- SSL证书，就是保存在服务器的证书文件，服务端需要向CA证书授权中心申请
- SSL加密过程先通过非对称加密获取密钥，然后通过对称加密进行通信，从而避免了非对称加密繁琐的过程
> 具体加密的过程就是：
- 客户端发送自己支持的加密方式，并给出第一随机数
- 服务端发送自己的加密方式、证书、并给出第二随机数
- 客户端根据两个随机数随机生成预主密钥，通过证书中的公钥对预主密钥进行加密，发送给服务端
- 服务端通过公钥对加密的预主密钥进行解密，获取到预主密钥
- 双方通过第一随机数、第二随机数和预主密钥混合，得到会话密钥，双方的相同

> 对称加密的过程就是：
- 后续双方都使用会话密钥进行加密，会话密钥只在当前会话中有效。



