



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="æœæ˜æ¸…çš„ä¸ªäººåšå®¢" href="https://dmqweb.cn/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="æœæ˜æ¸…çš„ä¸ªäººåšå®¢" href="https://dmqweb.cn/atom.xml" />
<link rel="alternate" type="application/json" title="æœæ˜æ¸…çš„ä¸ªäººåšå®¢" href="https://dmqweb.cn/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ–" />


<link rel="canonical" href="https://dmqweb.cn/2024/04/12/%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF/">



  <title>
å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ– - å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ– |
Web blog = æœæ˜æ¸…çš„ä¸ªäººåšå®¢ = ğŸ‘»æ¬¢è¿ä¸€èµ·äº¤æµå­¦ä¹ ğŸ‘»</title>
  <meta name="keywords" content="å‰ç«¯å¼€å‘, HTML, CSS, JavaScript, åšå®¢">
  <meta name="description" content="æ¢ç´¢å‰ç«¯å¼€å‘çš„æ— é™å¯èƒ½ã€‚æœ¬åšå®¢æä¾›æœ€æ–°çš„å‰ç«¯çŸ¥è¯†åº“ï¼Œä»¥åŠå®ç”¨çš„å¼€å‘æŠ€å·§å’Œæœ€ä½³å®è·µã€‚åŠ å…¥æˆ‘ä»¬çš„ç¤¾åŒºï¼Œå…±åŒæˆé•¿ã€‚">
<meta name="generator" content="Hexo 6.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ–
  </h1>
  
<div class="meta">
  <span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2024-04-12 08:33:58">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">å‘è¡¨äº</span>
    <time itemprop="dateCreated datePublished" datetime="2024-04-12T08:33:58+08:00">2024-04-12</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Web blog</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/25/0aebf75866635811.jpg"></li>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/12/65788b6548e9e58f.jpg"></li>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/13/9404a557b00200f4.jpg"></li>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/03/29/4e134f025ae53f2b.jpg"></li>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/28/91b1bdcfda8d22da.webp"></li>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/28/dc01f095118914ac.webp"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E9%83%A8%E7%BD%B2%E4%B8%8E%E4%BC%98%E5%8C%96/" itemprop="item" rel="index" title="åˆ†ç±»äº å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ–"><span itemprop="name">å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ–</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://dmqweb.cn/2024/04/12/%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="dmq">
    <meta itemprop="description" content="ğŸ‘»æ¬¢è¿ä¸€èµ·äº¤æµå­¦ä¹ ğŸ‘», ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æœæ˜æ¸…çš„ä¸ªäººåšå®¢">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="è½¯ä»¶ç”Ÿå‘½å‘¨æœŸ"><a class="anchor" href="#è½¯ä»¶ç”Ÿå‘½å‘¨æœŸ">#</a> è½¯ä»¶ç”Ÿå‘½å‘¨æœŸï¼š</h1>
<p><img data-src="/images/Snipaste_2024-04-16_12-54-33.jpg" alt="/images/Snipaste_2024-04-16_12-54-33.jpg" /></p>
<h1 id="æ¶æ„æµç¨‹å›¾"><a class="anchor" href="#æ¶æ„æµç¨‹å›¾">#</a> æ¶æ„æµç¨‹å›¾</h1>
<p><img data-src="/images/Snipaste_2024-04-17_12-16-04.jpg" alt="/images/Snipaste_2024-04-17_12-16-04.jpg" /></p>
<h1 id="å¤æ‚é¡¹ç›®é€šç”¨æ–¹æ¡ˆ"><a class="anchor" href="#å¤æ‚é¡¹ç›®é€šç”¨æ–¹æ¡ˆ">#</a> å¤æ‚é¡¹ç›®é€šç”¨æ–¹æ¡ˆ</h1>
<h4 id="ä¸šåŠ¡çš„å¤æ‚åº¦"><a class="anchor" href="#ä¸šåŠ¡çš„å¤æ‚åº¦">#</a> ä¸šåŠ¡çš„å¤æ‚åº¦</h4>
<ul>
<li>äº¤äº’çš„å¤æ‚æ€§</li>
<li>æ•°æ®ç»“æ„å’ŒçŠ¶æ€çš„å¤æ‚æ€§</li>
<li>å¤šé¡¹ç›®äº’ç›¸ä¾èµ–çš„å¤æ‚æ€§</li>
<li>æ‰“åŒ…</li>
<li>æ€§èƒ½ä¼˜åŒ–</li>
<li>ç¬¬ä¸‰æ–¹åº“çš„ä½¿ç”¨å’Œè°ƒç ”ä»¥åŠäºŒæ¬¡å¼€å‘</li>
</ul>
<h4 id="æµç¨‹çš„å¤æ‚åº¦"><a class="anchor" href="#æµç¨‹çš„å¤æ‚åº¦">#</a> æµç¨‹çš„å¤æ‚åº¦</h4>
<ul>
<li>git flow</li>
<li>lint å·¥å…·</li>
<li>å•å…ƒæµ‹è¯•</li>
<li>commit ä¿¡æ¯</li>
<li>PR revirew</li>
<li>CI / CD</li>
</ul>
<h1 id="ci-cdçš„æ¦‚å¿µ"><a class="anchor" href="#ci-cdçš„æ¦‚å¿µ">#</a> CI / CD çš„æ¦‚å¿µ</h1>
<p>ä¸šåŠ¡ç»„ä»¶åº“çš„å¼€å‘å’Œå‘å¸ƒæ˜¯éšç€ä¸€äº›åˆ—ä»»åŠ¡è¿›åŒ–çš„ï¼š</p>
<ul>
<li>æœ¬åœ° commit é’©å­å‡½æ•°å®Œæˆ commit éªŒè¯</li>
<li>ä»£ç  push åˆ°è¿œç«¯ä¹‹å</li>
<li>è·‘ç‰¹å®šçš„ testï¼ˆä¸ä»…ä»…æ˜¯æœ¬æœºçš„ unit testï¼Œä¹Ÿå¯èƒ½æœ‰æ—¶é—´å¾ˆé•¿çš„ E2E testï¼‰</li>
<li>test é€šè¿‡ä¹‹åæ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„ tagï¼Œå¦‚æœæœ‰å°±è‡ªåŠ¨ publish ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬</li>
<li>ç”šè‡³è¿˜æœ‰æ›´å¤šï¼Œè‡ªåŠ¨éƒ¨ç½²æ–‡æ¡£ç«™ç‚¹ç­‰ç­‰ã€‚</li>
</ul>
<p>è¿™äº›ä»»åŠ¡å¦‚æœæ‰‹åŠ¨æ“ä½œï¼Œå°±è´¹æ—¶è´¹åŠ›ï¼Œæ‰€ä»¥éœ€è¦è‡ªåŠ¨åŒ–è¿›è¡Œã€‚</p>
<h4 id="cicontinuous-integrationæŒç»­é›†æˆ"><a class="anchor" href="#cicontinuous-integrationæŒç»­é›†æˆ">#</a> CIï¼ˆContinuous integrationï¼‰æŒç»­é›†æˆ</h4>
<p>æŒç»­é›†æˆæ˜¯æŒ‡é¢‘ç¹åœ°å°†ä»£ç é›†æˆåˆ°ä¸»å¹²ï¼Œä¸€æ—¦å¼€å‘äººå‘˜å¯¹åº”ç”¨æ‰€åšçš„æ›´æ”¹è¢«åˆå¹¶ï¼Œç³»ç»Ÿå°±ä¼šé€šè¿‡è‡ªåŠ¨æ„å»ºåº”ç”¨å¹¶è¿è¡Œä¸åŒçº§åˆ«çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼ˆé€šå¸¸æ˜¯å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼‰æ¥éªŒè¯è¿™äº›æ›´æ”¹ï¼Œç¡®ä¿è¿™äº›æ›´æ”¹æ²¡æœ‰å¯¹åº”ç”¨é€ æˆç ´åã€‚</p>
<p>ä½œç”¨æœ‰ï¼š</p>
<ul>
<li>å¿«é€Ÿå‘ç°é”™è¯¯</li>
<li>é˜²æ­¢åˆ†æ”¯å¤§å¹…åç¦»ä¸»å¹²</li>
</ul>
<p>æŒç»­é›†æˆçš„ç›®çš„å°±æ˜¯è®©äº§å“å¯ä»¥å¿«é€Ÿè¿­ä»£ï¼ŒåŒæ—¶ä¿æŒé«˜è´¨é‡ã€‚</p>
<h4 id="cdcontinuous-deliveryæŒç»­äº¤ä»˜"><a class="anchor" href="#cdcontinuous-deliveryæŒç»­äº¤ä»˜">#</a> CDï¼ˆContinuous Deliveryï¼‰æŒç»­äº¤ä»˜</h4>
<p>æŒç»­äº¤ä»˜æ˜¯æŒ‡é¢‘ç¹åœ°å°†è½¯ä»¶çš„æ–°ç‰ˆæœ¬ï¼Œäº¤ä»˜ç»™è´¨é‡å›¢é˜Ÿæˆ–è€…ç”¨æˆ·ï¼Œä»¥ä¾›è¯„å®¡ã€‚</p>
<h4 id="cdcontinuous-deploymentæŒç»­éƒ¨ç½²"><a class="anchor" href="#cdcontinuous-deploymentæŒç»­éƒ¨ç½²">#</a> CDï¼ˆContinuous Deploymentï¼‰æŒç»­éƒ¨ç½²</h4>
<p>æŒç»­éƒ¨ç½²æ˜¯æŒç»­äº¤ä»˜çš„ä¸‹ä¸€æ­¥ï¼ŒæŒ‡çš„æ˜¯ä»£ç é€šè¿‡è¯„å®¡ä»¥åï¼Œè‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p>
<h4 id="ci-cdä¸¤å¤§æœåŠ¡"><a class="anchor" href="#ci-cdä¸¤å¤§æœåŠ¡">#</a> CI / CD ä¸¤å¤§æœåŠ¡ï¼š</h4>
<ul>
<li>github actions</li>
<li>travis-ci</li>
</ul>
<h1 id="åˆ—è¡¨æ’åºè§£å†³æ–¹æ¡ˆ"><a class="anchor" href="#åˆ—è¡¨æ’åºè§£å†³æ–¹æ¡ˆ">#</a> åˆ—è¡¨æ’åºè§£å†³æ–¹æ¡ˆ</h1>
<p>åˆ—è¡¨æ’åºåŸç†ï¼š</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span>template<span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token operator">&lt;</span>div<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"ul"</span> @drop<span class="token operator">=</span><span class="token string">"onDrop"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token operator">&lt;</span>li </pre></td></tr><tr><td data-num="5"></td><td><pre>            v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(item,index) in list"</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token operator">:</span>data<span class="token operator">-</span>index<span class="token operator">=</span><span class="token string">"index"</span> </pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"item.id"</span> </pre></td></tr><tr><td data-num="8"></td><td><pre>            @dragover<span class="token operator">=</span><span class="token string">"onDragover($event,index)"</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>            @dragstartart<span class="token operator">=</span><span class="token string">"dragstart($event,index)"</span> </pre></td></tr><tr><td data-num="10"></td><td><pre>            @dragenter<span class="token operator">=</span><span class="token string">"dragenter($event,index)"</span> </pre></td></tr><tr><td data-num="11"></td><td><pre>            draggable<span class="token operator">=</span><span class="token string">"true"</span> </pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"[item.id==currentLi?'glost':'']"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>swigï¿¼<span class="token number">0</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">&lt;</span>script setup<span class="token operator">></span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">/*eslint-disable*/</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>arrayMoveImmutable<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'array-move'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">let</span> currentLi <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token punctuation">&#123;</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'åˆ—è¡¨1'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token punctuation">&#123;</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'åˆ—è¡¨2'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token punctuation">&#123;</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'åˆ—è¡¨3'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token punctuation">&#123;</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'åˆ—è¡¨4'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token punctuation">&#123;</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'åˆ—è¡¨5'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">dragstart</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>inde</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  currentLi<span class="token punctuation">.</span>value <span class="token operator">=</span> inde<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">dragenter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>ind</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>ind <span class="token operator">!=</span> currentLi<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>      list<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">arrayMoveImmutable</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>value<span class="token punctuation">,</span>ind<span class="token punctuation">,</span>currentLi<span class="token punctuation">.</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>      currentLi<span class="token punctuation">.</span>value <span class="token operator">=</span> ind<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">onDrop</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>index<span class="token punctuation">,</span><span class="token string">'drop'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  list<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">arrayMoveImmutable</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>value<span class="token punctuation">,</span>index<span class="token punctuation">.</span>value<span class="token punctuation">,</span>currentLi<span class="token punctuation">.</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">onDragover</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>inde</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  index<span class="token punctuation">.</span>value <span class="token operator">=</span> inde<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token operator">&lt;</span>style  scoped<span class="token operator">></span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token punctuation">.</span>ul<span class="token operator">></span>li<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>  <span class="token literal-property property">height</span><span class="token operator">:</span> 50px<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token literal-property property">border</span><span class="token operator">:</span> 1px solid red<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token punctuation">.</span>glost<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>  box<span class="token operator">-</span>shadow<span class="token operator">:</span> 10px 10px 3px 3px gray<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></pre></td></tr></table></figure><p>åˆ—è¡¨æ’åºå¸¸ç”¨å·¥å…·åŒ…ï¼š</p>
<ul>
<li>vue-draggable</li>
<li>sortable.js</li>
<li>array-move.js</li>
</ul>
<h1 id="æ‹–åŠ¨æ”¹å˜ä½ç½®åŸç†"><a class="anchor" href="#æ‹–åŠ¨æ”¹å˜ä½ç½®åŸç†">#</a> æ‹–åŠ¨æ”¹å˜ä½ç½®åŸç†</h1>
<p>é€šè¿‡ç›‘å¬ mousedown å’Œ mousemove äº‹ä»¶ï¼Œç”¨ element.getBoundingClientRect æ–¹æ³•è·å¾— x å’Œ yï¼Œleft å’Œ top ç­‰å±æ€§ï¼Œæ”¹å˜å¯¹åº”å…ƒç´ çš„ top å’Œ left å±æ€§ã€‚</p>
<h1 id="æ‹–åŠ¨æ”¹å˜å¤§å°åŸç†"><a class="anchor" href="#æ‹–åŠ¨æ”¹å˜å¤§å°åŸç†">#</a> æ‹–åŠ¨æ”¹å˜å¤§å°åŸç†</h1>
<p>è®¾ç½®è¾¹æ¡†å…ƒç´ ï¼Œè¾¹æ¡†å…ƒç´ çš„å››ä¸ªè§’æ·»åŠ åœ†ç‚¹å…ƒç´ ï¼Œç›‘å¬ mousedown äº‹ä»¶å’Œ mousemove äº‹ä»¶ï¼Œå¹¶å°†æœ€æ–°çš„åæ ‡èµ‹å€¼ç»™å…ƒç´ çš„å°ºå¯¸å¤§å°ã€‚</p>
<h1 id="å¿«æ·é”®å®ç°åŸç†"><a class="anchor" href="#å¿«æ·é”®å®ç°åŸç†">#</a> å¿«æ·é”®å®ç°åŸç†</h1>
<p>å¥½ç”¨çš„å¿«æ·é”®ç¬¬ä¸‰æ–¹åº“ï¼šHotkeys.js</p>
<p>äº‹ä»¶åŸç†ï¼škeydown äº‹ä»¶çš„ç›‘å¬ï¼Œé€šè¿‡ event.key åˆ¤æ–­æ˜¯é‚£ä¸ªå¿«æ·é”®ï¼Œä»è€Œæ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚</p>
<h1 id="æ’¤é”€é‡åšåŸç†"><a class="anchor" href="#æ’¤é”€é‡åšåŸç†">#</a> æ’¤é”€é‡åšåŸç†</h1>
<p>ç»´æŠ¤ä¸€ä¸ªå›ºå®šé•¿åº¦çš„ histories æ•°ç»„å’Œ historyIndex æŒ‡é’ˆï¼Œæ¯æ¬¡ä¿®æ”¹çš„æ—¶å€™æ·»åŠ ä¸€æ¡è®°å½•ï¼ˆæ ‡è¯†æ“ä½œç±»å‹å’Œæ•°æ®ï¼‰ã€‚å›æ»šæ—¶æ”¹å˜ historyIndex æŒ‡é’ˆã€‚</p>
<h1 id="å³é”®èœå•åŸç†"><a class="anchor" href="#å³é”®èœå•åŸç†">#</a> å³é”®èœå•åŸç†</h1>
<p>åœ¨éœ€è¦æ˜¾ç¤ºçš„åŒºåŸŸæ‹¦æˆªé»˜è®¤çš„å³é”®ç‚¹å‡»äº‹ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦ç‚¹å‡»åœ¨ç»„ä»¶å…ƒç´ ä¸Šï¼ˆé€šè¿‡ event.targetï¼‰ï¼Œæ˜¾ç¤ºä¸€ä¸ªè‡ªå®šä¹‰èœå•ï¼Œå…¶ä¸­åŒ…æ‹¬æ“ä½œé¡¹ï¼Œæ˜¾ç¤ºåœ¨é¼ æ ‡çš„ä½ç½®ï¼ˆevent.clientX å’Œ event.clientYï¼‰ï¼Œç‚¹å‡»å®Œæˆæ“ä½œï¼Œé€šè¿‡ display:none éšè—ã€‚</p>
<h1 id="è‡ªåŠ¨ä¿å­˜å®ç°æ–¹æ¡ˆ"><a class="anchor" href="#è‡ªåŠ¨ä¿å­˜å®ç°æ–¹æ¡ˆ">#</a> è‡ªåŠ¨ä¿å­˜å®ç°æ–¹æ¡ˆ</h1>
<ul>
<li>å®šæ—¶ä¿å­˜ï¼ˆè¯­é›€ï¼‰</li>
<li>å®æ—¶ä¿å­˜ï¼ˆçŸ³å¢¨ï¼‰</li>
</ul>
<p>å®ç°åŸç†ï¼šæ·»åŠ  isDrity å­—æ®µæ ‡è®°æ•°æ®æ˜¯å¦æœ‰ä¿®æ”¹ï¼Œå½“ä¿®æ”¹æ—¶å°† isDirty è®¾ç½®ä¸º trueï¼Œæ ¹æ® isDIrty çš„å€¼è®¾ç½®å®šæ—¶å™¨ï¼Œå®šæ—¶è§¦å‘ä¿å­˜é€»è¾‘ã€‚</p>
<h1 id="domå…ƒç´ æˆªå›¾å®ç°æ–¹æ¡ˆ"><a class="anchor" href="#domå…ƒç´ æˆªå›¾å®ç°æ–¹æ¡ˆ">#</a> DOM å…ƒç´ æˆªå›¾å®ç°æ–¹æ¡ˆ</h1>
<p>å·¥å…·åŒ…ï¼šhtml2canvas</p>
<p>å®ç°åŸç†ï¼š</p>
<p>æ ¹æ® DOM å…ƒç´ çš„ styles æ ·å¼ï¼Œé€šè¿‡ svg çš„ foreignObject å…ƒç´ å¼•å…¥ XML å‘½åç©ºé—´çš„å…ƒç´ ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª image æ ‡ç­¾ï¼Œå°† svg é€šè¿‡ url.createObjectURL æ–¹æ³•åˆ›å»ºä¸€ä¸ªè·¯å¾„èµ‹å€¼ç»™ä¸€ä¸ª image æ ‡ç­¾çš„ src å±æ€§ï¼Œé€šè¿‡ canvas ç”»ç¬” çš„ drawImage æ–¹æ³•å°† image å›¾ç‰‡ç»˜åˆ¶åˆ° canvas ç”»å¸ƒä¸Šã€‚</p>
<p>å®ç°æµç¨‹ï¼š</p>
<ul>
<li>style è®¾ç½® DOM æ ·å¼</li>
<li>svg å¼•å…¥ DOM</li>
<li>createObjectURL åˆ›å»º url è·¯å¾„</li>
<li>å°† url å¤åˆ¶åˆ° image æ ‡ç­¾çš„ src</li>
<li>canvas çš„ drawImage å°† image å›¾ç‰‡ç»˜åˆ¶åˆ° canvas ç”»å¸ƒä¸Š</li>
</ul>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> data <span class="token operator">=</span></pre></td></tr><tr><td data-num="2"></td><td><pre>"<span class="token operator">&lt;</span>svg xmlns<span class="token operator">=</span><span class="token string">'http://www.w3.org/2000/svg'</span>width<span class="token operator">=</span><span class="token string">'400px'</span>height<span class="token operator">=</span>'<span class="token number">40</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token string">"&lt;foreignabject width='100%'height='100%'>"</span><span class="token operator">+</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token string">"&lt;div xmlns='http://ww.w3.org/1999/xhtml'>"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>element<span class="token punctuation">.</span>innerHTML<span class="token operator">+</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token string">"&lt;/div>"</span><span class="token operator">+</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token string">"&lt;/foreignobject>"</span> <span class="token operator">+</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token string">"&lt;/svg>"</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">const</span> svg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"image/svg+xml;charset=utf-8"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createobjectURL</span><span class="token punctuation">(</span>svg<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>image<span class="token punctuation">.</span>src <span class="token operator">=</span> url</pre></td></tr><tr><td data-num="14"></td><td><pre>image<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">const</span> ctx <span class="token operator">=</span>anvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="äºŒç»´ç ç”Ÿæˆæ–¹æ¡ˆ"><a class="anchor" href="#äºŒç»´ç ç”Ÿæˆæ–¹æ¡ˆ">#</a> äºŒç»´ç ç”Ÿæˆæ–¹æ¡ˆ</h1>
<ul>
<li>å·¥å…·åŒ…ï¼šnode-qrcode</li>
<li>ts é¡¹ç›®ä¸­éœ€è¦å®‰è£…é¢å¤–çš„å®šä¹‰æ–‡ä»¶ã€‚</li>
</ul>
<p>ç®€å•åŸç†ï¼šå°†æ•°æ®å˜ä¸ºäºŒè¿›åˆ¶ï¼Œç„¶åé€šè¿‡ canvas å°†äºŒè¿›åˆ¶å˜ä¸ºå›¾åƒã€‚</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>qrcode<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>128<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>128<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// å°†å­—ç¬¦ä¸²è½¬ä¸ºäºŒè¿›åˆ¶å½¢å¼</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">toBianary</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">let</span> charCode <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">let</span> binaryCharCode <span class="token operator">=</span> charCode<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            res <span class="token operator">+=</span> binaryCharCode<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">return</span> res<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">// ç»˜åˆ¶</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">function</span> <span class="token function">drawQRCode</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> canvas</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token comment">// ç»˜åˆ¶é»‘ç™½åƒç´ ç‚¹</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> text<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">var</span> row <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>i <span class="token operator">/</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">var</span> col <span class="token operator">=</span> i <span class="token operator">%</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">var</span> color <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"1"</span> <span class="token operator">?</span> <span class="token string">"#000000"</span> <span class="token operator">:</span> <span class="token string">"#FFFFFF"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> color<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre>        context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>col<span class="token punctuation">,</span> row<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">var</span> qrcodeCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"qrcode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token function">drawQRCode</span><span class="token punctuation">(</span><span class="token function">toBianary</span><span class="token punctuation">(</span><span class="token string">'https://dmqweb.cn'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> qrcodeCanvas<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¤ºä¾‹ï¼šç»˜åˆ¶ä¸€ä¸ªç®€å•çš„äºŒç»´ç </span></pre></td></tr><tr><td data-num="28"></td><td><pre>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><h1 id="å¤åˆ¶åŠŸèƒ½å®ç°åŸç†"><a class="anchor" href="#å¤åˆ¶åŠŸèƒ½å®ç°åŸç†">#</a> å¤åˆ¶åŠŸèƒ½å®ç°åŸç†</h1>
<ul>
<li>å·¥å…·åŒ…ï¼šclipboard.js</li>
<li>è‡ªå¸¦ type å®šä¹‰æ–‡ä»¶</li>
</ul>
<p>å®ç°åŸç†ï¼š</p>
<p>æ–¹æ¡ˆä¸€ï¼šdocument.execCommand () æ–¹æ³•ã€‚å†…ç½®ä¸€ç³»åˆ—åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¤åˆ¶æ–‡æœ¬ï¼ˆä½†<strong>å‰ææ˜¯éœ€è¦é€‰ä¸­æ–‡æœ¬</strong>ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä¸å¯è§å…ƒç´ è¿‚å›ã€‚</p>
<p>æ–¹æ¡ˆäºŒï¼šClipboard APIï¼ˆ navigator.clipboard ï¼‰ï¼Œä½†æ˜¯å¯¹äº<strong>æµè§ˆå™¨å…¼å®¹æ€§æœ‰å¾…åŠ å¼ºã€‚</strong></p>
<h1 id="ä¸‹è½½æ–‡ä»¶åŸç†"><a class="anchor" href="#ä¸‹è½½æ–‡ä»¶åŸç†">#</a> ä¸‹è½½æ–‡ä»¶åŸç†</h1>
<ul>
<li>å·¥å…·åŒ…ï¼šFileSaver.jsï¼ˆå°æ–‡ä»¶ï¼‰</li>
<li>StreamSaver.jsï¼ˆå¤§æ–‡ä»¶ï¼‰</li>
</ul>
<p>æ–¹æ¡ˆä¸€ï¼šè¶…é“¾æ¥ a æ ‡ç­¾æ·»åŠ  download å±æ€§ï¼Œå±æ€§å€¼ä¸ºæ–‡ä»¶åï¼Œrel å±æ€§è®¾ç½®æ‰“å¼€é¡µé¢çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚ï¼ˆä½†å‰ææ˜¯<strong> href å±æ€§ä¸ºå½“å‰åŒæºæƒ…å†µä¸‹</strong>ã€‚ï¼‰</p>
<p>æ–¹æ¡ˆäºŒï¼šé€šè¿‡ axios è¯·æ±‚åˆ°å›¾ç‰‡åœ°å€ï¼Œé€šè¿‡ URL.createObjectURL åˆ›å»ºä¸ºä¸€ä¸ªä¸ document ç›¸ç»‘å®šçš„åœ°å€ï¼Œèµ‹å€¼ç»™ a æ ‡ç­¾å³å¯ã€‚ï¼ˆä¸è¦å¿˜è®°ä½¿ç”¨ URL.revokeObjectURL å°†åˆ›å»ºçš„åœ°å€ç§»é™¤ã€‚ï¼‰</p>
<p>æ–¹æ¡ˆä¸‰ï¼šé€šè¿‡ FileReader.readAsDataURLï¼Œåˆ›å»ºä¸€ä¸ª FileReader å®ä¾‹ï¼Œä½¿ç”¨ readAsDataURL è¯»å–å¯¹è±¡è¿”å›ä¸€æ®µ base64 æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œç›‘å¬ reader å®ä¾‹çš„ onload äº‹ä»¶ï¼Œåˆ›å»º a æ ‡ç­¾å°† reader.result èµ‹å€¼ç»™ a æ ‡ç­¾çš„ href å±æ€§ã€‚</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function-variable function">downloadFile</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>fileName</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>   <span class="token comment">// ä¼ å…¥è¢«è¯»å–çš„ blob å¯¹è±¡</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>   <span class="token comment">// è¯»å–å®Œæˆçš„å›è°ƒäº‹ä»¶</span></pre></td></tr><tr><td data-num="6"></td><td><pre>   reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>       <span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>       a<span class="token punctuation">.</span>download <span class="token operator">=</span> fileName</pre></td></tr><tr><td data-num="9"></td><td><pre>       a<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span></pre></td></tr><tr><td data-num="10"></td><td><pre>       <span class="token comment">// ç”Ÿæˆçš„ base64 ç¼–ç </span></pre></td></tr><tr><td data-num="11"></td><td><pre>       <span class="token keyword">let</span> url <span class="token operator">=</span> reader<span class="token punctuation">.</span>result</pre></td></tr><tr><td data-num="12"></td><td><pre>       a<span class="token punctuation">.</span>href <span class="token operator">=</span> url</pre></td></tr><tr><td data-num="13"></td><td><pre>       document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>       a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>       document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ç»ˆæè§£å†³æ–¹æ¡ˆï¼šç”±äºé€šè¿‡ URL.createObjectURL å’Œ FileReader éƒ½ä¼šå…ˆå°†æ•°æ®ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œä¸šåŠ¡ä¸­ç»å¸¸éœ€è¦åç«¯éªŒè¯ token ä¹‹åæ‰èƒ½æ‹¿åˆ°æ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ a æ ‡ç­¾ã€‚å› æ­¤å®é™…ä¸­å¯ä»¥å…ˆå‘é€ ajax è¯·æ±‚éªŒè¯ tokenï¼ŒéªŒè¯ä¹‹åé¢å‘ä¸€ä¸ªè¿‡æœŸæ—¶é—´çŸ­çš„ cookieï¼Œä¹‹åä½¿ç”¨ a æ ‡ç­¾è¿›è¡Œä¸‹è½½å³å¯ã€‚ä½†æ˜¯åŒæ ·ä¼šå—åˆ° a æ ‡ç­¾ download å±æ€§è·¨åŸŸè¯·æ±‚çš„é™åˆ¶ã€‚</p>
<h1 id="åº”ç”¨éƒ¨ç½²çš„æµç¨‹"><a class="anchor" href="#åº”ç”¨éƒ¨ç½²çš„æµç¨‹">#</a> åº”ç”¨éƒ¨ç½²çš„æµç¨‹</h1>
<p><strong>æ„å»º</strong><br />
 Javascript è¯­è¨€æœ¬èº«æ˜¯ä¸éœ€è¦ç¼–è¯‘çš„ã€‚<br />
ä½†æ˜¯ç°ä»£çš„å‰ç«¯é¡¹ç›®ä½¿ç”¨çš„è¯­è¨€å’Œæˆ–è€…çš„æ¨¡å—ç³»ç»Ÿéƒ½æ— æ³•åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œéƒ½éœ€è¦ä½¿ç”¨ç‰¹å®šçš„<br />
 bundler å°†æºä»£ç æœ€ç»ˆè½¬æ¢ä¸ºæµè§ˆå™¨æ”¯æŒçš„ Javascript ä»£ç ã€‚<br />
<strong>ä¸åŒçš„ç¯å¢ƒ:</strong><br />
 å¼€å‘ç¯å¢ƒ (development) ï¼šæœ¬åœ°çš„æµ‹è¯•ç¯å¢ƒ<br />
æµ‹è¯•ç¯å¢ƒ (test æˆ–è€… stagingï¼‰ï¼šçº¿ä¸Šçš„æµ‹è¯•ç¯å¢ƒ</p>
<p>ç”Ÿäº§ç¯å¢ƒï¼ˆproduction)ï¼šçº¿ä¸Šçš„ç”Ÿäº§ç¯å¢ƒ</p>
<p><strong>ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒçš„åŒºåˆ«</strong><br />
å¼€å‘ç¯å¢ƒä¼šæ·»åŠ ä¸°å¯Œçš„é”™è¯¯æç¤ºï¼Œå¯ä»¥ä½¿ç”¨ mock server æˆ–è€…æœ¬åœ°åç«¯ç¯å¢ƒæ·»åŠ å„ç§ä¾¿åˆ©çš„åŠŸèƒ½ - æ¯”å¦‚ hot reload, è‡ªåŠ¨åˆ·æ–°ï¼Œä¸å¤ªå…³å¿ƒé™æ€èµ„æºçš„å¤§å°ï¼Œæœ€å¥½æä¾›æœ€ä¸°å¯Œçš„è°ƒè¯•ä¿¡æ¯ (sourcemap) ç­‰ã€‚</p>
<p><strong>ç”Ÿäº§ç¯å¢ƒ</strong></p>
<ul>
<li>ç¨³å®šæ˜¯æœ€é‡è¦çš„åŸåˆ™</li>
<li>é€Ÿåº¦æ˜¯ç¬¬ä¸€è¦åŠ¡</li>
</ul>
<p><strong>ç”Ÿäº§ç¯å¢ƒå’Œæµ‹è¯•ç¯å¢ƒçš„åŒºåˆ«</strong></p>
<ul>
<li>é«˜åº¦ç›¸ä¼¼</li>
<li>ä½¿ç”¨çš„åç«¯æœåŠ¡ä¸ä¸€æ ·</li>
</ul>
<p><strong>ç¯å¢ƒå˜é‡è®¾ç½®ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰</strong></p>
<ul>
<li>è·¨å¹³å°è®¾ç½®ç¯å¢ƒå˜é‡å·¥å…·åŒ…ï¼šcross-env</li>
<li>å‘½ä»¤ä¸­æ·»åŠ ç¯å¢ƒå˜é‡ï¼ˆå¹³å°é™åˆ¶ï¼‰</li>
<li>ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­é…ç½®</li>
</ul>
<p><strong>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­æ”¾ç½®ä¸‹åˆ—æ–‡ä»¶æ¥æŒ‡å®šç¯å¢ƒå˜é‡</strong></p>
<ul>
<li>.env                                        #åœ¨æ‰€æœ‰çš„ç¯å¢ƒä¸­è¢«è½½å…¥</li>
<li>.env.local                             #åœ¨æ‰€æœ‰çš„ç¯å¢ƒä¸­è¢«è½½å…¥ï¼Œä½†ä¼šè¢« git å¿½ç•¥</li>
<li>env.[mode]                         #åªåœ¨æŒ‡å®šçš„æ¨¡å¼ä¸­è¢«è½½å…¥</li>
<li>env.[mode].local             #åªåœ¨æŒ‡å®šçš„æ¨¡å¼ä¸­è¢«è½½å…¥ï¼Œä½†ä¼šè¢« git å¿½ç•¥</li>
</ul>
<h1 id="webpackæ„å»ºä¼˜åŒ–"><a class="anchor" href="#webpackæ„å»ºä¼˜åŒ–">#</a> webpack æ„å»ºä¼˜åŒ–</h1>
<h3 id="bundler"><a class="anchor" href="#bundler">#</a> Bundlerï¼š</h3>
<ul>
<li>
<p>å°†æµè§ˆå™¨ä¸æ”¯æŒçš„æ¨¡å—è¿›è¡Œç¼–è¯‘ï¼Œè½¬æ¢ï¼Œ</p>
</li>
<li>
<p>åˆå¹¶æœ€åç”Ÿæˆçš„ä»£ç å¯ä»¥åœ¨æµè§ˆå™¨ç«¯è‰¯å¥½çš„è¿è¡Œçš„å·¥å…·ã€‚</p>
</li>
</ul>
<h3 id="loaders"><a class="anchor" href="#loaders">#</a> <strong><span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmRvY3NjaGluYS5vcmcvY29uY2VwdHMvbG9hZGVycy8=">Loaders</span>ï¼š</strong></h3>
<p>loader ç”¨äºå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œè½¬æ¢ã€‚loader å¯ä»¥ä½¿ä½ åœ¨ import æˆ– &quot;Ioad (åŠ è½½)&quot; æ¨¡å—æ—¶é¢„å¤„ç†æ–‡ä»¶ã€‚<br />
<strong>å¤šä¸ª Loader</strong><br />
module.rules å…è®¸ä½ åœ¨ webpack é…ç½®ä¸­æŒ‡å®šå¤šä¸ª loaderã€‚è¿™ç§æ–¹å¼æ˜¯å±•ç¤º loader çš„ä¸€ç§ç®€æ˜æ–¹å¼ï¼Œå¹¶ä¸”æœ‰åŠ©äºä½¿ä»£ç å˜å¾—ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚</p>
<p><strong>webpack ä¸­ loader é…ç½®ï¼š</strong></p>
<figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre>const path = require('path')</pre></td></tr><tr><td data-num="2"></td><td><pre>module.exports = <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    entry<span class="token operator">:</span>'./main.js'<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    output<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        path<span class="token operator">:</span>path.resolve(dirname<span class="token punctuation">,</span>'dist')<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        filename<span class="token operator">:</span>bundle.js'<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>module<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    rules<span class="token operator">:</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        test<span class="token operator">:</span>/\.css$/<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        use<span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            loader<span class="token operator">:</span>'style-loader'<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>   <span class="token comment">// å…ˆå†™çš„ loader åæ‰§è¡Œã€‚</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            loader<span class="token operator">:</span>'css-loader'<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h6 id="åŸç†"><a class="anchor" href="#åŸç†">#</a> åŸç†</h6>
<p><strong>webpack ä¸­ loader åŸç†ï¼š</strong></p>
<p>åœ¨ webpack.config.js çš„ module å­—æ®µçš„ rules æ•°ç»„ä¸­è¿›è¡Œé…ç½®ï¼šæ·»åŠ ä¸€ä¸ªå¯¹è±¡æ ‡è¯†ä¸€ä¸ªç‹¬ç«‹çš„åŒ¹é…é¡¹ï¼Œtest å­—æ®µä½¿ç”¨æ­£åˆ™è¡¨ç¤ºåŒ¹é…çš„æ–‡ä»¶åï¼Œuse æ•°ç»„è¡¨ç¤ºå¯¹åº”æ–‡ä»¶éœ€è¦æ‰§è¡Œçš„ loaderï¼Œwebpack åœ¨æ‰“åŒ…æ—¶ä¼š<strong>å°†æ–‡ä»¶å†…å®¹ä¼ å…¥å¹¶æ‰§è¡Œå¯¹åº”çš„ loader</strong>ï¼ˆæ˜¯ä¸€ä¸ªå‡½æ•°ï¼‰ï¼Œ<strong>æ‰§è¡Œ loader å‡½æ•°åä¼šå°†å‡½æ•°è¿”å›å€¼åŒ…è£…æˆä¸€ä¸ªæ–°çš„å‡½æ•°</strong>ï¼Œå› æ­¤ webpack ä¸­çš„ loader é€šå¸¸éœ€è¦è¿›è¡Œä¸¤æ¬¡ module.exportsã€‚</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// æ‰‹å†™ä¸€ä¸ª md æ–‡ä»¶çš„ loader</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> marked <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'marked'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç¬¬ä¸‰æ–¹åº“ï¼Œç”¨äºå°† md è½¬ä¸º html</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>  <span class="token comment">// å®˜æ–¹åº“ï¼Œç”¨äºè·å–ç”¨æˆ·é…ç½® loader æ—¶ä¼ å…¥çš„å‚æ•°</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">markdownLoader</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">const</span> options <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">marked</span><span class="token punctuation">(</span>source <span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">module.exports = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> markdownLoader<span class="token punctuation">;</span></pre></td></tr></table></figure><p>é…ç½®ï¼š</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token literal-property property">entry</span><span class="token operator">:</span><span class="token string">'./main.js'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token literal-property property">output</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token literal-property property">path</span><span class="token operator">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token literal-property property">filename</span><span class="token operator">:</span>bundle<span class="token punctuation">.</span>js'<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token punctuation">&#123;</span> <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'style-loader'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>   <span class="token comment">// å…ˆå†™çš„ loader åæ‰§è¡Œã€‚</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token punctuation">&#123;</span> <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'css-loader'</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.md$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token punctuation">&#123;</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'./markdonwn-loader'</span><span class="token punctuation">,</span><span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">headerIds</span><span class="token operator">:</span><span class="token boolean">false</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// å…¶ä¸­ options æ˜¯ç»™ loader å‡½æ•°ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œloader ä¸­å¯ä»¥ä½¿ç”¨ loader-utils å®˜æ–¹ä¸‰æ–¹åº“è¿›è¡Œæ¥å—</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>å¤šä¸ª Loader ä¸²è”</strong><br />
æœ€åçš„ loader æœ€æ—©è°ƒç”¨ï¼Œå°†ä¼šä¼ å…¥åŸå§‹èµ„æºå†…å®¹ã€‚<br />
ç¬¬ä¸€ä¸ª loader æœ€åè°ƒç”¨ï¼ŒæœŸæœ›å€¼æ˜¯ä¼ å‡º JavaScript å’Œ source map (å¯é€‰)ã€‚<br />
ä¸­é—´çš„ loader æ‰§è¡Œæ—¶ï¼Œä¼šä¼ å…¥å‰ä¸€ä¸ª loader ä¼ å‡ºçš„ç»“æœã€‚<br />
<strong>å°† markdown è½¬æ¢ä¸º html:turndown</strong><br />
 åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIub20vZG9tY2hyaXN0aWUvdHVybmRvd24=">https://github.om/domchristie/turndown</span></p>
<h3 id="plugins"><a class="anchor" href="#plugins">#</a> <strong>plugins:</strong></h3>
<p><span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmRvY3NjaGluYS5vcmcvY29uY2VwdHMvcGx1Z2lucy8=">https://webpack.docschina.org/concepts/plugins/</span><br />
 æ’ä»¶æ˜¯ webpack çš„æ”¯æŸ±åŠŸèƒ½ã€‚webpack è‡ªèº«ä¹Ÿæ˜¯æ„å»ºå¼€ä½ åœ¨ webpack é…ç½®ä¸­ç”¨åˆ°çš„ç›¸åŒçš„æ’ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼æ’ä»¶ç›®çš„åœ¨äºè§£å†³ loader æ— æ³•å®ç°çš„å…¶ä»–äº‹ã€‚(æˆ‘è‡ªå·±çš„ç†è§£ï¼Œloader è§£å†³çš„æ˜¯å„ç§ä¸åŒèµ„æºçš„é—®é¢˜ï¼Œplugins æ›´å¤šè§£å†³çš„æ˜¯é¡¹ç›®æ•´ä½“çš„äº‹æƒ…)</p>
<figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre>const path = require('path');</pre></td></tr><tr><td data-num="2"></td><td><pre>const HtmlWebpackPlugin = require('html-webpack-plugin');</pre></td></tr><tr><td data-num="3"></td><td><pre>module.exports = <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    entry<span class="token operator">:</span>'./main.js'<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    output<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        path<span class="token operator">:</span>path.resolve(dirname<span class="token punctuation">,</span>'dist')<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        filename<span class="token operator">:</span>bundle.js'<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>module<span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    rules<span class="token operator">:</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        test<span class="token operator">:</span>/å…«.css$/<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        use<span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            loader<span class="token operator">:</span>'style-loader'<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>   <span class="token comment">// å…ˆå†™çš„ loader åæ‰§è¡Œã€‚</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            loader<span class="token operator">:</span>'css-loader'<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>plugins<span class="token operator">:</span><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    new BundlesizeWebpackPlugin( <span class="token punctuation">&#123;</span> sizeLimit<span class="token operator">:</span><span class="token number">3</span> <span class="token punctuation">&#125;</span> )  <span class="token comment">// è‡ªå·±æ‰‹å†™çš„æ’ä»¶ï¼ˆå¦‚ä¸‹ï¼‰</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    new webpack.ProgressPlugin()<span class="token punctuation">,</span> <span class="token comment">// æ˜¾ç¤ºæ‰“åŒ…è¿‡ç¨‹ï¼ˆwebpack å†…ç½®æ’ä»¶ï¼‰</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    new HtmlwebpackPlugin()<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h6 id="åŸç†-2"><a class="anchor" href="#åŸç†-2">#</a> åŸç†</h6>
<p><strong>webpack ä¸­ plugins åŸç†ï¼š</strong></p>
<p>webpack æ‰§è¡Œæ—¶ä¼šå°† plugins å­—æ®µä¸­çš„æ’ä»¶å®ä¾‹å–å‡ºå¹¶å°† webpack å®ä¾‹ä¼ å…¥å¹¶æ‰§è¡Œå…¶<strong> apply æ–¹æ³•</strong>ï¼Œé€šè¿‡ webpack å®ä¾‹çš„ hooks ä¸­çš„æ–¹æ³•æˆ‘ä»¬å¯ä»¥æ“æ§å¯¹åº”çš„é’©å­å‡½æ•°ã€‚</p>
<p>å®˜æ–¹çš„æ•™ç¨‹ï¼š<span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmpzLm9yZy9jb250cmlidXRlL3dyaXRpbmctYS1wbHVnaW4v">https://webpack.js.org/contribute/writing-a-plugin/</span><br />
<strong> æ’ä»¶çš„æ ¼å¼</strong><br />
ä¸€ä¸ª JavaScript å‡½æ•°æˆ– JavaScript ç±» ï¼Œåœ¨å®ƒåŸå‹ä¸Šå®šä¹‰çš„ apply æ–¹æ³•ï¼Œä¼šåœ¨å®‰è£…æ’ä»¶æ—¶è¢«è°ƒç”¨ï¼Œå¹¶è¢« webpack compiler è°ƒç”¨ä¸€æ¬¡ã€‚æŒ‡å®šä¸€ä¸ªè§¦åŠåˆ° webpack æœ¬èº«çš„äº‹ä»¶é’©å­ï¼Œå³ hooks, ç”¨äºç‰¹å®šæ—¶æœºå¤„ç†é¢å¤–çš„é€»è¾‘<br />
 Compiler Hooks åˆ—è¡¨<br />
<span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmlzLm9yZy9hcGkvY29tcGlsZXItaG9va3Mv"> https://webpack.is.org/api/compiler-hooks/</span></p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// æ‰‹å†™ä¸€ä¸ª webpack æ’ä»¶ï¼Œæ‰“åŒ…æ–‡ä»¶è¶…å‡ºé™åˆ¶æ—¶ï¼ŒæŠ¥é”™ã€‚</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> resolve <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> statSync <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//fs æ¨¡å—ä¸­åŒæ­¥è¯»å–æ–‡ä»¶ä¿¡æ¯</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BundlesizeWebpackPlugin</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token comment">// è·å–åˆ°ä¼ å…¥çš„å‚æ•°</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> sizeLimit <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compile<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'BundleSizePlugin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">compilationParams</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span> <span class="token comment">// ç¼–è¯‘æ—¶é’©å­ï¼Œå‚æ•°æ˜¯å‚æ•°</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'compileé˜¶æ®µ'</span><span class="token punctuation">,</span>compilationParams<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'BundleSizePlugin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span> <span class="token comment">// ç»“æŸæ—¶é’©å­ï¼Œå‚æ•°æ˜¯æ‰“åŒ…åçš„ä¿¡æ¯ã€‚</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">,</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token comment">// æ‹¿åˆ°æ‰“åŒ…åæ–‡ä»¶çš„è·¯å¾„å’Œæ–‡ä»¶å</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> path <span class="token punctuation">,</span> filename <span class="token punctuation">&#125;</span> <span class="token operator">=</span> stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>outputOptions<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token comment">// æ‹¼æ¥æˆæ–‡ä»¶è·¯å¾„</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">const</span> bundlePath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token comment">// è·å–åˆ°æ–‡ä»¶ size</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> size <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">statSync</span><span class="token punctuation">(</span>bundlePath<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token keyword">const</span> bundleSize <span class="token operator">=</span> size <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>bundleSize <span class="token operator">&lt;</span> sizeLimit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Safe:Bundle-Size'</span><span class="token punctuation">,</span>bundleSize<span class="token punctuation">,</span><span class="token string">'\n Size Limit:'</span><span class="token punctuation">,</span>sizeLimit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Unsafe:Bundle-Size'</span><span class="token punctuation">,</span>bundleSize<span class="token punctuation">,</span><span class="token string">'\n Size Limit:'</span><span class="token punctuation">,</span>sizeLimit<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> BundlesizeWebpackPlugin<span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a class="anchor" href="#æ€»ç»“">#</a> æ€»ç»“</h3>
<p><strong>Loaders å…³æ³¨ä»£ç ä¸­çš„å•ä¸ªèµ„æºï¼ŒPlugins å…³æ³¨æ•´ä½“æµç¨‹ï¼Œå¯ä»¥æ¥è§¦åˆ° webpack æ„å»ºæµç¨‹ä¸­çš„<br />
å„ä¸ªé˜¶æ®µå¹¶åŠ«æŒåšä¸€äº›ä»£ç å¤„ç†ã€‚</strong></p>
<h1 id="nodeåç«¯æ¡†æ¶"><a class="anchor" href="#nodeåç«¯æ¡†æ¶">#</a> node åç«¯æ¡†æ¶</h1>
<h2 id="nodejsåç«¯æ¡†æ¶è°ƒç ”"><a class="anchor" href="#nodejsåç«¯æ¡†æ¶è°ƒç ”">#</a> Node.js åç«¯æ¡†æ¶è°ƒç ”</h2>
<p><strong>åç«¯æ¡†æ¶åº”è¯¥æ³¨æ„çš„ä¸‰å¤§é—®é¢˜</strong><br />
è·¯ç”± Routes<br />
 è¯·æ±‚ Request<br />
 å“åº” Response</p>
<h4 id="express"><a class="anchor" href="#express">#</a> Express</h4>
<p>å®˜æ–¹ç½‘å€ï¼š[https:l/expressis.com (https:expressis.com)<br />
<strong> å®‰è£…</strong><br />
å®˜æ–¹ç½‘å€ï¼š[<span class="exturl" data-url="aHR0cHM6Ly9leHByZXNzaXMuY29tL3poLWNuL3N0YXJ0ZXIvaW5zdGFsbGluZy5odG1s">https://expressis.com/zh-cn/starter/installing.html</span>](https:l/expressjs.com/zh-<br />
cn/starter/installing.html)<br />
 ä½¿ç”¨ç”Ÿæˆå™¨å®‰è£…ï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆä¸€ç³»åˆ—çš„è„šæ‰‹æ¶ä»£ç ï¼š[https:/expressjs.com/zh<br />
cn/starter/generator.htmll(<span class="exturl" data-url="aHR0cHM6Ly9leHByZXNzaXMuY29tL3poLWNuL3N0YXJ0ZXIvZ2VuZXJhdG9yLmh0bWw=">https://expressis.com/zh-cn/starter/generator.html</span>)</p>
<p><strong>ä¼˜ç‚¹</strong></p>
<p>å¿«é€Ÿç®€å•ã€æ˜“ä¸Šæ‰‹</p>
<p><strong>ç¼ºç‚¹</strong></p>
<ul>
<li>è·¯ç”±å“åº”ä¸­ï¼Œå¾ˆå¯èƒ½æœ‰ï¼šä»å¤–éƒ¨è¯·æ±‚æ•°æ®çš„æœåŠ¡ï¼Œæœ‰éªŒè¯è·¯ç”±çš„è¯·æ±‚å‚æ•°ï¼Œè¿”å›ç‰¹å®šçš„æ ¼å¼ã€‚</li>
<li>æ‰€æœ‰é€»è¾‘ä¸åˆ†é’çº¢çš‚ç™½çš„å†™åœ¨ä¸€èµ·ï¼å¾ˆå®¹æ˜“äº§ç”Ÿå†—é•¿çš„éš¾ä»¥ç»´æŠ¤çš„ä»£ç ã€‚</li>
<li>ä¸€äº›å¤§å‹å¿…å¤‡çš„æ¨¡å—ï¼Œå¦‚ç¬¬ä¸‰æ–¹æœåŠ¡åˆå§‹åŒ–ï¼Œå®‰å…¨ï¼Œæ—¥å¿—éƒ½æ²¡æœ‰æ˜ç¡®çš„æ ‡å‡†ã€‚</li>
</ul>
<p><strong>Express ä¸­é—´ä»¶ï¼š</strong></p>
<p>Express æ˜¯ä¸€ä¸ªåŸºäºä¸­é—´ä»¶çš„æ¡†æ¶ï¼Œå…¶ä½™ä»»åŠ¡éƒ½ä¼šåœ¨ä¸­é—´ä»¶ä¸­æ‰§è¡Œï¼Œä¸­é—´ä»¶æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ç»“æ„ï¼Œå…ˆå†™å…¥çš„ä»»åŠ¡å…ˆæ‰§è¡Œï¼Œä¸­é—´ä»¶çš„å†™æ³•æ˜¯ï¼šapp.use ()ï¼Œå½“è°ƒç”¨ä¸­é—´ä»¶æ—¶ï¼Œä¼šå‘ä¼ å…¥çš„å‡½æ•°ä¸­ä¼ å…¥ req,res å’Œ next å‡½æ•°ã€‚</p>
<p><strong>ä¸­é—´ä»¶å¯ä»¥å®Œæˆçš„ä»»åŠ¡</strong></p>
<ul>
<li>æ‰§è¡Œä»»ä½•ä»£ç ã€‚</li>
<li>å¯¹è¯·æ±‚å’Œå“åº”å¯¹è±¡è¿›è¡Œæ›´æ”¹ã€‚</li>
<li>ç»“æŸè¯·æ±‚ / å“åº”å¾ªç¯ã€‚</li>
<li>è°ƒç”¨å †æ ˆä¸­çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</li>
</ul>
<h4 id="koa2"><a class="anchor" href="#koa2">#</a> Koa2</h4>
<p><strong>å®˜ç½‘åœ°å€</strong>ï¼š[https:I/koajs.com (https:/koajs.com)</p>
<p><strong>Koa2 å’Œ Express çš„åŒºåˆ«</strong></p>
<ul>
<li>ä½¿ç”¨ Promise (async,await) ä»£æ›¿ callback (node&gt;v7.6.0)</li>
<li>ä½¿ç”¨ ctx (ä¸Šä¸‹æ–‡å¯¹è±¡) å°è£… req (Request) å’Œ res (Response), ä»¥åŠä¸€äº›å¸¸ç”¨çš„åŠŸèƒ½ã€‚</li>
<li><strong>å®Œå…¨ä¸åŒçš„ä¸­é—´ä»¶æœºåˆ¶</strong></li>
<li><strong>æ›´è½»é‡çº§ï¼Œæ²¡æœ‰æ†ç»‘ä»»ä½•ä¸­é—´ä»¶</strong></li>
<li>å®˜æ–¹æ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2tvYWpzL2tvYS9ibG9iL21hc3Rlci9kb2NzL2tvYS12cy1leHByZXNzLm1k">https://github.com/koajs/koa/blob/naster/docs/koa-vs-express.md</span></li>
</ul>
<p><strong>Koa2 ä¸­é—´ä»¶ï¼š</strong></p>
<ol>
<li>Koa2 ä¸­é—´ä»¶ï¼Œç”± Express çš„é˜Ÿåˆ—æ¨¡å‹ï¼ˆåŒæ­¥ï¼‰è½¬å˜ä¸ºæ´‹è‘±æ¨¡å‹ï¼Œå½“ç¨‹åºè¿è¡Œåˆ° <code>await next()</code>  çš„æ—¶å€™å°±ä¼šæš‚åœå½“å‰ç¨‹åºï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¤„ç†å®Œä¹‹åæ‰ä¼šä»”å›è¿‡å¤´æ¥ç»§ç»­å¤„ç†ã€‚</li>
<li>Koa2 æ´‹è‘±æ¨¡å‹è§£å†³çš„é—®é¢˜å°±æ˜¯ä¸€ä¸ªä¸­é—´ä»¶å¯ä»¥è°ƒç”¨å…¶ä»–ä¸­é—´ä»¶æ‰§è¡Œåï¼Œå†ç»§ç»­è‡ªå·±çš„æ“ä½œï¼ŒExpress æ¡†æ¶ä¸­ next () æ‰§è¡Œåå°±ç›´æ¥åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æ“ä½œï¼Œæ— æ³•é€€å›ã€‚</li>
</ol>
<p><img data-src="/images/Snipaste_2024-04-22_14-30-49.jpg" alt="Koa2ä¸­é—´ä»¶" /></p>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">PORT</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>Koa2 ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å“åº”æœºåˆ¶çš„ä¸åŒ</li>
<li>Express: æˆ‘ä»¬ç›´æ¥æ“ä½œçš„æ˜¯ res å¯¹è±¡ï¼Œç›´æ¥ res.send ä¹‹åå°±ç«‹å³å“åº”äº†ã€‚</li>
<li>Koa2: æ•°æ®çš„å“åº”æ˜¯é€šè¿‡ ctx.body è¿›è¡Œè®¾ç½®ï¼Œæ³¨æ„è¿™é‡Œä»…æ˜¯è®¾ç½®å¹¶æ²¡æœ‰ç«‹å³å“åº”ï¼Œè€Œæ˜¯åœ¨æ‰€æœ‰çš„ä¸­é—´ä»¶ç»“æŸä¹‹ååšäº†å“åº”ã€‚</li>
</ul>
<p>** ç¼ºç‚¹ï¼š**Koa2 åœ¨ä½¿ç”¨ä¸Šæœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼Œå› ä¸ºå¤ªè¿‡äºè½»é‡ä½¿å¾—åœ¨ä½¿ç”¨æ—¶éœ€è¦æ‰‹åŠ¨å¤„ç†å¾ˆå¤šæ“ä½œï¼Œå¯ä»¥ä½¿ç”¨åŸºäº Koa2 çš„ä¸Šå±‚æ¡†æ¶ï¼ˆå¦‚ï¼šegg.jsï¼‰</p>
<h4 id="eggjs"><a class="anchor" href="#eggjs">#</a> egg.js</h4>
<p><strong>Express å’Œ Koa2 çš„ä¸è¶³</strong></p>
<ul>
<li>ç®€å•è€Œä¸”æ‰©å±•æ€§å¼ºï¼Œé€‚åˆä¸ªäººçš„æ¯”è¾ƒå°çš„é¡¹ç›®</li>
<li>æ²¡æœ‰çº¦å®šï¼Œå¯¹äºç»Ÿä¸€ç»´æŠ¤å’Œå¼€å‘éå¸¸ä¸åˆ©</li>
</ul>
<p><strong>å¯¹äºåç«¯æ¡†æ¶çš„éœ€æ±‚</strong></p>
<ul>
<li>éœ€è¦æœ‰ä¸€å¥—ä¼˜ç§€çš„ç»Ÿä¸€çš„çº¦å®šæˆ–è€…æ¶æ„è¿›è¡Œå¼€å‘</li>
<li>æœ‰ä¸°å¯Œçš„æ‰©å±•æœºåˆ¶å’Œå¯å®šåˆ¶æ€§</li>
<li>Typescript æ”¯æŒ</li>
</ul>
<p><strong>egg.js</strong></p>
<ul>
<li>åœ°å€ï¼š[https:l/eggis.org/zh-cnI (https:l/eggjs.org/zh-cn) ï¼ˆåŸºäº Koa2ï¼‰</li>
<li>é˜¿é‡Œå¤§å‚å‡ºå“ï¼Œç»´æŠ¤æœ‰ä¿éšœã€‚å›½å†…å¼€å‘è€…å¼€å‘ï¼Œä¸­æ–‡æ–‡æ¡£è´¨é‡æœ‰ä¿è¯ã€‚</li>
<li><strong>çº¦å®šä¼˜äºé…ç½®ï¼ŒæŒ‰ç…§ä¸€å¥—ç»Ÿä¸€çš„çº¦å®šè¿›è¡Œåº”ç”¨å¼€å‘ã€‚</strong></li>
<li>ä¸€ä¸ªæ’ä»¶åªåšä¸€ä»¶äº‹ï¼Œé«˜åº¦å¯æ‰©å±•çš„æ’ä»¶æœºåˆ¶</li>
<li>æ”¯æŒ Typescript</li>
</ul>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>//nodejsç‰ˆæœ¬10ä»¥ä¸Š</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">npm</span> init egg <span class="token parameter variable">--type</span><span class="token operator">=</span>ts</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">npm</span> run dev</pre></td></tr></table></figure><p><strong>egg.js æ¦‚å¿µï¼š</strong></p>
<ul>
<li>
<p>Application - å…¨å±€åº”ç”¨å¯¹è±¡ï¼Œåªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚</p>
</li>
<li>
<p>Context - ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæ¯æ¬¡è¯·æ±‚ç”Ÿæˆä¸€ä¸ªå®ä¾‹ã€‚</p>
</li>
<li>
<p>Request - è¯·æ±‚å¯¹è±¡ï¼Œæ¥è‡ª Koaã€‚</p>
</li>
<li>
<p>Response - å“åº”å¯¹è±¡ï¼Œæ¥è‡ª Koa çš„ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚</p>
</li>
<li>
<p>Helper - ç”¨æ¥æä¾›ä¸€äº›å®ç”¨çš„ utility å‡½æ•°ã€‚æ¡†æ¶å†…ç½®äº†å‡ ä¸ªç®€å•çš„ Helper å‡½æ•°ã€‚</p>
</li>
</ul>
<h4 id="nestjs"><a class="anchor" href="#nestjs">#</a> Nest.js</h4>
<ul>
<li>åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm5lc3Rqcy5jbg==">https:/docs.nestjs.com</span></li>
<li>å†…ç½®å¹¶ä¸”å®Œå…¨æ”¯æŒ Typescript</li>
<li>å¼€ç®±å³ç”¨çš„åº”ç”¨ç¨‹åºæ¶æ„</li>
<li>å¯æ‰©å±•ï¼Œæ¾æ•£è€¦åˆ</li>
<li>å¤§é‡é‡‡ç”¨äº†è£…é¥°å™¨çš„å†™æ³• <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm5lc3Rqcy5jbi8xMC9vcGVuYXBpP2lkPSVlOCVhMyU4NSVlOSVhNSViMCVlNSU5OSVhOA==">Nest.js è£…é¥°å™¨</span></li>
</ul>
<h1 id="vueconfigjs"><a class="anchor" href="#vueconfigjs">#</a> vue.config.js</h1>
<p><strong>ä¸ªæ€§åŒ–æ„å»ºç»“æœ - vue.config,js</strong><br />
 åœ¨åŸºç¡€çš„é…ç½®ä¸Šï¼Œè‡ªå®šä¹‰æ„å»ºçš„ç»“æœ - å¯ä»¥ä½¿ç”¨ vue.config.js<br />
 æ–‡æ¡£åœ°å€ï¼šhttps:l/cli.vuejs.org/zh/config#vue-config-js<br />
 ç®€ä»‹ä¸¤ä¸ªå­—æ®µ<br />
<strong> PublicPath</strong> - éƒ¨ç½²åº”ç”¨åŒ…æ—¶çš„åŸºæœ¬ URL, è¿™ä¸ªé…ç½®å¯¹åº”çš„æ˜¯ webpack çš„ PublicPath å±æ€§ï¼Œé»˜è®¤å€¼ä¸º '/'ï¼ŒVue CLI ä¼šå‡è®¾ä½ çš„åº”ç”¨æ˜¯è¢«éƒ¨ç½²åœ¨ä¸€ä¸ªåŸŸåçš„æ ¹è·¯å¾„ä¸Š https://abc.com/ã€‚å¯ä»¥è®¾ç½®ä¸ºå­è·¯å¾„ - å¦‚æœä½ çš„åº”ç”¨è¢«éƒ¨ç½²åœ¨ https:abc,com/sub/ é‚£ä¹ˆå°±è®¾ç½®ä¸º '/sub'ï¼Œå¯ä»¥è®¾ç½®ä¸º CDN è·¯å¾„ - åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ï¼Œæœ€åé™æ€èµ„æºæ˜¯è¦å…¨éƒ¨ä¸Šä¼ åˆ° CDN çš„ï¼Œï¼ˆè„šæ‰‹æ¶è‡ªåŠ¨å®Œæˆ)ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥è®¾ç½®ä¸ºä¸€ä¸ª cDN åŸŸå -'https:l/oss.imooc-Iego.com/editor'<br />
 è¿˜å¯ä»¥è®¾ç½®ä¸ºç»å¯¹è·¯å¾„ ('' æˆ–è€… './')ï¼Œè¿™æ ·æ‰€æœ‰çš„èµ„æºéƒ½ä¼šè¢«é“¾æ¥ä¸ºç›¸å¯¹è·¯å¾„</p>
<p><strong>css.loaderOptions</strong> å±æ€§<br />
å‘ CSS ç›¸å…³çš„ loader ä¼ é€’é€‰é¡¹<br />
 Ant-design-vue çš„æ ·å¼å˜é‡ï¼šhttps:lww,antd,com docs/vue/customize-theme-cn<br />
<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Z1ZUNvbXBvbmVudC9hbnQtZGVzaWduLXZ1ZS9ibG9iL21hc3Rlci9jb21wb25lbnRzL3N0eWxlL3RoZW1lcy9kZWZhdWx0Lmxlc3M=">https://github.com/vueComponent/ant-design-vue/blob/master/components/style/themes/default.less</span><br />
 æ·»åŠ æ›´å¤šçš„ CSS é¢„å¤„ç†å™¨ï¼š<br />
<span class="exturl" data-url="aHR0cHM6Ly9jbGkudnVlanMub3JnL3poL2d1aWRlL2Nzcy5odG1sIyVFOSVBMiU4NCVFNSVBNCU4NCVFNyU5MCU4NiVFNSU5OSVBOA==">https://cli.vuejs.org/zh/guide/css.html# é¢„å¤„ç†å™¨</span><br />
ç‰¹åˆ«æ³¨æ„ less å’Œ Iess-loader çš„ç‰ˆæœ¬é—®é¢˜ã€‚ä¸è¦è£…æœ€æ–°çš„ï¼Œå»ºè®®é€‰ç”¨ï¼š</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//vue.config.js é…ç½®ï¼š</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> isstaging <span class="token operator">=</span> <span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_STAGINE</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> isProduction <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token string">'production'</span></pre></td></tr><tr><td data-num="4"></td><td><pre>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token operator">/</span>ç”Ÿäº§ç¯å¢ƒè¦ä½¿ç”¨0SSåœ°å€</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token operator">/</span>å…¶ä»–ç¯å¢ƒéƒ½ä½¿ç”¨ç»å¯¹è·¯å¾„</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token literal-property property">publicPath</span><span class="token operator">:</span><span class="token punctuation">(</span>isProduction <span class="token number">6</span> <span class="token operator">!</span>isStaging<span class="token punctuation">)</span>'https<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">oss.imooc-lego.com</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token literal-property property">css</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    	<span class="token literal-property property">loaderOptions</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    	<span class="token literal-property property">less</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    		<span class="token literal-property property">lessoptions</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    			<span class="token literal-property property">modifyVars</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>          		 <span class="token string-property property">'primary-color'</span><span class="token operator">:</span><span class="token string">'#3E7FFF'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    			<span class="token punctuation">&#125;</span>ï¼Œ</pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token literal-property property">javascriptEnabled</span><span class="token operator">:</span><span class="token boolean">true</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        	<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token comment">// æ‰“åŒ…æ—¶å¿½ç•¥å¯¹åº”çš„æ–‡ä»¶</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token literal-property property">resourceRegExp</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.\/locale$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token literal-property property">contextRegExp</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    	<span class="token keyword">if</span><span class="token punctuation">(</span>isAnalyzeMode<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    		config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    			<span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token comment">// æ·»åŠ æ‰“åŒ…åçš„æ–‡ä»¶åˆ†æå·¥å…·ï¼ˆBundleAnalyzerPluginï¼‰</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    				<span class="token literal-property property">analyzerMode</span> <span class="token operator">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    			<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    		<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="é¡¹ç›®æ„å»ºä¼˜åŒ–"><a class="anchor" href="#é¡¹ç›®æ„å»ºä¼˜åŒ–">#</a> é¡¹ç›®æ„å»ºä¼˜åŒ–</h1>
<p><strong>å¥½ç”¨çš„ webpack æ’ä»¶:webpack-bundle-analyzer</strong></p>
<p>å¯è§†åŒ– webpack æ‰“åŒ…åçš„å·¥å…·åŒ…å¤§å°ï¼Œä¾¿äºåˆ†æä¾èµ–å’Œè¿›è¡Œé¡¹ç›®ä¼˜åŒ–ã€‚å¦‚ä¸Š vue.config.js ä¸­é…ç½®ã€‚</p>
<p><strong>æ ¹æ®å›¾è¡¨çš„ä¼˜åŒ–æ­¥éª¤</strong></p>
<p>ä¸€ã€çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆé‡å¤çš„æ¨¡å—ï¼Œæˆ–è€…æ²¡æœ‰ç”¨çš„æ¨¡å—è¢«æ‰“åŒ…åˆ°äº†æœ€ç»ˆçš„ä»£ç ä¸­<br />
äºŒã€çœ‹çœ‹ package.json, å¯¹æ¯”ä¸€ä¸‹æ˜¯å¦æœ‰åº”è¯¥åœ¨ devDeps çš„æ¨¡å—ï¼Œè¢«é”™è¯¯çš„æ”¾ç½®åˆ°äº† deps å½“ä¸­<br />
ä¸‰ã€æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤åŠ è½½çš„æ¨¡å—ï¼Œæˆ–è€…æ˜¯åŠŸèƒ½å¤§ä½“ç›¸åŒçš„æ¨¡å—ã€‚<br />
æ¯”å¦‚ï¼šä½¿ç”¨<strong> es</strong> ç‰ˆæœ¬çš„ç¬¬ä¸‰æ–¹åº“ï¼Œäº«å— tree-shaking çš„çº¢åˆ©ã€‚<br />
å››ã€æ£€æŸ¥æ˜¯å¦æœ‰æ²¡æœ‰ç”¨çš„æ¨¡å—æ˜¯å¦æ‰“åŒ…åˆ°äº†æœ€ç»ˆçš„æ–‡ä»¶ä¸­ï¼Œé€šè¿‡å¦‚ä¸‹æ’ä»¶å¿½ç•¥å¯¹åº”çš„æ–‡ä»¶ï¼Œä»è€Œ tree-shaking æ‰å¿½ç•¥çš„æ–‡ä»¶ï¼ˆå¦‚å›½é™…åŒ–éœ€è¦çš„å„ç§è¯­è¨€åŒ…ï¼‰, è¯¦ç»†é…ç½®å¦‚ä¸Š vue.config.js ä¸­ã€‚</p>
<p>webpack ignore pluginï¼š <span class="exturl" data-url="aHR0cHM6Ly93ZWJwYWNrLmpzLm9yZ2xwbHVnaW5zL2lnbm9yZS1wbHVnaW4vI3Jvb3Q=">https://webpack.js.orglplugins/ignore-plugin/#root</span></p>
<p><strong>å°†ä¸‰æ–¹åº“ä¸­å…¨éƒ¨å¯¼å…¥æ›´æ¢ä¸ºæŒ‰éœ€å¯¼å…¥</strong></p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>Input<span class="token punctuation">,</span>Dropdown<span class="token punctuation">,</span>Slider<span class="token punctuation">,</span>Select<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'Antd-vue'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> components <span class="token operator">=</span> <span class="token punctuation">[</span>Input<span class="token punctuation">,</span>Dropdown<span class="token punctuation">,</span>Slider<span class="token punctuation">,</span>Select<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    components<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        app<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">&#123;</span> install <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// åœ¨ main.js ä¸­å¯¼å…¥ï¼Œç„¶å app.use</span></pre></td></tr></table></figure><p><strong>æµè§ˆå™¨ç¼“å­˜ä¼˜åŒ–</strong></p>
<p>ä¸€ã€é¡¹ç›®å³ä½¿æ˜¯ä¸Šçº¿ä¹‹åä¹Ÿä¼šåœ¨åç»­è¿½åŠ æˆ–ä¿®æ”¹ä»£ç ï¼Œå¦‚æœåˆ†åŒ…è¾ƒå°‘é‡æ–°ä¸Šçº¿åå°±ä¸èƒ½ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜çš„æ–‡ä»¶ï¼Œå½“åˆ†åŒ…æ•°é‡è¾ƒå¤šæ—¶ï¼Œå°±å¯ä»¥å……åˆ†åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ã€‚</p>
<p>äºŒã€åˆ†åŒ…è¾ƒå¤šæ—¶å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ”¯æŒå¹³è¡ŒåŠ è½½å¤šä¸ªæ–‡ä»¶çš„ç‰¹æ€§ã€‚ï¼ˆHTTP1 å¯¹åŒä¸€åŸŸåå¹¶è¡Œè¯·æ±‚çš„ä¸ªæ•°è¿›è¡Œäº†é™åˆ¶ï¼ŒHTTP2 å®Œå…¨çªç ´äº†è¿™ä¸ªé™åˆ¶ï¼‰</p>
<p><strong>æ‰‹åŠ¨åˆ†å‰²ç¬¬ä¸‰æ–¹åº“ä¸ºå¤šä¸ªæ–‡ä»¶</strong></p>
<p>webpack çš„ config.optimization ä¸­è‡ªå¸¦ä¸€äº›ä¼˜åŒ–çš„é…ç½®é¡¹ï¼š</p>
<ul>
<li>minimizeï¼šå‹ç¼©</li>
<li>splitChunksï¼šåˆ†åŒ…ï¼ˆå¯ä»¥é…ç½® minSize ç­‰ï¼‰</li>
<li>ç­‰ç­‰</li>
</ul>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//vue.config.js é…ç½®ï¼š</span></pre></td></tr><tr><td data-num="2"></td><td><pre>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">//.... çœç•¥</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function-variable function">configureWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        config<span class="token punctuation">.</span>optimization<span class="token punctuation">.</span>splitChunks <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">300</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token literal-property property">antVendor</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ant-design-vue'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/](ant-design-vue)[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token literal-property property">canvasVendor</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                    <span class="token literal-property property">name</span><span class="token operator">:</span> 'html2canvas<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/](html2canvas)[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token literal-property property">vendor</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/](!html2canvas)(!ant-design-vue)[\\/]</span><span class="token regex-delimiter">/</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                all <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// åŒ¹é…å…¨éƒ¨çš„ node_modules ä¸­çš„æ–‡ä»¶</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                	<span class="token function">name</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">const</span> packageName <span class="token operator">=</span> module<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/](.*?)([\\/]|$)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>packageName<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'@'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span></pre></td></tr><tr><td data-num="26"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="é¡¹ç›®è¿è¡Œä¼˜åŒ–"><a class="anchor" href="#é¡¹ç›®è¿è¡Œä¼˜åŒ–">#</a> é¡¹ç›®è¿è¡Œä¼˜åŒ–</h1>
<p><strong>è·¯ç”±æ‡’åŠ è½½</strong></p>
<p>ä½¿ç”¨ import å‡½æ•°åŠ¨æ€åŠ è½½ï¼Œé…åˆé­”æ³•æ³¨é‡Šå¯ä»¥å’Œ webpack ä¸­çš„ bundler ç›¸é…åˆä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "my-lodash" */</span> <span class="token string">'lodash'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">lodash</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>     <span class="token comment">// ....</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>æ”¹å˜ HTML æ ‡é¢˜ï¼Œå¢å¼º SEO</strong></p>
<p>é¡¹ç›®ä¸­åŠ¨æ€æ·»åŠ æ ‡é¢˜çš„åŸç†ï¼šä½¿ç”¨ HtmlWebpackPlugin æ’ä»¶ï¼Œæ’å…¥åŠ¨æ€ js è¯­å¥è¿›è¡Œå ä½ï¼Œç„¶åé€šè¿‡é¡¹ç›®ä¸­ package.json ä¸­çš„ name è¿›è¡Œæ›¿æ¢ã€‚</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//vue.config.js é…ç½®ï¼š</span></pre></td></tr><tr><td data-num="2"></td><td><pre>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">//.... çœç•¥</span></pre></td></tr><tr><td data-num="4"></td><td><pre>   <span class="token function-variable function">chainWebpack</span><span class="token operator">:</span> <span class="token parameter">config</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>       config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>           args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">'ç½‘ç«™æ ‡é¢˜'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>           args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> <span class="token string">'ç½‘ç«™è¯¦æƒ…æè¿°'</span></pre></td></tr><tr><td data-num="8"></td><td><pre>           <span class="token keyword">return</span> args<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>       <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>   <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// è®°å¾—æ·»åŠ  &lt;meta name="viewport" content="&lt;%= htmlWebpackPlugin.options.desc %>"></span></pre></td></tr></table></figure><p><strong>åŒæ„æ¸²æŸ“æ–¹å¼</strong><br />
æœåŠ¡ç«¯æ¸²æŸ“å’Œå®¢æˆ·ç«¯æ¸²æŸ“çš„åŒºåˆ«å°±åœ¨äºåœ¨å“ªé‡Œå®Œæˆ html å®Œæ•´æ–‡ä»¶çš„æ‹¼æ¥ï¼š</p>
<h3 id="å®¢æˆ·ç«¯æ¸²æŸ“"><a class="anchor" href="#å®¢æˆ·ç«¯æ¸²æŸ“">#</a> å®¢æˆ·ç«¯æ¸²æŸ“</h3>
<p>å®¢æˆ·ç«¯æ¸²æŸ“ç”±å®¢æˆ·ç«¯å®Œæˆ html æ–‡ä»¶çš„æ‹¼æ¥ï¼ŒæœåŠ¡ç«¯åªè´Ÿè´£æä¾›æ•°æ®ã€‚</p>
<ul>
<li>ä¼˜åŠ¿ï¼šé¦–å±åŠ è½½å¿«</li>
<li>åŠ£åŠ¿ï¼šä¸åˆ©äº SEO</li>
</ul>
<h3 id="æœåŠ¡ç«¯æ¸²æŸ“"><a class="anchor" href="#æœåŠ¡ç«¯æ¸²æŸ“">#</a> æœåŠ¡ç«¯æ¸²æŸ“</h3>
<p>æœåŠ¡ç«¯æ¸²æŸ“ç”±æœåŠ¡ç«¯å®Œæˆ html æ–‡ä»¶çš„å‡­å€Ÿï¼Œå®¢æˆ·ç«¯ç›´æ¥æ¸²æŸ“å³å¯</p>
<ul>
<li>ä¼˜åŠ¿ï¼šåˆ©äº SEOï¼Œ</li>
<li>åŠ£åŠ¿ï¼šç™½å±é—®é¢˜ï¼ˆè·å– html æ–‡ä»¶è¾ƒæ…¢ï¼‰ï¼ŒæœåŠ¡ç«¯å‹åŠ›å¤§ï¼Œå ç”¨ CPU èµ„æºã€‚</li>
</ul>
<h3 id="åŒæ„æ¸²æŸ“"><a class="anchor" href="#åŒæ„æ¸²æŸ“">#</a> åŒæ„æ¸²æŸ“</h3>
<p>æœåŠ¡ç«¯å…ˆé€šè¿‡æœåŠ¡ç«¯æ¸²æŸ“ï¼Œç”Ÿæˆ html ä»¥åŠåˆå§‹åŒ–æ•°æ®ï¼Œå®¢æˆ·ç«¯æ‹¿åˆ°ä»£ç å’Œåˆå§‹åŒ–æ•°æ®ï¼Œåœ¨å®¢æˆ·ç«¯è¿›è¡Œæ¿€æ´»æ¸²æŸ“ã€‚</p>
<ul>
<li>ä¼˜åŠ¿ï¼šå…¼å®¹äº†å‰ç«¯æ¸²æŸ“çš„å¤§éƒ¨åˆ†ä¼˜ç‚¹ï¼ˆèŠ‚çœæœåŠ¡ç«¯èµ„æºã€å¤šç»ˆç«¯é€‚é…æ¸²æŸ“ã€å±€éƒ¨åˆ·æ–°ç­‰ï¼‰ï¼ŒåŒæ—¶ä¹Ÿå…·æœ‰æœåŠ¡ç«¯æ¸²æŸ“é¦–å±åŠ è½½å¿«ï¼ŒSEO æ”¯æŒå¥½çš„ç‰¹ç‚¹ã€‚</li>
<li>åŠ£åŠ¿ï¼šæœåŠ¡ç«¯å¿…é¡»æ˜¯è¦ js æ”¯æŒçš„è¯­è¨€ï¼Œå¢åŠ äº†æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚åº¦å’Œç»´æŠ¤æˆæœ¬ã€‚</li>
</ul>
<h3 id="ssgé¢„æ¸²æŸ“"><a class="anchor" href="#ssgé¢„æ¸²æŸ“">#</a> SSG é¢„æ¸²æŸ“</h3>
<p><strong>é™æ€ç«™ç‚¹ç”Ÿæˆ</strong> (Static-Site Generationï¼Œç¼©å†™ä¸º SSG)ï¼Œä¹Ÿè¢«ç§°ä¸ºé¢„æ¸²æŸ“ï¼Œæ˜¯å¦ä¸€ç§æµè¡Œçš„æ„å»ºå¿«é€Ÿç½‘ç«™çš„æŠ€æœ¯ã€‚</p>
<ul>
<li>
<p>å¦‚æœç”¨æœåŠ¡ç«¯æ¸²æŸ“ä¸€ä¸ªé¡µé¢æ‰€éœ€çš„æ•°æ®å¯¹æ¯ä¸ªç”¨æˆ·æ¥è¯´éƒ½æ˜¯ç›¸åŒçš„ï¼Œé‚£å°±å¯ä»¥åªæ¸²æŸ“ä¸€æ¬¡ï¼Œæå‰åœ¨æ„å»ºè¿‡ç¨‹ä¸­å®Œæˆï¼Œè€Œä¸æ˜¯æ¯æ¬¡è¯·æ±‚è¿›æ¥éƒ½é‡æ–°æ¸²æŸ“é¡µé¢ã€‚é¢„æ¸²æŸ“çš„é¡µé¢ç”Ÿæˆåä½œä¸ºé™æ€ HTML æ–‡ä»¶è¢«æœåŠ¡å™¨æ‰˜ç®¡ã€‚</p>
</li>
<li>
<p>SSG ä¿ç•™äº†å’Œ SSR åº”ç”¨ç›¸åŒçš„æ€§èƒ½è¡¨ç°ï¼šå®ƒå¸¦æ¥äº†ä¼˜ç§€çš„é¦–å±åŠ è½½æ€§èƒ½ã€‚åŒæ—¶ï¼Œå®ƒæ¯” SSR åº”ç”¨çš„èŠ±é”€æ›´å°ï¼Œä¹Ÿæ›´å®¹æ˜“éƒ¨ç½²ï¼Œå› ä¸ºå®ƒè¾“å‡ºçš„æ˜¯é™æ€ HTML å’Œèµ„æºæ–‡ä»¶ã€‚è¿™é‡Œçš„å…³é”®è¯æ˜¯<strong>é™æ€</strong>ï¼šSSG ä»…å¯ä»¥ç”¨äºæ¶ˆè´¹é™æ€æ•°æ®çš„é¡µé¢ï¼Œå³æ•°æ®åœ¨æ„å»ºæœŸé—´å°±æ˜¯å·²çŸ¥çš„ï¼Œå¹¶ä¸”åœ¨å¤šæ¬¡éƒ¨ç½²æœŸé—´ä¸ä¼šæ”¹å˜ã€‚æ¯å½“æ•°æ®å˜åŒ–æ—¶ï¼Œéƒ½éœ€è¦é‡æ–°éƒ¨ç½²ã€‚</p>
</li>
<li>
<p>å¦‚æœä½ è°ƒç ” SSR åªæ˜¯ä¸ºäº†ä¼˜åŒ–ä¸ºæ•°ä¸å¤šçš„è¥é”€é¡µé¢çš„ SEO (ä¾‹å¦‚ /ã€/about å’Œ /contact ç­‰)ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦ SSG è€Œä¸æ˜¯ SSRã€‚SSG ä¹Ÿéå¸¸é€‚åˆæ„å»ºåŸºäºå†…å®¹çš„ç½‘ç«™ï¼Œæ¯”å¦‚æ–‡æ¡£ç«™ç‚¹æˆ–è€…åšå®¢ã€‚<span class="exturl" data-url="aHR0cHM6Ly9saW5rLmp1ZWppbi5jbj90YXJnZXQ9aHR0cHMlM0ElMkYlMkZ2aXRlcHJlc3MuZGV2JTJG">VitePress</span> å°±æ˜¯ä¸€ä¸ªç”± Vite å’Œ Vue é©±åŠ¨çš„é™æ€ç«™ç‚¹ç”Ÿæˆå™¨ã€‚</p>
</li>
</ul>
<p><span class="exturl" data-url="aHR0cHM6Ly9saW5rLmp1ZWppbi5jbj90YXJnZXQ9aHR0cHMlM0ElMkYlMkZnaXRodWIuY29tJTJGdml0ZWpzJTJGdml0ZS1wbHVnaW4tdnVlJTJGYmxvYiUyRm1haW4lMkZwbGF5Z3JvdW5kJTJGc3NyLXZ1ZSUyRnByZXJlbmRlci5qcw==">Vite è„šæ‰‹æ¶æ¸²æŸ“ SSG ä»£ç ç¤ºä¾‹</span>ã€‚</p>
<h1 id="éƒ¨ç½²ä¸httpä¼˜åŒ–"><a class="anchor" href="#éƒ¨ç½²ä¸httpä¼˜åŒ–">#</a> éƒ¨ç½²ä¸ HTTP ä¼˜åŒ–</h1>
<h3 id="éƒ¨ç½²"><a class="anchor" href="#éƒ¨ç½²">#</a> <strong>éƒ¨ç½²</strong></h3>
<p><strong>å‰ç«¯éƒ¨ç½²ï¼šhttps:llci,uejs,org/zh/guide/deployment.html</strong></p>
<p>åŸç†å°±æ˜¯ï¼šå°†æ„å»ºç”Ÿæˆçš„äº§ç‰©ç›´æ¥çƒ¤è´åˆ°ä»»ä½•çš„é™æ€æ–‡ä»¶æœåŠ¡å™¨å½“ä¸­ã€‚</p>
<p><strong>åç«¯éƒ¨ç½²ï¼šhttps:/eggis.org/zh-cn/core/deployment.html</strong></p>
<p>å‡ ä¹æ²¡æœ‰æ„å»ºè¿‡ç¨‹ï¼šé™¤éä½ ç”¨äº† typescript ç­‰éœ€è¦ç¼–è¯‘çš„è¯­è¨€ã€‚</p>
<ul>
<li>
<p>æ–¹æ¡ˆä¸€ï¼šç›´æ¥å°†æœ¬åœ°çš„æºä»£ç æ‰“ä¸ªå‹ç¼©åŒ…æ‹·è´åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œç„¶åå¯åŠ¨æœåŠ¡å™¨ã€‚</p>
</li>
<li>
<p>æ–¹æ¡ˆäºŒï¼šåœ¨æœåŠ¡å™¨ä¸­ç›´æ¥ pu å·æºä»£ç ï¼Œinstall,. ç„¶åå¯åŠ¨æœåŠ¡å™¨ã€‚</p>
</li>
</ul>
<h3 id="nginxåå‘ä»£ç†"><a class="anchor" href="#nginxåå‘ä»£ç†">#</a> <strong>Nginx: åå‘ä»£ç†</strong></h3>
<p><strong>Nginx</strong> ä½œä¸ºæœåŠ¡å™¨è½¯ä»¶ï¼Œå®ƒçš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç‰¹åˆ«é€‚åˆå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®</li>
<li>ä¿è¯å®‰å…¨</li>
<li>éå¸¸å¿«</li>
<li>æ”¯æŒè´Ÿè½½å‡è¡¡</li>
</ul>
<p>ä½¿ç”¨ï¼š</p>
<ul>
<li>å®‰è£… nginx</li>
<li>nginx    å‘½ä»¤å¯åŠ¨æœåŠ¡å™¨</li>
<li>nginx -s stop    å‘½ä»¤å…³é—­æœåŠ¡å™¨</li>
<li>nginx -v      å‘½ä»¤æŸ¥çœ‹é…ç½®ä¿¡æ¯</li>
<li>nginx -s reload      å‘½ä»¤é‡å¯æœåŠ¡</li>
<li>é…ç½® nginx.conf æ–‡ä»¶</li>
</ul>
<h3 id="httpç¼“å­˜"><a class="anchor" href="#httpç¼“å­˜">#</a> <strong>HTTP ç¼“å­˜</strong></h3>
<p>ï¼ˆè‹¥æœåŠ¡å™¨ä½¿ç”¨ nginxï¼Œåˆ™åœ¨ nginx.conf ä¸­é…ç½®ï¼‰</p>
<p>Expires <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRUUC9IZWFkZXJzL0V4cGlyZXM=">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Expires</span><br />
<strong>Expires å“åº”å¤´åŒ…å«æ—¥æœŸ / æ—¶é—´ï¼Œå³åœ¨æ­¤æ—¶å€™ä¹‹åï¼Œå“åº”è¿‡æœŸ</strong><br />
ä½¿ç”¨ nginx æ·»åŠ å¯¹åº”çš„å“åº”å¤´ï¼šexpires æŒ‡ä»¤<br />
æ–‡æ¡£åœ°å€ï¼šhttp:l/nginx.org/en/docs/http/ngx http headers module.html</p>
<p>ä½†æ˜¯ç”±äºå®¢æˆ·ç«¯æ—¶é—´å’Œç”¨æˆ·ç«¯æ—¶é—´å¹¶ä¸æ€»æ˜¯ç›¸åŒçš„ï¼Œäºæ˜¯æœ‰äº† Cache-Controlï¼š</p>
<p><strong>Cache-Control</strong>: é€šç”¨æ¶ˆæ¯å¤´å­—æ®µï¼Œè¢«ç”¨äºåœ¨ http è¯·æ±‚å’Œå“åº”ä¸­ï¼Œé€šè¿‡æŒ‡å®šæŒ‡ä»¤æ¥å®ç°ç¼“å­˜æœºåˆ¶ã€‚<br />
æ–‡æ¡£åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXI=">https://developer</span> <span class="exturl" data-url="aHR0cDovL21vemlsbGEub3JnL3poLUNOL2RvY3MvV2ViL0hUVFAvSGVhZGVycy9DYWNoZS1Db250cm9s">mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control</span></p>
<p>*<strong>Etag</strong>:ETagHTTP å“åº”å¤´æ˜¯èµ„æºçš„ç‰¹å®šç‰ˆæœ¬çš„æ ‡è¯†ç¬¦ã€‚è¿™å¯ä»¥è®©ç¼“å­˜æ›´é«˜æ•ˆï¼Œå¹¶èŠ‚çœå¸¦å®½<br />
å› ä¸ºå¦‚æœå†…å®¹æ²¡æœ‰æ”¹å˜ï¼ŒWb æœåŠ¡å™¨ä¸éœ€è¦å‘é€å®Œæ•´çš„å“åº”ï¼Œç›´æ¥è¿”å› 304 è¡¨ç¤ºå¯ä»¥ä½¿ç”¨ç¼“å­˜æ–‡ä»¶ã€‚<br />
* æ–‡æ¡£åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRUUC9IZWFkZXJzL0VUYWc=">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag</span><br />
<strong>Last-Modified</strong>: æ˜¯ä¸€ä¸ªå“åº”é¦–éƒ¨ï¼Œå…¶ä¸­åŒ…å«æºå¤´æœåŠ¡å™¨è®¤å®šçš„èµ„æºåšå‡ºä¿®æ”¹çš„æ—¥æœŸåŠæ—¶é—´ã€‚<br />
æ–‡æ¡£åœ°å€ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRUUC9IZWFkZXJzL0xhc3QtTW9kaWZpZWQ=">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified</span><br />
nginx Etag:<span class="exturl" data-url="aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfY29yZV9tb2R1bGUuaHRtbCNldGFn">http://nginx.org/en/docs/http/ngx_http_core_module.html#etag</span><br />
304 Not Modified <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSElUUC9TdGF0dXMvMzA0">https://developer.mozilla.org/zh-CN/docs/Web/HITP/Status/304</span></p>
<p>æµè§ˆå™¨ä½¿ç”¨ç¼“å­˜ï¼š</p>
<p><img data-src="/images/image.png" alt="/images/image.png" /></p>
<h3 id="å‹ç¼©ç®—æ³•"><a class="anchor" href="#å‹ç¼©ç®—æ³•">#</a> å‹ç¼©ç®—æ³•</h3>
<p>å‹ç¼©æ¯”å¯¹ç…§è¡¨<br />
<span class="exturl" data-url="aHR0cHM6Ly9xdWl4ZGIuZ2l0aHViLmlvL3NxdWFzaC1iZW5jaG1hcmsvI3JhdGlvLXZzLWNvbXByZXNzaW9u"> https://quixdb.github.io/squash-benchmark/#ratio-vs-compression</span></p>
<h4 id="gzip"><a class="anchor" href="#gzip">#</a> gzip</h4>
<p><strong>ä¸€ã€åŠ¨æ€å‹ç¼©ï¼ˆæœåŠ¡å™¨åœ¨è¿”å›é™æ€æ–‡ä»¶ä¹‹å‰ï¼Œç”±æœåŠ¡å™¨å¯¹æ¯ä¸ªè¯·æ±‚å‹ç¼©åå†è¿›è¡Œè¾“å‡ºï¼‰</strong></p>
<p>nginx ä¸­å¯ç”¨ gzipï¼šåœ¨ nginx.conf ä¸­é…ç½®ï¼š</p>
<ul>
<li>gzip  on;        å¼€å¯ gzip</li>
<li>gzip_types     text/plain  application/javascript              è®¾ç½®é‚£äº›æ–‡ä»¶éœ€è¦å‹ç¼©</li>
<li>gzip_min_length   1k;         å°äºè®¾ç½®å€¼ä¸ä¼šå‹ç¼©</li>
<li>gzip_comp_level     1;          å‹ç¼©çº§åˆ«</li>
<li>ç­‰ç­‰</li>
</ul>
<p><strong>äºŒã€é™æ€å‹ç¼©ï¼ˆæœåŠ¡å™¨ç›´æ¥ä½¿ç”¨å‹ç¼©æ–‡ä»¶è¿›è¡Œè¾“å‡ºï¼‰</strong></p>
<p>ä¸¤ä¸ªæ­¥éª¤</p>
<ul>
<li>ç”Ÿæˆå‹ç¼©æ–‡ä»¶ï¼ˆgzip å‘½ä»¤æˆ–ä½¿ç”¨ webpack æ’ä»¶ compression-webpack-pluginï¼‰</li>
<li>åœ¨ nginÃ— å¼€å¯æ”¯æŒé™æ€å‹ç¼©çš„æ¨¡å—ï¼ˆä¾‹å¦‚ gzip_static  :  onï¼‰</li>
</ul>
<h4 id="brotli"><a class="anchor" href="#brotli">#</a> Brotli</h4>
<p><strong>ä¸€ã€åŠ¨æ€å‹ç¼©ï¼ˆæœåŠ¡å™¨åœ¨è¿”å›é™æ€æ–‡ä»¶ä¹‹å‰ï¼Œç”±æœåŠ¡å™¨å¯¹æ¯ä¸ªè¯·æ±‚å‹ç¼©åå†è¿›è¡Œè¾“å‡ºï¼‰</strong></p>
<p><strong>ä½¿ç”¨å‰æ</strong><br />
æµè§ˆå™¨æ”¯æŒï¼šhttps:caniuse.com/brotli<br />
<strong>HTTPS åè®®</strong><br />
 NGINX å¯¹åº”çš„æ¨¡å—ï¼šhttps:/github.com/google/nginx/brotli</p>
<p>nginx ä¸­å¯ç”¨ Brotliï¼šåœ¨ nginx.conf ä¸­é…ç½®ï¼š</p>
<ul>
<li>brotli  on;        å¼€å¯ Brotli</li>
<li>brotli_types     text/plain  application/javascript              è®¾ç½®é‚£äº›æ–‡ä»¶éœ€è¦å‹ç¼©</li>
<li>ç­‰ç­‰</li>
</ul>
<p><strong>äºŒã€é™æ€å‹ç¼©ï¼ˆæœåŠ¡å™¨ç›´æ¥ä½¿ç”¨å‹ç¼©æ–‡ä»¶è¿›è¡Œè¾“å‡ºï¼Œå¦‚ä¸Šã€‚ï¼‰</strong></p>
<h3 id="httpä¼˜åŒ–"><a class="anchor" href="#httpä¼˜åŒ–">#</a> HTTP ä¼˜åŒ–</h3>
<p>HTTP æ˜¯å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šï¼Œæ‰€ä»¥<strong> HTTP åè®®çš„ç“¶é¢ˆåŠå…¶ä¼˜åŒ–æŠ€å·§éƒ½æ˜¯åŸºäº TCP åè®®æœ¬èº«çš„ç‰¹æ€§</strong>ï¼Œä¾‹å¦‚ tcp å»ºç«‹è¿æ¥çš„ 3 æ¬¡æ¡æ‰‹å’Œæ–­å¼€è¿æ¥çš„ 4 æ¬¡æŒ¥æ‰‹ä»¥åŠæ¯æ¬¡å»ºç«‹è¿æ¥å¸¦æ¥çš„å»¶è¿Ÿæ—¶é—´ã€‚æ‰€ä»¥å‡å°‘è¿™äº›é‡æ–°æ¡æ‰‹å’Œè‡³å…³é‡è¦ã€‚</p>
<h4 id="keepaliveå±æ€§"><a class="anchor" href="#keepaliveå±æ€§">#</a> keepAlive å±æ€§</h4>
<p>keepAlive å±æ€§å¯ä»¥ä¿æŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å»ºç«‹çš„ä¼šè¯è¿æ¥ï¼Œå¼€å¯ä¹‹åé™¤é¦–æ¬¡å»ºç«‹è¿æ¥å¤–çš„å…¶ä»–è¯·æ±‚ä¸ä¼šè¿›è¡Œ<strong> DNS Lookup</strong>ï¼ˆNDS åŸŸåè§£æï¼‰å’Œ<strong> Initial connection</strong>ï¼ˆä¸‰æŠ¥æ–‡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼‰ï¼Œå¯ä»¥åœ¨æœåŠ¡ç«¯æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ã€‚</p>
<p><strong>KeepAlive çš„ä¼˜ç‚¹</strong></p>
<ul>
<li>TCP è¿æ¥æ›´å°‘ï¼Œè¿™æ ·å°±ä¼šèŠ‚çº¦ TCP è¿æ¥åœ¨å»ºç«‹ã€é‡Šæ”¾è¿‡ç¨‹ä¸­ï¼Œä¸»æœºå’Œè·¯ç”±å™¨ä¸Šçš„ CPU å’Œå†…å­˜å¼€é”€ã€‚</li>
<li>ç½‘ç»œæ‹¥å¡ä¹Ÿå‡å°‘äº†ï¼Œæ‹¿åˆ°å“åº”çš„å»¶æ—¶ä¹Ÿå‡å°‘äº†</li>
</ul>
<h4 id="http2"><a class="anchor" href="#http2">#</a> HTTP2</h4>
<p><strong>ä½¿ç”¨ HTTP/2 æå‡æ€§èƒ½</strong></p>
<ul>
<li>2010 å¹´ SPDY <span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9TUERZJUU2JUJDJTk0JUU1JThDJTk2JUU1JTg4JUIw">https://baike.baidu.com/item/SPDY æ¼”åŒ–åˆ°</span></li>
<li>2015 HTTP/2 <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9HbG9zc2FyeS9IVFRQXzI=">https://developer.mozilla.org/zh-CN/docs/Glossary/HTTP_2</span></li>
</ul>
<p><strong>å…¼å®¹æ€§</strong></p>
<p>éœ€è¦æµè§ˆå™¨æ”¯æŒ - https:/caniuse.com/http2</p>
<p>éœ€è¦ HTTPS åè®®æ”¯æŒ</p>
<p><strong>ä¸»è¦ç‰¹æ€§</strong></p>
<ul>
<li>äºŒè¿›åˆ¶åè®®ï¼š</li>
</ul>
<p>HTTP2 ç”±åŸæ¥çš„æ–‡æœ¬è¯·æ±‚ï¼ˆæŠ¥æ–‡ï¼‰è½¬å˜ä¸ºäºŒè¿›åˆ¶è¯·æ±‚å¸§ï¼ŒåŠ å¿«ä¼ è¾“</p>
<ul>
<li>å¤šè·¯å¤ç”¨ï¼š</li>
</ul>
<p><strong>HTTP2 å¤šè·¯å¤ç”¨è§£å†³äº†æµè§ˆå™¨åŒä¸€åŸŸåå¹¶è¡Œè¯·æ±‚æ•°é‡çš„é™åˆ¶ã€‚</strong></p>
<p>åœ¨ HTTP/2 ä¸­å¼•å…¥äº†å¤šè·¯å¤ç”¨çš„æŠ€æœ¯ã€‚å¤šè·¯å¤ç”¨å¾ˆå¥½çš„è§£å†³äº†æµè§ˆå™¨é™åˆ¶åŒä¸€ä¸ªåŸŸåä¸‹çš„è¯·æ±‚æ•°é‡çš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿæ¥æ›´å®¹æ˜“å®ç°å…¨é€Ÿä¼ è¾“ï¼Œæ¯•ç«Ÿå¼€ä¸€ä¸ª TCP è¿æ¥éƒ½éœ€è¦æ…¢æ…¢æå‡ä¼ è¾“é€Ÿåº¦ã€‚</p>
<p><strong>åŒä¸ªåŸŸååªéœ€è¦å ç”¨ä¸€ä¸ª TCP è¿æ¥</strong>ï¼Œä½¿ç”¨ä¸€ä¸ªè¿æ¥å¹¶è¡Œå‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œ<strong>æ¶ˆé™¤äº†å› å¤šä¸ª TCP è¿æ¥è€Œå¸¦æ¥çš„å»¶æ—¶å’Œå†…å­˜æ¶ˆè€—</strong>ã€‚</p>
<ul>
<li>Header å‹ç¼©å¤ç”¨</li>
</ul>
<p>TTP/2 åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨ â€œ<strong>é¦–éƒ¨è¡¨</strong>â€ æ¥è·Ÿè¸ªå’Œå­˜å‚¨ä¹‹å‰å‘é€çš„é”®ä¸€å€¼å¯¹ï¼Œå¯¹äºç›¸åŒçš„æ•°æ®ï¼Œä¸å†é€šè¿‡æ¯æ¬¡è¯·æ±‚å’Œå“åº”å‘é€ã€‚</p>
<p><strong>é…ç½® HTTP2ï¼š</strong></p>
<p>ä¾ nginx ä¸ºä¾‹ï¼šåœ¨ server å­—æ®µçš„ listen å­—æ®µæ·»åŠ ï¼šlisten   443   ssl   http2;</p>
<h1 id="mongodbæ•°æ®åº“"><a class="anchor" href="#mongodbæ•°æ®åº“">#</a> Mongodb æ•°æ®åº“</h1>
<h3 id="åŸºæœ¬æ“ä½œ"><a class="anchor" href="#åŸºæœ¬æ“ä½œ">#</a> <strong>åŸºæœ¬æ“ä½œ</strong></h3>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// å¯¼å…¥ Mongodb å®¢æˆ·ç«¯æ„é€ å‡½æ•°</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> MongoClient<span class="token punctuation">,</span>ObjectId<span class="token punctuation">,</span> <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"mongodb"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// åˆ›å»º mongo å®ä¾‹ (ä¼ å…¥ url)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// æ‰§è¡Œå‡½æ•°ï¼Œè¿æ¥ mongodb æ•°æ®åº“</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç­‰å¾…å®ä¾‹è¿æ¥</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºæ•°æ®åº“</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">ping</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ping å‘½ä»¤</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">const</span> userCollection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºé›†åˆè¡¨</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// æ•°æ®çš„æ’å…¥</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">//const result = await userCollection.insertOne (&#123;name:"å¼ ä¸‰",age:18&#125;)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">//const results = await userCollection.insertMany ([&#123;name:"æå››",age:12&#125;,&#123;name:"ç‹äº”",age:13&#125;]);</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">//console.log (result,results); // è¿”å›å½±å“çš„ä¿¡æ¯ï¼Œid ç­‰</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// æ•°æ®çš„æŸ¥æ‰¾</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">const</span> resultCursor <span class="token operator">=</span>  userCollection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//find è¿”å›çš„æ˜¯æŒ‡é’ˆå¯¹è±¡ï¼Œä¸æ˜¯ç»“æœ</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// å°†æ¸¸æ ‡å˜ä¸ºæ•°ç»„ç»“æœ</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// console.log(results);</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">// æ¯”è¾ƒæ“ä½œç¬¦ $lt å°äº $gt å¤§äº</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">const</span> results2 <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$lt</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">// console.log(results2);</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">// é€»è¾‘æ“ä½œç¬¦ $or</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">const</span> results3 <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$or</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$gt</span><span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">"ç‹äº”"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment">// console.log(results3);</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">// å…ƒç´ æ“ä½œç¬¦  $exists å­˜åœ¨ä¸å¦  $type æŒ‡å®šç±»å‹</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">const</span> results4 <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$type</span><span class="token operator">:</span><span class="token string">'number'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token comment">// console.log(results4);</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment">//limit  ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ options é…ç½®ï¼ˆprojection è¡¨ç¤ºåŒ…å«å­—æ®µå“ªäº›å­—æ®µï¼‰</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">const</span> result5 <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$type</span><span class="token operator">:</span><span class="token string">'number'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">limit</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token literal-property property">skip</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token literal-property property">sort</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token literal-property property">projection</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment">// console.log(result5);</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token comment">// æ›´æ–°æ›¿æ¢æ•°æ®   update æ›´æ–°æ•°æ®  replaceOne æ›¿æ¢æ•°æ®ï¼Œä¿®æ”¹æ“ä½œè¦ä¼ å…·ä½“æ›´æ–°æ“ä½œç¬¦ï¼š</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token comment">// æ™®é€šæ›´æ–°æ“ä½œç¬¦ï¼š $set è®¾ç½®å€¼ $inc å¢åŠ  $rename é‡å‘½å $unset åˆ é™¤ </span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment">// æ•°ç»„æ›´æ–°æ“ä½œç¬¦ï¼š $push æ•°ç»„å­—æ®µæ·»åŠ  $pop åˆ é™¤ $all åŒ…å« $regex æ­£åˆ™ã€‚å±æ€§ç¬¦ .$ å±æ€§å ä½ç¬¦</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">const</span> result6 <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">replaceOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">"Lebrown"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">const</span> result7 <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">ObjectId</span><span class="token punctuation">(</span><span class="token string">'6628b9876bac632e95ead1bb'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">"updateOne"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token literal-property property">$inc</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">const</span> result8 <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ObjectId</span><span class="token punctuation">(</span><span class="token string">'6628b9876bac632e95ead1bb'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string-property property">"hobbies.0"</span><span class="token operator">:</span><span class="token string">"golf"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">const</span> result9 <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ObjectId</span><span class="token punctuation">(</span><span class="token string">'6628b9876bac632e95ead1bb'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token literal-property property">hobbies</span><span class="token operator">:</span><span class="token string">'glof'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string-property property">"hobbies.$"</span><span class="token operator">:</span><span class="token string">"golf-new"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token comment">//console.log (result8);// è¿”å›å½±å“ä¿¡æ¯</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment">// åˆ é™¤æ•°æ®ï¼šdeleteOne (filter) å’Œ deleteMany</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="mongodbé«˜çº§"><a class="anchor" href="#mongodbé«˜çº§">#</a> <strong>mongodb é«˜çº§</strong></h3>
<h5 id="ç´¢å¼•"><a class="anchor" href="#ç´¢å¼•">#</a> ç´¢å¼•</h5>
<p><strong>MongoDB ç´¢å¼•</strong></p>
<ul>
<li>ç´¢å¼• (Index)<strong> ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡</strong></li>
<li>MongoDB çš„æ–‡ä»¶ç±»å‹ï¼š<strong>BSON</strong>,Binary JSON, ä¸»è¦è¢«ç”¨ä½œ MongoDB æ•°æ®åº“ä¸­çš„æ•°æ®å­˜å‚¨å’Œç½‘ç»œä¼ è¾“æ ¼å¼ã€‚</li>
<li>å‡å¦‚æ²¡æœ‰ç´¢å¼•ï¼Œå¿…é¡»æ‰«æè¿™ä¸ªå·¨å¤§ BSON å¯¹è±¡é›†åˆä¸­çš„æ¯ä¸ªæ–‡æ¡£å¹¶é€‰å–é‚£äº›ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼Œè¿™æ ·æ˜¯ä½æ•ˆçš„ã€‚</li>
<li>ç´¢å¼•æ˜¯ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œç´¢å¼•å­˜å‚¨åœ¨ä¸€ä¸ªæ˜“äºéå†è¯»å–çš„æ•°æ®é›†åˆä¸­ã€‚</li>
<li>ä¸ºæŸä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ä¹‹åæŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«ï¼ŒObjectId æ˜¯è‡ªå¸¦çš„ç´¢å¼•ï¼ˆ _ id _ ï¼‰ã€‚</li>
</ul>
<p><strong>åˆ›å»ºç´¢å¼•</strong></p>
<p>åˆ›å»ºç´¢å¼•å¯ä»¥ç›´æ¥ç”¨ Navicate ç­‰å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä»£ç ä¸­ä½¿ç”¨ï¼š</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//...... çœç•¥</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// ç»™ name å­—æ®µåˆ›å»ºç´¢å¼•ä¹‹å‰è€—æ—¶å¾ˆå¤§ï¼Œåˆ›å»ºä¹‹åè€—æ—¶å¾ˆå°</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> indexResult <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">"James"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>indexResult<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// åˆ›å»ºç´¢å¼•ï¼Œå±æ€§è¡¨ç¤ºå­—æ®µï¼Œå€¼è¡¨ç¤ºå‡åºé™åº</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">//1 è¡¨ç¤ºå‡åº</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// å–æ¶ˆç´¢å¼•</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> result1 <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span><span class="token string">"name_1"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h5 id="èšåˆ"><a class="anchor" href="#èšåˆ">#</a> èšåˆ</h5>
<p>èšåˆæ“ä½œå°†æ¥è‡ªå¤šä¸ªæ–‡æ¡£çš„å€¼ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å¯ä»¥å¯¹åˆ†ç»„æ•°æ®æ‰§è¡Œå„ç§æ“ä½œä»¥è¿”å›ç›¸åº”çš„ç»“æœã€‚<br />
<strong>linux å¸¸ç”¨çš„ç®¡é“å†™æ³•ï¼š</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> mongo</pre></td></tr></table></figure><p><strong>èšåˆå¸¸ç”¨çš„æ“ä½œç¬¦ï¼š</strong></p>
<ul>
<li>$group å°† collection ä¸­çš„ document: åˆ†ç»„ï¼Œå¯ç”¨äºç»Ÿè®¡ç»“æœ</li>
<li>$natch è¿‡æ»¤æ•°æ®ï¼Œåªè¾“å‡ºç¬¦åˆç»“æœçš„æ–‡æ¡£</li>
<li>$project ä¿®æ”¹è¾“å…¥æ–‡æ¡£çš„ç»“æ„ï¼ˆä¾‹å¦‚é‡å‘½åï¼Œå¢åŠ ã€åˆ é™¤å­—æ®µï¼Œåˆ›å»ºç»“ç®—ç»“æœç­‰ï¼‰</li>
<li>$sot å°†ç»“æœè¿›è¡Œæ’åºåè¾“å‡º</li>
<li>$imit é™åˆ¶ç®¡é“è¾“å‡ºçš„ç»“æœä¸ªæ•°</li>
<li>$skp è·³è¿‡åˆ¶å®šæ•°é‡çš„ç»“æœï¼Œå¹¶ä¸”è¿”å›å‰©ä¸‹çš„ç»“æœ</li>
</ul>
<p><strong>è¡¨è¾¾å¼æ“ä½œç¬¦ï¼š</strong></p>
<ul>
<li>sumè®¡ç®—æ€»å’Œï¼Œ{sum:1} è¡¨ç¤ºè¿”å›æ€»å’Œ Ã—1 çš„å€¼ï¼ˆå³æ€»å’Œçš„æ•°é‡ï¼‰ï¼Œä½¿ç”¨ {<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><msup><mo>:</mo><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup></mrow><annotation encoding="application/x-tex">sum:&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel">:</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span> åˆ¶å®šå­—æ®µ '} ä¹Ÿèƒ½ç›´æ¥è·å–åˆ¶å®šå­—æ®µçš„å€¼çš„æ€»å’Œ</li>
<li>$avg æ±‚å¹³å‡å€¼</li>
<li>$min æ±‚ min å€¼</li>
<li>$max æ±‚ max å€¼</li>
<li>$push å°†ç»“æœæ–‡æ¡£ä¸­æ’å…¥å€¼åˆ°ä¸€ä¸ªæ•°ç»„ä¸­</li>
<li>$frst æ ¹æ®æ–‡æ¡£çš„æ’åºè·å–ç¬¬ä¸€ä¸ªæ–‡æ¡£æ•°æ®</li>
<li>$last åŒç†ï¼Œè·å–æœ€åä¸€ä¸ªæ•°æ®</li>
</ul>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//.....</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> pipeLine <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#123;</span> <span class="token literal-property property">$match</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">age</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">$gt</span> <span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#123;</span> <span class="token literal-property property">$group</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">_id</span> <span class="token operator">:</span> <span class="token string">"$steam"</span> <span class="token punctuation">,</span> <span class="token literal-property property">total</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">$sum</span> <span class="token operator">:</span> <span class="token string">"$age"</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">,</span> <span class="token literal-property property">count</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">$sum</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#123;</span> <span class="token literal-property property">$sort</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">total</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>cosnt result <span class="token operator">=</span> <span class="token keyword">await</span> userCollection<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>pipeLine<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">//....</span></pre></td></tr></table></figure><h5 id="å¤šè¡¨è”æŸ¥"><a class="anchor" href="#å¤šè¡¨è”æŸ¥">#</a> å¤šè¡¨è”æŸ¥</h5>
<p><strong>æ™®é€šæ–¹å¼ä½¿ç”¨å¤šè¡¨è”æŸ¥éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢</strong></p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// å¯¼å…¥ Mongodb å®¢æˆ·ç«¯æ„é€ å‡½æ•°</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> MongoClient<span class="token punctuation">,</span>ObjectId<span class="token punctuation">,</span> <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"mongodb"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// åˆ›å»º mongo å®ä¾‹ (ä¼ å…¥ url)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// æ‰§è¡Œå‡½æ•°ï¼Œè¿æ¥ mongodb æ•°æ®åº“</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç­‰å¾…å®ä¾‹è¿æ¥</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºæ•°æ®åº“</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">ping</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ping å‘½ä»¤</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'connected'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// è·å–è¡¨</span></pre></td></tr><tr><td data-num="13"></td><td><pre>     <span class="token keyword">const</span> teamCollection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'team'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>     <span class="token keyword">const</span> playerCollection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'player'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>     <span class="token keyword">const</span> netsTeam <span class="token operator">=</span> <span class="token keyword">await</span> teamCollection<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">team</span><span class="token operator">:</span><span class="token string">"NETS"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>     <span class="token keyword">const</span> netsPlayers <span class="token operator">=</span> <span class="token keyword">await</span> playerCollection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">team</span><span class="token operator">:</span>netsTeam<span class="token punctuation">.</span>_id<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>ä½¿ç”¨èšåˆä¸­ $lookup è¿›è¡Œå¤šè¡¨è”æŸ¥åªéœ€è¦ä¸€æ¬¡æŸ¥è¯¢ï¼š</strong></p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//...</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> pipeLine2 <span class="token operator">=</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token literal-property property">$match</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">team</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">$exists</span> <span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token literal-property property">$lookup</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token literal-property property">from</span> <span class="token operator">:</span> <span class="token string">"team"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token literal-property property">localField</span> <span class="token operator">:</span> <span class="token string">"team"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token literal-property property">foreignField</span> <span class="token operator">:</span> <span class="token string">"_id"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token keyword">as</span> <span class="token operator">:</span> <span class="token string">"team"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">const</span> playerWithTeam <span class="token operator">=</span> <span class="token keyword">await</span> playerCollection<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>pipeLine2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>playerWithTeam<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">//...</span></pre></td></tr></table></figure><h3 id="æ•°æ®åº“è®¾è®¡"><a class="anchor" href="#æ•°æ®åº“è®¾è®¡">#</a> æ•°æ®åº“è®¾è®¡</h3>
<p>[MongoDB æœ€ä½³è®¾è®¡å®è·µ](<span class="exturl" data-url="aHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZGV2ZWxvcGVyL2FydGljbGUvbW9uZ29kYi0=">https://www.mongodb.com/developer/article/mongodb-</span><br />
schema-design-best-practices/)</p>
<p>å…³é”®é—®é¢˜ï¼šæ•°æ®äº§ç”Ÿå…³ç³»çš„æ—¶å€™ï¼Œé€‰æ‹©å†…åµŒè¿˜æ˜¯å¼•ç”¨ï¼Ÿ</p>
<p><strong>å†…åµŒæ¨¡å¼ï¼š</strong></p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>åªéœ€è¦ä¸€æ¬¡æŸ¥è¯¢å°±å¯ä»¥æŸ¥è¯¢æ‰€æœ‰çš„ä¿¡æ¯ã€‚</li>
<li>é¿å…å¤šé›†åˆæŸ¥è¯¢ã€‚</li>
<li>åªéœ€è¦ä¸€ä¸ªæ“ä½œå°±å¯ä»¥æ›´æ–°å¤šä¸ªä¿¡æ¯ã€‚</li>
</ul>
<p>åŠ£åŠ¿ï¼š</p>
<ul>
<li>å•ä¸ªæ–‡æ¡£å¤ªå¤§ï¼ŒæŸ¥è¯¢å¯èƒ½æ›´è€—æ—¶ï¼Œè·å¾—çš„æ— å…³ä¿¡æ¯æ¦‚ç‡å¢å¤§ã€‚</li>
<li>é’ˆå¯¹æ¯ä¸ªæ–‡æ¡£ï¼ŒMongoDB æœ‰ä¸€ä¸ª 16M çš„æœ€å¤§é™åˆ¶ï¼Œå†…åµŒå¤ªå¤šï¼Œå¯èƒ½è¶…è¿‡è¿™ä¸ªé™åˆ¶ã€‚</li>
</ul>
<p><strong>å¼•ç”¨æ¨¡å¼ï¼š</strong></p>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å°†æ•°æ®åˆ†æ•£åˆ°ä¸åŒæ–‡æ¡£ï¼Œæ•°æ®é‡ä¼šå˜å°ã€‚</li>
<li>ä¸å¤ªä¼šè¶…è¿‡ 16M æœ€å¤§é™åˆ¶ã€‚</li>
<li>æ¯æ¬¡æŸ¥è¯¢å–å¾—ä¸å¿…è¦æ•°æ®çš„æ…¨ç‡é™ä½ã€‚</li>
</ul>
<p>åŠ£åŠ¿ï¼šéœ€è¦å¤šæ¬¡æŸ¥è¯¢æ‰èƒ½è·å¾—æœ€ç»ˆæ•°æ®</p>
<p><strong>æœ€ä½³è®¾è®¡å®è·µï¼š</strong></p>
<ul>
<li>
<p>ä¸€å¯¹å‡ ä¸ªï¼šæ¨èä½¿ç”¨å†…åµŒå½¢å¼</p>
</li>
<li>
<p>ä¸€å¯¹å¾ˆå¤šï¼šæ¨èä½¿ç”¨å¼•ç”¨å½¢å¼</p>
<ul>
<li>å­é›†åˆä¸­ä½¿ç”¨ä¸€ä¸ªå­—æ®µä¿å­˜çˆ¶é›†åˆçš„_id   ï¼› æˆ–è€…ï¼š</li>
<li>çˆ¶é›†åˆä¸­ä½¿ç”¨ä¸€ä¸ªæ•°ç»„ä¿å­˜å­é›†åˆçš„_id</li>
</ul>
</li>
<li>
<p>ä¸€å¯¹äº¿ä¸‡ï¼šåªèƒ½å­é›†åˆä¸­ä½¿ç”¨ä¸€ä¸ªå­—æ®µä¿å­˜çˆ¶é›†åˆçš„_id</p>
</li>
</ul>
<h3 id="è®¿é—®æƒé™ç®¡ç†"><a class="anchor" href="#è®¿é—®æƒé™ç®¡ç†">#</a> <strong>è®¿é—®æƒé™ç®¡ç†</strong></h3>
<p><strong>æˆæƒæ–‡æ¡£</strong>ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC9jb3JlL2F1dGhlbnRpY2F0aW9uLw==">https://docs.mongodb.com/manual/core/authentication/</span><br />
<strong> å†…ç½®çš„ Roles</strong>ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC9yZWZlcmVuY2UvYnVpbHQtaW4tcm9sZXMv">https://docs.mongodb.com/manual/reference/built-in-roles/</span></p>
<p><strong>åœ¨ mongo å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼š</strong></p>
<pre><code class="language-cmd">show dbs
use admin
# mongodbåŸºäºRBACè¿›è¡Œæƒé™ç®¡ç†ï¼Œè®¾ç½®roleså¯ä»¥è®¾ç½®ç›¸åº”çš„å…¨é€‰ï¼Œè§ä¸Šã€‚
db.createUser(&#123; user : 'root' , pwd : '123456' , roles : ['root'] &#125;) 
db.auth('root','123456')
# --auth å¼€å¯æ•°æ®åº“çš„æƒé™éªŒè¯ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨mongo.confä¸­é…ç½®ï¼ˆå…ˆç»ˆæ­¢è¿è¡Œmongodï¼‰
mongod --config /usr/local/etc/mongo.conf --auth
# æ“ä½œé…ç½®äº†æƒé™ç®¡ç†çš„æ•°æ®åº“
mongo -u &quot;root&quot; -p &quot;123456&quot; --authenticationDatabase &quot;admin&quot;
</code></pre>
<p><strong>åˆå§‹åŒ–ä¸€ä¸ªæ–°æ•°æ®åº“ä»¥åæœŸæœ›çš„æ­¥éª¤</strong></p>
<ul>
<li>åˆ›å»º admin çº§è°œåˆ«çš„ root ç”¨æˆ· /roles:root</li>
<li>åˆ›å»ºå¯¹åº”çš„æ•°æ®åº“ lego</li>
<li>åˆ›å»ºè¯¥æ•°æ®åº“çš„ç®¡ç†å‘˜ dmq/roles:readWrite</li>
<li>ä»£ç ä¸­ï¼Œä½¿ç”¨ç®¡ç†å‘˜ dmq çš„ç”¨æˆ·åå¯†ç é“¾æ¥æ•°æ®åº“å¹¶ä¸”å®Œæˆæ“ä½œã€‚</li>
</ul>
<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<pre><code class="language-cmd">show dbs
use lego
db.createUser(&#123; user : &quot;dmq&quot; , pwd : '123456' , roles : [&#123; role : &quot;readWrite&quot; , db : &quot;lego&quot; &#125;]&#125;)
# é‡å¯æœåŠ¡ï¼šmongod --config /usr/local/etc/mongo.conf --auth
# è¿™æ ·åœ¨mongodbçš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ç”¨æˆ·ä¿¡æ¯ï¼Œå°±ä¿è¯åªèƒ½è¯»å–æ•°æ®åº“ä¿¡æ¯ï¼Œä¿è¯äº†æ•°æ®åº“çš„å®‰å…¨ã€‚ï¼ˆå¦‚æœç”¨æˆ·ä¿¡æ¯æ¥è‡ªadminæ•°æ®åº“å°±éœ€è¦é…ç½®authSource:'admin'ã€‚ï¼‰
</code></pre>
<h1 id="mongoose"><a class="anchor" href="#mongoose">#</a> Mongoose</h1>
<p><strong>å‡ºç°çš„åŸå› ï¼š</strong></p>
<p>ä½¿ç”¨åŸç”Ÿçš„ mongoDB nodejs driver æ•°æ®ç»“æ„åŠå…¶æ“ä½œè¿‡äºçµæ´»ã€‚</p>
<p><strong>mongooseï¼šMongoDB çš„ ODM æ–‡æ¡£å¯¹è±¡æ˜ å°„</strong>ï¼ˆmongoose ä¹‹äº mongodb ç±»ä¼¼äº ts ä¹‹äº jsï¼Œéƒ½æ˜¯åœ¨åŸæœ‰çš„åŸºç¡€ä¹‹ä¸ŠåŠ ä¸€å±‚æŠ½è±¡å±‚ï¼Œè¿›è¡Œç±»å‹å®šä¹‰ç­‰æ“ä½œï¼‰</p>
<p>mongooseï¼š<span class="exturl" data-url="aHR0cHM6Ly9tb25nb29zZWlzLmNvbS8=">https://mongooseis.com/</span></p>
<ul>
<li>å»ºç«‹åœ¨ native mongoDB nodejs driver ä¹‹ä¸Š</li>
<li>æå‡º Modl, æ•°æ®æ¨¡å‹çš„æ¦‚å¿µï¼Œç”¨æ¥çº¦æŸé›†åˆä¸­çš„æ•°æ®ç»“æ„</li>
<li>éå¸¸å¤šæ‰©å±•çš„å†…å®¹</li>
<li>å®ƒæ˜¯ä¸€ä¸ª ODM (Object Document Mapping) å·¥å…·ã€‚</li>
</ul>
<h3 id="orm"><a class="anchor" href="#orm">#</a> ORM</h3>
<p>ORM æŒ‡çš„æ˜¯<strong> Object Relational Mapping å¯¹è±¡å…³ç³»æ˜ å°„</strong>ï¼Œé’ˆå¯¹äº<strong>å…³ç³»å‹æ•°æ®åº“</strong>ã€‚</p>
<p><strong>ç®€å•è¯´ï¼ŒORM å°±æ˜¯é€šè¿‡å®ä¾‹å¯¹è±¡çš„è¯­æ³•ï¼Œå®Œæˆå…³ç³»å‹æ•°æ®åº“çš„æ“ä½œçš„æŠ€æœ¯ã€‚</strong></p>
<p><strong>ORM ä¼˜ç‚¹</strong></p>
<ul>
<li>ä¸éœ€è¦å†å»å†™æ™¦æ¶©çš„ SQL è¯­å¥ã€‚</li>
<li>ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œæ•°æ®ï¼Œä»£ç é‡å°‘ï¼Œè¯­ä¹‰æ€§å¥½ï¼Œå®¹æ˜“ç†è§£ã€‚</li>
<li>Classes ç±» - Tables</li>
<li>Objects å®ä¾‹ - Records (è¡¨ä¸­çš„ä¸€è¡Œæ•°æ®)</li>
<li>Attributes å±æ€§ - Records</li>
<li>å†…ç½®å¾ˆå¤šåŠŸèƒ½ï¼Œæ•°æ®éªŒè¯ï¼Œæ¸…æ´—ï¼Œé¢„å¤„ç†ç­‰ç­‰æ“ä½œã€‚</li>
</ul>
<h3 id="odm"><a class="anchor" href="#odm">#</a> ODM</h3>
<p>ODM æŒ‡çš„æ˜¯<strong> Object Document Mapping å¯¹è±¡æ–‡æ¡£æ˜ å°„</strong>ã€‚ODM é’ˆå¯¹äº<strong> noSql æ•°æ®åº“</strong>ï¼Œå…³æ³¨æ–‡æ¡£æ¨¡å‹ï¼Œmongoose æ˜¯ ODM çš„ä¸€ç§å®ç°ï¼Œå¯ä»¥ç”¨äºçº¦æŸæ•°æ®ç±»å‹ã€‚</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> User <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">"User"</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token literal-property property">username</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span> <span class="token operator">:</span> string <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token literal-property property">password</span><span class="token operator">:</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span> <span class="token operator">:</span> String <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//user object</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">const</span> newUser <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token literal-property property">username</span><span class="token operator">:</span><span class="token string">"john-doe"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token literal-property property">password</span><span class="token operator">:</span><span class="token string">"helloworld"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">await</span> newUser<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="egg-mongoose"><a class="anchor" href="#egg-mongoose">#</a> egg-mongoose</h1>
<p>å®˜ç½‘æ–‡æ¡£å¾ˆå¥½ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹ã€‚</p>
<h1 id="stream"><a class="anchor" href="#stream">#</a> Stream</h1>
<h3 id="ä»‹ç»"><a class="anchor" href="#ä»‹ç»">#</a> ä»‹ç»</h3>
<p>Stream çš„å®˜æ–¹æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly9ub2RlanMub3JnL2FwaS9zdHJlYW0uaHRtbA==">https://nodejs.org/api/stream.html</span><br />
<strong> æµæ˜¯ Node.js ä¸­æœ€å¥½ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“è¯¯è§£çš„æ…¨å¿µ</strong><br />
æµå°±æ˜¯æ•°æ®çš„åˆé›†ï¼Œæ•°æ®å¯ä»¥æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯æ•°ç»„ï¼Œæµçš„æ•°æ®ä¸æ˜¯ä¸€æ¬¡æ€§å…¨éƒ¨è·å¾—çš„ã€‚</p>
<p>å¤§æ–‡ä»¶è¾“å‡ºæ–¹å¼ï¼š</p>
<ul>
<li>
<p>ç›´æ¥è¯»å–</p>
<p>è¾“å…¥çš„æ–‡ä»¶ ------------ è¯»å–åˆ°å†…å­˜ ---------------- è¾“å‡ºæ–‡ä»¶å†…å®¹</p>
</li>
<li>
<p>æµå¼è¯»å–</p>
<p>è¾“å…¥çš„æ–‡ä»¶ ------------ é€šè¿‡å¯è¯»æµè¯»å–åˆ°ç®¡é“ ----------------- é€šè¿‡å¯å†™æµè¾“å‡ºæ–‡ä»¶å†…å®¹</p>
</li>
</ul>
<p><strong>Node.js æ”¯æŒæµçš„å†…ç½®æ¨¡å—ï¼š</strong></p>
<p><strong>Readable Streams:</strong></p>
<ul>
<li>HTTP responses,on the client</li>
<li>HTTP requests,on the server</li>
<li>fs read streams</li>
<li>zlib streams</li>
<li>crypto streams</li>
<li>TCP sockets</li>
<li>child process stdout and stderr</li>
<li>process.stdin</li>
</ul>
<p><strong>Writable  Streams:</strong></p>
<ul>
<li>HTTP requests,on the client</li>
<li>HTTP responses,on the server</li>
<li>fs write streams</li>
<li>zlib streams</li>
<li>crypto streams</li>
<li>TCP sockets</li>
<li>child process stdin</li>
<li>process.stdout,process.stderr</li>
</ul>
<p><strong>æµçš„ç±»å‹ï¼š</strong></p>
<ul>
<li>Readable - å¯è¯»æ“ä½œã€‚</li>
<li>Vritable - å¯å†™æ“ä½œã€‚</li>
<li>Duplex - å¯è¯»å¯å†™æ“ä½œ.</li>
<li>Transform - æ“ä½œè¢«å†™å…¥æ•°æ®ï¼Œç„¶åè¯»å‡ºç»“æœã€‚</li>
</ul>
<h3 id="pipe"><a class="anchor" href="#pipe">#</a> pipe</h3>
<p><strong>æµçš„æµåŠ¨ï¼š</strong></p>
<p>å¯è¯»æµ Readableï¼ˆæ•°æ®æº inputï¼‰----------------------pipe ç®¡é“ ---------------------------------------- å¯å†™æµ Writableï¼ˆè¾“å‡º outputï¼‰</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createReadStream<span class="token punctuation">,</span> createWriteStream <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> readStream <span class="token operator">=</span> <span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>readStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>å¯è¯»æµ Readableï¼ˆæ•°æ®æº inputï¼‰-------------pipe ç®¡é“ --------------- è½¬æ¢æµ Transform----------------pipe ç®¡é“ ----------- å¯å†™æµ Writableï¼ˆè¾“å‡º outputï¼‰</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createReadStream<span class="token punctuation">,</span> createWriteStream<span class="token punctuation">,</span> write <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> readStream <span class="token operator">=</span> <span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> writeStream <span class="token operator">=</span> <span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./b.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>readStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="åŸç†-3"><a class="anchor" href="#åŸç†-3">#</a> åŸç†</h3>
<p><strong>æµæ˜¯åŸºäº EventEmitterï¼ˆäº‹ä»¶ï¼‰ï¼Œpipe æ–¹æ³•æ˜¯åŸºäºäº‹ä»¶å°è£…çš„çš„è¯­æ³•ç³–ï¼Œå¸¸è§çš„äº‹ä»¶æœ‰ï¼š</strong></p>
<p><strong>Readable  Streamsï¼šå¯è¯»æµäº‹ä»¶å’Œå‡½æ•°</strong></p>
<ul>
<li>Events
<ul>
<li>data-- å½“æ²¡æœ‰æ•°æ®æ—¶è§¦å‘</li>
<li>end-- æ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯è¯»æ—¶è§¦å‘</li>
<li>error-- åœ¨æ¥å—å’Œå†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘</li>
<li>finish-- æ‰€æœ‰æ•°æ®å·²è¢«å†™å…¥åˆ°åº•å±‚ç³»ç»Ÿæ—¶è§¦å‘</li>
<li>close</li>
<li>readable</li>
</ul>
</li>
<li>Functions
<ul>
<li>pipe() , unpipe()</li>
<li>read() , unshift() , resume()</li>
<li>pause() , isPaused()</li>
<li>setEncoding()</li>
</ul>
</li>
</ul>
<p><strong>Writable  Streamsï¼šå†™å…¥æµäº‹ä»¶å’Œå‡½æ•°</strong></p>
<ul>
<li>Events
<ul>
<li>drain</li>
<li>finish</li>
<li>error</li>
<li>close</li>
<li>pipe/unpipe</li>
</ul>
</li>
<li>Functions
<ul>
<li>write()</li>
<li>end()</li>
<li>cork() , uncork()</li>
<li>setDefaultEncoding()</li>
</ul>
</li>
</ul>
<p><strong>pipe æ–¹æ³•åŸç†ï¼š</strong></p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createReadStream <span class="token punctuation">,</span> createWriteStream <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> readStream <span class="token operator">=</span> <span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> writeStream <span class="token operator">=</span> <span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./b.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>readStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span> <span class="token punctuation">,</span> <span class="token parameter">chunk</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    writeStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>readStream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    writeStream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>å‹ç¼©ï¼š</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createReadStream <span class="token punctuation">,</span> createWriteStream <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createGzip <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'zlib'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> readStream <span class="token operator">=</span> <span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> writeStream <span class="token operator">=</span> <span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./b.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>readStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>å°è£…ï¼š</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre>cosnt savePromise <span class="token operator">=</span> <span class="token punctuation">(</span>readStream <span class="token punctuation">,</span> writeStream <span class="token operator">=</span> stdout<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        readStream</pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>writeStream<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span>resolve<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        	<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span>reject<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="pipeline"><a class="anchor" href="#pipeline">#</a> pipeline</h3>
<p><strong>ä½¿ç”¨ pipe æ–¹æ³•æœ‰æ—¶ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š</strong></p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//....</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./a.txt'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>stdout<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span>finishFn<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span>errFn<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¿™é‡Œç›‘å¬çš„æ˜¯ pipe åçš„é”™è¯¯ï¼Œå¯¹äº createReadStream çš„é”™è¯¯åˆ™ä¼šå¡æ­»</span></pre></td></tr></table></figure><p><strong>äºæ˜¯æ¨å‡ºäº† pipeline æ–¹æ³•ï¼š</strong></p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//...</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">pipeLine</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./a.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>zlib<span class="token punctuation">.</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./b.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'pipeline failed'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'successed'</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="å¯¹è±¡å­˜å‚¨æœåŠ¡"><a class="anchor" href="#å¯¹è±¡å­˜å‚¨æœåŠ¡">#</a> å¯¹è±¡å­˜å‚¨æœåŠ¡</h1>
<p><strong>è‡ªå·±å®Œæˆé™æ€æ–‡ä»¶å­˜å‚¨çš„é—®é¢˜</strong></p>
<ul>
<li>Nod.js ä¸æ“…é•¿å¤„ç†é™æ€æ–‡ä»¶çš„å­˜å‚¨å’Œå±•ç¤ºï¼Œæ²¡æœ‰æœªé™æ€æ–‡ä»¶åšç‰¹æ®Šçš„ä¼˜åŒ–</li>
<li>å¦‚æœå°†å›¾ç‰‡ç”Ÿæˆå¤šç§å¤„ç†æ ¼å¼è¦è€—è´¹å¤§é‡çš„èµ„æºå’Œç©ºé—´</li>
</ul>
<p><strong>å„ä¸‰æ–¹æ¯”å¯¹</strong></p>
<h3 id="é˜¿é‡Œäº‘oss"><a class="anchor" href="#é˜¿é‡Œäº‘oss">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuYWxpeXVuLmNvbS9wcm9kdWN0Li9vc3M=">é˜¿é‡Œäº‘ OSS</span></h3>
<p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>æ”¯æŒä¸°å¯Œçš„å›¾ç‰‡å¤„ç† https://help.aliyun.com/document._detail/44686.html</li>
<li>egg.js æœ‰å¯¹åº”çš„æ’ä»¶ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VnZ2pzL2VnZy1vc3M=">https://github.com/eggjs/egg-oss</span></li>
</ul>
<p><strong>ä»·æ ¼</strong></p>
<ul>
<li>ä¸‹è¡Œæµé‡ 100GB ä¸€å¹´ 352 å…ƒ https://common-buy.aliyun.com/?spm=5176.7933691.J_5253785160.1.2e394c59q3FIsA&amp;commodityCode=ossbag#/buy</li>
<li>åŸºæœ¬å›¾ç‰‡å¤„ç†ï¼šæ¯æœˆ 0-10TB: å…è´¹ &gt; 10TB:0.025 å…ƒ / GB</li>
</ul>
<h3 id="ä¸ƒç‰›äº‘kodo"><a class="anchor" href="#ä¸ƒç‰›äº‘kodo">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cucWluaXUuY29tL3ByaWNlcy9rb2Rv">ä¸ƒç‰›äº‘ KODO</span></h3>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å¤šåª’ä½“å¤„ç†åŠŸèƒ½éå¸¸ä¸°å¯Œ https://www.giniu.com/products/dora</li>
<li>å›¾ç‰‡è§†é¢‘å¤„ç†</li>
<li>å®¡æ ¸</li>
<li>äººå·¥æ™ºèƒ½åˆ†æ</li>
</ul>
<p><strong>ä»·æ ¼ï¼š</strong></p>
<ul>
<li>å¤–ç½‘æµå‡º 100GB - å¹´ 278.4 å…ƒ https://qmall.qiniu.com/template./MTEy?spec_combo=MzE0NQ</li>
<li>åŸºæœ¬å›¾ç‰‡å¤„ç†ï¼šæ¯æœˆ 0-20TB: å…è´¹ 20TB ä»¥ä¸Šï¼š0.025 å…ƒ / GB https:/www.qiniu.com/prices/dora</li>
</ul>
<h3 id="è…¾è®¯äº‘cos"><a class="anchor" href="#è…¾è®¯äº‘cos">#</a> <span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNg==">è…¾è®¯äº‘ COS</span></h3>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<p>å›¾åƒå¤„ç†æœ‰ä¸€äº›æ–°çš„äº®ç‚¹ï¼Œæ¯”å¦‚è‡ªç ”çš„ TPG å‹ç¼©ç­‰</p>
<p><strong>ä»·æ ¼ï¼š</strong></p>
<ul>
<li>å¤–ç½‘æµå‡º 100GB ä¸€å¹´ 396 å…ƒ https://buy.cloud.tencent..com/price/cos#tab0-list1</li>
<li>åŸºæœ¬å›¾ç‰‡å¤„ç†ï¼šæ¯æœˆ 0-20TB: å…è´¹ 20TB ä»¥ä¸Šï¼š0.025 å…ƒ / GB</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzEyNDYvNDUyNzQ=">https://cloud.tencent.com/document/product/1246/45274</span></li>
<li>å›¾ç‰‡å‹ç¼©ï¼š1 å…ƒ / åƒæ¬¡</li>
</ul>
<h1 id="ssræœåŠ¡ç«¯æ¸²æŸ“"><a class="anchor" href="#ssræœåŠ¡ç«¯æ¸²æŸ“">#</a> SSR æœåŠ¡ç«¯æ¸²æŸ“</h1>
<h3 id="ä»‹ç»-2"><a class="anchor" href="#ä»‹ç»-2">#</a> ä»‹ç»</h3>
<p><strong>SSR-Server Side Rendering</strong></p>
<p>Vue å…³äº SSR çš„ä»‹ç»ï¼š<span class="exturl" data-url="aHR0cHM6Ly9zU3IudWVqcy5vcmcvemg=">https://sSr.uejs.org/zh</span></p>
<p><strong>SSR çš„ä¼˜ç‚¹</strong></p>
<ul>
<li>æ›´å¥½çš„ SEO</li>
<li>æ›´å¿«çš„æ¸²æŸ“æ—¶é—´ (Time to content)ï¼Œ</li>
</ul>
<p><strong>SSR çš„ç¼ºç‚¹</strong></p>
<ul>
<li>
<p>å¼€å‘çš„é™åˆ¶ï¼Œæµè§ˆå™¨ç›¸å…³çš„æ“ä½œåªèƒ½åœ¨ç‰¹å®šçš„é’©å­å‡½æ•°ä¸­ä½¿ç”¨</p>
</li>
<li>
<p>SPA åº”ç”¨å®Œå…¨é™æ€åŒ–ï¼Œè€Œ SSR app éœ€è¦ Node.js Server æ‰èƒ½è¿è¡Œ</p>
</li>
<li>
<p>æœåŠ¡ç«¯è´Ÿè·æ›´é«˜</p>
</li>
</ul>
<p><strong>SSR çš„å®ç°ï¼š</strong></p>
<ul>
<li>
<p>åŸºæœ¬åŸç†ï¼š@vue/server-renderer <span class="exturl" data-url="aHR0cHM6Ly92My51ZWpzLm9yZy9ndWlkZS9zc3IvZ2V0dGluZy1zdGFydGVkLmh0bWwjaW5zdGFsbGF0aW9u">https://v3.uejs.org/guide/ssr/getting-started.html#installation</span></p>
</li>
<li>
<p>ä½¿ç”¨ createSSRAppï¼ŒrenderToString ä»¥åŠ renderToStream æ–¹æ³•</p>
</li>
</ul>
<p><strong>æˆç†Ÿçš„ï¼Œå¤§è€Œå…¨çš„ SSR é€šç”¨å¼€å‘æ¡†æ¶ï¼š</strong></p>
<ul>
<li>Nuxt.js <span class="exturl" data-url="aHR0cHM6Ly9udXh0anMub3JnLw==">https://nuxtjs.org/</span>  ï¼ˆVueï¼‰</li>
<li>React ç±»ä¼¼çš„ Next.js <span class="exturl" data-url="aHR0cHM6Ly9uZXh0anMub3Jn">https://nextjs.org</span> ï¼ˆReactï¼‰</li>
</ul>
<h3 id="ssr"><a class="anchor" href="#ssr">#</a> SSR</h3>
<p>express ç­‰æ¡†æ¶çš„ res.render æ–¹æ³•å¯ä»¥æ¸²æŸ“ html æ¨¡æ¿ï¼Œä½¿ç”¨çš„æ˜¯ nunjucks åº“è¿›è¡Œæ•°æ®å¡«å……ã€‚</p>
<p>index.html</p>
<figure class="highlight html"><figcaption data-lang="HTML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no-js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>description<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>  //æ ¹æ®ä¼ å…¥çš„propsåŠ¨æ€æ·»åŠ styleæ ·å¼</pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment"></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>index.js  (ä¾æ® express æ¡†æ¶ä¸ºä¾‹ï¼š)</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//...res æ˜¯å“åº”å‚æ•°</span></pre></td></tr><tr><td data-num="2"></td><td><pre>res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>html</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="vueä¸­ssr"><a class="anchor" href="#vueä¸­ssr">#</a> vue ä¸­ SSR</h3>
<p>1ã€vue3 æœ‰åŒ…ï¼š@vue/server-rendererï¼Œåœ¨ 3.2.13 ç‰ˆæœ¬ä»¥ä¸Šå†…ç½®äº†ï¼Œä½äºæ­¤ç‰ˆæœ¬éœ€è¦è‡ªè¡Œå®‰è£…ã€‚</p>
<p>2ã€ä½¿ç”¨ï¼š</p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//.......... res æ˜¯æœåŠ¡ç«¯è¿”å›</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> pipeline <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'stream/promises'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createSSRApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> renderToString <span class="token punctuation">,</span> renderToNodeStream <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@vue/server-renderer'</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">const</span> vueApp <span class="token operator">=</span> <span class="token function">createSSRApp</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function-variable function">data</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span> <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">'hello world'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'&lt;h1>&lt;/h1>'</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">const</span> appContent <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>vueApp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>res<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/html'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>res<span class="token punctuation">.</span>body <span class="token operator">=</span> appContent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// æˆ–è€…ä½¿ç”¨æµå¼è¾“å‡ºï¼š</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">const</span> stream <span class="token operator">=</span> <span class="token function">renderToNodeStream</span><span class="token punctuation">(</span>vueApp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>res<span class="token punctuation">.</span>statys <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">await</span> <span class="token function">pipeline</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h1 id="rbacæƒé™éªŒè¯"><a class="anchor" href="#rbacæƒé™éªŒè¯">#</a> RBAC æƒé™éªŒè¯</h1>
<h3 id="ä»‹ç»-3"><a class="anchor" href="#ä»‹ç»-3">#</a> ä»‹ç»</h3>
<p><strong>æƒé™éªŒè¯çš„åœºæ™¯ä»¥åŠéœ€æ±‚ï¼š</strong></p>
<ul>
<li>ç‰¹å®šçš„è§’è‰²çš„ç”¨æˆ·æ‰èƒ½æ“ä½œç‰¹å®šçš„èµ„æº</li>
<li>ä¸åŒçš„ç”¨æˆ·èƒ½æ“ä½œåŒç±»èµ„æºçš„ç‰¹å®šå®ä½“</li>
<li>ä¸åŒçš„ç”¨æˆ·æ“ä½œç‰¹å®šèµ„æºçš„ä¸åŒå±æ€§</li>
</ul>
<p><strong>è° (User) æ‹¥æœ‰ä»€ä¹ˆæƒé™ (Authorityï¼‰å»æ“ä½œ (Operation) å“ªäº›èµ„æº (Resource)</strong><br />
 æ ¹æ®è§’è‰²å®Œæˆæƒé™çš„æ§åˆ¶ - RBAC (role based access control)ï¼Œå…¶å®å°±æ˜¯åœ¨åŸæœ¬ç”¨æˆ· ------- æƒé™çš„å¯¹åº”å…³ç³»ä¹‹ä¸ŠåŠ ä¸€å±‚ä¸­é—´å±‚è§’è‰²ï¼šç”¨æˆ· ------ è§’è‰² ----- æƒé™ã€‚å¥½å¤„æ˜¯<strong>ä½¿å¾—ç”¨æˆ·å’Œæƒé™çš„å¯¹åº”å…³ç³»æ›´åŠ æ¸…æ™°å’Œæ˜“äºæŒæ§</strong>ã€‚</p>
<h3 id="ä½¿ç”¨"><a class="anchor" href="#ä½¿ç”¨">#</a> ä½¿ç”¨</h3>
<p>Node.js å®ç° RBAC çš„åº“ï¼š</p>
<ul>
<li>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29udXJ5L2FjY2Vzc2NvbnRyb2w=">AccessControl.jsï¼ˆä¸æ¨èï¼Œä¸ç»´æŠ¤äº†ï¼‰</span></p>
<ul>
<li>1.6k Star</li>
<li>3 å¹´æ²¡æœ‰æ›´æ–°ï¼Œå¾ˆå¤š issue æ²¡äººå¤„ç†</li>
<li>ä¸æ”¯æŒ ts</li>
</ul>
</li>
<li>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nhc2Jpbi9ub2RlLWNhc2Jpbg==">Casbin</span></p>
<ul>
<li>1.7k Star</li>
<li>ts ç¼–å†™ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€</li>
<li>æ¦‚å¿µæ¯”è¾ƒå¤æ‚ï¼Œä½¿ç”¨ç•¥ç¹ç</li>
</ul>
</li>
<li>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N0YWxuaXkvY2FzbA==">Casl</span></p>
<ul>
<li>
<p>3.4k Star</p>
</li>
<li>
<p>ts ç¼–å†™</p>
</li>
<li>
<p>ç®€å•æ˜“ç”¨ï¼Œå¯è¯»æ€§è‰¯å¥½</p>
</li>
</ul>
</li>
</ul>
<h3 id="caslä½¿ç”¨"><a class="anchor" href="#caslä½¿ç”¨">#</a> <strong>Casl ä½¿ç”¨</strong></h3>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> AbilityBuilder <span class="token punctuation">,</span> Ability <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'@casl/ability'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Work</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">attrs</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>attrs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">const</span> templateWork <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Work</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">,</span> <span class="token literal-property property">isTemplate</span> <span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> notWork <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Work</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span> <span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">,</span> <span class="token literal-property property">isTemplate</span> <span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">function</span> <span class="token function">defineRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> can <span class="token punctuation">,</span> cannot <span class="token punctuation">,</span>build <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbilityBuilder</span><span class="token punctuation">(</span>Ability<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">can</span><span class="token punctuation">(</span><span class="token string">'read'</span><span class="token punctuation">,</span><span class="token string">'Work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">cannot</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">,</span><span class="token string">'Work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">can</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">,</span><span class="token string">'Work'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">isTemplate</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">return</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>templateWork<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">const</span> rules <span class="token function">defineRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rules<span class="token punctuation">.</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token string">'read'</span><span class="token punctuation">,</span><span class="token string">'Work'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rules<span class="token punctuation">.</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token string">'delete'</span><span class="token punctuation">,</span><span class="token string">'Work'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rules<span class="token punctuation">.</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">,</span>templateWork<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rules<span class="token punctuation">.</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">,</span>notWork<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="éƒ¨ç½²-2"><a class="anchor" href="#éƒ¨ç½²-2">#</a> éƒ¨ç½²</h1>
<h3 id="ä¼ ç»Ÿæ¨¡å¼"><a class="anchor" href="#ä¼ ç»Ÿæ¨¡å¼">#</a> ä¼ ç»Ÿæ¨¡å¼</h3>
<p><strong>æœ¬åœ°å¼€å‘</strong><br />
ä½¿ç”¨<span class="exturl" data-url="aHR0cHM6Z2l0aHViLmNvbS9lZ2dqcy9lZ2ctYmlu"> egg-bin</span>ï¼Œæä¾›äº†ä¾¿æ·çš„æ–¹å¼åœ¨æœ¬åœ°è¿›è¡Œå¼€å‘ã€è°ƒè¯•ã€å•å…ƒæµ‹è¯•ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨çš„ç›‘æ§æ–‡ä»¶çš„ä¿®æ”¹ï¼Œç„¶åé‡æ–°è¿è¡Œå¯¹åº”çš„å‘½ä»¤ã€‚<br />
é‡‡ç”¨çš„é…ç½®æ–‡ä»¶æ˜¯ï¼šconfig.default.ts<br />
 å¯åŠ¨å¼€å‘ç¯å¢ƒå‘½ä»¤ä¸º <code>egg-bin dev</code> <br />
<strong> ç”Ÿäº§ç¯å¢ƒè¿è¡Œç¨‹åº</strong><br />
<span class="exturl" data-url="aHR0cHM6Ly9wbTIua2V5bWV0cmljcy5pby8="> pm2-process manager</span></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">node</span> script.js </pre></td></tr><tr><td data-num="2"></td><td><pre>pm2 start script.js</pre></td></tr></table></figure><p><strong>PM2 çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>clusterï¼ˆé›†ç¾¤ï¼‰æ¨¡å¼è¿è¡Œ</li>
<li>è‡ªåŠ¨é‡å¯ auto reload</li>
<li>çƒ­æ›¿æ¢ hot reload</li>
<li>æ€§èƒ½ç›‘æ§ Monitoring</li>
</ul>
<p><strong>egg.js ä¸­æœ‰å¯¹åº”äº PM2 çš„å†…ç½®æ–¹æ³•ï¼š</strong></p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VnZ2pzL2VnZy1zY3JpcHRz">egg-scripts</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VnZ2pzL2VnZy1jbHVzdGVy">egg-cluster</span></li>
</ul>
<p><strong>egg.js ç”Ÿäº§ç¯å¢ƒå¯åŠ¨å’Œå…³é—­</strong></p>
<pre><code class="language-cmd">egg-scripts start
egg-scripts stop
</code></pre>
<p><strong>é…ç½®æ–‡ä»¶</strong><br />
 config.prod.ts å’Œ config.default.ts<br />
<strong> ç¼–è¯‘è¿‡ç¨‹</strong><br />
éœ€è¦æ‰‹åŠ¨å°† ts è½¬æ¢ä¸º js, å€ŸåŠ©<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3doeGF4ZXMvZWdnLXRzLWhlbHBlcg=="> ets</span><br />
 <code>ç‰¹åˆ«æ³¨æ„å°†é¡¹ç›®ä¸­çš„typscriptç‰ˆæœ¬å‡çº§åˆ°4.4.3 </code></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> run tsc</pre></td></tr></table></figure><h3 id="clusteræ¨¡å‹"><a class="anchor" href="#clusteræ¨¡å‹">#</a> Cluster æ¨¡å‹</h3>
<p><strong>Egg.js Cluster æ¨¡å‹çš„åŸç†</strong><br />
 Egg.js å…³äºè¿™éƒ¨åˆ†å†…å®¹çš„æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly9lZ2dqcy5vcmcvemgtY24vY29yZS9jbHVzdGVyLWFuZC1pcGMuaHRtbA==">https://eggjs.org/zh-cn/core/cluster-and-ipc.html</span><br />
<strong> ä¸ºä»€ä¹ˆè¦é‡‡ç”¨ Cluster æ¨¡å¼</strong><br />
 JavaScript ä»£ç æ˜¯è¿è¡Œåœ¨å•çº¿ç¨‹ä¸Šçš„ï¼Œé‚£ä¹ˆå¦‚æœç”¨ Node.js æ¥åš Web Server, å°±æ— æ³•äº«å—åˆ°å¤šæ ¸è¿ç®—çš„å¥½å¤„ã€‚<br />
<strong>ä»€ä¹ˆæ˜¯ Cluster æ¨¡å¼</strong><br />
æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cDovL25vZGVqcy5jbi9hcGkvY2x1c3Rlci5odG1s">http://nodejs.cn/api/cluster.html</span></p>
<p>Node.js çš„å•ä¸ªå®ä¾‹åœ¨å•ä¸ªçº¿ç¨‹ä¸­è¿è¡Œã€‚ä¸ºäº†åˆ©ç”¨å¤šæ ¸ç³»ç»Ÿï¼Œç”¨æˆ·æœ‰æ—¶ä¼šæƒ³<br />
è¦å¯åŠ¨ Node.js è¿›ç¨‹çš„é›†ç¾¤æ¥å¤„ç†è´Ÿè½½ã€‚</p>
<ul>
<li>åœ¨æœåŠ¡å™¨ä¸ŠåŒæ—¶å¯åŠ¨å¤šä¸ªè¿›ç¨‹</li>
<li>æ¯ä¸ªè¿›ç¨‹é‡Œéƒ½è·‘çš„æ˜¯åŒä¸€ä»½æºä»£ç ï¼ˆå°†ä¸€ä¸ªè¿›ç¨‹çš„å·¥ä½œåˆ†ç»™å¤šä¸ªè¿›ç¨‹å»åšï¼‰</li>
<li>è¿™äº›è¿›ç¨‹å¯ä»¥åŒæ—¶ç›‘å¬ä¸€ä¸ªç«¯å£</li>
</ul>
<p><strong>Cluster çš„è¿è¡Œæ¨¡å¼ï¼š</strong></p>
<p>Request-------------master_process ä¸»è¿›ç¨‹ ---------------------workers è¿›ç¨‹ï¼ˆå¤šä¸ªï¼‰</p>
<p><strong>è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ï¼š</strong></p>
<p><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU4JUExJThDJUU3JUE4JThCJUU5JTk2JTkzJUU5JTgwJTlBJUU4JUE4JThB">IPC Inter-Process Communication</span></p>
<p>IPC æŒ‡çš„æ˜¯è‡³å°‘ä¸¤ä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹é—´ä¼ é€æ•°æ®æˆ–ä¿¡å·çš„ä¸€äº›æŠ€æœ¯æˆ–è€…æ–¹æ³•ï¼ŒNode.js å°†å…¶å°è£…ä¸ºåŸºäºäº‹ä»¶çš„å½¢å¼ä¾¿äºä½¿ç”¨ã€‚</p>
<p><strong>Cluster ä½¿ç”¨ï¼š</strong></p>
<figure class="highlight js"><figcaption data-lang="JavaScript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">'http'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> cluster <span class="token keyword">from</span> <span class="token string">'cluster'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> cpus <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'os'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> process <span class="token keyword">from</span> <span class="token string">'process'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">if</span><span class="token punctuation">(</span>cluster<span class="token punctuation">.</span>isPrimary<span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment">// é€šè¿‡ cluster.isPrimary æ¥åˆ†æ”¯å¤„ç†ä¸»è¿›ç¨‹å’Œ worker è¿›ç¨‹</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">master </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>process<span class="token punctuation">.</span>pid<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> running</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">const</span> cpuLength <span class="token operator">=</span> <span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cpuLength <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        cluster<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    cluster<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">worker</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">worker </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>worker<span class="token punctuation">.</span>process<span class="token punctuation">.</span>pid<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> exited</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token comment">// åˆ†æ”¯åˆ¤æ–­åˆ°æ˜¯ worker è¿›ç¨‹ï¼Œcluster.fork () å¤åˆ¶çš„ worker è¿›ç¨‹éƒ½ä¼šè¿›å…¥</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">worker </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span> process<span class="token punctuation">.</span>pid <span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> started</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cluster<span class="token punctuation">.</span>workers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å¾—å­è¿›ç¨‹ï¼Œå¯ä»¥é€šè¿‡ process.send å’Œ on ('message') äº‹ä»¶è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>egg.js ä¸­å¯¹äº Cluster çš„äºŒæ¬¡å°è£…ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ egg-scripts å¯åŠ¨ master process</li>
<li>ä½¿ç”¨ egg-cluster å¯åŠ¨å’Œ CPU æ ¸æ•°ç›¸ç­‰çš„ app_worker process</li>
<li>ä½¿ç”¨ egg-cluster å¯åŠ¨çš„ä¸€ä¸ªç‹¬ç‰¹çš„ agent_worker process</li>
</ul>
<p><strong>è¿›ç¨‹å®ˆæŠ¤</strong><br />
è€ƒè™‘åˆ°ç”Ÿäº§ç¯å¢ƒçš„å¥å£®æ€§ï¼Œå¿…é¡»ä¿è¯è¿›ç¨‹å¼‚å¸¸çš„æƒ…å†µä¸‹æ€æ ·å¤„ç†ã€‚<br />
<strong>å½“ä»£ç æŠ›å‡ºå¼‚å¸¸å¹¶æ²¡æœ‰è¢«æ•è·çš„æ—¶å€™ï¼Œworker ä½¿ç”¨ process.on ('uncaughtException',handler) æ¥æ•è·å¯¹åº”çš„é”™è¯¯ï¼Œè¿™æ—¶è¿›ç¨‹å¤„äºä¸ç¡®å®šçš„çŠ¶æ€ï¼Œéœ€è¦ä¼˜é›…é€€å‡ºã€‚</strong></p>
<p><strong>ç³»ç»Ÿå¼‚å¸¸</strong><br />
è€Œå½“ä¸€ä¸ªè¿›ç¨‹å‡ºç°å¼‚å¸¸å¯¼è‡´ crash æˆ–è€…è¢«ç³»ç»Ÿæ€æ­»æ—¶ï¼Œä¸åƒæœªæ•è·å¼‚å¸¸å‘ç”Ÿæ—¶æˆ‘ä»¬è¿˜æœ‰æœºä¼šè®©è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼ŒMaster ç«‹åˆ» fork ä¸€ä¸ªæ–°çš„ Workerã€‚<br />
<strong>Agent æœºåˆ¶</strong><br />
æœ‰ä¸€äº›ç‰¹æ®Šæ€§è´¨çš„å·¥ä½œï¼Œä¸èƒ½å¤šä¸ª worker ä¸€èµ·åˆä½œï¼Œå®¹æ˜“é€ æˆæ··ä¹±ã€‚å¯¹äºè¿™ç§å·¥ä½œ egg.js æä¾›äº†ä¸€ä¸ªæ–°çš„ agent è¿›ç¨‹æ¥å®Œæˆã€‚</p>
<p><strong>Egg.js ä¸‰ç§è¿›ç¨‹çš„æ€»ç»“ï¼š</strong></p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>è¿›ç¨‹æ•°é‡</th>
<th>ä½œç”¨</th>
<th>ç¨³å®šæ€§</th>
<th>æ˜¯å¦è¿è¡Œä¸šåŠ¡ä»£ç </th>
</tr>
</thead>
<tbody>
<tr>
<td>Master è¿›ç¨‹</td>
<td>1</td>
<td>è¿›ç¨‹ç®¡ç†ï¼Œè¿›ç¨‹é—´æ¶ˆæ¯è½¬å‘</td>
<td>éå¸¸é«˜</td>
<td>å¦</td>
</tr>
<tr>
<td>Agent è¿›ç¨‹</td>
<td>1</td>
<td>åå°è¿è¡Œå·¥ä½œ</td>
<td>é«˜</td>
<td>å°‘é‡</td>
</tr>
<tr>
<td>Workers è¿›ç¨‹</td>
<td>CPU æ ¸æ•°</td>
<td>æ‰§è¡Œä¸šåŠ¡ä»£ç </td>
<td>ä¸€èˆ¬</td>
<td>æ˜¯</td>
</tr>
</tbody>
</table>
<p><strong>Cluster æ¨¡å‹å’Œ Node å¤šè¿›ç¨‹çš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li>Cluster æ¨¡å—å¯ä»¥å°†ä¸€ä¸ª node è¿›ç¨‹åˆ†è£‚æˆå¤šä¸ªå­è¿›ç¨‹ï¼Œæ¯ä¸ªå­è¿›ç¨‹ç‹¬ç«‹è¿è¡Œåœ¨ cpu å†…æ ¸ä¸Šï¼Œä»¥æå‡åº”ç”¨ç¨‹åºçš„å¹¶å‘èƒ½åŠ›å’Œæ€§èƒ½ï¼Œé€šè¿‡ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œå¤„ç†å¹¶å‘è¯·æ±‚ã€‚</li>
<li>node å¤šè¿›ç¨‹ä½¿ç”¨ child_process æ¨¡å—ï¼Œå…¶ä¸å…·å¤‡è´Ÿè½½å‡è¡¡å’Œé€šä¿¡æœºåˆ¶ï¼Œéœ€è¦è‡ªè¡Œå®ç°è¿›ç¨‹é—´é€šä¿¡å’Œè´Ÿè½½å‡è¡¡é€»è¾‘ã€‚å¯ç”¨äºå¤„ç†é•¿æ—¶æ“ä½œï¼Œè¿”å›ç»“æœç»™ä¸»è¿›ç¨‹ã€‚</li>
</ul>
<p><strong>Node.js å‹åŠ›æµ‹è¯•å·¥å…·ï¼š</strong></p>
<p>æ¨¡æ‹Ÿé«˜å¹¶å‘åœºæ™¯ï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbG9hZHRlc3Q=">Loadtest</span></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># n                   æ€»è¿‡å‘é€å¤šå°‘ä¸ªè¯·æ±‚</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># c concurrency       åŒæ—¶æœ‰å‡ ä¸ªå®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># rps request per seconds   æ¯ç§’å‘é€å¤šå°‘ä¸ªè¯·æ±‚</span></pre></td></tr><tr><td data-num="4"></td><td><pre>loadtest <span class="token parameter variable">-n</span> <span class="token number">400</span> <span class="token parameter variable">-c</span> <span class="token number">10</span> <span class="token parameter variable">--rps</span> <span class="token number">200</span> http://mysite.com/</pre></td></tr></table></figure><h1 id="äº‘æœåŠ¡å™¨"><a class="anchor" href="#äº‘æœåŠ¡å™¨">#</a> äº‘æœåŠ¡å™¨</h1>
<h4 id="è´­ä¹°"><a class="anchor" href="#è´­ä¹°">#</a> è´­ä¹°</h4>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYWxpeXVuLmNvbS9wcm9kdWN0L2Vjcw==">é˜¿é‡Œäº‘ ECS</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9wcm9kdWN0L2N2bQ==">è…¾è®¯äº‘ CVM</span></p>
<p>ä»·æ ¼ï¼ˆå­¦ç”Ÿä¼˜æƒ ï¼‰ï¼š<span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9hY3QvY2FtcHVzP2Zyb209MTQ1OTk=">https://cloud.tencent.com/act/campus?from=14599</span> 12G 38</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuaHVhd2VpY2xvdWQuY29tL3Byb2R1Y3QvZWNzLmh0bWw=">åä¸ºäº‘ ECS</span></p>
<h4 id="ç™»å½•"><a class="anchor" href="#ç™»å½•">#</a> ç™»å½•</h4>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ root ç™»å½•æ—¶ä¸€ä¸ªä¸å¥½çš„å®è·µ</strong></p>
<ul>
<li>æœ‰éå¸¸å¤šçš„ bot ä¼šå°è¯•ä½¿ç”¨ root+pwd çš„ ssh æ–¹å¼æš´åŠ›ç™»å½•æœºå™¨ï¼Œå½“å°è¯•æˆåŠŸä»¥åï¼Œé»‘å®¢å°±ä¼šæ§åˆ¶æ•´ä¸ªç³»ç»Ÿã€‚</li>
<li>å‡å¦‚ä½¿ç”¨ç‰¹å®šç”¨æˆ·å + pwd,bot éœ€è¦å…ˆçŒœæµ‹ç”¨æˆ·å (N æ¬¡)ï¼Œç„¶åæ˜¯å¯†ç  (M æ¬¡)ï¼Œè¿™æ ·å¤æ‚åº¦æå‡åˆ° N*M</li>
<li>root å¯ä»¥é€ æˆæ›´å¤§çš„å±å®³ï¼Œå½±å“æ•´ä¸ªç³»ç»Ÿï¼Œè€ŒæŸä¸ªç‰¹å®šç”¨æˆ·åªèƒ½å½±å“å®ƒçš„æ–‡ä»¶ç³»ç»Ÿ</li>
</ul>
<p><strong>åˆ›å»ºä¸€ä¸ªç”¨æˆ·è´¦å·è¿›è¡Œç™»å½•</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># è¿œç¨‹ç™»å½•</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">ssh</span> root@xxx.xx.xx.xx</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># æ·»åŠ ç”¨æˆ·ä»¥åŠè®¾ç½®å¯†ç </span></pre></td></tr><tr><td data-num="4"></td><td><pre>adduser dmq</pre></td></tr></table></figure><p><strong>è®¾ç½®è¯¥ç”¨æˆ·æ‹¥æœ‰ sudo æƒé™ï¼Œç»™äºˆå®ƒåœ¨ç™»å½•ä»¥ååˆ‡æ¢åˆ° root çš„èƒ½åŠ›</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># ä¿®æ”¹æƒé™ï¼Œu è¡¨ç¤ºæ‰€æœ‰è€…ï¼Œw è¡¨ç¤ºå†™æƒé™ + è¡¨ç¤ºæ·»åŠ </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">chmod</span> u+w /etc/sudoers</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># ç¼–è¾‘æ–‡ä»¶</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">vim</span> /etc/sudoers</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># æ‰¾åˆ°  `root ALL=(ALL)  ALL`</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># å†åŠ ä¸€è¡Œ  `dmq ALL=(ALL)  ALL`</span></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æ–°ç”¨æˆ·ç™»å½•å¹¶ä¸”æµ‹è¯•æƒé™</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ssh</span> dmq@xxx.xx.xx.xx</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># å¯ä»¥ä½¿ç”¨ su ç›´æ¥åˆ‡æ¢ä¸º root ç”¨æˆ·</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨ sudo å¿«æ·çš„ä½¿ç”¨ root æƒé™è¿›è¡Œæ“ä½œ</span></pre></td></tr></table></figure><p><strong>ç¦æ­¢ä½¿ç”¨ root è¿œç¨‹ç™»å½• ssh</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># ä¿®æ”¹ ssh é…ç½®</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">vim</span> /etc/ssh/sshd_config I</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># ä¿®æ”¹ yes ä¸º no</span></pre></td></tr><tr><td data-num="4"></td><td><pre>PermitRootLogin no</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># é‡å¯ sshd æœåŠ¡</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">service</span> sshd restart</pre></td></tr></table></figure><p><strong>å¯é€‰ï¼šä¸ä½¿ç”¨å¯†ç ç™»å½•</strong><br />
ä¸ºä»€ä¹ˆä½¿ç”¨å¯†ç ç™»å½•æœ‰æ—¶å€™æ˜¯ä¸€ä¸ªä¸å¥½çš„å®è·µï¼Ÿ<br />
<strong>éå¸¸ç®€å•ï¼šç”¨æˆ·ç»å¸¸ä½¿ç”¨éå¸¸é”™è¯¯ï¼ˆç®€å•çš„ï¼‰ç”¨æˆ·å¯†ç ï¼Œå…¨çƒæœ€å¸¸ç”¨çš„å¯†ç æ˜¯ 123456 ä»¥åŠ bc123, è€Œä¸”ç”¨æˆ·ä¼šåœ¨å¤šä¸ªè´¦æˆ·å¤§é‡é‡å¤ä½¿ç”¨ï¼Œæ‰€ä»¥é»‘å®¢ä»åˆ«çš„åœ°æ–¹ç›—å–çš„å¯†ç å¾ˆå¯èƒ½åœ¨å…¶ä»–è´¦æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨</strong></p>
<p><strong>ä½¿ç”¨ SSH kev è¿›è¡Œç™»å½•</strong><br />
 SSH key é‡‡è§’äº†ç»å…¸çš„éå¯¹ç§°åŠ å¯†æŠ€æœ¯ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·åˆ›å»ºä¸€ä¸ªå…¬é’¥å’Œç§é’¥ï¼Œä½ å¯ä»¥å°†å…¬é’¥æ”¾ç½®åœ¨ä»»ä½•çš„æœåŠ¡å™¨å½“ä¸­ï¼Œåœ¨æœ¬åœ°ä¿ç•™ç§é’¥ã€‚åœ¨ ssh ç™»å½•çš„æ—¶å€™ï¼ŒSSH éªŒè¯å…¬é’¥å’Œç§é’¥çš„åˆæ³•æ€§ï¼Œå½“åˆæ³•çš„æ—¶å€™ï¼Œå°±å¯ä»¥å…å¯†ç ç™»å½•äº†ã€‚è¯ä¹¦ç”± 1024Bits åˆ° 4096Bitsï¼ˆ128 åˆ° 512 å­—ç¬¦) çš„éšæœºå­—ç¬¦ç»„æˆï¼Œè¦æ¯”ä½ è‡ªå·±çš„å¯†ç å®‰å…¨çš„å¤šã€‚</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#åˆ›å»º ssh key pair</span></pre></td></tr><tr><td data-num="2"></td><td><pre>ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-b</span> <span class="token number">4096</span> <span class="token parameter variable">-C</span> <span class="token string">"your email@example.com"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>windowså¯ä»¥ä½¿ç”¨puttyæˆ–è€…git scmaè½¯ä»¶ç”Ÿæˆï¼Œå¤‡æ³¨ç½‘å€ï¼š</pre></td></tr><tr><td data-num="4"></td><td><pre>https://www.jianshu.com/p/95262f5eba7a</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># æœ¬åœ° ssh è¯ä¹¦çš„ä½ç½®</span></pre></td></tr><tr><td data-num="6"></td><td><pre>-/.ssh/id rsa</pre></td></tr><tr><td data-num="7"></td><td><pre>-/.ssh/id rsa.pub</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># ç™»å½•è¿œç¨‹æœºå™¨</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">ssh</span> viking@xxx.xx.xx.xx</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># åˆ›å»ºå—ä¿¡ä»»çš„ç™»å½•å¯†é’¥</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># è¿™ä¸ªæ–‡ä»¶å½“ä¸­çš„å…¬é’¥ä¼šè¢«å½“å‰çš„ä¸»æœºè®¾ç½®ä¸ºä¿¡ä»»æ–¹</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">touch</span> -/.ssh/authorized keys</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># å°† id rsa.pub çš„æ–‡æœ¬å†…å®¹é»è´´è¿›æ¥</span></pre></td></tr></table></figure><p><strong>å¯é€‰ï¼Œå…³é—­å¯†ç ç™»å½•æœåŠ¡å™¨çš„åŠŸèƒ½</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">vim</span> /etc/ssh/sshd config</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#ä¿®æ”¹ä¸º no</span></pre></td></tr><tr><td data-num="3"></td><td><pre>PasswordAuthentication no</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#é‡å¯æœåŠ¡</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">service</span> sshd i restart</pre></td></tr></table></figure><h4 id="ä½¿ç”¨-2"><a class="anchor" href="#ä½¿ç”¨-2">#</a> ä½¿ç”¨</h4>
<p><strong>å‡†å¤‡äº‘æœåŠ¡å™¨å¿…å¤‡è½¯ä»¶</strong></p>
<ul>
<li>nodejs (16)</li>
<li>MongoDB</li>
<li>Redis</li>
<li>Git</li>
</ul>
<p><strong>Linux å‘è¡Œç‰ˆçš„ä¸¤å¤§å®¶æ—</strong></p>
<ul>
<li>Debian (å®Œå…¨å…è´¹çš„ Linux å‘è¡Œç‰ˆ)-Ubuntu (åŸºäº Debian, æ›´åŠ å®¹æ˜“ä¸Šæ‰‹)-apt åŒ…ç®¡ç†ç³»ç»Ÿ - è½¯ä»¶æ ¼å¼ä¸º deb åŒ…å¤§</li>
<li>Red Hat (å•†ç”¨ Linux å‘è¡Œç‰ˆ)-CentOS (Red Hat å‡å»æ”¶è´¹è½¯ä»¶)-yum åŒ…ç®¡ç†ç³»ç»Ÿ - è½¯ä»¶æ ¼å¼ä¸º rpm</li>
</ul>
<p><strong>è½¯ä»¶å®‰è£…</strong><br />
<strong>å®‰è£… Node.js</strong><br />
1 å®‰è£… nvm ç®¡ç† node ç‰ˆæœ¬ https://github.com/nvm-sh/nvm<br />
2 ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£… node æœ€æ–°ç‰ˆæœ¬ https://github.com/nodesource/distributions/blob/master/README.md#deb</p>
<p><strong>å®‰è£… MongoDB</strong><br />
1 ä»æºä»£ç ä¸‹è½½å®‰è£…ï¼Œå›é¡¾ä¹‹å‰çš„å†…å®¹<br />
 2 ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…<br />
 Ubuntu:<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC90dXRvcmlhbC9pbnN0YWxsLW1vbmdvZGItb24tdWJ1bnR1Lw==">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/</span><br />
Centos:<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC90dXRvcmlhbC9pbnN0YWxsLW1vbmdvZGItb24tcmVkLWhhdC8=">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/</span></p>
<p><strong>å®‰è£… Redis</strong><br />
1 ä»æºä»£ç ä¸‹è½½å®‰è£…ï¼Œå›é¡¾ä¹‹å‰çš„åŸºç¡€çŸ¥è¯†<br />
 2 ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…<br />
 CentOS:<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlnaXRhbG9jZWFuLmNvbS9jb21tdW5pdHkvdHV0b3JpYWxzL2hvdy10by1pbnN0YWxsLXNlY3VyZS1yZWRpcy1jZW50b3MtNw==">https://www.digitalocean.com/community/tutorials/how-to-install-secure-redis-centos-7</span><br />
Ubuntu:<span class="exturl" data-url="aHR0cHM6Ly93d3cuZGlnaXRhbG9jZWFuLmNvbS9jb21tdW5pdHkvdHV0b3JpYWxzL2hvdy10by1pbnN0YWxsLWFuZC1zZWN1cmUtcmVkaXMtb24tdWJ1bnR1LTE4LTA0">https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04</span></p>
<h4 id="ç®¡ç†"><a class="anchor" href="#ç®¡ç†">#</a> ç®¡ç†</h4>
<p><strong>ä½¿ç”¨ service æˆ–è€… systemctl ç®¡ç†æœåŠ¡</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># systemd æ¨¡å— - https://en.wikipedia.org/wiki/Systemd</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">service</span>  æœåŠ¡åç§°<span class="token punctuation">(</span>mongod<span class="token punctuation">)</span>  æ“ä½œæŒ‡ä»¤<span class="token punctuation">(</span>status/start/stop/restart<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>systemctl  æ“ä½œæŒ‡ä»¤<span class="token punctuation">(</span>start/stop/status/restart/reload<span class="token punctuation">)</span>  æœåŠ¡åç§°service</pre></td></tr></table></figure><h1 id="æ™®é€šéƒ¨ç½²"><a class="anchor" href="#æ™®é€šéƒ¨ç½²">#</a> æ™®é€šéƒ¨ç½²</h1>
<p><strong>åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²å¹¶è¿è¡Œ</strong></p>
<ul>
<li>
<p>ç™»å½•è¿œç¨‹æœºå™¨ï¼Œä½¿ç”¨æ™®é€šç”¨æˆ·ã€‚</p>
</li>
<li>
<p>åœ¨è‡ªå·±çš„ç›®å½•ä¸‹é¢ï¼Œclone ä»£ç </p>
</li>
<li>
<p>å®‰è£…å¯¹åº”çš„ä¾èµ–</p>
<ul>
<li>
<p>å¯ä»¥ä½¿ç”¨ sharp æ·˜å® mirror æ¥å®‰è£…æ¯”è¾ƒå¤§çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><span class="exturl" data-url="aHR0cHM6Ly9zaGFycC5waXhlbHBsdW1iaW5nLmNvbS9pbnN0YWxsI2NoaW5lc2UtbWlycm9y">https://sharp.pixelplumbing.com/install#chinese-mirror</span></p>
</li>
</ul>
</li>
<li>
<p>åˆ›å»ºå¹¶ä¸”è®¾ç½®.env æ–‡ä»¶</p>
</li>
<li>
<p>å¼€å¯äº‘æœåŠ¡å¯¹åº”çš„ç«¯å£ (7001) è®¿é—®ã€‚</p>
<ul>
<li>
<p>é˜¿é‡Œäº‘ï¼šå·¦ä¾§å¯¼èˆª â€œæœ¬å®ä¾‹å®‰å…¨ç»„â€ï¼Œâ€œé…ç½®è§„åˆ™â€ï¼Œâ€œæ‰‹åŠ¨æ·»åŠ  &quot; ç«¯å£</p>
</li>
<li>
<p>å…¶ä»–äº‘å¹³å°è¯·è‡ªè¡ŒæŸ¥çœ‹ã€‚</p>
</li>
</ul>
</li>
<li>
<p>å¯åŠ¨æœåŠ¡å™¨</p>
<ul>
<li>
<p>ç¡®è®¤ mongoï¼Œredis åœ¨è¿è¡ŒçŠ¶æ€</p>
</li>
<li>
<p>npm run tsc</p>
</li>
<li>
<p>npm run start</p>
</li>
</ul>
</li>
</ul>
<p>äºæ­¤å¯ä»¥å®ŒæˆåŸºæœ¬çš„é¡¹ç›®éƒ¨ç½²ï¼Œä½†æ˜¯è¿™ç§éƒ¨ç½²æ–¹å¼å¯åŠ¨å’Œæ›´æ–°æ—¶è¿‡äºå¤æ‚ï¼Œå­˜åœ¨å¦‚ä¸‹é—®é¢˜ï¼š</p>
<p>ä¸‰ä¸ªé—®é¢˜</p>
<ul>
<li>å‰ç½®è½¯ä»¶çš„å®‰è£…ï¼Œå®ƒä»¬åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸­å®‰è£…çš„æ–¹å¼ï¼Œå¯åŠ¨çš„è„šæœ¬ï¼Œé¢„è®¾åˆå§‹çš„æ–¹å¼æœ‰å¯èƒ½éƒ½ä¸ç›¸åŒï¼Œè¿™å°±ç»™æˆ‘ä»¬é€ æˆä¸€ä¸ªå¾ˆå¤§çš„å›°æ‰°ï¼Œå‡å¦‚ä½ åœ¨å¤šå°æœºå™¨ä¸Šéƒ¨ç½²çš„è¯ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ã€‚</li>
<li>é¡¹ç›®éœ€è¦è¿è¡Œä¸€ç³»åˆ—å¯¹åº”çš„å‘½ä»¤æ‰èƒ½å¯åŠ¨</li>
<li>é¡¹ç›®æ›´æ–°çš„é—®é¢˜ï¼Œéœ€è¦ä¸€ç³»åˆ—æ‰‹åŠ¨çš„æ­¥éª¤ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç¹çï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™çš„æ­¥éª¤ã€‚æœ‰æ²¡æœ‰æ›´æ–¹ä¾¿çš„æ–¹å¼å¯ä»¥å®Œæˆè¿™ä¸ªè¿‡ç¨‹å‘¢ï¼Ÿ
<ul>
<li>å®Œæˆå¯¹åº”çš„ pull ä»£ç ï¼Œæ›´æ–°ä¾èµ–ï¼Œå¯åŠ¨åº”ç”¨çš„è¿‡ç¨‹</li>
<li>æ˜¯åœ¨ç‰¹å®šçš„æäº¤è‡ªåŠ¨è§¦å‘è¿™ä¸ªè¿‡ç¨‹</li>
</ul>
</li>
</ul>
<p>æƒ³è¦æ›´åŠ æ–¹ä¾¿çš„è¿›è¡Œéƒ¨ç½²å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å·¥å…·ï¼š</p>
<h2 id="docker"><a class="anchor" href="#docker">#</a> <span class="exturl" data-url="aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS9wcm9kdWN0cy9kb2NrZXItZGVza3RvcA==">Docker</span></h2>
<h3 id="ä»‹ç»-4"><a class="anchor" href="#ä»‹ç»-4">#</a> ä»‹ç»</h3>
<p><strong>é—®é¢˜</strong><br />
æˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªå·¥å…·å¯ä»¥å¸®æˆ‘ä»¬ä¸€é”®æ™ºèƒ½éƒ¨ç½²ï¼Œå‡å¦‚ä½ è¦éƒ¨ç½²åœ¨å¤šå°ä¸åŒçš„æœºå™¨ä¸Šï¼Œå¯ä»¥ä¸ç”¨åœ¨æ‹…å¿ƒä¸åŒç³»ç»Ÿï¼Œä¸åŒç‰ˆæœ¬çš„å·®å¼‚ï¼Œä»¥åŠè¿è¡Œä¹‹å‰éœ€è¦å®‰è£…ä¸åŒè½¯ä»¶çš„ç—›è‹¦ã€‚<br />
<strong>è§£å†³</strong><br />
å½“çº¢çš„è™šæ‹ŸåŒ–è½¯ä»¶ï¼š<span class="exturl" data-url="aHR0cHM6L3d3dy5kb2NrZXIuY29tbA==">Docker</span><br />
Docker çš„è¿›åŒ–</p>
<p><img data-src="/images/Snipaste_2024-04-26_20-27-53.jpg" alt="Dockerçš„è¿›åŒ–" /></p>
<ul>
<li>ä¼ ç»Ÿè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿç¡¬ä»¶ä»¥åï¼Œéœ€è¦åœ¨ä¸Šé¢å®‰è£…ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿã€‚</li>
<li>Docker: æ¨å‡ºäº†å®¹å™¨çš„æ¦‚å¿µï¼Œæ¯ä¸ªå®¹å™¨ä¸éœ€è¦å®‰è£…å®Œæˆçš„æ“ä½œç³»ç»Ÿï¼Œé‡Œé¢çš„è¿›ç¨‹ç›´æ¥è¿è¡Œåœ¨ Docker åˆ›é€ çš„å®¿ä¸»å†…æ ¸ä¸­ï¼Œä¸éœ€è¦è™šæ‹Ÿç¡¬ä»¶ã€‚</li>
</ul>
<p><strong>Docker çš„ä¼˜ç‚¹</strong></p>
<ul>
<li>æ›´å¿«é€Ÿçš„å¯åŠ¨é€Ÿåº¦</li>
<li>æ›´å°‘çš„èµ„æºå ç”¨</li>
<li>ä¸€è‡´çš„è¿è¡Œç¯å¢ƒï¼Œä½¿ç”¨æˆ·ä¸å…³æ³¨æ“ä½œç³»ç»Ÿè€Œåªå…³å¿ƒåº”ç”¨ç¨‹åºã€‚</li>
<li>å¾®æœåŠ¡æ¶æ„ï¼Œdocker å¤©ç”Ÿé€‚é…å¾®æœåŠ¡æ¶æ„ï¼ˆDocker æœ‰åŠ©äºå°†ä¸€ä¸ªå¤æ‚ç³»ç»Ÿåˆ†è§£æˆä¸€ç³»åˆ—å¯ç»„åˆçš„éƒ¨åˆ†ï¼Œè¿™è®©ç”¨æˆ·å¯ä»¥ç”¨æ›´ç¦»æ•£çš„æ–¹å¼æ¥æ€è€ƒå…¶æœåŠ¡ã€‚ç”¨æˆ·å¯ä»¥åœ¨ä¸å½±å“å…¨å±€çš„å‰æä¸‹é‡ç»„è½¯ä»¶ï¼Œä½¿å…¶å„éƒ¨åˆ†æ›´æ˜“äºç®¡ç†å’Œå¯æ’æ‹”ã€‚ï¼‰</li>
<li>ç”¨æˆ·å¯ä»¥æ›´å‡†ç¡®åœ°æ§åˆ¶æ„å»ºç¯å¢ƒçš„çŠ¶æ€ï¼ŒDocker æ„å»ºæ¯”ä¼ ç»Ÿè½¯ä»¶æ„å»ºæ–¹æ³•æ›´å…·æœ‰å¯é‡ç°æ€§å’Œå¯å¤åˆ¶æ€§ã€‚ä½¿æŒç»­äº¤ä»˜çš„å®ç°å˜å¾—æ›´å®¹æ˜“ã€‚</li>
</ul>
<h3 id="docker-images"><a class="anchor" href="#docker-images">#</a> <strong>Docker  images</strong></h3>
<p>å¯ä»¥åœ¨ https://hub.docker.com/search?g=&amp;type=image ä¸­è·å–å„ç§å®˜æ–¹çš„é•œåƒï¼Œå¹¶ä¸”å¯ä»¥ä¸Šä¼ ä½ è‡ªå·±çš„è‡ªå®šä¹‰é•œåƒ<br />
 Docker é•œåƒä»“åº“è·å–é•œåƒçš„å‘½ä»¤æ˜¯ docker pull</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># ä¸‹è½½é•œåƒ</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">docker</span> pull <span class="token operator">&lt;</span>image-name<span class="token operator">></span>:<span class="token operator">&lt;</span>tag<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># æŸ¥çœ‹ä»¥åŠä¸‹è½½çš„é•œåƒ</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">docker</span> images</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># åˆ é™¤é•œåƒ</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">docker</span> rmi <span class="token operator">&lt;</span>image-id<span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># ä¸Šä¼ </span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">docker</span> push <span class="token operator">&lt;</span>username<span class="token operator">></span>/<span class="token operator">&lt;</span>repository<span class="token operator">></span>:<span class="token operator">&lt;</span>tag<span class="token operator">></span></pre></td></tr></table></figure><p><strong>ä½¿ç”¨é•œåƒä»£ç†ï¼š</strong></p>
<figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token string">"https://docker.mirrors.ustc.edu.cn/"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token string">"https://reg-mirror.qiniu.com"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><h3 id="docker-container"><a class="anchor" href="#docker-container">#</a> <strong>Docker Container</strong></h3>
<p><strong>å¯åŠ¨ Docker å®¹å™¨</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> ä¸»æœºç«¯å£:é•œåƒç«¯å£ <span class="token parameter variable">--name</span> å®¹å™¨åç§° é•œåƒåç§°</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># ä¾‹å¦‚ï¼šï¼ˆ--name å®¹å™¨åç§°çœç•¥ï¼‰</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">81</span>:80 nginx</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># -d  åå°è¿è¡Œ</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># -p  ç«¯å£æ˜ å°„ï¼Œ81 ä¸ºä¸»æœºçš„ç«¯å£ï¼Œ80 ä¸ºé•œåƒç«¯å£</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># --name è‡ªå®šä¹‰å®¹å™¨åç§°</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># é•œåƒåç§°ï¼Œå‡å¦‚æœ¬åœ°æ²¡æœ‰ï¼Œä¼šè‡ªåŠ¨ pull ä¸€æ¬¡é•œåƒè¿›è¡Œä¸‹è½½ã€‚</span></pre></td></tr></table></figure><p><strong>å…¶ä»–å‘½ä»¤</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">docker</span>  <span class="token function">ps</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># åœæ­¢å®¹å™¨</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">docker</span> stop container-id</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># åˆ é™¤å®¹å™¨</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">docker</span> <span class="token function">rm</span> container-id</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">docker</span> container start container-id</pre></td></tr></table></figure><p><strong>è¿›å…¥å®¹å™¨å†…éƒ¨</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>container-id<span class="token operator">></span> <span class="token builtin class-name">command</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token parameter variable">-i</span> <span class="token builtin class-name">:</span> å³ä½¿æ²¡æœ‰é™„åŠ ä¹Ÿä¿æŒSTDIN æ‰“å¼€</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token parameter variable">-t</span> <span class="token builtin class-name">:</span> åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯</pre></td></tr></table></figure><h3 id="æŒä¹…åŒ–å®¹å™¨æ•°æ®"><a class="anchor" href="#æŒä¹…åŒ–å®¹å™¨æ•°æ®">#</a> <strong>æŒä¹…åŒ–å®¹å™¨æ•°æ®</strong></h3>
<p>ä½¿ç”¨ - v å‚æ•°ï¼Œå¯ä»¥è®¾å®šä¸€ä¸ªæ•°æ®çš„æ˜ å°„å…³ç³»ï¼Œå°†æœ¬åœ°çš„æ–‡ä»¶æ˜ å°„åˆ°å®¹å™¨ä¸­å¯¹åº”çš„æ–‡ä»¶ä¸­å»ã€‚</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">81</span>:80 <span class="token parameter variable">-v</span> host:container image-name</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#ä¾‹å¦‚ï¼šå°†æœ¬åœ°æ•°æ®å·æ˜ å°„åˆ°å®¹å™¨ä¸­</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-v</span> /data/db:/data/db mongo</pre></td></tr></table></figure><p><strong>åˆ›å»ºå¯¹åº”çš„æ•°æ®å· volumn</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># åˆ›å»ºæ•°æ®å·</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">docker</span> volume create <span class="token operator">&lt;</span>volumn-name<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#ä¾‹å¦‚ï¼šdocker volume create mongo</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># ä½¿ç”¨ volumn æ•°æ®å·</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-v</span> <span class="token operator">&lt;</span>volumn-name<span class="token operator">></span>:/data/db mongo</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># ä¾‹å¦‚ï¼šdocker run -d -v mongo:/data/db mongo</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># æ£€æŸ¥æ•°æ®å·</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">docker</span> volume inspect <span class="token operator">&lt;</span>volumn-name<span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># åˆ é™¤æ•°æ®å·</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">docker</span> volume remove mongo</pre></td></tr></table></figure><h3 id="dockerfileè‡ªå®šä¹‰é•œåƒ"><a class="anchor" href="#dockerfileè‡ªå®šä¹‰é•œåƒ">#</a> Dockerfile è‡ªå®šä¹‰é•œåƒ</h3>
<p>Docker image ä¸­çš„é•œåƒè™½ç„¶éå¸¸å¤šï¼Œä½†æ˜¯ä¸èƒ½å®Œå…¨ç¬¦åˆè‡ªå·±é¡¹ç›®çš„å…¨éƒ¨éœ€æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰æ„å»ºä¸€ä¸ªè‡ªå·±çš„é•œåƒã€‚</p>
<p>Dockerfile æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ç³»åˆ—æŒ‡ä»¤ï¼Œç”¨äºæ„å»ºå¯¹åº”çš„é•œåƒã€‚</p>
<p><strong><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNmcm9t">æŒ‡ä»¤</span></strong></p>
<p><strong>Dockerfile ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight dockerfile"><figcaption data-lang="Docker"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æŒ‡å®šåŸºç¡€é•œåƒï¼Œä» node14 å¼€å§‹æ„å»º</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token instruction"><span class="token keyword">FROM</span> node:14</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œä½œä¸ºé¡¹ç›®è¿è¡Œçš„ä½ç½®</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token instruction"><span class="token keyword">RUN</span> mkdir -p /usr/src/app</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># æŒ‡å®šå·¥ä½œåŒºï¼Œåé¢çš„è¿è¡Œä»»ä½•å‘½ä»¤éƒ½æ˜¯åœ¨è¿™ä¸ªå·¥ä½œåŒºä¸­å®Œæˆçš„</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token instruction"><span class="token keyword">WORKDIR</span> /usr/sec/app</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># ä»æœ¬åœ°æ‹·è´å¯¹åº”çš„æ–‡ä»¶ åˆ° å·¥ä½œåŒº</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token instruction"><span class="token keyword">COPY</span> server.js /usr/src/app</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># æ‰§è¡Œå®‰è£…å‘½ä»¤</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token instruction"><span class="token keyword">RUN</span> npm install --registry=https://registry.npm.taobao.org</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token instruction"><span class="token keyword">RUN</span> npm run tsc</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">#å‘ŠçŸ¥å½“å‰ Docker image æš´éœ²çš„æ˜¯ 3000 ç«¯â˜</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token instruction"><span class="token keyword">EXPOSE</span> 3000</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">#æ‰§è¡Œå¯åŠ¨å‘½ä»¤ï¼Œä¸€ä¸ª Dockerfile åªèƒ½æœ‰ä¸€ä¸ª</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token instruction"><span class="token keyword">CMD</span> node server.js</span></pre></td></tr></table></figure><p><strong>æ„å»ºï¼š</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># è¿™é‡Œç‰¹åˆ«æ³¨æ„ä¸Šä¸‹æ–‡çš„æ¦‚å¿µï¼Œä¸è¦åœ¨æ ¹ç›®å½•ä½¿ç”¨ Dockerfi1e</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">docker</span> build <span class="token punctuation">[</span>é€‰é¡¹<span class="token punctuation">]</span> <span class="token operator">&lt;</span>ä¸Šä¸‹æ–‡è·¯å¾„/URL/-<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># ä¾‹å¦‚ï¼š(åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­è¿è¡Œ)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">docker</span> build <span class="token parameter variable">-t</span> test-node <span class="token builtin class-name">.</span></pre></td></tr></table></figure><p><strong>.dockerignore æ–‡ä»¶ç”¨äºå¿½ç•¥ docker ä¸­éœ€è¦æ‰“åŒ…è¿›é•œåƒçš„æ–‡ä»¶</strong></p>
<p><strong>.dockerignore ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight dockerfile"><figcaption data-lang="Docker"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Microbundle cache</span></pre></td></tr><tr><td data-num="2"></td><td><pre>.rpt2_cache/</pre></td></tr><tr><td data-num="3"></td><td><pre>.rts2_cache_cjs/</pre></td></tr><tr><td data-num="4"></td><td><pre>.rts2_cache_es/</pre></td></tr><tr><td data-num="5"></td><td><pre>.rts2_cache_umd/</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># Optional REPL history</span></pre></td></tr><tr><td data-num="7"></td><td><pre>.node_repl_history</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># Output of 'npm pack'</span></pre></td></tr><tr><td data-num="9"></td><td><pre>*.tgz</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># Yarn Integrity file</span></pre></td></tr><tr><td data-num="11"></td><td><pre>.yarn-integrity</pre></td></tr></table></figure><p><strong>å¤šä¸ªå®¹å™¨ç›¸äº’é€šä¿¡ï¼š</strong></p>
<p>è¦ç‚¹ï¼šDocker ä¸­æ¯ä¸€ä¸ª container åº”è¯¥åªå®Œæˆä¸€ä¸ªå·¥ä½œï¼Œå¹¶ä¸”å°†å®ƒåšå¥½ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>è§£è€¦ï¼Œè¿™æ ·ä¸åŒçš„æœåŠ¡å’Œåç«¯ä»£ç €éƒ½å¯ä»¥å®Œå…¨åˆ†ç¦»å¼€æ¥ï¼Œæ–¹ä¾¿ç®¡ç†ä»¥åŠæœªæ¥çš„æ‰©å±•ã€‚</li>
<li>æœåŠ¡çš„æ›´æ–°ä»¥åŠå‡çº§éƒ½æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚</li>
<li>åœ¨ä¸€ä¸ª container ä¸­ï¼Œå¯åŠ¨å¤šä¸ªä¸åŒçš„è¿›ç¨‹ï¼Œéœ€è¦ä¸€ä¸ªè¿›ç¨‹ç®¡ç†å™¨</li>
</ul>
<p><strong>é€šä¿¡è¿‡ç¨‹ï¼š</strong></p>
<p>docker å®¹å™¨ä¹‹é—´ä¸èƒ½ç›´æ¥è¿›è¡Œè®¿é—®ï¼Œè€Œæ˜¯åº”è¯¥é€šè¿‡ docker ç½‘ç»œè¿›è¡Œè®¿é—®ã€‚</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># åˆ›å»º docker ç½‘ç»œ</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">docker</span> network create <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># åœ¨åˆ›å»ºçš„ docker ç½‘ç»œä¸­å¯åŠ¨æœåŠ¡</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--network</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--name</span> mongo <span class="token parameter variable">-p</span> <span class="token number">27017</span>:27017 mongo</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># å°†åŸæ¥é¡¹ç›®ä¸­çš„çš„ ip åœ°å€æ›¿æ¢ä¸º docker çš„ name åç§°</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># ä¾‹å¦‚åŸæ¥ä¸ºï¼šmongodb://localhost:27017/api  çš„åœ°å€è¦æ›¿æ¢ä¸ºï¼š mongodb://mongo:27017/api</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># åªæœ‰åœ¨åŒä¸€ä¸ª docker ç½‘ç»œä¸­å¯åŠ¨çš„é¡¹ç›®é—´æ‰èƒ½è¿›è¡Œè®¿é—®ã€‚</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--network</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--name</span> use <span class="token parameter variable">-p</span> <span class="token number">80</span>:3000 use</pre></td></tr></table></figure><p>å¦‚æœæ¯ä¸ªå®¹å™¨éƒ½è¦è¿™æ ·æ“ä½œä¸€éå°±ä¼šæ˜¾å¾—éå¸¸éº»çƒ¦ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ Docer compose å·¥å…·ï¼ˆé…ç½® docker-compose.yml æ–‡ä»¶ï¼‰</p>
<p>Docker compose å·¥å…·</p>
<p>Docker compose æ˜¯ Docker å®˜æ–¹æ¨å‡ºçš„å·¥å…·ï¼Œç”¨æ¥ç®¡ç†å’Œå…±äº«å¤šä¸ªå®¹å™¨çš„åº”ç”¨ï¼ŒMac ç³»ç»Ÿå’Œ Windows ç³»ç»Ÿå®‰è£…å®¢æˆ·ç«¯æ—¶è‡ªå¸¦ã€‚<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29tcG9zZS9pbnN0YWxsLw==">Linux éœ€è¦å•ç‹¬å®‰è£…</span>ã€‚</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker-compose</span> version</pre></td></tr></table></figure><p><strong>é…ç½®ï¼š</strong></p>
<ul>
<li>docker compose é€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„ yml æ–‡ä»¶ï¼Œè¿›è¡Œé…ç½®ï¼Œè¿™ä¸ªæ–‡ä»¶å¿…é¡»å‘½åä¸º<strong> docker-compose.yml</strong></li>
<li>docker-compose æ‰€æœ‰çš„å­—æ®µå‚è€ƒæ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29tcG9zZS9jb21wb3NlLWZpbGUvY29tcG9zZS1maWxlLXYzLw==">https://docs.docker.com/compose/compose-file/compose-file-v3/</span></li>
</ul>
<p><strong>docker-compose.yml æ–‡ä»¶é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span> <span class="token comment"># docker æŒ‡ä»¤ç‰ˆæœ¬</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span> <span class="token comment"># è¦å¯åŠ¨çš„æœåŠ¡</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">test-mongo</span><span class="token punctuation">:</span> <span class="token comment"># æœåŠ¡åç§°ï¼Œè¿™é‡Œçš„æœåŠ¡åç§°å¯¹åº”ç€å®¹å™¨é€šä¿¡æ—¶çš„å‰ç¼€ï¼</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo <span class="token comment"># ä½¿ç”¨çš„é•œåƒåç§°</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>mongo <span class="token comment"># å®¹å™¨åç§°</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>  <span class="token comment"># ä½¿ç”¨çš„æ•°æ®å·æ˜ å°„</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">'.docker-volumes/mongo/data:/data/db'</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span>  <span class="token comment"># ç«¯å£æ˜ å°„</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">-</span> 27017<span class="token punctuation">:</span><span class="token number">27017</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span> <span class="token comment"># è®¾ç½®ç¯å¢ƒå˜é‡</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token punctuation">-</span> MONGO_INITDB_ROOT_USERNAME=admin  <span class="token comment"># å†…ç½®çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åˆå§‹åŒ–æ·»åŠ ä¸€ä¸ª User</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">-</span> MONGO_INITDB_ROOT_PASSWORD=pass</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">env_file</span><span class="token punctuation">:</span> <span class="token comment"># è®¾ç½®ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œå°†æ•æ„Ÿä¿¡æ¯æ”¾ç½®åˆ°ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">-</span> .env</pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token key atrule">test-use</span><span class="token punctuation">:</span> <span class="token comment"># ç¬¬äºŒä¸ªé¡¹ç›®ï¼Œæ³¨æ„å¯¹é½å…³ç³»</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> <span class="token comment"># é…ç½®æ‰€ä¾èµ–çš„æœåŠ¡</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token punctuation">-</span> test<span class="token punctuation">-</span>mongo</pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token key atrule">build</span><span class="token punctuation">:</span> <span class="token comment"># è®¾ç½®æ„å»ºé…ç½®</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token key atrule">context</span><span class="token punctuation">:</span> . <span class="token comment"># æ“ä½œä¸Šä¸‹æ–‡ä¸ºå½“å‰ç›®å½•</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile <span class="token comment"># åŸºäº Dockerfile è¿›è¡Œæ„å»º</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>use<span class="token punctuation">-</span>image</pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>use</pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token punctuation">-</span> 7001<span class="token punctuation">:</span><span class="token number">7001</span></pre></td></tr></table></figure><p><strong>å¯åŠ¨ä»¥åŠå…³é—­ï¼š</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># å¯åŠ¨</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># å…³é—­</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">docker-compose</span> down</pre></td></tr></table></figure><h3 id="æ•°æ®åº“é…ç½®"><a class="anchor" href="#æ•°æ®åº“é…ç½®">#</a> æ•°æ®åº“é…ç½®</h3>
<p><strong>æ•°æ®åº“å‡†å¤‡å·¥ä½œ</strong></p>
<ul>
<li>æ•°æ®åº“é…ç½®ï¼Œåˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚æ’å…¥ä¸€äº›ç‰¹å®šçš„æ•°æ®</li>
<li>é¿å…ä½¿ç”¨ root ç”¨æˆ·å»å¯åŠ¨æœåŠ¡ï¼Œä»è€Œæé«˜å®‰å…¨æ€§ï¼ˆé…ç½®æ•°æ®åº“è®¿é—®æƒé™ï¼‰</li>
</ul>
<p><strong>ç‰¹æ®Šçš„åˆå§‹åŒ–æ•°æ®åº“çš„ä½ç½®ï¼š/docker-entrypoint-initdb.dï¼ˆè¿™ä¸ªæ–‡ä»¶å¤¹ä¸­çš„è„šæœ¬ä¼šåœ¨å®¹å™¨å¯åŠ¨å‰è‡ªåŠ¨æ‰§è¡Œï¼‰</strong></p>
<ul>
<li>
<p>å¯ä»¥åˆ›å»º js æ–‡ä»¶æˆ–è€… sh æ–‡ä»¶ï¼ˆshellï¼‰è¿›è¡Œæ‰§è¡Œã€‚</p>
</li>
<li>
<p>mongoDBï¼š<span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9fbW9uZ28=">https://hub.docker.com/_mongo</span></p>
</li>
<li>
<p>Postgres:<span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9fbHBvc3RncmVz">https://hub.docker.com/_lpostgres</span></p>
</li>
<li>
<p>ç‰¹åˆ«æ³¨æ„ï¼Œåªæœ‰åœ¨æ•°æ®åº“æ²¡æœ‰è¢«åˆ›å»ºçš„æƒ…å†µä¸‹ï¼Œä¹Ÿå°±æ˜¯<strong>æ•°æ®åº“çš„æ–‡ä»¶å¤¹æ˜¯ç©ºçš„æƒ…å†µä¸‹</strong>ï¼Œè„šæœ¬æ‰ä¼šè¢«æ‰§è¡Œã€‚</p>
</li>
</ul>
<p><strong>docker-compose.yml æ–‡ä»¶ä¸­é…ç½® env_file ä¸ºå½“å‰æ–‡ä»¶å¤¹ä¸‹çš„.env æ–‡ä»¶ã€‚</strong></p>
<p>å¯ä»¥ä½¿ç”¨ js æ–‡ä»¶æˆ–è€… sh æ–‡ä»¶ï¼Œä½†æ˜¯ç”±äºæ­¤æ–‡ä»¶åœ¨å…¶ä½™æ–‡ä»¶ä¹‹å‰è¿è¡Œï¼Œæ­¤æ—¶ js æ–‡ä»¶ä¸­é€šè¿‡ process.env è·å–ä¸åˆ°æ‰€éœ€è¦çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥é€‰ç”¨ sh æ–‡ä»¶ã€‚</p>
<p><strong>Shell ä¸­ EOF&lt;&lt; çš„ç”¨æ³•</strong><br />
åœ¨ Shell ä¸­æˆ‘ä»¬é€šå¸¸å°† EOF ä¸ &lt; ç»“åˆä½¿ç”¨ï¼Œè¡¨ç¤ºï¼ŒäºŒå€ºçš„è¾“å…¥ä½œä¸ºå­å‘½ä»¤æˆ–å­ Shell çš„è¾“å…¥ï¼Œç›´åˆ°é‡åˆ° EOF ä¸ºæ­¢ï¼Œå†è¿”å›åˆ°ä¸»è°ƒ Shellã€‚.</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mongo <span class="token operator">&lt;&lt;</span><span class="token string">EOF</pre></td></tr><tr><td data-num="3"></td><td><pre>use admin</pre></td></tr><tr><td data-num="4"></td><td><pre>db.auth('root','123456')</pre></td></tr><tr><td data-num="5"></td><td><pre>use lego</pre></td></tr><tr><td data-num="6"></td><td><pre>db.createUser(&#123;</pre></td></tr><tr><td data-num="7"></td><td><pre>	user: '<span class="token variable">$MONGO_DB_USERNAME</span>',</pre></td></tr><tr><td data-num="8"></td><td><pre>	pwd: '<span class="token variable">$MONGO_DB_PASSWORD</span>',</pre></td></tr><tr><td data-num="9"></td><td><pre>	roles: [&#123;</pre></td></tr><tr><td data-num="10"></td><td><pre>		role: 'readWrite',</pre></td></tr><tr><td data-num="11"></td><td><pre>		db: 'lego'</pre></td></tr><tr><td data-num="12"></td><td><pre>	&#125;]</pre></td></tr><tr><td data-num="13"></td><td><pre>&#125;)</pre></td></tr><tr><td data-num="14"></td><td><pre>db.createCollection('works')</pre></td></tr><tr><td data-num="15"></td><td><pre>db.works.insertMany([</pre></td></tr><tr><td data-num="16"></td><td><pre>	&#123;</pre></td></tr><tr><td data-num="17"></td><td><pre>  		id:19,</pre></td></tr><tr><td data-num="18"></td><td><pre>  		title:'æµ‹è¯•æ ‡é¢˜',</pre></td></tr><tr><td data-num="19"></td><td><pre>  		name:'å¼ ä¸‰'</pre></td></tr><tr><td data-num="20"></td><td><pre>	&#125;</pre></td></tr><tr><td data-num="21"></td><td><pre>])</pre></td></tr><tr><td data-num="22"></td><td><pre>EOF</span></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–é•œåƒå¤§å°"><a class="anchor" href="#ä¼˜åŒ–é•œåƒå¤§å°">#</a> ä¼˜åŒ–é•œåƒå¤§å°</h3>
<p><strong>Docker é•œåƒæ„å»ºä¼˜åŒ–ï¼šä½¿ç”¨ alpine ç‰ˆæœ¬çš„é•œåƒ</strong></p>
<p>ä¼˜åŒ–é•œåƒå¤§å°  ï¼š   ä»€ä¹ˆæ˜¯ Alpine Linux:<span class="exturl" data-url="aHR0cHM6Ly9hbHBpbmVsaW51eC5vcmc=">https://alpinelinux.org</span></p>
<p><strong>Alpine çš„ä¼˜ç‚¹</strong></p>
<ul>
<li>
<p>Small å°</p>
<ul>
<li>
<p>é»˜è®¤è½¯ä»¶åŒ…ï¼Œalpine é€‰æ‹© busybox</p>
</li>
<li>
<p>C è¿è¡Œåº“ï¼Œä¸€èˆ¬ä¼šç”¨ glibc,alpine é€‰æ‹© musl</p>
</li>
</ul>
</li>
<li>
<p>æœ€ç®€ä¾èµ–ï¼ŒSimple</p>
<ul>
<li>
<p>å¾ˆå¤šå†…ç½®è½¯ä»¶çš„æ’ä»¶éƒ½å»æ‰ã€‚</p>
</li>
<li>
<p>å›½é™…åŒ–å†…å®¹éƒ½è¢«åˆ é™¤</p>
</li>
</ul>
</li>
<li>
<p>Secure å®‰å…¨</p>
</li>
</ul>
<p><strong>ä½¿ç”¨ alpine ç‰ˆæœ¬çš„é•œåƒå¯ä»¥å¤§å¤§å‡å°é•œåƒçš„ä½“ç§¯ã€‚</strong></p>
<p><strong>DockerBuild æ„å»ºæé€Ÿ</strong></p>
<p>docker ä¸­è¿è¡Œå‘½ä»¤æ˜¯åŸºäºä¸€å±‚ä¸€å±‚çš„ï¼Œå½“ä¿®æ”¹æ–‡ä»¶ä¹‹åï¼ŒCOPY åçš„ç¼“å­˜å…¨éƒ¨å¤±æ•ˆï¼Œè¿™æ—¶å°±ä¼šé‡æ–°æ‰§è¡Œåç»­å‘½ä»¤ï¼Œä½¿ç”¨ä¸äº†ç¼“å­˜ï¼Œå¯¼è‡´æ„å»ºé€Ÿåº¦å¾ˆæ…¢ã€‚æ­¤æ—¶å¯ä»¥å°†åŸæ¥ COPY æ–‡ä»¶å¤¹ï¼Œæ”¹ä¸º COPY å…·ä½“çš„æ–‡ä»¶ï¼ˆè¿›è¡Œæ‹†åˆ†ï¼‰ï¼Œä»¥æ›´å¥½åœ°ä½¿ç”¨ç¼“å­˜ã€‚</p>
<h3 id="éƒ¨ç½²-3"><a class="anchor" href="#éƒ¨ç½²-3">#</a> éƒ¨ç½²</h3>
<p><strong>å®‰è£… Dockerï¼ˆæœ‰çš„äº‘æœåŠ¡å¯ä»¥è‡ªå®šä¹‰å®‰è£…ï¼‰</strong></p>
<p>Ubuntuï¼šï¼ˆéœ€è¦ä½¿ç”¨ root è´¦æˆ·è¿›è¡Œå®‰è£…ï¼‰</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cucnVub29iLmNvbS9kb2NrZXIvdWJ1bnR1LWRvY2tlci1pbnN0YWxsLmh0bWw=">https://www.runoob.com/docker/ubuntu-docker-install.html</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2luc3RhbGwvdWJ1bnR1Lw==">https://docs.docker.com/engine/install/ubuntu/</span></li>
</ul>
<p><strong>é…ç½®ç”¨æˆ·ç»„</strong><br />
å› ä¸ºæ˜¯ root å®‰è£…ï¼Œæ™®é€šç”¨æˆ·æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤çš„æ—¶å€™æœ‰å¯èƒ½ä¼šæŠ¥é”™ï¼š<br />
 <code>Can't connect to docker daemonGot permission denied while trying to connect to the Docker daemonsocket at unix:///var/run/docker.sock</code></p>
<p><strong>éœ€è¦å°†å¯¹åº”çš„ç”¨æˆ·æ·»åŠ åˆ° docker çš„ç”¨æˆ·ç»„ä¸­ã€‚</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#usermod å‘½ä»¤ä¿®æ”¹ç”¨æˆ·è´¦æˆ·</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#a--append æ·»åŠ  - G--groups</span></pre></td></tr><tr><td data-num="3"></td><td><pre>ç»„çš„åç§°</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">sudo</span> usermod-aG <span class="token function">docker</span> ä½ çš„ç”¨æˆ·å</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#å¦‚æœç»„ä¸å­˜åœ¨ï¼Œæ·»åŠ å¯¹åº”çš„ docker ç»„</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">sudo</span> <span class="token function">groupadd</span> <span class="token function">docker</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#æŸ¥çœ‹ä¸€ä¸ªç”¨æˆ·æ‰€å±çš„ç»„</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">groups</span></pre></td></tr></table></figure><p><strong>æ·»åŠ ä¸‹è½½é•œåƒï¼š</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># root</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">vim</span> /etc/docker/daemon.json</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token string">"registry-mirrors"</span><span class="token builtin class-name">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token string">"https://docker.mirrors.ustc.edu.cn/"</span>,</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token string">"https://reg-mirror.qiniu.com"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p><strong>è¿è¡Œï¼š</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æ‹‰æœ€æ–°çš„ä»£ç </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">git</span> pull</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># å…ˆæŸ¥çœ‹ç›®å‰ç«¯å£æ˜¯å¦è¢«å ç”¨</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># å¦‚æœè¢«å ç”¨ï¼Œé‡Šæ”¾ç«¯å£</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># æˆ–è€…æ”¹å˜ docker-compose,yml çš„æ˜ å°„ç«¯å£</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></pre></td></tr></table></figure><h1 id="yamlè¯­è¨€"><a class="anchor" href="#yamlè¯­è¨€">#</a> YAML è¯­è¨€</h1>
<p>YAML<br />
 (YAML Ain't a Markup Language) æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼Œå®ƒä½¿ç”¨ç©ºæ ¼ä½œä¸ºç¼©è¿›ï¼Œçœ‹èµ·æ¥éå¸¸çš„ç®€æ´ï¼Œå¯è¯»æ€§éå¸¸çš„å¥½ï¼Œéå¸¸é€‚åˆä¸€äº›å†…å®¹å¤§çº²å’Œé…ç½®æ–‡ä»¶ã€‚ä»–æœ€ç»ˆæ˜¯é€šè¿‡å·¥å…·è½¬åŒ–ä¸º JSON æ–‡ä»¶çš„ï¼Œä½†æ˜¯ YAML çš„å¯è¯»æ€§æ¯” JSON å¼ºå¾ˆå¤šï¼Œå› æ­¤å¤æ‚çš„é…ç½®æ–‡ä»¶ä¸€èˆ¬ä½¿ç”¨ YAMLã€‚</p>
<p><strong>ä¾‹å¦‚ï¼š</strong></p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># å­—ç¬¦ä¸²ä¸ç”¨åŠ å¼•å·</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">key</span><span class="token punctuation">:</span> value</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token key atrule">boolean</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># å­—ç¬¦ä¸²ä¸ç”¨åŠ å¼•å·ï¼Œä½†æ˜¯åŠ ä¸Šä¹Ÿä¸ä¼šæŠ¥é”™</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token key atrule">quote_string</span><span class="token punctuation">:</span> <span class="token string">'quote String'</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># å¤šè¡Œå­—ç¬¦ä¸²ä½¿ç”¨ literal block è¯­æ³•ï¼šä¹Ÿå°±æ˜¯ç«–çº¿</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token key atrule">mutiple_string</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></pre></td></tr><tr><td data-num="9"></td><td><pre>  line one</pre></td></tr><tr><td data-num="10"></td><td><pre>  line two</pre></td></tr><tr><td data-num="11"></td><td><pre>  line three</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># collection types é›†åˆç±»å‹</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œæœ€å¥½ä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼ï¼Œä¸æ˜¯ä¸¤ä¸ªç©ºæ ¼ä¹Ÿæ²¡å…³ç³»ï¼Œå¯¹é½å°±è¡Œ</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token key atrule">person</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token key atrule">name</span><span class="token punctuation">:</span> dmq</pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">18</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token key atrule">address</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token key atrule">city</span><span class="token punctuation">:</span> ä¸Šæµ·</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># sequences æ•°ç»„æˆ–è€…åˆ—è¡¨</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token key atrule">hobbies</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">-</span> Item 1</pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">-</span> Item 2</pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> weson</pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token key atrule">value</span><span class="token punctuation">:</span> xyz</pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token key atrule">address</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token key atrule">city</span><span class="token punctuation">:</span> åŒ—äº¬</pre></td></tr></table></figure><h1 id="github-action"><a class="anchor" href="#github-action">#</a> Github Action</h1>
<p>Github å®˜æ–¹çš„ CI/CD å·¥å…·ï¼Œä½œä¸º github çš„äº²å„¿å­ï¼Œå’Œ github å‡ ä¹æ˜¯å®Œç¾çš„æ— ç¼è¡”æ¥çš„ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ã€‚</p>
<p>CI   CD å¸¸ç”¨å·¥å…·ï¼š</p>
<ul>
<li>Github actions <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vZW4vYWN0aW9ucw==">https://docs.github.com/en/actions</span></li>
<li>Travis <span class="exturl" data-url="aHR0cHM6Ly93d3cudHJhdmlzLWNpLmNvbS8=">https://www.travis-ci.com/</span></li>
<li>CircleCl <span class="exturl" data-url="aHR0cHM6Ly9jaXJjbGVjaS5jb20v">https://circleci.com/</span></li>
<li>Jenkins <span class="exturl" data-url="aHR0cHM6Ly93d3cuamVua2lucy5pby8=">https://www.jenkins.io/</span></li>
<li>ä¼˜åŠ¿è®¨è®ºï¼š<span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzMwNjE5NTAzMy9hbnN3ZXIvMTg3MDMyMjExOA==">https://www.zhihu.com/question/306195033/answer/1870322118</span></li>
</ul>
<p><img data-src="/images/Snipaste_2024-04-27_18-37-04.jpg" alt="/images/Snipaste_2024-04-16_12-54-33.jpg" /></p>
<p><strong>Workflow</strong><br />
<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vY24vYWN0aW9ucy9sZWFybi1naXRodWItYWN0aW9ucy91bmRlcnN0YW5kaW5nLWdpdGh1Yi1hY3Rpb25zI3dvcmtmbG93cw==">https://docs.github.com/cn/actions/learn-github-actions/understanding-github-actions#workflows</span><br />
Workflow æ˜¯ä¸€ä¸ªå¯é…ç½®çš„è‡ªåŠ¨åŒ–æµç¨‹ï¼Œå¯ä»¥åŒ…å«å¤šä¸ª jobs, é€šè¿‡ä¸€ä¸ªåœ¨ repo å½“ä¸­çš„ yml æ–‡ä»¶æ¥å®šä¹‰å¯¹åº”çš„æµç¨‹ï¼Œä¸€ä¸ª repo å¯ä»¥åŒ…å«å¤šä¸ª workflowã€‚<br />
<strong>Events</strong><br />
Event æ˜¯è§¦å‘ workflow çš„ç‰¹æ®Šäº‹ä»¶ï¼Œæ¯”å¦‚ pull request,push æˆ–è€… issue, ä¹Ÿå¯ä»¥å®Œå…¨è‡ªå®šä¹‰ï¼Œå®Œæ•´åˆ—è¡¨è¯·çœ‹ï¼šhttps:/docs.github.com/cn/actions/learn-github-actions/events-that-trigger-workflows</p>
<p><strong>Jobs</strong></p>
<p>Job æ˜¯ Workflow å½“ä¸­ä¸€ç³»åˆ—çš„å¯æ‰§è¡Œæ­¥éª¤ï¼Œæ¯ä¸ª Job æ˜¯åœ¨åŒä¸€ä¸ª runner ä¸­è¿›è¡Œçš„ï¼ˆ(Runner æ˜¯æŒ‡å¤„äº github çš„ä¸€å°ç‰¹æ®Šçš„è™šæ‹Ÿæœºï¼Œæ”¯æŒå„ç§æ“ä½œç³»ç»Ÿ)ï¼Œæ¯ä¸ªæ­¥éª¤æˆ–è€…æ˜¯ä¸€ä¸ª shell è„šæœ¬ï¼ŒæŠ‘æˆ–æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„ action, æ¯ä¸ªæ­¥éª¤æ˜¯æŒ‰é¡ºåºæ‰§è¡Œï¼Œå¹¶ä¸”äº’ç›¸ä¾èµ–çš„ã€‚</p>
<p><img data-src="/images/Snipaste_2024-04-27_19-54-06.jpg" alt="/images/Snipaste_2024-04-16_12-54-33.jpg" /></p>
<p><strong>Actions</strong></p>
<p>Action æ˜¯ github actions ä¸­çš„ä¸€ä¸ªè‡ªå®šä¹‰åº”ç”¨ï¼Œå®ƒå¯ä»¥è¿è¡Œä¸€ç³»åˆ—å¤æ‚çš„å¹¶ä¸”å¸¸ç”¨çš„ä»»åŠ¡ï¼Œä½¿ç”¨ action å¯ä»¥å¸®æˆ‘ä»¬å‡å°‘åœ¨ workflow ä¸­å†™é‡å¤ä»£ç ï¼ŒGithub æä¾›äº†éå¸¸å¤šå¸¸ç”¨çš„ action, å¯ä»¥åœ¨<span class="exturl" data-url="aHR0cHM6Z2l0aHViLmNvbS9tYXJrZXRwbGFjZT90eXBlPWFjdGlvbnM=">è¿™é‡ŒæŸ¥é˜…</span>ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å†™è‡ªå·±çš„ actionã€‚</p>
<p><strong>github secrets</strong></p>
<p>é¡¹ç›®ä¸­æœ‰çš„ç§å¯†ä¿¡æ¯ä¸å¸Œæœ›å…¬å¼€æš´éœ²ï¼Œé€šå¸¸çš„åšæ³•æ˜¯å°†ç§å¯†ä¿¡æ¯å†™é“ env æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨ gitingore å°†å…¶å¿½ç•¥æ‰ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªåšæ³•å°±æ˜¯ github secretsï¼Œåœ¨ github å®˜ç½‘è®¾ç½® github secretï¼Œç„¶ååœ¨æ–‡ä»¶ä¸­ç›´æ¥ä¹¦å†™å˜é‡ã€‚</p>
<p><strong>ä¾‹å¦‚ï¼š.github æ–‡ä»¶å¤¹ä¸‹ workflow æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ª yml æ–‡ä»¶ï¼Œå†™å…¥ï¼š</strong></p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">name</span><span class="token punctuation">:</span> Github Actions Demo</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">jobs</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">Check-Github-actions</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">steps</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "triggered by a $&lt;<span class="token tag">!--swig</span>ï¿¼5<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> event"</pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "running on a $&lt;<span class="token tag">!--swig</span>ï¿¼6<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> server hosted by github"</pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> check out repo code</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2 <span class="token comment"># åœ¨å·¥ä½œæµç¨‹ä¸­æ£€å‡ºä»£ç ä»“åº“çš„å†…å®¹ã€ç¡®ä¿å·¥ä½œæµç¨‹å§‹ç»ˆä½¿ç”¨ä¸€è‡´çš„ä»£ç ç‰ˆæœ¬</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> echo "the $&lt;<span class="token tag">!--swig</span>ï¿¼7<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> has been cloned"</pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> List files in the repo</pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></pre></td></tr><tr><td data-num="14"></td><td><pre>          ls $</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token key atrule">build</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest</pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token key atrule">steps</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2</pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token key atrule">width</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>          <span class="token key atrule">repository</span><span class="token punctuation">:</span> <span class="token string">'vikingmute/lego-bricks'</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> List files in the repo</pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></pre></td></tr><tr><td data-num="23"></td><td><pre>          ls $</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v2</pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token key atrule">with</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'16'</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> node <span class="token punctuation">-</span>v</pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token punctuation">-</span>g typescript</pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> tsc <span class="token punctuation">-</span>v</pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token key atrule">jobs</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token key atrule">SECRET-SSH-ACTIONS</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest</pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token key atrule">steps</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token comment">#ä½¿ç”¨ ssh-action å®Œæˆè¿œç¨‹ç™»é™†ï¼šæ–‡æ¡£åœ°å€ï¼šhttps://github.com/appleboy/ssh-action</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> appleboy/ssh<span class="token punctuation">-</span>action@master </pre></td></tr><tr><td data-num="36"></td><td><pre>          <span class="token key atrule">with</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token key atrule">host</span><span class="token punctuation">:</span> $&lt;<span class="token tag">!--swig</span>ï¿¼10<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span><span class="token scalar string"></pre></td></tr><tr><td data-num="38"></td><td><pre>            username: $</pre></td></tr><tr><td data-num="39"></td><td><pre>            password: $</pre></td></tr><tr><td data-num="40"></td><td><pre>            script_stop: true</pre></td></tr><tr><td data-num="41"></td><td><pre>            script: |</pre></td></tr><tr><td data-num="42"></td><td><pre>              pwd</pre></td></tr><tr><td data-num="43"></td><td><pre>              ls -l</pre></td></tr><tr><td data-num="44"></td><td><pre>              touch secret.txt</pre></td></tr><tr><td data-num="45"></td><td><pre>              echo $ >> secret.txt</span></pre></td></tr></table></figure><h1 id="è‡ªåŠ¨åŒ–éƒ¨ç½²"><a class="anchor" href="#è‡ªåŠ¨åŒ–éƒ¨ç½²">#</a> è‡ªåŠ¨åŒ–éƒ¨ç½²</h1>
<h2 id="æ¨é€è¿œç¨‹é•œåƒä»“åº“"><a class="anchor" href="#æ¨é€è¿œç¨‹é•œåƒä»“åº“">#</a> æ¨é€è¿œç¨‹é•œåƒä»“åº“</h2>
<p><strong>æ™®é€šçº¿ä¸Šæ›´æ–°æµç¨‹ï¼š</strong></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æ¯æ¬¡ä»£ç æ›´æ–°ä»¥åï¼Œç™»å½•åˆ° ssh æœåŠ¡å™¨</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># å…³é—­æœåŠ¡</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">docker-compose</span> down</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># æ›´æ–°ä»£ç </span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">git</span> pull</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># å‡å¦‚æœ‰.envï¼Œçš„æ›´æ–°éœ€è¦é‡æ–°è®¾ç½®ï¼Œenv æ–‡ä»¶</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># é‡æ–° build åº”ç”¨é•œåƒ</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">docker-compose</span> build lego-backend</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># é‡å¯æœåŠ¡</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span></pre></td></tr></table></figure><p><strong>å¼Šç«¯ï¼š</strong></p>
<ul>
<li>
<p>åˆæ¬¡ä¸Šçº¿å’Œæ›´æ–°å±äºä¸¤æ­¥</p>
</li>
<li>
<p>åˆæ¬¡ä¸Šçº¿éœ€è¦ç‰¹åˆ«çš„æ“ä½œï¼Œå°±æ˜¯ä¹‹å‰æ‰‹åŠ¨éƒ¨ç½²ä¸Šçº¿çš„è¿è¡Œçš„è¿‡ç¨‹</p>
<ul>
<li>
<p>clone ä»£ç </p>
</li>
<li>
<p>è®¾ç½®ç¯å¢ƒå˜é‡.env</p>
</li>
<li>
<p>docker-compose up -d</p>
</li>
</ul>
</li>
</ul>
<p><strong>è¿½æ±‚çš„æˆæœï¼š</strong></p>
<p><strong>æ¯æ¬¡æäº¤ï¼Œå¯ä»¥è‡ªåŠ¨ä¸€æ¬¡æ€§çš„éƒ¨ç½²åˆ°ä»»ä½•æœåŠ¡å™¨ï¼Œå®ç°åˆæ¬¡å¯åŠ¨æˆ–è€…æ›´æ–°çš„æ•ˆæœï¼Œè¿™æ‰æ˜¯ä¸€ä¸ªå®Œç¾çš„ develops çš„æµç¨‹</strong></p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p>å°†ä¸Šé¢æœ¬åœ°çš„é•œåƒå­˜åˆ° docker hub æœåŠ¡å™¨ä¸­ï¼Œè¿™æ ·æ¯æ¬¡å°±ä¸ç”¨é‡æ–° buildï¼Œè€Œæ˜¯ç›´æ¥æ‹‰å–ã€‚</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">lego-redis</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    image<span class="token punctuation">:</span>redis<span class="token punctuation">:</span><span class="token number">6</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">lego-mongo</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    image<span class="token punctuation">:</span>mongo<span class="token punctuation">:</span>latest</pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">lego-backend</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    image<span class="token punctuation">:</span>lego<span class="token punctuation">-</span>backend</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">#æˆ‘ä»¬éœ€è¦æ¯æ¬¡æ‰‹åŠ¨çš„ build é•œåƒï¼Œä¹Ÿå°±è¯´é•œåƒåªå­˜åœ¨äºæœ¬åœ°</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">build</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">...</span><span class="token punctuation">...</span>context<span class="token punctuation">:</span>.</pre></td></tr><tr><td data-num="11"></td><td><pre>    dockerfile<span class="token punctuation">:</span>Dockerfile</pre></td></tr></table></figure><p><strong>æ”¹ä¸ºï¼š</strong></p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æ›´å¥½çš„æ–¹æ¡ˆ</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># ä¸éœ€è¦ä»»ä½•ä»£ç åº“ä¸­çš„æ–‡ä»¶ï¼Œåªéœ€è¦ä¸€ä¸ª docker-compose.yml æ–‡ä»¶</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># å°±å¯ä»¥è½»æ¾çš„åœ¨ä»»ä½•æœåŠ¡å™¨è¿è¡Œ</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token key atrule">lego-redis</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    image<span class="token punctuation">:</span>redis<span class="token punctuation">:</span><span class="token number">6</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  lego<span class="token punctuation">-</span>mongo</pre></td></tr><tr><td data-num="8"></td><td><pre>    image<span class="token punctuation">:</span>mongo<span class="token punctuation">:</span>latest</pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token key atrule">lego-backend</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># ä¸éœ€è¦ build, è€Œæ˜¯å­˜åœ¨äº docker hub æœåŠ¡å™¨ä¸­ï¼Œå¯ä»¥æ¯æ¬¡ç›´æ¥æ‹‰å–</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    image<span class="token punctuation">:</span>lego<span class="token punctuation">-</span>backend<span class="token punctuation">:</span>1.0.1</pre></td></tr></table></figure><p><strong>docker hub å…è´¹ç‰ˆæœ‰é™åˆ¶ï¼Œæ¨èä½¿ç”¨é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ï¼š</strong></p>
<p><strong><span class="exturl" data-url="aHR0cHM6bFd3dy5hbGl5dW4uY29tL3Byb2R1Y3QvYWNy">é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ ACR</span></strong><br />
 ä¸ªäººç‰ˆå®Œå…¨å…è´¹</p>
<p>åˆ›å»ºé•œåƒä»“åº“ä¹‹åï¼Œéœ€è¦å°†æœ¬åœ°é•œåƒæ¨é€åˆ° ACR ä»“åº“ä¸­ï¼š</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æ¥åˆ°é•œåƒä»“åº“çš„åŸºæœ¬ä¿¡æ¯é¡µé¢</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># ç™»å½•</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">docker</span> login <span class="token parameter variable">--username</span><span class="token operator">=</span>ç”¨æˆ·å registry.cn-hangzhou.aliyuncs.com</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># tag ä¸¤ç§æ–¹å¼ï¼š</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 1: ä½¿ç”¨ tag bui1d</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">docker</span> build--tag <span class="token string">"registry.cn-hangzhou.aliyuncs.com/dmq00/test:[é•œåƒç‰ˆæœ¬å·]"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 2: ç»™ build å¥½çš„æ‰“ tag</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">docker</span> tag <span class="token punctuation">[</span>ImageId<span class="token punctuation">]</span> registry.cn-hangzhou.aliyuncs.com/dmq00/test:<span class="token punctuation">[</span>é•œåƒç‰ˆæœ¬å·<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># æŸ¥çœ‹é•œåƒæ˜¯å¦ build å®Œæˆ</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function">docker</span> images</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># æ¨é€é•œåƒ</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">docker</span> push registry.cn-hangzhou.aliyuncs.com/dmq00/test:<span class="token punctuation">[</span>é•œåƒç‰ˆæœ¬å·<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># åœ¨é˜¿é‡Œäº‘ ACR ç•Œé¢æ£€æŸ¥çœ‹æ˜¯å¦å·²ç»å­˜åœ¨</span></pre></td></tr></table></figure><h2 id="github-actionsè‡ªåŠ¨éƒ¨ç½²"><a class="anchor" href="#github-actionsè‡ªåŠ¨éƒ¨ç½²">#</a> Github Actions è‡ªåŠ¨éƒ¨ç½²</h2>
<p><strong>ä½¿ç”¨ github actions åŠ æˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼šå½“æ¨é€ä»£ç åˆ° github ä»“åº“æ—¶ï¼Œè®©æˆ‘ä»¬çš„ä»£ç è‡ªåŠ¨æäº¤é•œåƒåˆ°é•œåƒä»“åº“ã€‚</strong></p>
<p><strong>å¤§ä½“åˆ†ä¸ºä¸¤æ­¥</strong></p>
<ul>
<li>
<h6 id="åœ¨githubæœåŠ¡å™¨ä¸Šbuild-imageå¹¶ä¸”push"><a class="anchor" href="#åœ¨githubæœåŠ¡å™¨ä¸Šbuild-imageå¹¶ä¸”push">#</a> åœ¨ github æœåŠ¡å™¨ä¸Š build image å¹¶ä¸” push</h6>
</li>
<li>
<p><strong>ä½¿ç”¨ docker-compose-online æ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œåº”ç”¨</strong></p>
</li>
</ul>
<p><strong>ç¬¬ä¸€æ­¥è¯¦ç»†æµç¨‹åˆ†æï¼Œåœ¨ github runner ä¸Šè¿è¡Œ</strong></p>
<ul>
<li>
<p>checkout ä»£ç ï¼ˆåœ¨ github æœåŠ¡å™¨ä¸Šï¼‰</p>
</li>
<li>
<p>åˆ›å»º.env æ–‡ä»¶ï¼Œå¹¶ä¸”æ·»åŠ ä¸¤ä¸ªç¯å¢ƒå˜é‡ (upload to OSS éœ€è¦ä¸¤ä¸ªå¯¹åº”çš„ä¿¡æ¯)</p>
</li>
<li>
<p>ä½¿ç”¨é˜¿é‡Œäº‘ ACR å®Œæˆ docker login</p>
</li>
<li>
<p>ä½¿ç”¨æ­£ç¡®çš„é˜¿é‡Œäº‘ tag è¿›è¡Œ docker build</p>
<ul>
<li>æ€æ ·æ¯æ¬¡ push ç”Ÿæˆç‰¹æ®Šçš„ tagï¼Ÿæ˜¯ä¸€ä¸ªåç»­çš„é—®é¢˜</li>
</ul>
</li>
<li>
<p>docker push</p>
</li>
</ul>
<p>ä¾‹å¦‚ï¼šã€1ã€‘åœ¨é¡¹ç›®æ–‡ä»¶å¤¹.github/workflow ä¸‹åˆ›å»º yml æ–‡ä»¶ï¼Œå†™å…¥ï¼š</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">name</span><span class="token punctuation">:</span> build image<span class="token punctuation">,</span>push to ACR</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">jobs</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">build-and-push</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">steps</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token comment"># checkout ä»£ç </span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2</pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token comment"># åˆ›å»º env æ–‡ä»¶</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> touch .env</pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token comment"># ä½¿ç”¨ â€œ>> â€ æ·»åŠ ä¿¡æ¯</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> echo ALC_ACCESS_KEY=$&lt;<span class="token tag">!--swig</span>ï¿¼14<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> <span class="token punctuation">></span><span class="token punctuation">></span> .env</pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> echo ALC_SECRET_KEY=$&lt;<span class="token tag">!--swig</span>ï¿¼15<span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">></span> <span class="token punctuation">></span><span class="token punctuation">></span> .env</pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token comment"># ä½¿ç”¨é˜¿é‡Œäº‘ ACR å®Œæˆ docker login</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Login to Aliyun ACR</pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token key atrule">uses</span><span class="token punctuation">:</span> aliyun/acr<span class="token punctuation">-</span>login@v1 <span class="token comment"># ä½¿ç”¨ä¸“å±çš„é•œåƒ</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token key atrule">with</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>          <span class="token key atrule">login-server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com</pre></td></tr><tr><td data-num="19"></td><td><pre>          <span class="token key atrule">region-id</span><span class="token punctuation">:</span> cn<span class="token punctuation">-</span>hangzhou <span class="token comment"># æŸ¥çœ‹å®˜ç½‘è‡ªå·±ä»“åº“çš„ä¿¡æ¯</span></pre></td></tr><tr><td data-num="20"></td><td><pre>          <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"$"</span></pre></td></tr><tr><td data-num="21"></td><td><pre>          <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"$"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token comment"># ä½¿ç”¨æ­£ç¡®çš„é˜¿é‡Œäº‘ tag è¿›è¡Œ docker build</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build image for Docker</pre></td></tr><tr><td data-num="24"></td><td><pre>          <span class="token key atrule">run</span><span class="token punctuation">:</span> docker build <span class="token punctuation">-</span><span class="token punctuation">-</span>tag "registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/dmq00/test<span class="token punctuation">:</span>0.0.2"</pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Push Image to ACR</pre></td></tr><tr><td data-num="26"></td><td><pre>          <span class="token key atrule">run</span><span class="token punctuation">:</span> docker push registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/dmq00/test<span class="token punctuation">:</span>0.0.2</pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½ä¿è¯ä»£ç  push åˆ° github ä¸Šä¹‹åè‡ªåŠ¨å°†é•œåƒæ¨é€åˆ° docker é•œåƒä»“åº“ï¼Œç»“åˆ dockerfile æ–‡ä»¶å°±èƒ½ä¿è¯ä½¿ç”¨ docker é•œåƒæ—¶è‡ªåŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œå®‰è£…å¯¹åº”ä¾èµ–å¹¶æ‰§è¡Œé¡¹ç›®ã€‚</p>
<p><strong>ç¬¬äºŒæ­¥è¯¦ç»†æµç¨‹åˆ†æï¼Œåœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²å¯¹åº”çš„ä»£ç å¹¶ä¸”è¿è¡Œ</strong></p>
<ul>
<li>
<p>checkout ä»£ç </p>
</li>
<li>
<p>åˆ›å»º.env æ–‡ä»¶ï¼Œæ·»åŠ å¤šä¸ªç¯å¢ƒå˜é‡ã€‚(åº”ç”¨æ‰€æœ‰éœ€è¦çš„ç¯å¢ƒå˜é‡)ï¼Œgithub  secrets ä¸­æ·»åŠ ã€‚</p>
</li>
<li>
<p>åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œæ‹·è´å¦‚ä¸‹æ–‡ä»¶åˆ°æ–‡ä»¶å¤¹å†…</p>
<ul>
<li>.env</li>
<li>docker-compose-online.yml</li>
<li>mongo-entrypoint æ–‡ä»¶å¤¹</li>
</ul>
</li>
<li>
<p>å°†æ–°å»ºçš„æ–‡ä»¶å¤¹æ‹·è´åˆ°æœåŠ¡å™¨ (SCP) å½“ä¸­</p>
<ul>
<li>ä½¿ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FwcGxlYm95L3NjcC1hY3Rpb24=">https://github.com/appleboy/scp-action</span></li>
</ul>
</li>
<li>
<p>SSH åˆ°æœåŠ¡å™¨ä¸­</p>
<ul>
<li>è¿›å…¥æ‹·è´çš„æ–‡ä»¶å¤¹å†…</li>
<li>ç™»å½•é˜¿é‡Œäº‘ ACR</li>
<li>åœæ­¢æœåŠ¡ docker-compose down ï¼ˆç¬¬ä¸€æ¬¡çš„è¯ï¼Œæ²¡æœ‰å¯åŠ¨ä¹Ÿä¸ä¼šæŠ¥é”™ï¼‰</li>
<li>å¯åŠ¨æœåŠ¡ docker-compose up</li>
<li>æ¸…ç†å·¥ä½œå¯é€‰ï¼Œä¿è¯å®‰å…¨ï¼ˆåˆ é™¤.env æ–‡ä»¶ï¼Œç™»å‡º docker è´¦æˆ·ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>åç»­è¿‡ç¨‹éœ€è¦å®Œæˆï¼š</strong></p>
<ul>
<li>
<p>åœ¨ push tags çš„æ—¶å€™æ‰è§¦å‘å¯¹åº”çš„ job</p>
<p>ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vY24vYWN0aW9ucy9sZWFybi1naXRodWItYWN0aW9ucy9ldmVudHMtdGhhdC10cmlnZ2VyLXdvcmtmbG93cw==">https://docs.github.com/cn/actions/learn-github-actions/events-that-trigger-workflows</span></p>
</li>
<li>
<p>æ€æ ·è·å–å¯¹åº”çš„æ¯æ¬¡æäº¤ç›¸å…³çš„ç‰¹æ®Šä¿¡æ¯</p>
<p>ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vZW4vYWN0aW9ucy9sZWFybi1naXRodWItYWN0aW9ucy9jb250ZXh0cw==">https://docs.github.com/en/actions/learn-github-actions/contexts</span></p>
</li>
<li>
<p>ä½¿ç”¨è¿™ä¸ªç‰¹æ®Šä¿¡æ¯ï¼Œåœ¨å¯¹åº”çš„ docker-compose-online.yml ä¸­è¿›è¡Œæ›¿æ¢ï¼Œå°†è¦å¯åŠ¨çš„ç‰ˆæœ¬æ›¿æ¢ä¸ºå°†è¦æ„å»ºçš„ç‰ˆæœ¬ã€‚</p>
</li>
</ul>

      <div class="tags">
          <a href="/tags/%E5%A4%8D%E6%9D%82%E4%B8%9A%E5%8A%A1%E9%83%A8%E7%BD%B2%E4%B8%8E%E4%BC%98%E5%8C%96/" rel="tag"><i class="ic i-tag"></i> å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ–</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">æ›´æ–°äº</span>
    <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-07-09 13:16:59" itemprop="dateModified" datetime="2024-07-09T13:16:59+08:00">2024-07-09</time>
  </span>
  <span id="2024/04/12/å¤æ‚é¡¹ç›®éƒ¨ç½²ä¸Šçº¿/" class="item leancloud_visitors" data-flag-title="å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ–" title="é˜…è¯»æ¬¡æ•°">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">é˜…è¯»æ¬¡æ•°</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">æ¬¡</span>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> èµèµ</button>
  <p>è¯·æˆ‘å–[èŒ¶]~(ï¿£â–½ï¿£)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="dmq å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="dmq æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>dmq <i class="ic i-at"><em>@</em></i>æœæ˜æ¸…çš„ä¸ªäººåšå®¢
  </li>
  <li class="link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://dmqweb.cn/2024/04/12/%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF/" title="å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ–">https://dmqweb.cn/2024/04/12/å¤æ‚é¡¹ç›®éƒ¨ç½²ä¸Šçº¿/</a>
  </li>
  <li class="license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2024/03/30/jest/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s3.uuu.ovh&#x2F;imgs&#x2F;2024&#x2F;04&#x2F;05&#x2F;f58f811a8b6cbdbb.jpg" title="jest">
  <span class="type">ä¸Šä¸€ç¯‡</span>
  <span class="category"><i class="ic i-flag"></i> TDD</span>
  <h3>jest</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2024/04/12/%E8%84%9A%E6%89%8B%E6%9E%B6/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s3.uuu.ovh&#x2F;imgs&#x2F;2024&#x2F;04&#x2F;05&#x2F;d389418a13d92e24.jpg" title="è„šæ‰‹æ¶å¼€å‘">
  <span class="type">ä¸‹ä¸€ç¯‡</span>
  <span class="category"><i class="ic i-flag"></i> è„šæ‰‹æ¶å¼€å‘</span>
  <h3>è„šæ‰‹æ¶å¼€å‘</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.</span> <span class="toc-text"> è½¯ä»¶ç”Ÿå‘½å‘¨æœŸï¼š</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">2.</span> <span class="toc-text"> æ¶æ„æµç¨‹å›¾</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E9%80%9A%E7%94%A8%E6%96%B9%E6%A1%88"><span class="toc-number">3.</span> <span class="toc-text"> å¤æ‚é¡¹ç›®é€šç”¨æ–¹æ¡ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E7%9A%84%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="toc-number">3.0.0.1.</span> <span class="toc-text"> ä¸šåŠ¡çš„å¤æ‚åº¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E7%9A%84%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="toc-number">3.0.0.2.</span> <span class="toc-text"> æµç¨‹çš„å¤æ‚åº¦</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ci-cd%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">4.</span> <span class="toc-text"> CI &#x2F; CD çš„æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cicontinuous-integration%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90"><span class="toc-number">4.0.0.1.</span> <span class="toc-text"> CIï¼ˆContinuous integrationï¼‰æŒç»­é›†æˆ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cdcontinuous-delivery%E6%8C%81%E7%BB%AD%E4%BA%A4%E4%BB%98"><span class="toc-number">4.0.0.2.</span> <span class="toc-text"> CDï¼ˆContinuous Deliveryï¼‰æŒç»­äº¤ä»˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cdcontinuous-deployment%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2"><span class="toc-number">4.0.0.3.</span> <span class="toc-text"> CDï¼ˆContinuous Deploymentï¼‰æŒç»­éƒ¨ç½²</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ci-cd%E4%B8%A4%E5%A4%A7%E6%9C%8D%E5%8A%A1"><span class="toc-number">4.0.0.4.</span> <span class="toc-text"> CI &#x2F; CD ä¸¤å¤§æœåŠ¡ï¼š</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%97%E8%A1%A8%E6%8E%92%E5%BA%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">5.</span> <span class="toc-text"> åˆ—è¡¨æ’åºè§£å†³æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8B%96%E5%8A%A8%E6%94%B9%E5%8F%98%E4%BD%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-number">6.</span> <span class="toc-text"> æ‹–åŠ¨æ”¹å˜ä½ç½®åŸç†</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8B%96%E5%8A%A8%E6%94%B9%E5%8F%98%E5%A4%A7%E5%B0%8F%E5%8E%9F%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text"> æ‹–åŠ¨æ”¹å˜å¤§å°åŸç†</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BF%AB%E6%8D%B7%E9%94%AE%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text"> å¿«æ·é”®å®ç°åŸç†</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%92%A4%E9%94%80%E9%87%8D%E5%81%9A%E5%8E%9F%E7%90%86"><span class="toc-number">9.</span> <span class="toc-text"> æ’¤é”€é‡åšåŸç†</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95%E5%8E%9F%E7%90%86"><span class="toc-number">10.</span> <span class="toc-text"> å³é”®èœå•åŸç†</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E4%BF%9D%E5%AD%98%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-number">11.</span> <span class="toc-text"> è‡ªåŠ¨ä¿å­˜å®ç°æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dom%E5%85%83%E7%B4%A0%E6%88%AA%E5%9B%BE%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="toc-number">12.</span> <span class="toc-text"> DOM å…ƒç´ æˆªå›¾å®ç°æ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E7%BB%B4%E7%A0%81%E7%94%9F%E6%88%90%E6%96%B9%E6%A1%88"><span class="toc-number">13.</span> <span class="toc-text"> äºŒç»´ç ç”Ÿæˆæ–¹æ¡ˆ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">14.</span> <span class="toc-text"> å¤åˆ¶åŠŸèƒ½å®ç°åŸç†</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E5%8E%9F%E7%90%86"><span class="toc-number">15.</span> <span class="toc-text"> ä¸‹è½½æ–‡ä»¶åŸç†</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="toc-number">16.</span> <span class="toc-text"> åº”ç”¨éƒ¨ç½²çš„æµç¨‹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#webpack%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96"><span class="toc-number">17.</span> <span class="toc-text"> webpack æ„å»ºä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bundler"><span class="toc-number">17.0.1.</span> <span class="toc-text"> Bundlerï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loaders"><span class="toc-number">17.0.2.</span> <span class="toc-text"> Loadersï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">17.0.2.0.0.1.</span> <span class="toc-text"> åŸç†</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#plugins"><span class="toc-number">17.0.3.</span> <span class="toc-text"> plugins:</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-2"><span class="toc-number">17.0.3.0.0.1.</span> <span class="toc-text"> åŸç†</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">17.0.4.</span> <span class="toc-text"> æ€»ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#node%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6"><span class="toc-number">18.</span> <span class="toc-text"> node åç«¯æ¡†æ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nodejs%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6%E8%B0%83%E7%A0%94"><span class="toc-number">18.1.</span> <span class="toc-text"> Node.js åç«¯æ¡†æ¶è°ƒç ”</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#express"><span class="toc-number">18.1.0.1.</span> <span class="toc-text"> Express</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#koa2"><span class="toc-number">18.1.0.2.</span> <span class="toc-text"> Koa2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#eggjs"><span class="toc-number">18.1.0.3.</span> <span class="toc-text"> egg.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nestjs"><span class="toc-number">18.1.0.4.</span> <span class="toc-text"> Nest.js</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vueconfigjs"><span class="toc-number">19.</span> <span class="toc-text"> vue.config.js</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96"><span class="toc-number">20.</span> <span class="toc-text"> é¡¹ç›®æ„å»ºä¼˜åŒ–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%BF%90%E8%A1%8C%E4%BC%98%E5%8C%96"><span class="toc-number">21.</span> <span class="toc-text"> é¡¹ç›®è¿è¡Œä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B8%B2%E6%9F%93"><span class="toc-number">21.0.1.</span> <span class="toc-text"> å®¢æˆ·ç«¯æ¸²æŸ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93"><span class="toc-number">21.0.2.</span> <span class="toc-text"> æœåŠ¡ç«¯æ¸²æŸ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%9E%84%E6%B8%B2%E6%9F%93"><span class="toc-number">21.0.3.</span> <span class="toc-text"> åŒæ„æ¸²æŸ“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssg%E9%A2%84%E6%B8%B2%E6%9F%93"><span class="toc-number">21.0.4.</span> <span class="toc-text"> SSG é¢„æ¸²æŸ“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E4%B8%8Ehttp%E4%BC%98%E5%8C%96"><span class="toc-number">22.</span> <span class="toc-text"> éƒ¨ç½²ä¸ HTTP ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">22.0.1.</span> <span class="toc-text"> éƒ¨ç½²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">22.0.2.</span> <span class="toc-text"> Nginx: åå‘ä»£ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E7%BC%93%E5%AD%98"><span class="toc-number">22.0.3.</span> <span class="toc-text"> HTTP ç¼“å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95"><span class="toc-number">22.0.4.</span> <span class="toc-text"> å‹ç¼©ç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gzip"><span class="toc-number">22.0.4.1.</span> <span class="toc-text"> gzip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#brotli"><span class="toc-number">22.0.4.2.</span> <span class="toc-text"> Brotli</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E4%BC%98%E5%8C%96"><span class="toc-number">22.0.5.</span> <span class="toc-text"> HTTP ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#keepalive%E5%B1%9E%E6%80%A7"><span class="toc-number">22.0.5.1.</span> <span class="toc-text"> keepAlive å±æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http2"><span class="toc-number">22.0.5.2.</span> <span class="toc-text"> HTTP2</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mongodb%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">23.</span> <span class="toc-text"> Mongodb æ•°æ®åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">23.0.1.</span> <span class="toc-text"> åŸºæœ¬æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mongodb%E9%AB%98%E7%BA%A7"><span class="toc-number">23.0.2.</span> <span class="toc-text"> mongodb é«˜çº§</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">23.0.2.0.1.</span> <span class="toc-text"> ç´¢å¼•</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%9A%E5%90%88"><span class="toc-number">23.0.2.0.2.</span> <span class="toc-text"> èšåˆ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%81%94%E6%9F%A5"><span class="toc-number">23.0.2.0.3.</span> <span class="toc-text"> å¤šè¡¨è”æŸ¥</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">23.0.3.</span> <span class="toc-text"> æ•°æ®åº“è®¾è®¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="toc-number">23.0.4.</span> <span class="toc-text"> è®¿é—®æƒé™ç®¡ç†</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mongoose"><span class="toc-number">24.</span> <span class="toc-text"> Mongoose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#orm"><span class="toc-number">24.0.1.</span> <span class="toc-text"> ORM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#odm"><span class="toc-number">24.0.2.</span> <span class="toc-text"> ODM</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#egg-mongoose"><span class="toc-number">25.</span> <span class="toc-text"> egg-mongoose</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#stream"><span class="toc-number">26.</span> <span class="toc-text"> Stream</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">26.0.1.</span> <span class="toc-text"> ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pipe"><span class="toc-number">26.0.2.</span> <span class="toc-text"> pipe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-3"><span class="toc-number">26.0.3.</span> <span class="toc-text"> åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pipeline"><span class="toc-number">26.0.4.</span> <span class="toc-text"> pipeline</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">27.</span> <span class="toc-text"> å¯¹è±¡å­˜å‚¨æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91oss"><span class="toc-number">27.0.1.</span> <span class="toc-text"> é˜¿é‡Œäº‘ OSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E7%89%9B%E4%BA%91kodo"><span class="toc-number">27.0.2.</span> <span class="toc-text"> ä¸ƒç‰›äº‘ KODO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%85%BE%E8%AE%AF%E4%BA%91cos"><span class="toc-number">27.0.3.</span> <span class="toc-text"> è…¾è®¯äº‘ COS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ssr%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93"><span class="toc-number">28.</span> <span class="toc-text"> SSR æœåŠ¡ç«¯æ¸²æŸ“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">28.0.1.</span> <span class="toc-text"> ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssr"><span class="toc-number">28.0.2.</span> <span class="toc-text"> SSR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vue%E4%B8%ADssr"><span class="toc-number">28.0.3.</span> <span class="toc-text"> vue ä¸­ SSR</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rbac%E6%9D%83%E9%99%90%E9%AA%8C%E8%AF%81"><span class="toc-number">29.</span> <span class="toc-text"> RBAC æƒé™éªŒè¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="toc-number">29.0.1.</span> <span class="toc-text"> ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">29.0.2.</span> <span class="toc-text"> ä½¿ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#casl%E4%BD%BF%E7%94%A8"><span class="toc-number">29.0.3.</span> <span class="toc-text"> Casl ä½¿ç”¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-2"><span class="toc-number">30.</span> <span class="toc-text"> éƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E6%A8%A1%E5%BC%8F"><span class="toc-number">30.0.1.</span> <span class="toc-text"> ä¼ ç»Ÿæ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cluster%E6%A8%A1%E5%9E%8B"><span class="toc-number">30.0.2.</span> <span class="toc-text"> Cluster æ¨¡å‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">31.</span> <span class="toc-text"> äº‘æœåŠ¡å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%AD%E4%B9%B0"><span class="toc-number">31.0.0.1.</span> <span class="toc-text"> è´­ä¹°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%99%BB%E5%BD%95"><span class="toc-number">31.0.0.2.</span> <span class="toc-text"> ç™»å½•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-2"><span class="toc-number">31.0.0.3.</span> <span class="toc-text"> ä½¿ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86"><span class="toc-number">31.0.0.4.</span> <span class="toc-text"> ç®¡ç†</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E9%83%A8%E7%BD%B2"><span class="toc-number">32.</span> <span class="toc-text"> æ™®é€šéƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker"><span class="toc-number">32.1.</span> <span class="toc-text"> Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-4"><span class="toc-number">32.1.1.</span> <span class="toc-text"> ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-images"><span class="toc-number">32.1.2.</span> <span class="toc-text"> Docker  images</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-container"><span class="toc-number">32.1.3.</span> <span class="toc-text"> Docker Container</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">32.1.4.</span> <span class="toc-text"> æŒä¹…åŒ–å®¹å™¨æ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F"><span class="toc-number">32.1.5.</span> <span class="toc-text"> Dockerfile è‡ªå®šä¹‰é•œåƒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-number">32.1.6.</span> <span class="toc-text"> æ•°æ®åº“é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E9%95%9C%E5%83%8F%E5%A4%A7%E5%B0%8F"><span class="toc-number">32.1.7.</span> <span class="toc-text"> ä¼˜åŒ–é•œåƒå¤§å°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-3"><span class="toc-number">32.1.8.</span> <span class="toc-text"> éƒ¨ç½²</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#yaml%E8%AF%AD%E8%A8%80"><span class="toc-number">33.</span> <span class="toc-text"> YAML è¯­è¨€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#github-action"><span class="toc-number">34.</span> <span class="toc-text"> Github Action</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2"><span class="toc-number">35.</span> <span class="toc-text"> è‡ªåŠ¨åŒ–éƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A8%E9%80%81%E8%BF%9C%E7%A8%8B%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93"><span class="toc-number">35.1.</span> <span class="toc-text"> æ¨é€è¿œç¨‹é•œåƒä»“åº“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#github-actions%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2"><span class="toc-number">35.2.</span> <span class="toc-text"> Github Actions è‡ªåŠ¨éƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9C%A8github%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8Abuild-image%E5%B9%B6%E4%B8%94push"><span class="toc-number">35.2.0.0.0.1.</span> <span class="toc-text"> åœ¨ github æœåŠ¡å™¨ä¸Š build image å¹¶ä¸” push</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« ">
        <ul>
          <li class="active"><a href="/2024/04/12/%E5%A4%8D%E6%9D%82%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF/" rel="bookmark" title="å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ–">å¤æ‚ä¸šåŠ¡éƒ¨ç½²ä¸ä¼˜åŒ–</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="dmq"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">dmq</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">79</span>
        <span class="name">æ–‡ç« </span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">59</span>
        <span class="name">åˆ†ç±»</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">98</span>
        <span class="name">æ ‡ç­¾</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RtcTA/dGFiPXJlcG9zaXRvcmllcw==" title="https:&#x2F;&#x2F;github.com&#x2F;dmq0?tab&#x3D;repositories"><i class="ic i-github"></i></span>
      <span class="exturl item npm" data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL35kbXEwMDA=" title="https:&#x2F;&#x2F;www.npmjs.com&#x2F;~dmq000"><i class="ic i-file"></i></span>
      <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9kLTg4LTYxLTgz" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;d-88-61-83"><i class="ic i-zhihu"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTgwMjc4OTk0OTE=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;8027899491"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vdS83NjI1OTAxNzE3" title="https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;7625901717"><i class="ic i-weibo"></i></span>
      <span class="exturl item email" data-url="bWFpbHRvOjMyNjc4MDc1MTRAcXEuY29t" title="mailto:3267807514@qq.com"><i class="ic i-envelope"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>ä»‹ç»</a>
  </li>

    
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>å½’æ¡£</a>
  </li>

    
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a>
  </li>

    
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a>
  </li>

    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>å‹é“¾</a>
  </li>

    
  <li class="item">
    <a href="/links/" rel="section"><i class="ic i-magic"></i>å·¥å…·</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2024/03/30/jest/" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2024/04/12/%E8%84%9A%E6%89%8B%E6%9E%B6/" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>éšæœºæ–‡ç« </h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/HTTP/" title="åˆ†ç±»äº HTTP">HTTP</a>
</div>

    <span><a href="/2023/05/02/HTTP/" title="HTTP">HTTP</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/webpack/" title="åˆ†ç±»äº webpack">webpack</a>
</div>

    <span><a href="/2023/10/21/webpack/" title="webpackç¬”è®°">webpackç¬”è®°</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%89%8B%E5%86%99JS%E6%BA%90%E7%A0%81/" title="åˆ†ç±»äº æ‰‹å†™JSæºç ">æ‰‹å†™JSæºç </a>
</div>

    <span><a href="/2023/06/02/JS%E6%89%8B%E5%86%99/" title="æ‰‹å†™JSæºç ">æ‰‹å†™JSæºç </a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91/" title="åˆ†ç±»äº è„šæ‰‹æ¶å¼€å‘">è„šæ‰‹æ¶å¼€å‘</a>
</div>

    <span><a href="/2024/04/12/%E8%84%9A%E6%89%8B%E6%9E%B6/" title="è„šæ‰‹æ¶å¼€å‘">è„šæ‰‹æ¶å¼€å‘</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="åˆ†ç±»äº æ­£åˆ™è¡¨è¾¾å¼">æ­£åˆ™è¡¨è¾¾å¼</a>
</div>

    <span><a href="/2024/01/10/%E6%AD%A3%E5%88%99/" title="æ­£åˆ™ç†å¿µ">æ­£åˆ™ç†å¿µ</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/markdown/" title="åˆ†ç±»äº markdown">markdown</a>
</div>

    <span><a href="/2023/02/10/md/" title="markdown">markdown</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" title="åˆ†ç±»äº è‡ªåŠ¨åŒ–æµ‹è¯•">è‡ªåŠ¨åŒ–æµ‹è¯•</a>
</div>

    <span><a href="/2024/03/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" title="è‡ªåŠ¨åŒ–æµ‹è¯•">è‡ªåŠ¨åŒ–æµ‹è¯•</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/json-server/" title="åˆ†ç±»äº json-server">json-server</a>
</div>

    <span><a href="/2023/01/09/json-server%E6%95%99%E7%A8%8B/" title="json-server">json-server</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91/" title="åˆ†ç±»äº è„šæ‰‹æ¶å¼€å‘">è„šæ‰‹æ¶å¼€å‘</a>
</div>

    <span><a href="/2024/03/30/%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E9%93%BE%E6%8E%A5/" title="æœ¬åœ°æ–‡ä»¶é“¾æ¥">æœ¬åœ°æ–‡ä»¶é“¾æ¥</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E7%AE%97%E6%B3%95/" title="åˆ†ç±»äº ç®—æ³•">ç®—æ³•</a>
</div>

    <span><a href="/2023/06/02/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="å›¾ç‰‡ä¸Šä¼ è§£å†³æ–¹æ¡ˆ">å›¾ç‰‡ä¸Šä¼ è§£å†³æ–¹æ¡ˆ</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>æœ€æ–°è¯„è®º</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 â€“ 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">dmq @ Web blog</span>
  </div>
  <div class="powered-by">
    åŸºäº <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2024/04/12/å¤æ‚é¡¹ç›®éƒ¨ç½²ä¸Šçº¿/',
    favicon: {
      show: "ç§‘æŠ€å¼•é¢†æœªæ¥",
      hide: "æ¬¢è¿ä¸æˆ‘äº¤æµ"
    },
    search : {
      placeholder: "æ–‡ç« æœç´¢",
      empty: "å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",
      stats: "${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"
    },
    valine: true,fancybox: true,
    copyright: 'å¤åˆ¶æˆåŠŸï¼Œè½¬è½½è¯·éµå®ˆ <i class="ic i-creative-commons"></i>BY-NC-SA åè®®ã€‚',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//gcore.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>


  <script data-pjax>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9ba187659e850a6910681214f0faa16b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</body>
</html>
