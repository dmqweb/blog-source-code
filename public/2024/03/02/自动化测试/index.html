



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="杜明清的个人博客" href="https://dmqweb.cn/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="杜明清的个人博客" href="https://dmqweb.cn/atom.xml" />
<link rel="alternate" type="application/json" title="杜明清的个人博客" href="https://dmqweb.cn/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="自动化测试" />


<link rel="canonical" href="https://dmqweb.cn/2024/03/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/">



  <title>
自动化测试 - 自动化测试 |
Web blog = 杜明清的个人博客 = 👻欢迎一起交流学习👻</title>
  <meta name="keywords" content="前端开发, HTML, CSS, JavaScript, 博客">
  <meta name="description" content="探索前端开发的无限可能。本博客提供最新的前端知识库，以及实用的开发技巧和最佳实践。加入我们的社区，共同成长。">
<meta name="generator" content="Hexo 6.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">自动化测试
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2024-03-02 10:04:04">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2024-03-02T10:04:04+08:00">2024-03-02</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>46k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>41 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Web blog</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/15/9d4994abd78e2f72.jpg"></li>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/25/b4f20660104f3911.jpg"></li>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/15/effaa43770a5e6bc.jpg"></li>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/12/f63f09ff2084b1f3.jpg"></li>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/05/05d9a07e0d190274.webp"></li>
          <li class="item" data-background-image="https://s3.uuu.ovh/imgs/2024/04/06/a16303594a53d8d1.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首页</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" itemprop="item" rel="index" title="分类于 自动化测试"><span itemprop="name">自动化测试</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://dmqweb.cn/2024/03/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="dmq">
    <meta itemprop="description" content="👻欢迎一起交流学习👻, ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="杜明清的个人博客">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="5-3-自动化测试"><a class="anchor" href="#5-3-自动化测试">#</a> 5-3 自动化测试</h1>
<h2 id="介绍"><a class="anchor" href="#介绍">#</a> 介绍</h2>
<p>在前端界，浏览器兼容性是让工程师们头疼的问题，对于经验丰富的人来说，很清楚浏览器有哪些坑，但是对于大部分程序员，最可怕的是代码明明在这个浏览器运行得很好，但是到了另一个浏览器中就不能正常运行了。对于这部分的程序员，保障代码能正常运行的方法便是能尽早发现问题，然后将其解决。</p>
<p><strong>前端项目如何做测试？</strong></p>
<ul>
<li>测试同学：功能测试，性能测试，测试用例</li>
<li>前端同学：单元测试，常用于组件库、AP 等 (Jest、Mocha), 上线项目如何做测试？</li>
</ul>
<p><strong>上线项目如何进行测试</strong></p>
<ul>
<li>利用前端监控，进行监控项目稳定性和性能，并上报前端日志</li>
<li>稳定性：如 ljserror、白屏检测等</li>
<li>性能：如秒开率、首屏渲染时长、接请求时长等</li>
<li>前端日志：如 console.log、API 请求记录等</li>
</ul>
<p><strong>为什么需要自动化测试？</strong></p>
<p>项目经过不断的开发，最终肯定会趋于稳定，在<strong>适当的时机下</strong>引入自动化测试能及早发现问题，<strong>保证产品的质量</strong>。</p>
<p>测试作为完整的开发流程中最后的一环，是保证产品质量重要的一环。而前端测试一般在产品开发流程中属于偏后的环节，在整个开发架构中属于较高层次，前端测试更加偏向于 GUI 的特性，因此前端的测试难度很大。</p>
<p>测试的目的：</p>
<ul>
<li>有利于写出高质量的代码，尽早发现问题</li>
<li>有利于代码的扩展</li>
<li>有利于代码的维护</li>
</ul>
<p><strong>本课程的学习路径：</strong></p>
<ul>
<li>学习基础的概念，清晰测试不同的应用场景</li>
<li>学习不同的前端测试工具，了解如何进行选择</li>
<li>在项目中进行实践</li>
</ul>
<p><strong>本课程的主要内容：</strong></p>
<ul>
<li>介绍测试框架的分类</li>
<li>单元测试工具介绍：Mocha，Jest，AVA，Karma</li>
<li>E2E 测试工具介绍：Nightmare</li>
</ul>
<p><strong>本课程的学习准备：</strong></p>
<ul>
<li>IDE vscode，node  LTS</li>
<li>包管理工具：yarn, cnpm</li>
</ul>
<h2 id="前端自动化测试"><a class="anchor" href="#前端自动化测试">#</a> 前端自动化测试</h2>
<p>测试是一个庞大的主题，包括各种分类的测试，诸如黑盒测试 / 白盒测试、单元测试 / 集成测试 / 端到端测试等。通常程序员在测试自己的代码的时候用得最多的便是单元测试，但是因为测试也是需要代价，很多人是不喜欢写测试的，甚至是一点都不写。</p>
<p>那么是什么原因让大家不愿意写呢？</p>
<ol>
<li>不熟悉</li>
<li>浪费时间</li>
<li>知识不成体系</li>
<li>团队氛围</li>
<li>缺少实践</li>
</ol>
<p>我们要从基础的东西学起，打消对测试的恐惧。</p>
<h3 id="测试的分类"><a class="anchor" href="#测试的分类">#</a> 测试的分类</h3>
<p>在多浏览器的自动化测试，我们多半是进行端到端的测试工作，一小部分是大粒度的单元测试。端到端测试测试模拟用户的行为。在 Web 应用程序中，他们会启动服务器，打开浏览器，模拟用户的行为进行点击、输入、提交等动作，断言浏览器中发生了特定的事情或者是得到了期待的结果，从而让我们相信功能可以正常的运行。</p>
<p>而单元测试根据代码单元的公共 API 运行它们。这些测试需要创建一个类的实例，使用特定的输入调用它的方法，断言被调用的方法达到了预期的效果。在下文中我们会看到这两种测试的实践，当然有时候区分度并不大，可能无法明显地区分哪些是端对端测试哪些是单元测试，有时候他们是混合起来的，不过只要记住我们的目标是保证功能可以正常运行救足够了。</p>
<p>按照软件工程自底而上的概念，前端测试一般分为单元测试（Unit Testing ）、集成测试（Integration Testing）和端到端测试（E2E Testing）。从下面的图可以看出，从底向上测试的复杂度将不断提高，另一方面测试的收益反而不断降低的。</p>
<p><img data-src="assets/16415de723a8d411.png" alt="img" /></p>
<blockquote>
<p>关于软件测试分类，可见<a href="#%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E7%9A%84%E5%88%86%E7%B1%BB">软件测试的分类</a></p>
</blockquote>
<h3 id="测试工具对比"><a class="anchor" href="#测试工具对比">#</a> 测试工具对比</h3>
<p>在进行项目实践前，很重要的一项工作是选择合适的技术栈。好比在前端开发时应该选择 React，Vue 还是 Angular 作为框架一样，前端的测试工作也需要选择一套技术栈。很多时候大家在制定技术栈时容易走偏，在选择技术框架时不是选择最合适的框架，而是选择最热门的框架。当然一定程度上热门的框架能反应其受欢迎程度，可能是因为其出众的优点，如较高的开发效率、高效的渲染特性或者是活跃的社区。在前端开发中，很容易有这样的感受，就是只要半个月没有关注业界的最新动态，就感觉恍若隔世，新的解决方案层出不穷，让人喘不过气。</p>
<p>经过几年的前端洗礼之后，就已经过了慌乱的年纪，再也不会盲目地追寻新技术，而转向关注技术背后解决的痛点，原理等。</p>
<p><img data-src="assets/v2-af09ebe8167f63a49ea49287fe04526f_hd-20190706122102737.jpg" alt="img" /></p>
<h4 id="如何选择测试框架"><a class="anchor" href="#如何选择测试框架">#</a> 如何选择测试框架</h4>
<p>测试框架基本上都做了一件事儿：</p>
<ul>
<li>描述你要测试的东西</li>
<li>对其进行测试</li>
<li>判断是否符合预期</li>
</ul>
<p>选择框架会考虑下面的点：</p>
<ul>
<li>
<p>测试框架是否有简明的语法与文档。</p>
<p>Mocha、Jasmine、Jest、AVA、Karma、Nightmare</p>
</li>
<li>
<p>断言 (Assertions)：用于判断结果是否符合预期。有些框架需要单独的断言库。</p>
<p>Should.js、chai、expect.js 等等，断言库提供了很多语义化的方法来对值做各种各样的判断。当然也可以不用断言库，Node.js 中也可以直接使用原生 assert 库。</p>
</li>
<li>
<p>适合 TDD / BDD：是否适合 测试驱动型 / 行为驱动型 的测试风格。</p>
<blockquote>
<p>BDD (Bebavior Driven Developement，行为驱动测试) 和 TDD (Testing Driven Developement，测试驱动开发)</p>
</blockquote>
<p>BDD 和 TDD 均有各自的适用场景，BDD 一般更偏向于系统功能和业务逻辑的自动化测试设计，而 TDD 在快速开发并测试功能模块的过程中则更加高效，以快速完成开发为目的。下面我们看下 BDD 和 TDD 具体的特点：</p>
<p>BDD 的特点：</p>
<ul>
<li>从业务逻辑的角度定义具体的输入与预期输出，以及可衡量的目标；</li>
<li>尽可能覆盖所有的测试用例情况；</li>
<li>描述一系列可执行的行为，根据业务的分析来定义预期输出。例如，expect, should, assert；</li>
<li>设定关键的测试通过节点输出提示，便于测试人员理解；</li>
<li>最大程度的交付出符合用户期望的产品，避免输出不一致带来的问题。</li>
</ul>
<p>TDD 的特点：</p>
<ul>
<li>需求分析，快速编写对应的输入输出测试脚本；</li>
<li><strong>仅在自动测试失败时才编写新代码</strong>。</li>
<li>重构去除不必要的依赖关系，然后重复测试，最终让程序符合所有要求。</li>
</ul>
</li>
<li>
<p>异步测试：有些框架对异步测试支持良好。</p>
</li>
<li>
<p>使用的语言：大部分 js 测试框架使用 js。</p>
</li>
<li>
<p>用于特定目的：每个框架可能会擅长处理不同的问题。</p>
<p>是要测试单个功能、单个组件、还是集成化测试？</p>
<p>是要测试 GUI 逻辑、交互？</p>
<p>是要测试非功能性指标？兼容性？</p>
</li>
<li>
<p>社区是否活跃。</p>
</li>
</ul>
<h4 id="测试工具的类型"><a class="anchor" href="#测试工具的类型">#</a> 测试工具的类型</h4>
<p>测试工具可分为以下功能。有些只为我们提供了一种功能，有些功能为我们提供了一种组合。</p>
<p>为了实现最灵活的集合功能，通常使用多种工具的组合。</p>
<ul>
<li>
<p>提供 UI 界面或者 CLI 工具：（<span class="exturl" data-url="aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLw==">Karma</span>，<span class="exturl" data-url="aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==">Jasmine</span>，<span class="exturl" data-url="aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=">Jest</span>，<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=">TestCafe</span>，<span class="exturl" data-url="aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=">Cypress</span>）</p>
<p><strong>CLI 工具</strong>会给出一系列测试，以及运行这些测试所需的各种配置和脚手架（运行什么浏览器，使用什么 babel 插件，如何格式化输出等）</p>
</li>
<li>
<p>提供测试框架（形成文件目录）：(<span class="exturl" data-url="aHR0cHM6Ly9tb2NoYWpzLm9yZy8=">Mocha</span>, <span class="exturl" data-url="aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==">Jasmine</span>, <span class="exturl" data-url="aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=">Jest</span>, <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2N1Y3VtYmVyL2N1Y3VtYmVyLWpz">Cucumber</span>, <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=">TestCafe</span>, <span class="exturl" data-url="aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=">Cypress</span>)</p>
</li>
<li>
<p>提供断言：（<span class="exturl" data-url="aHR0cDovL2NoYWlqcy5jb20v">Chai</span>，<span class="exturl" data-url="aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==">Jasmine</span>，<span class="exturl" data-url="aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=">Jest</span>，<span class="exturl" data-url="aHR0cDovL3VuZXhwZWN0ZWQuanMub3JnLw==">Unexpected</span>，<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=">TestCafe</span>，<span class="exturl" data-url="aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=">Cypress</span>）</p>
<p><strong>断言函数</strong>检查测试返回的结果是否符合预期</p>
</li>
<li>
<p>生成，展示测试结果（<span class="exturl" data-url="aHR0cHM6Ly9tb2NoYWpzLm9yZy8=">Mocha</span>，<span class="exturl" data-url="aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==">Jasmine</span>，<span class="exturl" data-url="aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=">Jest</span>，<span class="exturl" data-url="aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLw==">Karma</span>，<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=">TestCafe</span>，<span class="exturl" data-url="aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=">Cypress</span>）</p>
</li>
<li>
<p>快照测试（<span class="exturl" data-url="aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=">Jest</span>，<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YQ==">Ava</span>）</p>
<p>快照测试 (snapshot testing)，测试 UI 或数据结构是否和之前完全一致，通常 UI 测试不在单元测试中</p>
</li>
<li>
<p>提供仿真（<span class="exturl" data-url="aHR0cDovL3Npbm9uanMub3JnLw==">Sinon</span>，<span class="exturl" data-url="aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==">Jasmine</span>，<span class="exturl" data-url="aHR0cDovL2FpcmJuYi5pby9lbnp5bWUvZG9jcy9hcGkv">enzyme</span>，<span class="exturl" data-url="aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=">Jest</span>，<span class="exturl" data-url="aHR0cHM6Ly90ZXN0ZG91YmxlLmNvbS8=">testdouble</span>）</p>
<p>仿真 (mocks, spies, and stubs)：获取方法的调用信息，模拟方法，模块，甚至服务器</p>
</li>
<li>
<p>生成测试覆盖率报告 (<span class="exturl" data-url="aHR0cHM6Ly9nb3R3YXJsb3N0LmdpdGh1Yi5pby9pc3RhbmJ1bC8=">Istanbul</span>, <span class="exturl" data-url="aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=">Jest</span>, <span class="exturl" data-url="aHR0cDovL2JsYW5rZXRqcy5vcmcv">Blanket</span>)</p>
</li>
<li>
<p>提供类浏览器环境 (<span class="exturl" data-url="aHR0cDovL25pZ2h0d2F0Y2hqcy5vcmcv">Nightwatch</span>, <span class="exturl" data-url="aHR0cDovL3d3dy5uaWdodG1hcmVqcy5vcmcv">Nightmare</span>, <span class="exturl" data-url="aHR0cDovL3BoYW50b21qcy5vcmcv">Phantom</span><strong>,</strong> <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dvb2dsZUNocm9tZS9wdXBwZXRlZXI=">Puppeteer</span>, <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=">TestCafe</span>, <span class="exturl" data-url="aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=">Cypress</span>)</p>
</li>
<li>
<p>可视化回归工具 (<span class="exturl" data-url="aHR0cHM6Ly9hcHBsaXRvb2xzLmNvbS8=">Applitools</span>, <span class="exturl" data-url="aHR0cHM6Ly9wZXJjeS5pby8=">Percy</span>, <span class="exturl" data-url="aHR0cDovL2JiYy1uZXdzLmdpdGh1Yi5pby93cmFpdGgv">Wraith</span>, <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dlYmRyaXZlcmlvLWJvbmV5YXJkL3dlYmRyaXZlcmNzcw==">WebdriverCSS</span>)</p>
</li>
</ul>
<h4 id="单元测试类工具"><a class="anchor" href="#单元测试类工具">#</a> 单元测试类工具</h4>
<p>npm trends: <span class="exturl" data-url="aHR0cHM6Ly93d3cubnBtdHJlbmRzLmNvbS9tb2NoYS12cy1qZXN0LXZzLWF2YS12cy1qYXNtaW5lLWNvcmU=">点击链接</span></p>
<p><img data-src="assets/image-20190706101634263.png" alt="/images/image-20190706101634263" /></p>
<p><strong>Karma</strong></p>
<p>Karma 是一个 Runner（即运行环境），具体详细的介绍见 <a href="#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83&amp;%E5%B8%AE%E6%89%8BKarma">后面的章节 Karma</a></p>
<blockquote>
<p>A test runner is the library or tool that picks up an assembly (or a source code directory) that contains unit tests, and a bunch of settings, and then executes them and writes the test results to the console or log files.<br />
there are many runners for different languages. See Nunit and MSTest for C#, or Junit for Java.</p>
</blockquote>
<p>karma 设计目标主要有下面四点：</p>
<blockquote>
<p>高效<br />
扩展性<br />
运行在真实设备<br />
无缝的使用流程</p>
</blockquote>
<p>karma 是一个典型的 C/S 程序，包含 client 和 server ，通讯方式基于 Http ，通常情况下，客户端和服务端基本都运行在开发者本地机器上。</p>
<p>一个服务端实例对应一个项目，假如想同时运行多个项目，得同时开启多个服务端实例。</p>
<p>Karma 的<strong>优点</strong>是能通过插件和配置的方式集成大部分的主流的测试框架和前端库，能方便的一次在多浏览器环境执行测试用例，并集成了测试覆盖率生成功能，生成页面形式覆盖率报告并能导出不同形式的覆盖率报告数据。</p>
<p>它的<strong>缺点</strong>是，对测试页面环境的搭建和资源文件的加载不是常见的形式，最开始搭建环境时会有很多跟预期不一致的情况，配置不直观。</p>
<p><strong>Jasmine</strong></p>
<p>Jasmine 带有 assertions (断言)，spies (用来模拟函数的执行环境) 和 mocks (mock 工具)，Jasmine 初始化设置简单，同时，如果你需要一些单元功能的时候你仍然可以加一些库进来。</p>
<p><strong>Mocha</strong></p>
<p>Mocha 是一个灵活的库，提供给开发者的只有一个基础测试结构。然后，其它功能性的功能如 assertions， spies 和 mocks，这些功能<strong>需要引用添加其它库</strong> / 插件来完成。</p>
<p><strong>Jest</strong></p>
<p>被 Facebook 和各种 React 应用推荐和使用，Jest 得到了很好的支持。Jest 也被发现是一个非常快速的测试库在平行测试报告中。</p>
<p>对于小型项目来说你可能在开始的时候不用过多担心，而性能的提高，对于希望全天持续部署的大型应用 app 来说是非常之好的。</p>
<p>而开发人员主要是用 Jest 去测试 React 应用，Jest 可以很容易地集成到其它应用程序中充许你使用更独特的特性在其它地方</p>
<p>快照测试是一个非常好用的工具，去确保你的应用 UI 不会有超出预期的错误，在产品发布替换的期间发生。虽然大部分功能，专门设计都是使用在 React 上。</p>
<p>Jest 有着很广阔的 API 。</p>
<p><strong>AVA</strong></p>
<p>AVA 它的优势是 JavaScript 的异步特性和并发运行测试.</p>
<p>利用了 JavaScript 的异步特性优势，优化了在部署的时间等待</p>
<p>保留了简单的 API 为你提供你所需要的功能。</p>
<p>如果搭配 mocking 来使用它会显得更加友好，但是必须安装一个单独的库。</p>
<h4 id="e2e测试类工具"><a class="anchor" href="#e2e测试类工具">#</a> E2E 测试类工具</h4>
<p>npm trends: <span class="exturl" data-url="aHR0cHM6Ly93d3cubnBtdHJlbmRzLmNvbS9jeXByZXNzLXZzLW5pZ2h0bWFyZS12cy1uaWdodHdhdGNoLXZzLXRlc3RjYWZlLXZzLXdlYmRyaXZlcmlv">点击链接</span></p>
<p><img data-src="assets/image-20190706100636750.png" alt="/images/image-20190706100636750" /></p>
<h3 id="最佳实践"><a class="anchor" href="#最佳实践">#</a> 最佳实践</h3>
<p>测试有很多好处，但不代表一上来就要写出 100% 场景覆盖的测试用例。</p>
<p><strong>最佳的实践：基于投入产出比来做测试</strong></p>
<p>由于维护测试用例也是一大笔开销（毕竟没有多少测试会专门帮前端写业务测试用例，而前端使用的流程自动化工具更是没有测试参与了）。</p>
<p>对于像基础组件、基础模型之类的不常变更且复用较多的部分，可以考虑去写测试用例来保证质量。个</p>
<p>先写少量的测试用例覆盖到 80%+ 的场景，保证覆盖主要使用流程。</p>
<p>一些极端场景出现的 bug 可以在迭代中形成测试用例沉淀，场景覆盖也将逐渐趋近 100%。</p>
<p>但对于迭代较快的业务逻辑以及生存时间不长的活动页面之类的就别花时间写测试用例了，维护测试用例的时间大了去了，成本太高。</p>
<p>大型项目，可以使用 Jest 快速形成配置并且开始单元测试。</p>
<p>需要测试快照，则可以选择 Jest 或者 Ava。</p>
<p>对于配置性要求高，对测试框架性能有要求的可以选择 mocha。</p>
<p>对模拟还原浏览器业务操作有很大的需求的，可以选择 nightmare</p>
<p>配合 CI 工具完成自动化测试、测试覆盖率、测试结果推送。</p>
<h2 id="喜欢简单选择mocha"><a class="anchor" href="#喜欢简单选择mocha">#</a> 喜欢简单，选择 Mocha</h2>
<p><a target="_blank" rel="noopener" href="https://mochajs.org/"> <code>Mocha</code> </a>（发音 &quot;摩卡&quot;）诞生于 2011 年，是现在最流行的 JavaScript 测试框架之一，在浏览器和 Node 环境都可以使用。所谓 &quot;测试框架&quot;，就是运行测试的工具。通过它，可以为 JavaScript 应用添加测试，从而保证代码的质量。</p>
<h3 id="安装"><a class="anchor" href="#安装">#</a> 安装</h3>
<p>全局安装 Mocha</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> mocha</pre></td></tr></table></figure><p>项目中也安装 Mocha</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> --save-dev mocha</pre></td></tr></table></figure><p>在 package.json 中加入下面脚本：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token string">"scripts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token string">"test"</span><span class="token builtin class-name">:</span> <span class="token string">"mocha"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>Chai 是一个针对 Node.js 和浏览器的行为驱动测试和测试驱动测试的<strong>断言库</strong>，可与任何 JavaScript 测试框架集成。它是 Mocha 的好帮手～～</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> --save-dev chai</pre></td></tr></table></figure><p>在 package.json 中加入下面脚本：</p>
<pre><code class="language-javascripton">&quot;scripts&quot;: &#123;
    &quot;test&quot;: &quot;mocha&quot;
&#125;
</code></pre>
<h3 id="关于断言"><a class="anchor" href="#关于断言">#</a> 关于断言</h3>
<p><code>expect</code>  断言的优点是很接近自然语言，下面是一些例子。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 相等或不相等</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>deep<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token string">'baz'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 布尔值为 true</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'everthing'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>ok<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>not<span class="token punctuation">.</span>be<span class="token punctuation">.</span>ok<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// typeof</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">an</span><span class="token punctuation">(</span><span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>an<span class="token punctuation">.</span><span class="token function">instanceof</span><span class="token punctuation">(</span>Foo<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// include</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'foobar'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">contain</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">'universe'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>include<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">// empty</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>empty<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>empty<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>empty<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">// match</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">'foobar'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^foo</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>两种使用方式：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// commonjs</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// es6</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> expect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'chai'</span></pre></td></tr></table></figure><h3 id="测试案例"><a class="anchor" href="#测试案例">#</a> 测试案例</h3>
<p>其中 index.js 为我们的被测试代码：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</pre></td></tr><tr><td data-num="2"></td><td><pre> * 加法函数</pre></td></tr><tr><td data-num="3"></td><td><pre> * @param &#123;第一个数&#125; a </pre></td></tr><tr><td data-num="4"></td><td><pre> * @param &#123;第二个数&#125; b </pre></td></tr><tr><td data-num="5"></td><td><pre> */</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">function</span> <span class="token function">addNum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>module<span class="token punctuation">.</span>exports<span class="token operator">=</span>addNum<span class="token punctuation">;</span></pre></td></tr></table></figure><p>新建测试脚本 <code>test/demo.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> addNum <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/index'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试index.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试addNum函数'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'两数相加结果为两个数字的和'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token comment">// 以上语法为 chai 的 expect 语法，它还有 should 语法和 asset 语法。</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// 等价的意思</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">var</span> addNum<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../src/index'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试index.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试addNum函数'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'两数相加结果为两个数字的和'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"两数相加结果不为两个数字的和"</span><span class="token punctuation">)</span>；</pre></td></tr><tr><td data-num="22"></td><td><pre>       <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="mocha测试命令"><a class="anchor" href="#mocha测试命令">#</a> Mocha 测试命令</h3>
<p>如果想测试单一的测试 js，可以用：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>mocha test/index.test.js</pre></td></tr></table></figure><p>或者多个 js</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>mocha test/index.test.js test/add.test.js</pre></td></tr></table></figure><p>当然也可以用通配符测试某个文件夹下所有的 js 和 jsx：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># node 通配符</span></pre></td></tr><tr><td data-num="2"></td><td><pre>mocha <span class="token string">'test/some/*.@(js|jsx)'</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># shell 通配符</span></pre></td></tr><tr><td data-num="5"></td><td><pre>mocha test/unit/*.js</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>mocha spec/<span class="token punctuation">&#123;</span>my,awesome<span class="token punctuation">&#125;</span>.js</pre></td></tr></table></figure><h3 id="es6语法支持"><a class="anchor" href="#es6语法支持">#</a> ES6 语法支持</h3>
<p>在上面我们用的并非是 ES6 的语法，那么让我们把其中的代码都改为 ES6 的语法。<br />
其中 index.js 为：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</pre></td></tr><tr><td data-num="2"></td><td><pre> * 加法函数</pre></td></tr><tr><td data-num="3"></td><td><pre> * @param &#123;第一个数&#125; a </pre></td></tr><tr><td data-num="4"></td><td><pre> * @param &#123;第二个数&#125; b </pre></td></tr><tr><td data-num="5"></td><td><pre> */</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">function</span> <span class="token function">addNum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">return</span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">export</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  addNum</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>而 index.test.js 为：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> expect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'chai'</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> addNum <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../src/index'</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试index.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试addNum函数'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'两个参数相加结果为两个数字的和'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'两个参数相加结果不为和以外的数'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>此时直接运行 mocha 肯定是不行的，我们现需要安装一下 babel：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> --save-dev @babel/cli @babel/core @babel/node @babel/register @babel/preset-env chai mocha nodemon</pre></td></tr></table></figure><p>然后，在项目目录下面，新建一个.babelrc 文件：</p>
<pre><code class="language-javascripton">&#123;
  &quot;presets&quot;: [&quot;@babel/preset-env&quot;]
&#125;
</code></pre>
<p>接着讲 package.json 中的脚本改为：</p>
<pre><code class="language-javascripton">&quot;scripts&quot;: &#123;
  &quot;test&quot;: &quot;mocha --require @babel/register&quot;
&#125;,
</code></pre>
<p>命令变得更加简单了</p>
<h3 id="更多用法"><a class="anchor" href="#更多用法">#</a> 更多用法</h3>
<h4 id="超时"><a class="anchor" href="#超时">#</a> 超时</h4>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>--timeout, -t, <span class="token parameter variable">--timeouts</span>  Specify <span class="token builtin class-name">test</span> <span class="token function">timeout</span> threshold <span class="token punctuation">(</span>in milliseconds<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>                                                        <span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token punctuation">[</span>default: <span class="token number">2000</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>官方默认的超时是 2000 毫秒，即 2s。</p>
<p>有三种方式来修改超时：</p>
<p><code>--no-timeout</code>  参数或者 <code>debug</code>  模式中，全局禁用了超时；</p>
<p><code>--timeout</code>  后面接时间（毫秒），全局修改了本次执行测试用例的超时时间；</p>
<p>在测试用例里面，使用 <code>this.timeout</code>  方法：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should take less than 500ms'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">setTimeout</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在<a href="#%E9%92%A9%E5%AD%90%E6%96%B9%E6%B3%95%EF%BC%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0%EF%BC%89">钩子方法</a>里面使用：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'a suite of tests'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// A very long environment setup.</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> <span class="token number">2500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote>
<p>同样，可以使用 ``this.timeout (0) <code> </code> 去禁用超时。</p>
</blockquote>
<h4 id="钩子方法生命周期函数"><a class="anchor" href="#钩子方法生命周期函数">#</a> 钩子方法（生命周期函数）</h4>
<p>Mocha 在 describe 块之中，提供测试用例的四个钩子：before ()、after ()、beforeEach () 和 afterEach ()。它们会在指定时间执行。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试index.js'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"在本区块的所有测试用例之前执行"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"在本区块的所有测试用例之后执行"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"在本区块的每个测试用例之前执行"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span>console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"在本区块的每个测试用例之后执行"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'测试addNum函数'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'两数相加结果为两个数字的和'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token function">addNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="异步测试"><a class="anchor" href="#异步测试">#</a> 异步测试</h4>
<p>Mocha 本身是支持异步测试的。只需要为 <code>describe</code>  回调函数添加一个 <code>done</code>  参数， 成功时调用 <code>done()</code> ，失败时调用 <code>done(err)</code> 。例如：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">var</span> expect <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chai'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>expect<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'db'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'#get'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> foo</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">done</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>        </pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token function">expect</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li>如果未调用 <code>done</code>  函数，Mocha 会一直等待直到超时。</li>
<li>如果未添加 <code>done</code>  参数，Mocha 会直接返回成功，不会捕获到异步的断言失败。例如：</li>
</ul>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'#get'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>运行上述测试<span class="exturl" data-url="aHR0cHM6Ly9tb2NoYWpzLm9yZy8="> Mocha</span> 总会提示 Passing。</p>
<blockquote>
<p>Mocha 怎么知道是否要等待异步断言呢？因为 JavaScript 中的<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRnVuY3Rpb24="> Function</span> 有一个 <code>length</code>  属性， 通过它可以获得该函数的形参个数。Mocha 通过传入回调的 <code>length</code>  来判断是否需要等待。</p>
</blockquote>
<p>或者， <code>done()</code>  您可以返回<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvUHJvbWlzZQ=="> Promise</span>，而不是使用回调。如果您正在测试的 API 返回 promises 而不是回调，可以这样进行使用：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">[</span>tobi<span class="token punctuation">,</span> loki<span class="token punctuation">,</span> jane<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'#find()'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'respond with matching records'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'User'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>should<span class="token punctuation">.</span>eventually<span class="token punctuation">.</span>have<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>同样，可以使用<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvU3RhdGVtZW50cy9hc3luY19mdW5jdGlvbg=="> async /await</span>，您还可以编写如下的异步测试：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">[</span>tobi<span class="token punctuation">,</span> loki<span class="token punctuation">,</span> jane<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'#find()'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'responds with matching records'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'User'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    users<span class="token punctuation">.</span>should<span class="token punctuation">.</span>have<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote>
<p>需要 Babel 支持～～～</p>
</blockquote>
<h3 id="示例项目"><a class="anchor" href="#示例项目">#</a> 示例项目</h3>
<h4 id="创建项目安装依赖"><a class="anchor" href="#创建项目安装依赖">#</a> 创建项目 &amp; 安装依赖</h4>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>// 初始化一个nodejs项目</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">npm</span> init <span class="token parameter variable">-y</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>// 安装依赖</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> --save-dev @babel/cli @babel/core @babel/node @babel/register @babel/preset-env chai mocha nodemon</pre></td></tr></table></figure><p>形成 package.json</p>
<pre><code class="language-javascripton">&#123;
  &quot;name&quot;: &quot;projects&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: &#123;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;devDependencies&quot;: &#123;
    &quot;@babel/cli&quot;: &quot;^7.5.0&quot;,
    &quot;@babel/core&quot;: &quot;^7.5.0&quot;,
    &quot;@babel/node&quot;: &quot;^7.5.0&quot;,
    &quot;@babel/preset-env&quot;: &quot;^7.5.0&quot;,
    &quot;@babel/register&quot;: &quot;^7.4.4&quot;,
    &quot;chai&quot;: &quot;^4.2.0&quot;,
    &quot;mocha&quot;: &quot;^6.1.4&quot;,
    &quot;nodemon&quot;: &quot;^1.19.1&quot;
  &#125;
&#125;
</code></pre>
<h4 id="测试过程"><a class="anchor" href="#测试过程">#</a> 测试过程</h4>
<p>新建一个待测试的方法 <code>./src/index.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"Hello world!!!"</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// ES6 语法</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">default</span> sayHello</pre></td></tr></table></figure><p>测试脚本 <code>./test/index.spec.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> expect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"chai"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> sayHello <span class="token keyword">from</span> <span class="token string">"../src/index"</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"index test"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"sayHello function"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should say Hello guys!"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token function">expect</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">"Hello guys!"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>package.json</code>  中的脚本：</p>
<pre><code class="language-javascripton">  &quot;scripts&quot;: &#123;
    // &quot;start&quot;: &quot;nodemon ./src/index.js&quot;,  // 针对ES5语法
    &quot;start:babel&quot;: &quot;nodemon --exec babel-node ./src/index.js&quot;,
    &quot;test:watch&quot;: &quot;mocha --require @babel/register --watch&quot;,
    &quot;test&quot;: &quot;mocha --require @babel/register&quot;,
    &quot;build&quot;: &quot;babel src --out-dir ./dist --source-maps&quot;,
    &quot;serve&quot;: &quot;node ./dist/index.js&quot;,
    &quot;debug&quot;: &quot;node --inspect-brk ./dist/index.js&quot;
  &#125;,
</code></pre>
<p>开始测试： <code>npm run test</code></p>
<p>报错了，因为期望的值与实际值不一致。</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Hello world<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>  index <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    sayHello <span class="token keyword">function</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token number">1</span><span class="token punctuation">)</span> should say Hello guys<span class="token operator">!</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token number">0</span> passing <span class="token punctuation">(</span>9ms<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token number">1</span> failing</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token number">1</span><span class="token punctuation">)</span> index <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="13"></td><td><pre>       sayHello <span class="token keyword">function</span></pre></td></tr><tr><td data-num="14"></td><td><pre>         should say Hello guys<span class="token operator">!</span>:</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>      AssertionError: expected <span class="token string">'Hello world!!!'</span> to equal <span class="token string">'Hello guys!'</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      + expected - actual</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token parameter variable">-Hello</span> world<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      +Hello guys<span class="token operator">!</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      </pre></td></tr><tr><td data-num="22"></td><td><pre>      at Context.equal <span class="token punctuation">(</span>test/index.spec.js:9:22<span class="token punctuation">)</span></pre></td></tr></table></figure><p>修改测试脚本，或者修改 index.js 文件：</p>
<p>修改 <code>./test/index.spec.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> expect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"chai"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> sayHello <span class="token keyword">from</span> <span class="token string">"../src/index"</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"index test"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"sayHello function"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should say Hello world!!!"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token function">expect</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token string">"Hello world!!!"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>再次测试：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> mocha <span class="token parameter variable">--require</span> @babel/register</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>Hello world<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  index <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    sayHello <span class="token keyword">function</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      ✓ should say Hello world<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token number">1</span> passing <span class="token punctuation">(</span>6ms<span class="token punctuation">)</span></pre></td></tr></table></figure><p>使用 <code>mochawesome</code>  展示你的测试结果：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> --save-dev mochawesome</pre></td></tr></table></figure><p>然后在 <code>package.json</code>  的 <code>scripts</code>  中添加如下内容，</p>
<pre><code class="language-javascripton">&#123;
	&quot;report&quot;: &quot;mocha --require @babel/register --reporter mochawesome&quot;,
&#125;
</code></pre>
<p>使用方式：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> run report</pre></td></tr></table></figure><p>形成出来的报告在浏览器中打开：</p>
<p><img data-src="assets/image-20190707212821248.png" alt="/images/image-20190707212821248" /></p>
<p>在 Vscode 中可以安装 Live Server 这个插件快速打开：</p>
<p><img data-src="assets/image-20190707212923919.png" alt="/images/image-20190707212923919" /></p>
<h2 id="开箱即用jest"><a class="anchor" href="#开箱即用jest">#</a> 开箱即用 Jest</h2>
<p>Jest 是由 Facebook 发布的开源的、基于<span class="exturl" data-url="aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw=="> Jasmine</span> 的 JavaScript 单元测试框架。Jest 源于 Facebook 的构想，用于快速、可靠地测试 Web 聊天应用。它吸引了公司内部的兴趣，Facebook 的一名软件工程师 Jeff Morrison 半年前又重拾这个项目，改善它的性能，并将其开源。Jest 的目标是减少开始测试一个项目所要花费的时间和认知负荷，因此它提供了大部分你需要的现成工具：快速的命令行接口、Mock 工具集以及它的自动模块 Mock 系统。此外，如果你在寻找隔离工具例如 Mock 库，大部分其它工具将让你在测试中（甚至经常在你的主代码中）写一些不尽如人意的样板代码，以使其生效。Jest 与 Jasmine 框架的区别是在后者之上增加了一些层。最值得注意的是，运行测试时，Jest 会自动模拟依赖。Jest 自动为每个依赖的模块生成 Mock，并默认提供这些 Mock，这样就可以很容易地隔离模块的依赖。</p>
<p>Jest 支持 Babel，我们将很轻松的使用 ES6 的高级语法</p>
<p>Jest 支持 webpack，非常方便的使用它来管理我们的项目</p>
<p>Jest 支持 TypeScript，书写测试用例更加严谨</p>
<ol>
<li>
<p>简化 API</p>
<p>Jest 既简单又强大，内置支持以下功能：</p>
<ul>
<li>灵活的配置：比如，可以用文件名通配符来检测测试文件。</li>
<li>测试的事前步骤 (Setup) 和事后步骤 (Teardown)，同时也包括测试范围。</li>
<li>匹配表达式 (Matchers)：能使用期望 <code>expect</code>  句法来验证不同的内容。</li>
<li>测试异步代码：支持承诺 (promise) 数据类型和异步等待 <code>async</code>  /  <code>await</code>  功能。</li>
<li>模拟函数：可以修改或监查某个函数的行为。</li>
<li>手动模拟：测试代码时可以忽略模块的依存关系。</li>
<li>虚拟计时：帮助控制时间推移。</li>
</ul>
</li>
<li>
<p>性能与隔离</p>
<p>Jest 文档里写道：</p>
<p>Jest 能运用所有的工作部分，并列运行测试，使性能最大化。终端上的信息经过缓冲，最后与测试结果一起打印出来。沙盒中生成的测试文件，以及自动全局状态在每个测试里都会得到重置，这样就不会出现两个测试冲突的情况。</p>
<p>Mocha 用一个进程运行所有的测试，和它比较起来，Jest 则完全不同。要在测试之间模拟出隔离效果，我们必须要引入几个测试辅助函数来妥善管理清除工作。这种做法虽然不怎么理想，但 99% 的情况都可以用，因为测试是按顺序进行的。</p>
</li>
<li>
<p>沉浸式监控模式</p>
<p>快速互动式监控模式可以监控到哪些测试文件有过改动，只运行与改动过的文件相关的测试，并且由于优化作用，能迅速放出监控信号。设置起来非常简单，而且还有一些别的选项，可以用文件名或测试名来过滤测试。我们用 Mocha 时也有监控模式，不过没有那么强大，要运行某个特定的测试文件夹或文件，就不得不自己创造解决方法，而这些功能 Jest 本身就已经提供了，不用花力气。</p>
</li>
<li>
<p>代码覆盖率 &amp; 测试报告</p>
<p>Jest 内置有代码覆盖率报告功能，设置起来易如反掌。可以在整个项目范围里收集代码覆盖率信息，包括未经受测试的文件。</p>
<p>要使完善 Circle CI 整合，只需要一个自定义报告功能。有了 Jest，用<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21pY2hhZWxsZWVhbGxlbi9qZXN0LWp1bml0LXJlcG9ydGVy"> jest-junit-reporter</span> 就可以做到，其用法和 Mocha 几乎相同。</p>
</li>
<li>
<p>快照功能</p>
<p>快照测试的目的不是要替换现有的单元测试，而是要使之更有价值，让测试更轻松。在某些情况下，某些功能比如 React 组件功能，有了快照测试意味着无需再做单元测试，但同样这两者不是非此即彼。</p>
</li>
</ol>
<h3 id="安装-2"><a class="anchor" href="#安装-2">#</a> 安装</h3>
<p>新建文件夹然后通过 npm 命令安装：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> --save-dev jest</pre></td></tr></table></figure><p>或者通过 yarn 来安装：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">--dev</span> jest</pre></td></tr></table></figure><p>然后就可以开始测试了</p>
<p>也可用 <code>npm install -g jest</code>  进行全局安装；并在 package.json 中指定 test 脚本：</p>
<pre><code class="language-javascripton">&#123;
  &quot;scripts&quot;: &#123;
    &quot;test&quot;: &quot;jest&quot;
  &#125;
&#125;
</code></pre>
<p>Jest 的测试脚本名形如 <code>.test.js</code> ，不论 Jest 是全局运行还是通过 <code>npm test</code>  运行，它都会执行当前目录下所有的 <code>*.test.js</code>  或  <code>*.spec.js</code>  文件、完成测试。</p>
<p>ES6 语法支持：</p>
<ol>
<li>安装依赖</li>
</ol>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">--dev</span> babel-jest @babel/core @babel/preset-env</pre></td></tr></table></figure><ol start="2">
<li>配置 <code>.babelrc</code></li>
</ol>
<pre><code class="language-javascripton">&#123;
  &quot;presets&quot;: [
    [
      &quot;@babel/preset-env&quot;,
      &#123;
        &quot;targets&quot;: &#123;
          &quot;node&quot;: &quot;current&quot;
        &#125;
      &#125;
    ]
  ]
&#125;
</code></pre>
<p>接下来就可以使用 ES6 的语法了～～～</p>
<p>更多高阶的 ES6/7/8… 语法，可以参见：<span class="exturl" data-url="aHR0cHM6Ly9iYWJlbGpzLmlvLw==">babel 官网</span></p>
<p>关于 Typescript 的支持，可以参见 ：<span class="exturl" data-url="aHR0cHM6Ly9qZXN0anMuaW8vZG9jcy9lbi9nZXR0aW5nLXN0YXJ0ZWQjdXNpbmctdHlwZXNjcmlwdA==">Using Typescript</span></p>
<h3 id="举个例子"><a class="anchor" href="#举个例子">#</a> 举个例子</h3>
<p>关于 test suite 与 test case：</p>
<p><img data-src="assets/w80140jb42.jpg" alt="img" /></p>
<p>describe 属于 test suite 的描述，而每个 test 或者 it 则描述了每个 test case。</p>
<p>例如： <code>math.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">multiple</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">*</span> b<span class="token punctuation">;</span></pre></td></tr></table></figure><p>测试脚本： <code>math.test.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./src/math'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"math"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">let</span> a</pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">let</span> b</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"#should return result as a+b"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// test code</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">const</span> result <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"#should return result as a*b"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">//test code</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">const</span> result <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">multiple</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>test suite 可以进行嵌套：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"bar"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"foo bar"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token comment">//test code</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>test case 也可以脱离 test suite 独立运行：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// hello.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'Hello world'</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// hello.test.js</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hello.js'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'should get "Hello world"'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'Hello world'</span><span class="token punctuation">)</span> <span class="token comment">// 测试成功</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">//expect (hello ()).toBe ('Hello') // 测试失败</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="mock与spy"><a class="anchor" href="#mock与spy">#</a> Mock 与 Spy</h3>
<p><strong>mock</strong> 测试就是在测试过程中，对于某些不容易构造或者不容易获取的对象，用一个虚拟的对象来创建以便测试的测试方法。</p>
<p>Mock 是单元测试中经常使用的一种技术。单元测试，顾名思义测试的重点是某个具体单元。但是在实际代码中，代码与代码之间，模块与模块之间总是会存在着相互引用。这个时候，剥离出这种单元的依赖，让测试更加独立，使用到的技术就是 Mock。</p>
<p><strong>为什么要使用 Mock 函数？</strong></p>
<p>在项目中，一个模块的方法内常常会去调用另外一个模块的方法。在单元测试中，我们可能并不需要关心内部调用的方法的执行过程和结果，只想知道它是否被正确调用即可，甚至会指定该函数的返回值。此时，使用 Mock 函数是十分有必要。</p>
<p>Mock 函数提供的以下三种特性，在我们写测试代码时十分有用：</p>
<ul>
<li>捕获函数调用情况</li>
<li>设置函数返回值</li>
<li>改变函数的内部实现</li>
</ul>
<p><img data-src="assets/8u3cp5kz2s.png" alt="img" /></p>
<p>举个例子：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// math.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getFooResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// foo logic here</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getBarResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">// bar logic here</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// caculate.js</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> getFooResult<span class="token punctuation">,</span> getBarResult <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./math"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getFooBarResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getFooResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getBarResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>此时，getFooResult () 和 getBarResult () 就是 getFooBarResult 这个函数的依赖。如果我们关注的点是 getFooBarResult 这个函数，我们就应该把 getFooResult 和 getBarResult Mock 掉，剥离这种依赖。下面是一个使用 Jest 进行 Mock 的例子。</p>
<p><code>jest.fn()</code>  是创建 Mock 函数最简单的方式，如果没有定义函数内部的实现， <code>jest.fn()</code>  会返回 <code>undefined</code>  作为返回值。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试jest.fn()调用'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">let</span> mockFn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">mockFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">// 断言 mockFn 的执行后返回 undefined</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeUndefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">// 断言 mockFn 被调用</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">// 断言 mockFn 被调用了一次</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment">// 断言 mockFn 传入的参数为 1, 2, 3</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">expect</span><span class="token punctuation">(</span>mockFn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>情景一：设置函数 的返回值</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// calculate.test.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> getFooBarResult <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./calculate"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fooBar <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'getResult should return result getFooResult() + getBarResult()'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">//mock add 方法和 multiple 方法</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  fooBar<span class="token punctuation">.</span>getFooBarResult <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  fooBar<span class="token punctuation">.</span>getBarResult <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getFooBarResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>Mock 其实就是一种 Spies，在 Jest 中使用 spies 来 “spy”(窥探) 一个函数的行为。</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9qZXN0anMuaW8vZG9jcy9lbi9tb2NrLWZ1bmN0aW9uLWFwaS5odG1sI2NvbnRlbnQ=">Jest 文档</span>对于 spies 的解释:</p>
<blockquote>
<p>Mock 函数也称为 “spies”，因为它们让你窥探一些由其他代码间接调用的函数的行为，而不仅仅是测试输出。你可以通过使用  <code>jest.fn()</code>  创建一个 mock 函数。</p>
</blockquote>
<p>简单来说，一个 spy 是另一个内置的能够记录对其调用细节的函数：调用它的次数，使用什么参数。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// calculate.test.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> getFooBarResult <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./calculate"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> fooBar <span class="token keyword">from</span> <span class="token string">'./math'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'getResult should return result getFooResult() + getBarResult()'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token comment">//mock add 方法和 multiple 方法</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  fooBar<span class="token punctuation">.</span>getFooResult <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  fooBar<span class="token punctuation">.</span>getBarResult <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getFooBarResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment">// 监控 getFooResult 和 getBarResult 的调用情况.</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">expect</span><span class="token punctuation">(</span>fooBar<span class="token punctuation">.</span>getFooResult<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token function">expect</span><span class="token punctuation">(</span>fooBar<span class="token punctuation">.</span>getBarResult<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>情景二：捕获函数调用情况</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// bot method</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function-variable function">sayHello</span><span class="token operator">:</span> <span class="token parameter">name</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// test.js</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"bot"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should say hello"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>bot<span class="token punctuation">,</span> <span class="token string">"sayHello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    bot<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">"Michael"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">"Michael"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    spy<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>我们通过  <code>jest.spyOn</code>  创建了一个监听  <code>bot</code>  对象的  <code>sayHello</code>  方法的 spy。它就像间谍一样监听了所有对  <code>bot#sayHello</code>  方法的调用。由于创建 spy 时，Jest 实际上修改了  <code>bot</code>  对象的  <code>sayHello</code>  属性，所以在断言完成后，我们还要通过  <code>mockRestore</code>  来恢复  <code>bot</code>  对象原本的  <code>sayHello</code>  方法。</p>
<p>Jest 的<span class="exturl" data-url="aHR0cHM6Ly9qZXN0anMuaW8vZG9jcy9lbi9qZXN0LW9iamVjdCNqZXN0c3B5b25vYmplY3QtbWV0aG9kbmFtZQ=="> spyOn 介绍</span></p>
<p><strong>情景三：修改函数的内容实现</strong></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> bot <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function-variable function">sayHello</span><span class="token operator">:</span> <span class="token parameter">name</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"bot"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should say hello"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>bot<span class="token punctuation">,</span> <span class="token string">"sayHello"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token parameter">name</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello mix </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>    bot<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">"Michael"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">"Michael"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    spy<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>使用 spyOn 方法，还可以去修改 Math.random 这样的函数</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>Math<span class="token punctuation">,</span> <span class="token string">"random"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">0.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>举个例子：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// getNum.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">getNum</span> <span class="token operator">=</span> <span class="token parameter">index</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">return</span> arr<span class="token punctuation">[</span>index <span class="token operator">%</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> arr<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// num.test.js</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> getNum <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../src/getNum'</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">"getNum"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should select numbber based on index if provided"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">"should select a random number based on Math.random if skuId not available"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">const</span> spy <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>Math<span class="token punctuation">,</span> <span class="token string">"random"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">0.9</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">getNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    spy<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="cli命令"><a class="anchor" href="#cli命令">#</a> CLI 命令</h3>
<pre><code>➜ npx jest --help
Usage: jest [--config=&lt;pathToConfigFile&gt;] [TestPathPattern]

选项：
  --help, -h                    显示帮助信息                              [布尔]
  --version, -v                 Print the version and exit                [布尔]
  --config, -c                  The path to a jest config file specifying how to
                                find and execute tests. If no rootDir is set in
                                the config, the directory containing the config
                                file is assumed to be the rootDir for the
                                project.This can also be a JSON encoded value
                                which Jest will use as configuration.   [字符串]
  --coverage                    Indicates that test coverage information should
                                be collected and reported in the output.  [布尔] 
  --timers                      Setting this value to fake allows the use of
                                fake timers for functions such as setTimeout.
                                                                        [字符串]
  --verbose                     Display individual test results with the test
                                suite hierarchy.                          [布尔]
  --watch                       Watch files for changes and rerun tests related
                                to changed files. If you want to re-run all
                                tests when a file has changed, use the
                                `--watchAll` option.                      [布尔]
  --watchAll                    Watch files for changes and rerun all tests. If
                                you want to re-run only the tests related to the
                                changed files, use the `--watch` option.  [布尔]
...
</code></pre>
<p>常见使用：</p>
<p><code>--verbose</code>  显示详细的测试信息，包括测试 suite 和 case：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>➜ npx jest <span class="token parameter variable">--verbose</span></pre></td></tr><tr><td data-num="2"></td><td><pre> PASS  test/mock.test.js</pre></td></tr><tr><td data-num="3"></td><td><pre>  bot</pre></td></tr><tr><td data-num="4"></td><td><pre>    ✓ should say hello <span class="token punctuation">(</span>7ms<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  console.log test/mock.test.js:10</pre></td></tr><tr><td data-num="7"></td><td><pre>    Hello mix Michael</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre> PASS  test/domain.test.js</pre></td></tr><tr><td data-num="10"></td><td><pre>  getImageDomain</pre></td></tr><tr><td data-num="11"></td><td><pre>    ✓ should <span class="token keyword">select</span> domain based on skuId <span class="token keyword">if</span> provided <span class="token punctuation">(</span>1ms<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    ✓ should <span class="token keyword">select</span> a random domain based on Math.random <span class="token keyword">if</span> skuId not available <span class="token punctuation">(</span>1ms<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>  console.log test/sayhello.test.js:3</pre></td></tr><tr><td data-num="15"></td><td><pre>    Hello Michael<span class="token operator">!</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre> PASS  test/sayhello.test.js</pre></td></tr><tr><td data-num="18"></td><td><pre>  bot</pre></td></tr><tr><td data-num="19"></td><td><pre>    ✓ should say hello <span class="token punctuation">(</span>6ms<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre> PASS  test/num.test.js</pre></td></tr><tr><td data-num="22"></td><td><pre>  getNum</pre></td></tr><tr><td data-num="23"></td><td><pre>    ✓ should <span class="token keyword">select</span> numbber based on index <span class="token keyword">if</span> provided <span class="token punctuation">(</span>1ms<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    ✓ should <span class="token keyword">select</span> a random number based on Math.random <span class="token keyword">if</span> skuId not available</pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre> PASS  test/math.test.js</pre></td></tr><tr><td data-num="27"></td><td><pre>  math</pre></td></tr><tr><td data-num="28"></td><td><pre>    ✓ <span class="token comment">#should return result as a+b (1ms)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    ✓ <span class="token comment">#should return result as a*b (4ms)</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>Test Suites: <span class="token number">5</span> passed, <span class="token number">5</span> total</pre></td></tr><tr><td data-num="32"></td><td><pre>Tests:       <span class="token number">8</span> passed, <span class="token number">8</span> total</pre></td></tr><tr><td data-num="33"></td><td><pre>Snapshots:   <span class="token number">0</span> total</pre></td></tr><tr><td data-num="34"></td><td><pre>Time:        <span class="token number">1</span>.075s</pre></td></tr><tr><td data-num="35"></td><td><pre>Ran all <span class="token builtin class-name">test</span> suites.</pre></td></tr></table></figure><p><code>--watch</code>  和 <code>--watchAll</code>  用来监听测试文件的变化</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Ran all <span class="token builtin class-name">test</span> suites.</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>Watch Usage</pre></td></tr><tr><td data-num="4"></td><td><pre> › Press f to run only failed tests.</pre></td></tr><tr><td data-num="5"></td><td><pre> › Press o to only run tests related to changed files.</pre></td></tr><tr><td data-num="6"></td><td><pre> › Press p to filter by a filename regex pattern.</pre></td></tr><tr><td data-num="7"></td><td><pre> › Press t to filter by a <span class="token builtin class-name">test</span> name regex pattern.</pre></td></tr><tr><td data-num="8"></td><td><pre> › Press q to quit <span class="token function">watch</span> mode.</pre></td></tr><tr><td data-num="9"></td><td><pre> › Press Enter to trigger a <span class="token builtin class-name">test</span> run.</pre></td></tr></table></figure><p><code>--coverage</code>  用来形成测试覆盖率报告</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>-----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>-------------------<span class="token operator">|</span></pre></td></tr><tr><td data-num="2"></td><td><pre>File       <span class="token operator">|</span>  % Stmts <span class="token operator">|</span> % Branch <span class="token operator">|</span>  % Funcs <span class="token operator">|</span>  % Lines <span class="token operator">|</span> Uncovered Line <span class="token comment">#s |</span></pre></td></tr><tr><td data-num="3"></td><td><pre>-----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>-------------------<span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre>All files  <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>                   <span class="token operator">|</span></pre></td></tr><tr><td data-num="5"></td><td><pre> getNum.js <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>                   <span class="token operator">|</span></pre></td></tr><tr><td data-num="6"></td><td><pre> math.js   <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>                   <span class="token operator">|</span></pre></td></tr><tr><td data-num="7"></td><td><pre>-----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>----------<span class="token operator">|</span>-------------------<span class="token operator">|</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>Test Suites: <span class="token number">5</span> passed, <span class="token number">5</span> total</pre></td></tr><tr><td data-num="10"></td><td><pre>Tests:       <span class="token number">8</span> passed, <span class="token number">8</span> total</pre></td></tr><tr><td data-num="11"></td><td><pre>Snapshots:   <span class="token number">0</span> total</pre></td></tr><tr><td data-num="12"></td><td><pre>Time:        <span class="token number">1</span>.497s</pre></td></tr></table></figure><h3 id="jest在react-vue项目中的应用"><a class="anchor" href="#jest在react-vue项目中的应用">#</a> Jest 在 React、Vue 项目中的应用</h3>
<p>在 <code>create-react-app</code>  中的应用：</p>
<p>安装对应的依赖：</p>
<pre><code>npm install react-test-renderer enzyme enzyme-adapter-react-16 
</code></pre>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FpcmJuYi9lbnp5bWU=">Enzyme</span> 是一个非常棒的 React 组件测试测试库。</p>
<blockquote>
<p>Enzyme is a JavaScript Testing utility for React that makes it easier to test your React Components' output. You can also manipulate, traverse, and in some ways simulate runtime given the output.</p>
<p>Enzyme's API is meant to be intuitive and flexible by mimicking jQuery's API for DOM manipulation and traversal</p>
</blockquote>
<p>需要注意的两点是：</p>
<ul>
<li>需要配置 Adapter，不同的 React 的 Adapter 不同</li>
</ul>
<table>
<thead>
<tr>
<th>Enzyme Adapter Package</th>
<th>React semver compatibility</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>enzyme-adapter-react-16</code></td>
<td><code>^16.4.0-0</code></td>
</tr>
<tr>
<td><code>enzyme-adapter-react-16.3</code></td>
<td><code>~16.3.0-0</code></td>
</tr>
<tr>
<td><code>enzyme-adapter-react-16.2</code></td>
<td><code>~16.2</code></td>
</tr>
<tr>
<td><code>enzyme-adapter-react-16.1</code></td>
<td><code>~16.0.0-0 || ~16.1</code></td>
</tr>
<tr>
<td><code>enzyme-adapter-react-15</code></td>
<td><code>^15.5.0</code></td>
</tr>
<tr>
<td><code>enzyme-adapter-react-15.4</code></td>
<td><code>15.0.0-0 - 15.4.x</code></td>
</tr>
<tr>
<td><code>enzyme-adapter-react-14</code></td>
<td><code>^0.14.0</code></td>
</tr>
<tr>
<td><code>enzyme-adapter-react-13</code></td>
<td><code>^0.13.0</code></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>需要初始化配置 <code>setUpTests.js</code></p>
<p>官方文档在 Package.json 中设置 jest 配置，已经过时，Jest 框架最新会默认加载文件 <code>src/setUpTests.js</code></p>
</li>
<li>
<pre><code class="language-react">import &#123; configure &#125; from 'enzyme';
import Adapter from 'enzyme-adapter-react-16'

configure(&#123; adapter: new Adapter() &#125;)
</code></pre>
</li>
</ul>
<p>在 vue 工程化项目中：</p>
<pre><code class="language-javascripton">&quot;devDependencies&quot;: &#123;
  &quot;@vue/cli-plugin-unit-jest&quot;: &quot;^3.9.0&quot;,
  &quot;@vue/test-utils&quot;: &quot;1.0.0-beta.29&quot;,
  &quot;babel-core&quot;: &quot;7.0.0-bridge.0&quot;,
  &quot;babel-eslint&quot;: &quot;^10.0.1&quot;,
  &quot;babel-jest&quot;: &quot;^23.6.0&quot;,
  &quot;babel-preset-env&quot;: &quot;^1.7.0&quot;,
&#125;,
</code></pre>
<p>添加如上依赖，</p>
<p>配置 scripts:</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string-property property">"test"</span><span class="token operator">:</span> <span class="token string">"vue-cli-service test:unit"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr></table></figure><p>配置 <code>jest.config.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">// 处理 vue 结尾的文件</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token literal-property property">moduleFileExtensions</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token string">'js'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token string">'jsx'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token string">'json'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token string">'vue'</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">//es6 转义</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token string-property property">'^.+\\.vue$'</span><span class="token operator">:</span> <span class="token string">'vue-jest'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token string-property property">'.+\\.(css|styl|less|sass|scss|svg|png|jpg|ttf|woff|woff2)$'</span><span class="token operator">:</span> <span class="token string">'jest-transform-stub'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token string-property property">'^.+\\.jsx?$'</span><span class="token operator">:</span> <span class="token string">'babel-jest'</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token literal-property property">transformIgnorePatterns</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token string">'/node_modules/'</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token comment">//cli 配置了 webpack 别名</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token literal-property property">moduleNameMapper</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token string-property property">'^@/(.*)$'</span><span class="token operator">:</span> <span class="token string">'&lt;rootDir>/src/$1'</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token literal-property property">snapshotSerializers</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token string">'jest-serializer-vue'</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token literal-property property">testMatch</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token string">'**/tests/unit/**/*.spec.(js|jsx|ts|tsx)|**/__tests__/*.(js|jsx|ts|tsx)'</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token literal-property property">testURL</span><span class="token operator">:</span> <span class="token string">'http://localhost/'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token literal-property property">watchPlugins</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token string">'jest-watch-typeahead/filename'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token string">'jest-watch-typeahead/testname'</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>写一个测试用例：</p>
<pre><code>
</code></pre>
<h2 id="简约之美ava"><a class="anchor" href="#简约之美ava">#</a> 简约之美 AVA</h2>
<p>简单的说 ava 是 mocha 的替代品：</p>
<ul>
<li>es6 语法支持更好，对 aysnc/await 有支持</li>
<li>执行效率更高，使用 io 并发，就必须保证测试的原子性</li>
<li>语义上更简单，集众家之长</li>
</ul>
<p>虽然 JavaScript 是单线程，但在 Node.js 里由于其异步的特性使得 IO 可以并行。AVA 利用这个优点让你的测试可以并发执行，这对于 IO 繁重的测试特别有用。另外，测试文件可以在不同的进程里并行运行，让每一个测试文件可以获得更好的性能和独立的环境。</p>
<h3 id="ava特点"><a class="anchor" href="#ava特点">#</a> AVA 特点</h3>
<ul>
<li>
<p>轻量和高效</p>
</li>
<li>
<p>简单的测试语法</p>
</li>
<li>
<p>并发运行测试</p>
</li>
<li>
<p>强制编写<strong>原子测试</strong></p>
<p>一旦开始，就一直运行到结束，中间不会切换到另一个测试</p>
</li>
<li>
<p>没有隐藏的全局变量</p>
</li>
<li>
<p>为每个测试文件隔离环境</p>
</li>
<li>
<p><strong>用 ES2015 编写测试</strong></p>
</li>
<li>
<p>支持 Promise</p>
</li>
<li>
<p>支持 Generator</p>
</li>
<li>
<p>支持 Async</p>
</li>
<li>
<p>支持 Observable</p>
</li>
<li>
<p>强化断言信息</p>
</li>
<li>
<p>可选的 TAP 输出显示</p>
<p><img data-src="assets/tap-reporter.png" alt="img" /></p>
</li>
<li>
<p>简明的堆栈跟踪</p>
</li>
</ul>
<h3 id="安装开始"><a class="anchor" href="#安装开始">#</a> 安装 &amp; 开始</h3>
<p>情景一：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>// 创建一个ava项目</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">npm</span> init ava</pre></td></tr></table></figure><p>形成 package.json</p>
<pre><code class="language-javascripton">&#123;
	&quot;name&quot;: &quot;awesome-package&quot;, 
	&quot;scripts&quot;: &#123;
		&quot;test&quot;: &quot;ava&quot;
	&#125;,
	&quot;devDependencies&quot;: &#123;
		&quot;ava&quot;: &quot;^1.0.0&quot;
	&#125;
&#125;
</code></pre>
<p>情景二：（推荐）</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> init <span class="token parameter variable">-y</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>// <span class="token function">npm</span> <span class="token operator">&amp;</span> cnpm</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> ava</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>// <span class="token function">yarn</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">yarn</span> <span class="token function">add</span> ava <span class="token parameter variable">-D</span></pre></td></tr></table></figure><p>测试 ava 正常安装：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>➜ npx ava <span class="token parameter variable">--version</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2.2</span>.0</pre></td></tr></table></figure><h3 id="第一个ava测试例子"><a class="anchor" href="#第一个ava测试例子">#</a> 第一个 ava 测试例子</h3>
<p>流程：</p>
<ol>
<li>引用 ava 的测试 API</li>
<li>执行测试</li>
<li>使用断言</li>
</ol>
<p>创建 <code>test.js</code>  文件</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> test <span class="token keyword">from</span> <span class="token string">'ava'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> <span class="token function-variable function">testfn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'hello ava'</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  t<span class="token punctuation">.</span><span class="token function">pass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'my first test'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">t</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'hello ava!!!!'</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  t<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">'hello ava!!!!'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'add method'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">t</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">testfn</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  t<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>ava 自动搜索如下文件结尾的文件：</p>
<ul>
<li><code>**/test.js</code></li>
<li><code>**/test-*.js</code></li>
<li><code>**/*.spec.js</code></li>
<li><code>**/*.test.js</code></li>
<li><code>**/test/**/*.js</code></li>
<li><code>**/tests/**/*.js</code></li>
<li><code>**/__tests__/**/*.js</code></li>
</ul>
<p>ava 中的断言：</p>
<pre><code class="language-javascripton">.pass([message])
.fail([message])
.assert(value, [message])
.truthy(value, [message])
.falsy(value, [message])
.true(value, [message])
.false(value, [message])
.is(value, expected, [message])
.not(value, expected, [message])
.deepEqual(value, expected, [message])
.notDeepEqual(value, expected, [message])
.deepEqual()。
.throws(fn, [expected, [message]])
.throwsAsync(thrower, [expected, [message]])
.notThrows(fn, [message])
.notThrowsAsync(nonThrower, [message])
.regex(contents, regex, [message])
.notRegex(contents, regex, [message])
.snapshot(expected, [message])
.snapshot(expected, [options], [message])
</code></pre>
<h3 id="cli命令-2"><a class="anchor" href="#cli命令-2">#</a> CLI 命令</h3>
<p>使用 <code>--help</code>  命令去查看 ava 支持的 cli 参数</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>➜ npx ava <span class="token parameter variable">--help</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>  Testing can be a drag. AVA helps you get it done.</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  Usage</pre></td></tr><tr><td data-num="6"></td><td><pre>    ava <span class="token punctuation">[</span><span class="token operator">&lt;</span>file<span class="token operator">></span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  Options</pre></td></tr><tr><td data-num="9"></td><td><pre>    --watch, <span class="token parameter variable">-w</span>             Re-run tests when tests and <span class="token builtin class-name">source</span> files change</pre></td></tr><tr><td data-num="10"></td><td><pre>    --match, <span class="token parameter variable">-m</span>             Only run tests with matching title <span class="token punctuation">(</span>Can be repeated<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    --update-snapshots, <span class="token parameter variable">-u</span>  Update snapshots</pre></td></tr><tr><td data-num="12"></td><td><pre>    --fail-fast             Stop after first <span class="token builtin class-name">test</span> failure</pre></td></tr><tr><td data-num="13"></td><td><pre>    --timeout, <span class="token parameter variable">-T</span>           Set global <span class="token function">timeout</span> <span class="token punctuation">(</span>milliseconds or human-readable, e.g. 10s, 2m<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    --serial, <span class="token parameter variable">-s</span>            Run tests serially</pre></td></tr><tr><td data-num="15"></td><td><pre>    --concurrency, <span class="token parameter variable">-c</span>       Max number of <span class="token builtin class-name">test</span> files running at the same <span class="token function">time</span> <span class="token punctuation">(</span>Default: CPU cores<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    --verbose, <span class="token parameter variable">-v</span>           Enable verbose output</pre></td></tr><tr><td data-num="17"></td><td><pre>    --tap, <span class="token parameter variable">-t</span>               Generate TAP output</pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token parameter variable">--color</span>                 Force color output</pre></td></tr><tr><td data-num="19"></td><td><pre>    --no-color              Disable color output</pre></td></tr><tr><td data-num="20"></td><td><pre>    --reset-cache           Reset AVA's compilation cache and <span class="token builtin class-name">exit</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token parameter variable">--config</span>                JavaScript <span class="token function">file</span> <span class="token keyword">for</span> AVA to <span class="token builtin class-name">read</span> its config from, instead of using package.json</pre></td></tr><tr><td data-num="22"></td><td><pre>                            or ava.config.js files</pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>  Examples</pre></td></tr><tr><td data-num="25"></td><td><pre>    ava</pre></td></tr><tr><td data-num="26"></td><td><pre>    ava test.js test2.js</pre></td></tr><tr><td data-num="27"></td><td><pre>    ava test-*.js</pre></td></tr><tr><td data-num="28"></td><td><pre>    ava <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>  The above relies on your shell expanding the glob patterns.</pre></td></tr><tr><td data-num="31"></td><td><pre>  Without arguments, AVA uses the following patterns:</pre></td></tr><tr><td data-num="32"></td><td><pre>    **/test.js **/test-*.js **/*.spec.js **/*.test.js **/test/**/*.js **/tests/**/*.js **/__tests__/**/*.js</pre></td></tr></table></figure><h4 id="文件匹配"><a class="anchor" href="#文件匹配">#</a> 文件匹配</h4>
<p>使用 <code>match</code>  指令，匹配对应需要测试的文件：</p>
<p>匹配标题以 <code>foo</code> ：结尾</p>
<pre><code>npx ava --match ='* foo'
</code></pre>
<p>匹配标题以 <code>foo</code> ：</p>
<pre><code>npx ava --match ='foo *'
</code></pre>
<p>匹配标题包含 <code>foo</code> ：</p>
<pre><code>npx ava --match ='* foo *'
</code></pre>
<p>匹配是完全相同  <code>foo</code> ：</p>
<pre><code>npx ava --match ='foo'
</code></pre>
<p>匹配标题不包含 <code>foo</code> ：</p>
<pre><code>npx ava --match ='！* foo *'
</code></pre>
<p>匹配以下 <code>foo</code>  结尾的标题 <code>bar</code> ：</p>
<pre><code>npx ava --match ='foo * bar'
</code></pre>
<p>匹配 <code>foo</code>  以 <code>bar</code> ：开头或结尾的标题：</p>
<pre><code>npx ava --match ='foo *' -  match ='* bar'
</code></pre>
<h4 id="关于reporter"><a class="anchor" href="#关于reporter">#</a> 关于 reporter</h4>
<p>默认情况下，AVA 使用最小的报告：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/avajs/ava/blob/master/media/mini-reporter.gif"><img data-src="assets/mini-reporter.gif" alt="img" /></a></p>
<p>使用该 <code>--verbose</code>  标志启用详细的报告者。除非启用 TAP 报告，否则始终在 CI 环境中使用此选项。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/avajs/ava/blob/master/media/verbose-reporter.png"><img data-src="assets/verbose-reporter.png" alt="img" /></a></p>
<p><strong>TAP 报告（推荐）</strong></p>
<p>AVA 支持 TAP 格式，因此与任何 TAP 报告器兼容。使用该 <code>--tap</code>  标志启用 TAP 输出。</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>$ npx ava <span class="token parameter variable">--tap</span> <span class="token operator">|</span> npx tap-nyan</pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://github.com/avajs/ava/blob/master/media/tap-reporter.png"><img data-src="assets/tap-reporter-20190709154342692.png" alt="img" /></a></p>
<p>这里有一些格式：</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Njb3R0Y29yZ2FuL3RhcC1kb3Q=">tap-dot</span> - Dotted output.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Njb3R0Y29yZ2FuL3RhcC1zcGVj">tap-spec</span> - Mocha-like spec reporter.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NhbHZpbm1ldGNhbGYvdGFwLW55YW4=">tap-nyan</span> - Nyan cat.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2d1bW1lc3Nvbi90YXAtbWlu">tap-min</span> - Minimal output.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL25hbXVvbC90YXAtZGlmZmxldA==">tap-difflet</span> - Minimal output with diffing.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2F4cm9zcy90YXAtZGlmZg==">tap-diff</span> - Human-friendly output with diffing.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2pvZXliYWtlci90YXAtc2ltcGxl">tap-simple</span> - Simple output.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N1YnN0YWNrL2ZhdWNldA==">faucet</span> - Human-readable summarizer.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lzYWFjcy90YXAtbW9jaGEtcmVwb3J0ZXI=">tap-mocha-reporter</span> - Use any of the <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2lzYWFjcy90YXAtbW9jaGEtcmVwb3J0ZXIvdHJlZS9tYXN0ZXIvbGliL3JlcG9ydGVycw==">Mocha reporters</span>.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3pvdWJpbi90YXAtc3VtbWFyeQ==">tap-summary</span> - Summarized output.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NsdXgvdGFwLXBlc3NpbWlzdA==">tap-pessimist</span> - Only shows failed tests.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Rvb2xuZXNzL3RhcC1wcmV0dGlmeQ==">tap-prettify</span> - Nice readable output with diffing.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3N1YnN0YWNrL3RhcC1jb2xvcml6ZQ==">tap-colorize</span> - Colorize the output while preserving machine-readability.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2p1bGlhbmdydWJlci90YXAtYmFpbA==">tap-bail</span> - Bail out when the first test fails.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2F4cm9zcy90YXAtbm90aWZ5">tap-notify</span> - Notifier for macOS, Linux and Windows.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2d1bW1lc3Nvbi90YXAtanNvbg==">tap-json</span> - JSON output.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdmFzeDIvYXZhLXRhcC1qc29u">ava-tap-json</span> - JSON output with AVA compatibility.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FnaGFzc2VtaS90YXAteHVuaXQ=">tap-xunit</span> - xUnit output.</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Ntb2NrbGUvdGFwLXRlYW1jaXR5">tap-teamcity</span> - Output for TeamCity.</li>
</ul>
<h4 id="快照功能"><a class="anchor" href="#快照功能">#</a> 快照功能</h4>
<p>ava 自动进行项目测试快照，如果文件放置在 <code>test</code>  或者 <code>tests</code>  目录，则快照会放置在 <code>snapshots</code>  目录。如果测试放置在 <code>__test__</code> 目录，则快照放置在 <code>__snapshots__</code> 目录</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>ava --update-snapshots</pre></td></tr></table></figure><p>可以指定一个固定位置，以便在 AVA 的 <code>package.json</code>  配置中存储快照文件：</p>
<p><strong>package.json：</strong></p>
<pre><code class="language-javascripton">&#123;
	 &quot;ava&quot;：&#123;
		 &quot;snapshotDir&quot;：&quot;自定义目录&quot;
	&#125;
&#125;
</code></pre>
<h4 id="设置超时"><a class="anchor" href="#设置超时">#</a> 设置超时</h4>
<p>AVA 中的超时行为与其他测试框架中的行为不同。AVA 在每次测试后重置计时器，如果在指定的超时内没有收到新的测试结果，则强制测试退出。这可用于处理停滞的测试。</p>
<p><em>没有默认超时。</em></p>
<p>您可以配置使用超时 <code>--timeout</code>  命令行选项，或配置文件中设置。它们可以以人类可读的方式设置：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 10 秒</span></pre></td></tr><tr><td data-num="2"></td><td><pre>npx ava <span class="token parameter variable">--timeout</span> <span class="token operator">=</span> 10s </pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 2 分钟</span></pre></td></tr><tr><td data-num="5"></td><td><pre>npx ava <span class="token parameter variable">--timeout</span> <span class="token operator">=</span> 2m </pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 100 毫秒</span></pre></td></tr><tr><td data-num="8"></td><td><pre>npx ava <span class="token parameter variable">--timeout</span> <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr></table></figure><p>还可以为每个测试单独设置超时。每次进行断言时都会重置这些超时。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	t<span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100 milliseconds</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token comment">// Write your assertions here</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="其他ava设置相关"><a class="anchor" href="#其他ava设置相关">#</a> 其他 ava 设置相关</h3>
<h4 id="eslint"><a class="anchor" href="#eslint">#</a> ESLint</h4>
<p>如果使用了 ESLint，请添加<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2VzbGludC1wbHVnaW4tYXZh"> eslint-plugin-ava</span></p>
<pre><code class="language-javascripton">&#123;
	plugins: [
		&quot;ava&quot;
	]
&#125;
</code></pre>
<h4 id="异步相关"><a class="anchor" href="#异步相关">#</a> 异步相关</h4>
<p>如果异步操作使用 promises，则应返回 promise：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'fetches foo'</span><span class="token punctuation">,</span> <span class="token parameter">t</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>		t<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>更好的是，使用 <code>async</code> /  <code>await</code> ：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'fetches foo'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">t</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	t<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="测试环境帮手karma"><a class="anchor" href="#测试环境帮手karma">#</a> 测试环境 &amp; 帮手 Karma</h2>
<p>Karma 是一个基于 Node.js 的 JavaScript 测试执行过程管理工具（Test Runner）。该工具可用于测试所有主流 Web 浏览器，也可以集成到 CI（Continuous integration）工具，还可以和其他代码编辑器一起使用。</p>
<p>Karma 会监控配置文件中所指定的每一个文件，每当文件发生改变，它都会向测试服务器发送信号，来通知所有的浏览器再次运行测试代码。此时，浏览器会重新加载源文件，并执行测试代码。其结果会传递回服务器，并以某种形式显示给开发者。</p>
<p>访问浏览器执行结果，可通过以下的方式</p>
<ul>
<li>手工方式 - 通过浏览器</li>
<li>自动方式 - 让 karma 来启动对应的浏览器</li>
</ul>
<h3 id="工作原理简介"><a class="anchor" href="#工作原理简介">#</a> 工作原理简介</h3>
<p><code>karma</code>  是一个典型的  <code>C/S</code>  程序，包含 client 和 server ，通讯方式基于  <code>Http</code>  ，通常情况下，客户端和服务端基本都运行在开发者本地机器上。</p>
<p>一个服务端实例对应一个项目，假如想同时运行多个项目，得同时开启多个服务端实例。</p>
<p><strong>Server</strong></p>
<p><code>Server</code>  是框架的主要组成部分之一，它内部保存了所有的程序运行状态，比如 client 连接，当前运行的单测文件，根据这些数据状态，它提供了下面几个功能， 下图是 server 的结构</p>
<p><img data-src="assets/TB13X9xLXXXXXXoaXXXDUoU9pXX-902-329.png" alt="karma_server" /></p>
<ul>
<li>监听文件</li>
<li>与 client 进行通讯</li>
<li>向开发者输出测试结果</li>
<li>提供 client 端所需的资源文件</li>
</ul>
<p><strong>Client</strong></p>
<p>client 是单测最终运行的地方，类似一个 web app ， 跟 server 端通讯利用  <code>socket.io</code> ， 执行单测在一个独立的  <code>iframe</code>  中。下面是它的结构图</p>
<p><img data-src="assets/TB1jTKwLXXXXXX.aXXX0KhCSFXX-619-472.png" alt="karma_impl_client" /></p>
<p>client 和 server 端通讯采用  <code>socket.io</code></p>
<ul>
<li>client 端会发送这些消息</li>
</ul>
<p><img data-src="assets/TB1XXuILXXXXXcAXFXX.hdJKpXX-918-179.png" alt="karma_impl_client_message_c" /></p>
<ul>
<li>server 端会发送这些消息</li>
</ul>
<p><img data-src="assets/TB1PvisLXXXXXcqaXXXEHlCNpXX-896-103.png" alt="karma_impl_client_message_s" /></p>
<h3 id="安装karma"><a class="anchor" href="#安装karma">#</a> 安装 Karma</h3>
<p>对于 Nodejs 版本的要求：</p>
<blockquote>
<p>Karma currently works on Node.js <strong>6.x</strong>, <strong>8.x</strong>, and <strong>10.x</strong>. See <span class="exturl" data-url="aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLzQuMC9pbnRyby9mYXEuaHRtbA==">FAQ</span> for more info.</p>
</blockquote>
<ol>
<li>
<p>全局安装</p>
<pre><code>$npm install -g karma
</code></pre>
<p>安装 Karma 命令会到全局的  <code>node_modules</code>  目录下，我们可以在任何位置直接运行 karma 命令。</p>
<pre><code>npm install -g karma-cli
</code></pre>
<p>此命令用来安装  <code>karma-cli</code> ，它会在当前目录下寻找 karma 的可执行文件。这样我们就可以在一个系统内运行多个版本的 Karma。</p>
</li>
<li>
<p>本地安装</p>
<pre><code>$ npm install karma --save-dev
</code></pre>
<p>安装 Karma 命令到当前  <code>node_modules</code>  目录下，此时，如果需要执行 karma 命令，就需要这样</p>
<pre><code>./node_modules/.bin/karma

npx karma --version
</code></pre>
</li>
</ol>
<h3 id="配置karma"><a class="anchor" href="#配置karma">#</a> 配置 Karma</h3>
<p>karma 配置文件可以用 JavaScript，CoffeeScript 或 TypeScript 编写，并作为常规 Node.js 模块加载。</p>
<p>除非作为参数提供，否则 Karma CLI 将在以下位置以该顺序 (从上至下) 查找配置文件</p>
<ul>
<li><code>./karma.conf.js</code></li>
<li><code>./karma.conf.coffee</code></li>
<li><code>./karma.conf.ts</code></li>
<li><code>./.config/karma.conf.js</code></li>
<li><code>./.config/karma.conf.coffee</code></li>
<li><code>./.config/karma.conf.ts</code></li>
</ul>
<p>在配置文件中，配置代码通过设置 <code>module.exports</code>  指向一个接受一个参数的函数：配置对象。</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// karma.conf.js</span></pre></td></tr><tr><td data-num="2"></td><td><pre>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token literal-property property">basePath</span><span class="token operator">:</span> <span class="token string">'../..'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token literal-property property">frameworks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'jasmine'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">//...</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre># karma<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>coffee</pre></td></tr><tr><td data-num="10"></td><td><pre>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span></pre></td></tr><tr><td data-num="11"></td><td><pre>  config<span class="token punctuation">.</span>set</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token literal-property property">basePath</span><span class="token operator">:</span> <span class="token string">'../..'</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token literal-property property">frameworks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'jasmine'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    # <span class="token operator">...</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// karma.conf.ts</span></pre></td></tr><tr><td data-num="16"></td><td><pre>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token literal-property property">basePath</span><span class="token operator">:</span> <span class="token string">'../..'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token literal-property property">frameworks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'jasmine'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">//...</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote>
<p>关于 typescript 的支持，需要使用到 <code>ts-node</code> ，配置 ts-node 以使用 <code>commonjs</code>  模块格</p>
</blockquote>
<p>配置文件中的基本的属性介绍：<span class="exturl" data-url="aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLzQuMC9jb25maWcvY29uZmlndXJhdGlvbi1maWxlLmh0bWw=">Overview</span></p>
<p>使用 CLI 工具，快速创建配置</p>
<p>开始配置</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>~/Downloads/Demo is 📦 v1.0.0 via ⬢ v10.16.0 </pre></td></tr><tr><td data-num="2"></td><td><pre>➜ npx karma init</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 如果在应用中用到了其它的测试框架，那就需要我们安装它们所对应的插件，并在配置文件中标注它们（详见 karma.conf.js 中的 plugins 项）</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Which testing framework <span class="token keyword">do</span> you want to use ?</pre></td></tr><tr><td data-num="6"></td><td><pre>Press tab to list possible options. Enter to move to the next question.</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span> jasmine</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># mocha</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># qunit</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># nodeunit</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># nunit</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># Require.js 是异步加载规范（AMD）的实现。常被作为基础代码库，应用在了很多的项目与框架之中，例如 Dojo, AngularJs 等</span></pre></td></tr><tr><td data-num="14"></td><td><pre>Do you want to use Require.js ?</pre></td></tr><tr><td data-num="15"></td><td><pre>This will <span class="token function">add</span> Require.js plugin.</pre></td></tr><tr><td data-num="16"></td><td><pre>Press tab to list possible options. Enter to move to the next question.</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">></span> no</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># yes</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 选择需要运行测试用例的浏览器。需要注意的就是，必须保证所对应的浏览器插件已经安装成功。</span></pre></td></tr><tr><td data-num="21"></td><td><pre>Do you want to capture any browsers automatically ?</pre></td></tr><tr><td data-num="22"></td><td><pre>Press tab to list possible options. Enter empty string to move to the next question.</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">></span> Chrome</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># ChromeHeadless</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># ChromeCanary</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># Firefox</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># Safari</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment"># PhantomJS</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment"># Opera</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment"># IE</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment"># 选择测试用例所在的目录位置。Karma 支持通配符的方式配置文件或目录，例如 *.js, test/**/*.js 等。如果目录或文件使用相对位置，要清楚地是，此时的路径是相对于当前运行 karma 命令时所在的目录。</span></pre></td></tr><tr><td data-num="33"></td><td><pre>What is the location of your <span class="token builtin class-name">source</span> and <span class="token builtin class-name">test</span> files ?</pre></td></tr><tr><td data-num="34"></td><td><pre>You can use glob patterns, eg. <span class="token string">"js/*.js"</span> or <span class="token string">"test/**/*Spec.js"</span><span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="35"></td><td><pre>Enter empty string to move to the next question.</pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token operator">></span> src/*js</pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment"># 目录中不包括的那些文件。</span></pre></td></tr><tr><td data-num="39"></td><td><pre>Should any of the files included by the previous patterns be excluded ?</pre></td></tr><tr><td data-num="40"></td><td><pre>You can use glob patterns, eg. <span class="token string">"**/*.swp"</span><span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="41"></td><td><pre>Enter empty string to move to the next question.</pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token comment"># 是否需要 Karma 自动监听文件？并且文件一旦被修改，就重新运行测试用例？</span></pre></td></tr><tr><td data-num="44"></td><td><pre>Do you want Karma to <span class="token function">watch</span> all the files and run the tests on change ?</pre></td></tr><tr><td data-num="45"></td><td><pre>Press tab to list possible options.</pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token operator">></span> <span class="token function">yes</span></pre></td></tr></table></figure><p>生成了一个 <code>karma.conf.js</code>  文件：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Karma configuration</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// Generated on Wed Jul 10 2019 22:46:32 GMT+0800 (GMT+08:00)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// base path that will be used to resolve all patterns (eg. files, exclude)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token literal-property property">basePath</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// frameworks to use</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// available frameworks: https://npmjs.org/browse/keyword/karma-adapter</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token literal-property property">frameworks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'mocha'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">// list of files / patterns to load in the browser</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token string">'src/*js'</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">// list of files / patterns to exclude</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment">// preprocess matching files before serving them to the browser</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token comment">// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token literal-property property">preprocessors</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token comment">// test results reporter to use</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token comment">// possible values: 'dots', 'progress'</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment">// available reporters: https://npmjs.org/browse/keyword/karma-reporter</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token literal-property property">reporters</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'progress'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">// web server port</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">9876</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token comment">// enable / disable colors in the output (reporters and logs)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token literal-property property">colors</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token comment">// level of logging</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token comment">// possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token literal-property property">logLevel</span><span class="token operator">:</span> config<span class="token punctuation">.</span><span class="token constant">LOG_INFO</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token comment">// enable / disable watching file and executing tests whenever any file changes</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token literal-property property">autoWatch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token comment">// start these browsers</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token comment">// available browser launchers: https://npmjs.org/browse/keyword/karma-launcher</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token literal-property property">browsers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Chrome'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token comment">// Continuous Integration mode</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token comment">// if true, Karma captures browsers, runs the tests and exits</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token literal-property property">singleRun</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token comment">// Concurrency level</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token comment">// how many browser should be started simultaneous</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token literal-property property">concurrency</span><span class="token operator">:</span> <span class="token number">Infinity</span></pre></td></tr><tr><td data-num="68"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="karma示例"><a class="anchor" href="#karma示例">#</a> karma 示例</h3>
<p>目标 ：</p>
<ul>
<li>babel 支持，ES6 语法支持</li>
<li>mocha 与 chai 支持</li>
<li>karma 与 chrome、webpack 对接</li>
</ul>
<p>说明：</p>
<p>Karma 对 babel 支持的，一个可选项：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2JhYmVsL2thcm1hLWJhYmVsLXByZXByb2Nlc3Nvcg==">karma-babel-preprocessor</span>，但是：</p>
<blockquote>
<p>babel and karma-babel-preprocessor only convert ES6 modules to CommonJS/AMD/SystemJS/UMD**. If you choose CommonJS, you still need to resolve and concatenate CommonJS modules on your own**. We recommend <strong>karma-browserify + babelify</strong> or <strong>webpack + babel-loader</strong> in such cases.</p>
</blockquote>
<p>所以，我们选择了 webpack</p>
<ol>
<li>
<p>安装依赖</p>
<pre><code>npm install @babel/core @babel/preset-env chai mocha webpack webpack-cli babel-loader -D
</code></pre>
</li>
<li>
<p>安装 karma 的适配器</p>
<pre><code>npm install karma-webpack karma-chrome-launcher karma-mocha karma-chai -D
</code></pre>
</li>
<li>
<p>配置 <code>karma.config.js</code></p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Karma configuration</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// Generated on Thu Jul 11 2019 23:23:44 GMT+0800 (GMT+08:00)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  config<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// base path that will be used to resolve all patterns (eg. files, exclude)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token literal-property property">basePath</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// frameworks to use</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// available frameworks: https://npmjs.org/browse/keyword/karma-adapter</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token literal-property property">frameworks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'mocha'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">// list of files / patterns to load in the browser</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token string">'src/**/*.js'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token string">'test/**/*.js'</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre> </pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment">// ....</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    </pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">// preprocess matching files before serving them to the browser</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment">// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token literal-property property">preprocessors</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token string-property property">'src/**/*.js'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'webpack'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token string-property property">'test/**/*.js'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'webpack'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token literal-property property">webpack</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="35"></td><td><pre>      <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token literal-property property">fs</span><span class="token operator">:</span> <span class="token string">'empty'</span></pre></td></tr><tr><td data-num="37"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre>      <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="40"></td><td><pre>          <span class="token punctuation">&#123;</span> <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">"babel-loader"</span><span class="token punctuation">,</span> <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@babel/env"</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="42"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre> </pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token comment">// ....</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    </pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="48"></td><td><pre>      <span class="token string">'karma-mocha'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre>      <span class="token string">'karma-chai'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>      <span class="token string">'karma-chrome-launcher'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre>      <span class="token string">'karma-webpack'</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p>书写测试用例 <code>test.js</code> ：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> describe <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"mocha"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> expect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'chai'</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'first test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'hello mocha and karma'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello mocha'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">.</span>be<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li>
<li>
<p>开始测试：</p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>npx karma start</pre></td></tr></table></figure><p>添加到 <code>package.json</code></p>
<pre><code class="language-javascripton">&quot;scripts&quot;: &#123;
  &quot;karma&quot;: &quot;karma start&quot;
&#125;,
</code></pre>
<p>然后使用， <code>npm run karma</code></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>➜ npx karma start</pre></td></tr><tr><td data-num="2"></td><td><pre>ℹ ｢wdm｣: Hash: 9d2c943b68425fd58dd0</pre></td></tr><tr><td data-num="3"></td><td><pre>Version: webpack <span class="token number">4.35</span>.3</pre></td></tr><tr><td data-num="4"></td><td><pre>Time: 53ms</pre></td></tr><tr><td data-num="5"></td><td><pre>Built at: <span class="token number">2019</span>-07-12 <span class="token number">5</span>:07:49 PM</pre></td></tr><tr><td data-num="6"></td><td><pre>ℹ ｢wdm｣: Compiled successfully.</pre></td></tr><tr><td data-num="7"></td><td><pre>ℹ ｢wdm｣: Compiling<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="8"></td><td><pre>⚠ ｢wdm｣: Hash: cca8316f4bd5855fc4de</pre></td></tr><tr><td data-num="9"></td><td><pre>Version: webpack <span class="token number">4.35</span>.3</pre></td></tr><tr><td data-num="10"></td><td><pre>Time: 2414ms</pre></td></tr><tr><td data-num="11"></td><td><pre>Built at: <span class="token number">2019</span>-07-12 <span class="token number">5</span>:07:52 PM</pre></td></tr><tr><td data-num="12"></td><td><pre>       Asset      Size  Chunks             Chunk Names</pre></td></tr><tr><td data-num="13"></td><td><pre>src/index.js  <span class="token number">3.62</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  src/index</pre></td></tr><tr><td data-num="14"></td><td><pre>test/test.js  <span class="token number">1010</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  test/test</pre></td></tr><tr><td data-num="15"></td><td><pre>Entrypoint src/index <span class="token operator">=</span> src/index.js</pre></td></tr><tr><td data-num="16"></td><td><pre>Entrypoint test/test <span class="token operator">=</span> test/test.js</pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> ./src/index.js <span class="token number">27</span> bytes <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> ./test/test.js <span class="token number">223</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> ./node_modules/mocha/browser-entry.js <span class="token number">4.19</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> ./node_modules/process/browser.js <span class="token number">4.96</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/global.js <span class="token number">878</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> ./node_modules/browser-stdout/index.js <span class="token number">662</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> ./node_modules/stream-browserify/index.js <span class="token number">3.53</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span> ./node_modules/util/util.js <span class="token number">19</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span> ./node_modules/mocha/lib/mocha.js <span class="token number">21.8</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/module.js <span class="token number">552</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span> ./node_modules/escape-string-regexp/index.js <span class="token number">230</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span> path <span class="token punctuation">(</span>ignored<span class="token punctuation">)</span> <span class="token number">15</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span> ./node_modules/mocha/lib/reporters/index.js <span class="token number">945</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span><span class="token number">105</span><span class="token punctuation">]</span> ./node_modules/chai/index.js <span class="token number">39</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span><span class="token number">106</span><span class="token punctuation">]</span> ./node_modules/chai/lib/chai.js <span class="token number">1.22</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    + <span class="token number">128</span> hidden modules</pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">217</span>:20-37</pre></td></tr><tr><td data-num="35"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num="36"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num="37"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">222</span>:24-70</pre></td></tr><tr><td data-num="40"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num="41"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num="42"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">266</span>:24-35</pre></td></tr><tr><td data-num="45"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num="46"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num="47"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">313</span>:35-48</pre></td></tr><tr><td data-num="50"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num="51"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num="52"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre>WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">329</span>:23-44</pre></td></tr><tr><td data-num="55"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num="56"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num="57"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num="58"></td><td><pre>ℹ ｢wdm｣: Compiled with warnings.</pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:07:52.761:WARN <span class="token punctuation">[</span>karma<span class="token punctuation">]</span>: No captured browser, <span class="token function">open</span> http://localhost:9876/</pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:07:52.770:INFO <span class="token punctuation">[</span>karma-server<span class="token punctuation">]</span>: Karma v4.1.0 server started at http://0.0.0.0:9876/</pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:07:52.770:INFO <span class="token punctuation">[</span>launcher<span class="token punctuation">]</span>: Launching browsers Chrome with concurrency unlimited</pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:07:52.773:INFO <span class="token punctuation">[</span>launcher<span class="token punctuation">]</span>: Starting browser Chrome</pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:07:54.135:INFO <span class="token punctuation">[</span>Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span><span class="token punctuation">]</span>: Connected on socket R9R31QB1GtR_kayNAAAA with <span class="token function">id</span> <span class="token number">55412577</span></pre></td></tr><tr><td data-num="64"></td><td><pre>Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span> LOG: <span class="token string">'hello karma'</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre>LOG: <span class="token string">'hello mocha'</span></pre></td></tr><tr><td data-num="67"></td><td><pre>Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span>: Executed <span class="token number">1</span> of <span class="token number">1</span> SUCCESS <span class="token punctuation">(</span><span class="token number">0</span> secs / <span class="token number">0.001</span> secs</pre></td></tr><tr><td data-num="68"></td><td><pre>~/Downloads/karma-demo is 📦 v1.0.0 via ⬢ v10.16.0 </pre></td></tr><tr><td data-num="69"></td><td><pre>➜ <span class="token function">npm</span> run karma</pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token operator">></span> karma-demo@1.0.0 karma /Users/itheima/Downloads/karma-demo</pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token operator">></span> karma start</pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre>ℹ ｢wdm｣: Hash: 9d2c943b68425fd58dd0</pre></td></tr><tr><td data-num="75"></td><td><pre>Version: webpack <span class="token number">4.35</span>.3</pre></td></tr><tr><td data-num="76"></td><td><pre>Time: 48ms</pre></td></tr><tr><td data-num="77"></td><td><pre>Built at: <span class="token number">2019</span>-07-12 <span class="token number">5</span>:24:02 PM</pre></td></tr><tr><td data-num="78"></td><td><pre>ℹ ｢wdm｣: Compiled successfully.</pre></td></tr><tr><td data-num="79"></td><td><pre>ℹ ｢wdm｣: Compiling<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="80"></td><td><pre>⚠ ｢wdm｣: Hash: cca8316f4bd5855fc4de</pre></td></tr><tr><td data-num="81"></td><td><pre>Version: webpack <span class="token number">4.35</span>.3</pre></td></tr><tr><td data-num="82"></td><td><pre>Time: 2307ms</pre></td></tr><tr><td data-num="83"></td><td><pre>Built at: <span class="token number">2019</span>-07-12 <span class="token number">5</span>:24:04 PM</pre></td></tr><tr><td data-num="84"></td><td><pre>       Asset      Size  Chunks             Chunk Names</pre></td></tr><tr><td data-num="85"></td><td><pre>src/index.js  <span class="token number">3.62</span> KiB       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  src/index</pre></td></tr><tr><td data-num="86"></td><td><pre>test/test.js  <span class="token number">1010</span> KiB       <span class="token number">1</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  test/test</pre></td></tr><tr><td data-num="87"></td><td><pre>Entrypoint src/index <span class="token operator">=</span> src/index.js</pre></td></tr><tr><td data-num="88"></td><td><pre>Entrypoint test/test <span class="token operator">=</span> test/test.js</pre></td></tr><tr><td data-num="89"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> ./src/index.js <span class="token number">27</span> bytes <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="90"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> ./test/test.js <span class="token number">223</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="91"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> ./node_modules/mocha/browser-entry.js <span class="token number">4.19</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="92"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> ./node_modules/process/browser.js <span class="token number">4.96</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="93"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/global.js <span class="token number">878</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="94"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> ./node_modules/browser-stdout/index.js <span class="token number">662</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="95"></td><td><pre>  <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> ./node_modules/stream-browserify/index.js <span class="token number">3.53</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="96"></td><td><pre> <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span> ./node_modules/util/util.js <span class="token number">19</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="97"></td><td><pre> <span class="token punctuation">[</span><span class="token number">38</span><span class="token punctuation">]</span> ./node_modules/mocha/lib/mocha.js <span class="token number">21.8</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="98"></td><td><pre> <span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>webpack<span class="token punctuation">)</span>/buildin/module.js <span class="token number">552</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="99"></td><td><pre> <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span> ./node_modules/escape-string-regexp/index.js <span class="token number">230</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="100"></td><td><pre> <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span> path <span class="token punctuation">(</span>ignored<span class="token punctuation">)</span> <span class="token number">15</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="101"></td><td><pre> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span> ./node_modules/mocha/lib/reporters/index.js <span class="token number">945</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token punctuation">[</span><span class="token number">105</span><span class="token punctuation">]</span> ./node_modules/chai/index.js <span class="token number">39</span> bytes <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token punctuation">[</span><span class="token number">106</span><span class="token punctuation">]</span> ./node_modules/chai/lib/chai.js <span class="token number">1.22</span> KiB <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="104"></td><td><pre>    + <span class="token number">128</span> hidden modules</pre></td></tr><tr><td data-num="105"></td><td><pre></pre></td></tr><tr><td data-num="106"></td><td><pre>WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">217</span>:20-37</pre></td></tr><tr><td data-num="107"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num="108"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num="109"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num="110"></td><td><pre></pre></td></tr><tr><td data-num="111"></td><td><pre>WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">222</span>:24-70</pre></td></tr><tr><td data-num="112"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num="113"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num="114"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num="115"></td><td><pre></pre></td></tr><tr><td data-num="116"></td><td><pre>WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">266</span>:24-35</pre></td></tr><tr><td data-num="117"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num="118"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num="119"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num="120"></td><td><pre></pre></td></tr><tr><td data-num="121"></td><td><pre>WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">313</span>:35-48</pre></td></tr><tr><td data-num="122"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num="123"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num="124"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num="125"></td><td><pre></pre></td></tr><tr><td data-num="126"></td><td><pre>WARNING <span class="token keyword">in</span> ./node_modules/mocha/lib/mocha.js <span class="token number">329</span>:23-44</pre></td></tr><tr><td data-num="127"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num="128"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num="129"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num="130"></td><td><pre>ℹ ｢wdm｣: Compiled with warnings.</pre></td></tr><tr><td data-num="131"></td><td><pre><span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:24:04.905:WARN <span class="token punctuation">[</span>karma<span class="token punctuation">]</span>: No captured browser, <span class="token function">open</span> http://localhost:9876/</pre></td></tr><tr><td data-num="132"></td><td><pre><span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:24:04.914:INFO <span class="token punctuation">[</span>karma-server<span class="token punctuation">]</span>: Karma v4.1.0 server started at http://0.0.0.0:9876/</pre></td></tr><tr><td data-num="133"></td><td><pre><span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:24:04.914:INFO <span class="token punctuation">[</span>launcher<span class="token punctuation">]</span>: Launching browsers Chrome with concurrency unlimited</pre></td></tr><tr><td data-num="134"></td><td><pre><span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:24:04.922:INFO <span class="token punctuation">[</span>launcher<span class="token punctuation">]</span>: Starting browser Chrome</pre></td></tr><tr><td data-num="135"></td><td><pre><span class="token number">12</span> 07 <span class="token number">2019</span> <span class="token number">17</span>:24:06.289:INFO <span class="token punctuation">[</span>Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span><span class="token punctuation">]</span>: Connected on socket EbCCSbQRPbxHbq3OAAAA with <span class="token function">id</span> <span class="token number">92342032</span></pre></td></tr><tr><td data-num="136"></td><td><pre>Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span> LOG: <span class="token string">'hello karma'</span></pre></td></tr><tr><td data-num="137"></td><td><pre></pre></td></tr><tr><td data-num="138"></td><td><pre>LOG: <span class="token string">'hello mocha'</span></pre></td></tr><tr><td data-num="139"></td><td><pre>Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span>: Executed <span class="token number">1</span> of <span class="token number">1</span> SUCCESS <span class="token punctuation">(</span><span class="token number">0</span> secs / <span class="token number">0.001</span> secs</pre></td></tr><tr><td data-num="140"></td><td><pre>Chrome <span class="token number">75.0</span>.3770 <span class="token punctuation">(</span>Mac OS X <span class="token number">10.14</span>.5<span class="token punctuation">)</span>: Executed <span class="token number">1</span> of <span class="token number">1</span> SUCCESS <span class="token punctuation">(</span><span class="token number">0.006</span> secs / <span class="token number">0.001</span> </pre></td></tr><tr><td data-num="141"></td><td><pre>secs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="142"></td><td><pre>TOTAL: <span class="token number">1</span> SUCCESS</pre></td></tr></table></figure></li>
</ol>
<h2 id="ui测试利器nightmare"><a class="anchor" href="#ui测试利器nightmare">#</a> UI 测试利器 Nightmare</h2>
<p>Nightmare 是<span class="exturl" data-url="aHR0cHM6Ly9zZWdtZW50LmNvbS8="> Segment</span> 的高级浏览器自动化库。</p>
<p>目标是公开一些模仿用户操作（例如 <code>goto</code> ， <code>type</code>  和 <code>click</code> ）的简单方法，使用对每个脚本块感觉同步的 API，而不是深层嵌套的回调。它最初设计用于在没有 API 的站点之间自动执行任务，但最常用于 UI 测试和爬网。</p>
<p>它使用<span class="exturl" data-url="aHR0cDovL2VsZWN0cm9uLmF0b20uaW8v"> Electron</span>，它与<span class="exturl" data-url="aHR0cDovL3BoYW50b21qcy5vcmcv"> PhantomJS</span> 类似，但大约<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUvaXNzdWVzLzQ4NCNpc3N1ZWNvbW1lbnQtMTg0NTE5NTkx">快两倍</span>，更现代。</p>
<h3 id="安装与起步"><a class="anchor" href="#安装与起步">#</a> 安装与起步</h3>
<ol>
<li>
<p>安装 <code>nightmare</code></p>
</li>
<li>
<pre><code>// 初始化项目
npm init -y

npm install --save-dev nightmare

</code></pre>
</li>
</ol>
<p>npm install --save-dev mocha</p>
<pre><code>
2. 淘宝源加速

</code></pre>
<p>// 使用淘宝源加速 electron 的安装<br />
 export ELECTRON_MIRROR=&quot;<span class="exturl" data-url="aHR0cHM6Ly9ucG0udGFvYmFvLm9yZy9taXJyb3JzL2VsZWN0cm9uLw==">https://npm.taobao.org/mirrors/electron/</span>&quot;</p>
<pre><code>
3. 起步测试：

```javascript
const Nightmare = require('nightmare')
const assert = require('assert')

describe('Load a Page', function () &#123;
  // Recommended: 5s locally, 10s to remote server, 30s from airplane ¯\_(ツ)_/¯
  this.timeout('30s')

  let nightmare = null
  beforeEach(() =&gt; &#123;
    nightmare = new Nightmare()
  &#125;)

  describe('/ (Home Page)', () =&gt; &#123;
    it('should load without error', done =&gt; &#123;
      // your actual testing urls will likely be `http://localhost:port/path`
      nightmare.goto('https://www.baidu.com')
        .end()
        .then(function (result) &#123;
          done()
        &#125;)
        .catch(done)
    &#125;)
  &#125;)
&#125;)
</code></pre>
<h3 id="nightmare配合mocha测试"><a class="anchor" href="#nightmare配合mocha测试">#</a> nightmare 配合 mocha 测试</h3>
<p>nightmare 可以进行网页的抓取，配合 mocha 进行页面的测试：</p>
<p>安装 <code>mocha</code></p>
<figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">npm</span> <span class="token function">install</span> --save-dev mocha</pre></td></tr></table></figure><blockquote>
<p>还可以安装一些断言库，如： <code>chai</code></p>
</blockquote>
<p>新建测试：</p>
<figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> Nightmare <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'nightmare'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> assert <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'assert'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Search nightmare'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token string">'30s'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">let</span> nightmare <span class="token operator">=</span> <span class="token keyword">null</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  </pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    nightmare <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Nightmare</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'should load with result nightmare'</span><span class="token punctuation">,</span> <span class="token parameter">done</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">const</span> selector <span class="token operator">=</span> <span class="token string">'em'</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    nightmare<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'#kw'</span><span class="token punctuation">,</span> <span class="token string">'nightmare'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'#su'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      <span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token string">'em'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token parameter">selector</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token comment">// now we're executing inside the browser scope.</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">.</span>innerText</pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> selector<span class="token punctuation">)</span> <span class="token comment">// &lt;-- that's how you pass parameters from Node scope to browser scope</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">'nightmare'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>将 mocha 作为测试脚本添加到您的   <code>package.json</code> ：</p>
<pre><code class="language-javascripton">&quot;scripts&quot;: &#123;
  &quot;test&quot;: &quot;mocha&quot;
&#125;
</code></pre>
<h3 id="api介绍"><a class="anchor" href="#api介绍">#</a> API 介绍</h3>
<h4 id="nightmare的配置项"><a class="anchor" href="#nightmare的配置项">#</a> nightmare 的配置项</h4>
<pre><code>waitTimeout (default: 30s)
gotoTimeout (default: 30s)
loadTimeout (default: infinite)
executionTimeout (default: 30s)
paths
switches
electronPath
dock
openDevTools
typeInterval (default: 100ms)
pollInterval (default: 250ms)
maxAuthRetries (default: 3)
certificateSubjectName
.engineVersions()
.useragent(useragent)
.authentication(user, password)
.authentication(user, password)
.halt(error, done)
</code></pre>
<p>配置链接：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUjbmlnaHRtYXJlb3B0aW9ucw==">https://github.com/segmentio/nightmare#nightmareoptions</span></p>
<h4 id="页面交互相关"><a class="anchor" href="#页面交互相关">#</a> 页面交互相关</h4>
<pre><code>.back()
.forward()
.refresh()
.click(selector)
.mousedown(selector)
.mouseup(selector)
.mouseover(selector)
.mouseout(selector)
.type(selector[, text])
.insert(selector[, text])
.check(selector)
.uncheck(selector)
.select(selector, option)
.scrollTo(top, left)
.viewport(width, height)
.inject(type, file)
.evaluate(fn[, arg1, arg2,...])
.wait(ms)
.wait(selector)
.wait(fn[, arg1, arg2,...])
.header(header, value)
</code></pre>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUjaW50ZXJhY3Qtd2l0aC10aGUtcGFnZQ==">配置参考链接</span></p>
<h4 id="页面提取"><a class="anchor" href="#页面提取">#</a> 页面提取</h4>
<pre><code>.exists(selector)
.visible(selector)
.on(event, callback)
.once(event, callback)
.removeListener(event, callback)
.screenshot([path][, clip])
.html(path, saveType)
.pdf(path, options)
.title()
.url()
.path()
</code></pre>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUjZXh0cmFjdC1mcm9tLXRoZS1wYWdl">配置参考链接</span></p>
<h2 id="补充学习"><a class="anchor" href="#补充学习">#</a> 补充学习</h2>
<h3 id="补充资料"><a class="anchor" href="#补充资料">#</a> 补充资料</h3>
<h4 id="软件测试的分类"><a class="anchor" href="#软件测试的分类">#</a> 软件测试的分类</h4>
<p><strong>第一部分：软件测试的分类</strong></p>
<ul>
<li>
<p>按测试执行阶段划分</p>
<p>单元测试、集成测试、系统测试、验收测试（正式验收测试、Alpha 测试、Beta 测试）</p>
</li>
<li>
<p>按测试技术划分</p>
<p>白盒测试、黑盒测试、灰盒测试</p>
</li>
<li>
<p>被测试对象是否运行划分</p>
<p>动态测试、静态测试（文档检查、代码走查、界面检查）</p>
</li>
<li>
<p>按不同的测试手段划分</p>
<p>手工测试、自动化测试</p>
</li>
<li>
<p>按测试包含的内容划分</p>
<p>功能测试、界面测试、安全测试、兼容性测试、易用性测试、性能测试、压力测试、负载测试、恢复测试</p>
</li>
<li>
<p>其他测试</p>
<p>冒烟测试、回归测试、探索性测试 / 自由测试（测试思维）</p>
</li>
</ul>
<p><strong>第二部分：接下来对软件测试分类进行一个说明</strong></p>
<p><img data-src="../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-889a2848a1b2a8eeccae000be23c247a_hd.jpg" alt="img" /><img data-src="../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-889a2848a1b2a8eeccae000be23c247a_hd.jpg" alt="img" /></p>
<p><img data-src="../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-f831b8041976b50aad7c2425aada44e2_hd-1561454378198.jpg" alt="img" /><img data-src="../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-f831b8041976b50aad7c2425aada44e2_hd.jpg" alt="img" /></p>
<p><strong>第三部分：测试工具</strong></p>
<p>SVN，Git——&gt; 版本控制管理工具</p>
<p>禅道 ——&gt;Bug 管理工具</p>
<p>Fiddler——&gt; 抓包，定位问题你</p>
<p>postman，jmeter，soapui——&gt; 接口测试</p>
<p>Loadrunner，Jmeter——&gt; 性能，压力测试</p>
<h4 id="2019年javascript测试概览"><a class="anchor" href="#2019年javascript测试概览">#</a> 2019 年 Javascript 测试概览</h4>
<p><span class="exturl" data-url="aHR0cHM6Ly9tZWRpdW0uY29tL3dlbGxkb25lLXNvZnR3YXJlL2FuLW92ZXJ2aWV3LW9mLWphdmFzY3JpcHQtdGVzdGluZy1pbi0yMDE5LTI2NGUxOTUxNGQwYQ==">https://medium.com/welldone-software/an-overview-of-javascript-testing-in-2019-264e19514d0a</span></p>
<p>这是一篇非常好的国外的博文，同时也是 2018 年 Javascript 测试概览的作者。这里有 2018 年的译文：</p>
<p><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zMjcwMjQyMQ==">展望 2018 年 JavaScript Testing</span></p>
<p>在文中很好介绍到了测试类型，并举了大量的例子，非常全面。</p>
<h4 id="什么是tdd"><a class="anchor" href="#什么是tdd">#</a> 什么是 TDD？</h4>
<p><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzNlNzM4NzZmYjlhMDQ5ZDM3ZjVkYjE=">测试驱动开发（TDD）总结 —— 原理篇</span></p>
<p>TDD （Test Driven Development） 在不同的圈子、不同的角色的认知中可能会有不同的理解，有人可能会理解成 ATDD（Acceptance Test Driven Development），也有人可能会理解成 UTDD（Unit Test Driven Development），为了避免产生歧义，<strong>文章涉及到 TDD 专指 UTDD（Unit Test Driven Development），即 「单元测试驱动开发」</strong>。</p>
<p>TDD 的目标</p>
<blockquote>
<p>Kent Beck 在他的著作《Test-Driven Development》一书中提到：“<strong>代码简洁可用</strong>这句言简意赅的话，正是 TDD 所追求的目标”。</p>
</blockquote>
<p><strong>对于如何保证 “代码简洁可用” 可以使用分而治之的方法，先达到 “可用” 目标，再追求 “简洁” 目标。</strong></p>
<p><strong>可用：</strong> 保证代码通过自动化测试。</p>
<p><strong>代码简洁：</strong> 在不同阶段人们对简洁的理解程度也不一样，不过遵循的原则差不多，例如 OOD 的 SOLID 原则，Kent Beck 的 Simple Design 原则等。</p>
<p>虽然有很多因素妨碍我们得到整洁的代码，甚至可用的代码，无需征求太多意见，只需要采用 TDD 的开发方式来驱动出简洁可用的代码。</p>
<h4 id="karma的前世今生"><a class="anchor" href="#karma的前世今生">#</a> Karma 的前世今生</h4>
<p>2016 年的文章，由淘宝前端团队书写：<span class="exturl" data-url="aHR0cDovL3Rhb2Jhb2ZlZC5vcmcvYmxvZy8yMDE2LzAxLzA4L2thcm1hLW9yaWdpbi8=">http://taobaofed.org/blog/2016/01/08/karma-origin/</span></p>
<p>通篇介绍了 karma 的工作原理及实现原理，非常有价值的文章。</p>
<h3 id="ava框架的配置文件"><a class="anchor" href="#ava框架的配置文件">#</a> ava 框架的配置文件</h3>
<pre><code class="language-javascripton">&#123;
	&quot;ava&quot;: &#123;
		&quot;files&quot;: [
			&quot;test/**/*&quot;,
			&quot;!test/exclude-files-in-this-directory&quot;,
			&quot;!**/exclude-files-with-this-name.*&quot;
		],
		&quot;helpers&quot;: [
			&quot;**/helpers/**/*&quot;
		],
		&quot;sources&quot;: [
			&quot;src/**/*&quot;
		],
		&quot;match&quot;: [
			&quot;*oo&quot;,
			&quot;!foo&quot;
		],
		&quot;cache&quot;: true,
		&quot;concurrency&quot;: 5,
		&quot;failFast&quot;: true,
		&quot;failWithoutAssertions&quot;: false,
		&quot;environmentVariables&quot;: &#123;
			&quot;MY_ENVIRONMENT_VARIABLE&quot;: &quot;some value&quot;
		&#125;,
		&quot;tap&quot;: true,
		&quot;verbose&quot;: true,
		&quot;compileEnhancements&quot;: false,
		&quot;require&quot;: [
			&quot;@babel/register&quot;
		],
		&quot;babel&quot;: &#123;
			&quot;extensions&quot;: [&quot;js&quot;, &quot;jsx&quot;],
			&quot;testOptions&quot;: &#123;
				&quot;babelrc&quot;: false
			&#125;
		&#125;
	&#125;
&#125;
</code></pre>
<ul>
<li><code>files</code> ：用于选择测试文件的 glob 模式数组。带有下划线前缀的文件将被忽略。默认情况下，仅选择具有 <code>js</code>  扩展名的文件，即使该模式与其他文件匹配。指定 <code>extensions</code>  并 <code>babel.extensions</code>  允许其他文件扩展名</li>
<li><code>helpers</code> ：用于选择帮助文件的 glob 模式数组。这里匹配的文件永远不会被视为测试。默认情况下，仅选择具有 <code>js</code>  扩展名的文件，即使该模式与其他文件匹配。指定 <code>extensions</code>  并 <code>babel.extensions</code>  允许其他文件扩展名</li>
<li><code>sources</code> ：一组 glob 模式，用于匹配文件，这些文件在更改时会导致重新运行测试（在监视模式下）。有关详细信息，<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YS9ibG9iL21hc3Rlci9kb2NzL3JlY2lwZXMvd2F0Y2gtbW9kZS5tZCNzb3VyY2UtZmlsZXMtYW5kLXRlc3QtZmlsZXM=">请参阅</span></li>
<li><code>match</code> ：通常在 <code>package.json</code>  配置中没用，但等同于在 CLI 上指定 <code>--match</code></li>
<li><code>cache</code> ：缓存编译的测试和帮助文件 <code>node_modules/.cache/ava</code> 。如果 <code>false</code> ，文件缓存在临时目录中</li>
<li><code>failFast</code> ：一旦测试失败，停止运行进一步的测试</li>
<li><code>failWithoutAssertions</code> ：如果设置成 <code>false</code> ，那么如果没有运行断言，则测试失败</li>
<li><code>environmentVariables</code> ：指定要供测试使用的环境变量。此处定义的环境变量会覆盖其中的环境变量 <code>process.env</code></li>
<li><code>tap</code> ：设置成  <code>true</code> ，启用 TAP 报告</li>
<li><code>verbose</code> ：设置成  <code>true</code> ，启用详细输出</li>
<li><code>snapshotDir</code> ：指定用于存储快照文件的固定位置。如果快照最终位于错误的位置，请使用此选项</li>
<li><code>compileEnhancements</code> ：设置成  <code>false</code> ，禁用了 <a target="_blank" rel="noopener" href="https://github.com/avajs/ava/blob/master/docs/03-assertions.md#enhanced-assertion-messages"> <code>power-assert</code> </a>，否则有助于提供更具描述性的错误消息， 并检测 <code>t.throws()</code>  断言的不当使用</li>
<li><code>extensions</code> ：未使用 AVA 的 Babel 预设进行预编译的测试文件的扩展名。请注意，文件仍然会被编译为启用 <code>power-assert</code>  和其他功能，因此您可能还需要设置 <code>compileEnhancements</code>  为 <code>false</code>  文件是否为有效的 JavaScript。设置此 <code>&quot;js&quot;</code>  值会覆盖默认值，因此请确保在列表中包含该扩展名，只要它不包含在内 <code>babel.extensions</code></li>
<li><code>require</code> ：在运行测试之前需要额外的模块。工作进程中需要模块</li>
<li><code>babel</code> ：测试文件特定的 Babel 选项。有关详细信息，请参阅<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YS9ibG9iL21hc3Rlci9kb2NzL3JlY2lwZXMvYmFiZWwubWQjY29uZmlndXJpbmctYmFiZWw="> Babel 配置</span></li>
<li><code>babel.extensions</code> ：将使用 AVA 的 Babel 预设进行预编译的测试文件的扩展。设置此选项会覆盖默认 <code>&quot;js&quot;</code>  值，因此请确保在列表中包含该扩展名。</li>
<li><code>timeout</code> ：AVA 中的超时行为与其他测试框架中的行为不同。AVA 在每次测试后重置计时器，如果在指定的超时内没有收到新的测试结果，则强制测试退出。这可用于处理停滞的测试。请参阅我们的<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YS9ibG9iL21hc3Rlci9kb2NzLzA3LXRlc3QtdGltZW91dHMubWQ=">超时文档</span>以获取更多选</li>
</ul>
<p>请注意，在 CLI 上提供文件会覆盖该 <code>files</code>  选项。</p>
<h2 id="参考资料"><a class="anchor" href="#参考资料">#</a> 参考资料</h2>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC80NzAwOTY2NA==">使用 Jest 测试 JavaScript (Mock 篇)</span></li>
</ul>

      <div class="tags">
          <a href="/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" rel="tag"><i class="ic i-tag"></i> 自动化测试</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2024-07-24 14:35:27" itemprop="dateModified" datetime="2024-07-24T14:35:27+08:00">2024-07-24</time>
  </span>
  <span id="2024/03/02/自动化测试/" class="item leancloud_visitors" data-flag-title="自动化测试" title="阅读次数">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">阅读次数</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">次</span>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> 赞赏</button>
  <p>请我喝[茶]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="dmq 微信支付">
        <p>微信支付</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="dmq 支付宝">
        <p>支付宝</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>dmq <i class="ic i-at"><em>@</em></i>杜明清的个人博客
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="https://dmqweb.cn/2024/03/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" title="自动化测试">https://dmqweb.cn/2024/03/02/自动化测试/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2024/02/03/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s3.uuu.ovh&#x2F;imgs&#x2F;2024&#x2F;04&#x2F;28&#x2F;a34792f58e340f69.webp" title="持续集成与持续部署">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> 持续集成与部署</span>
  <h3>持续集成与持续部署</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2024/03/02/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s3.uuu.ovh&#x2F;imgs&#x2F;2024&#x2F;04&#x2F;07&#x2F;d94cad8780c8c094.jpg" title="前端性能优化">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> 前端性能优化</span>
  <h3>前端性能优化</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#5-3-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-number">1.</span> <span class="toc-text"> 5-3 自动化测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text"> 介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.</span> <span class="toc-text"> 前端自动化测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.1.</span> <span class="toc-text"> 测试的分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 测试工具对比</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6"><span class="toc-number">1.2.2.1.</span> <span class="toc-text"> 如何选择测试框架</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.2.2.</span> <span class="toc-text"> 测试工具的类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%B1%BB%E5%B7%A5%E5%85%B7"><span class="toc-number">1.2.2.3.</span> <span class="toc-text"> 单元测试类工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#e2e%E6%B5%8B%E8%AF%95%E7%B1%BB%E5%B7%A5%E5%85%B7"><span class="toc-number">1.2.2.4.</span> <span class="toc-text"> E2E 测试类工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.2.3.</span> <span class="toc-text"> 最佳实践</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%96%9C%E6%AC%A2%E7%AE%80%E5%8D%95%E9%80%89%E6%8B%A9mocha"><span class="toc-number">1.3.</span> <span class="toc-text"> 喜欢简单，选择 Mocha</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E6%96%AD%E8%A8%80"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 关于断言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%A1%88%E4%BE%8B"><span class="toc-number">1.3.3.</span> <span class="toc-text"> 测试案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mocha%E6%B5%8B%E8%AF%95%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.4.</span> <span class="toc-text"> Mocha 测试命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#es6%E8%AF%AD%E6%B3%95%E6%94%AF%E6%8C%81"><span class="toc-number">1.3.5.</span> <span class="toc-text"> ES6 语法支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A%E7%94%A8%E6%B3%95"><span class="toc-number">1.3.6.</span> <span class="toc-text"> 更多用法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%85%E6%97%B6"><span class="toc-number">1.3.6.1.</span> <span class="toc-text"> 超时</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%A9%E5%AD%90%E6%96%B9%E6%B3%95%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.6.2.</span> <span class="toc-text"> 钩子方法（生命周期函数）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E6%B5%8B%E8%AF%95"><span class="toc-number">1.3.6.3.</span> <span class="toc-text"> 异步测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.3.7.</span> <span class="toc-text"> 示例项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">1.3.7.1.</span> <span class="toc-text"> 创建项目 &amp; 安装依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.7.2.</span> <span class="toc-text"> 测试过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E7%AE%B1%E5%8D%B3%E7%94%A8jest"><span class="toc-number">1.4.</span> <span class="toc-text"> 开箱即用 Jest</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-2"><span class="toc-number">1.4.1.</span> <span class="toc-text"> 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%B8%AA%E4%BE%8B%E5%AD%90"><span class="toc-number">1.4.2.</span> <span class="toc-text"> 举个例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mock%E4%B8%8Espy"><span class="toc-number">1.4.3.</span> <span class="toc-text"> Mock 与 Spy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cli%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.4.</span> <span class="toc-text"> CLI 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jest%E5%9C%A8react-vue%E9%A1%B9%E7%9B%AE%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.4.5.</span> <span class="toc-text"> Jest 在 React、Vue 项目中的应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E7%BA%A6%E4%B9%8B%E7%BE%8Eava"><span class="toc-number">1.5.</span> <span class="toc-text"> 简约之美 AVA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ava%E7%89%B9%E7%82%B9"><span class="toc-number">1.5.1.</span> <span class="toc-text"> AVA 特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%BC%80%E5%A7%8B"><span class="toc-number">1.5.2.</span> <span class="toc-text"> 安装 &amp; 开始</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AAava%E6%B5%8B%E8%AF%95%E4%BE%8B%E5%AD%90"><span class="toc-number">1.5.3.</span> <span class="toc-text"> 第一个 ava 测试例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cli%E5%91%BD%E4%BB%A4-2"><span class="toc-number">1.5.4.</span> <span class="toc-text"> CLI 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%B9%E9%85%8D"><span class="toc-number">1.5.4.1.</span> <span class="toc-text"> 文件匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Ereporter"><span class="toc-number">1.5.4.2.</span> <span class="toc-text"> 关于 reporter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E7%85%A7%E5%8A%9F%E8%83%BD"><span class="toc-number">1.5.4.3.</span> <span class="toc-text"> 快照功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%B6%85%E6%97%B6"><span class="toc-number">1.5.4.4.</span> <span class="toc-text"> 设置超时</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96ava%E8%AE%BE%E7%BD%AE%E7%9B%B8%E5%85%B3"><span class="toc-number">1.5.5.</span> <span class="toc-text"> 其他 ava 设置相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#eslint"><span class="toc-number">1.5.5.1.</span> <span class="toc-text"> ESLint</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E7%9B%B8%E5%85%B3"><span class="toc-number">1.5.5.2.</span> <span class="toc-text"> 异步相关</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E5%B8%AE%E6%89%8Bkarma"><span class="toc-number">1.6.</span> <span class="toc-text"> 测试环境 &amp; 帮手 Karma</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text"> 工作原理简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85karma"><span class="toc-number">1.6.2.</span> <span class="toc-text"> 安装 Karma</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEkarma"><span class="toc-number">1.6.3.</span> <span class="toc-text"> 配置 Karma</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#karma%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.4.</span> <span class="toc-text"> karma 示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ui%E6%B5%8B%E8%AF%95%E5%88%A9%E5%99%A8nightmare"><span class="toc-number">1.7.</span> <span class="toc-text"> UI 测试利器 Nightmare</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E8%B5%B7%E6%AD%A5"><span class="toc-number">1.7.1.</span> <span class="toc-text"> 安装与起步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nightmare%E9%85%8D%E5%90%88mocha%E6%B5%8B%E8%AF%95"><span class="toc-number">1.7.2.</span> <span class="toc-text"> nightmare 配合 mocha 测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#api%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.7.3.</span> <span class="toc-text"> API 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nightmare%E7%9A%84%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">1.7.3.1.</span> <span class="toc-text"> nightmare 的配置项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E4%BA%A4%E4%BA%92%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.3.2.</span> <span class="toc-text"> 页面交互相关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E6%8F%90%E5%8F%96"><span class="toc-number">1.7.3.3.</span> <span class="toc-text"> 页面提取</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.8.</span> <span class="toc-text"> 补充学习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E8%B5%84%E6%96%99"><span class="toc-number">1.8.1.</span> <span class="toc-text"> 补充资料</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.8.1.1.</span> <span class="toc-text"> 软件测试的分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2019%E5%B9%B4javascript%E6%B5%8B%E8%AF%95%E6%A6%82%E8%A7%88"><span class="toc-number">1.8.1.2.</span> <span class="toc-text"> 2019 年 Javascript 测试概览</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFtdd"><span class="toc-number">1.8.1.3.</span> <span class="toc-text"> 什么是 TDD？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#karma%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F"><span class="toc-number">1.8.1.4.</span> <span class="toc-text"> Karma 的前世今生</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ava%E6%A1%86%E6%9E%B6%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.8.2.</span> <span class="toc-text"> ava 框架的配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.9.</span> <span class="toc-text"> 参考资料</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
        <ul>
          <li class="active"><a href="/2024/03/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/" rel="bookmark" title="自动化测试">自动化测试</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="dmq"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">dmq</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">82</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">66</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">102</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RtcTA/dGFiPXJlcG9zaXRvcmllcw==" title="https:&#x2F;&#x2F;github.com&#x2F;dmq0?tab&#x3D;repositories"><i class="ic i-github"></i></span>
      <span class="exturl item npm" data-url="aHR0cHM6Ly93d3cubnBtanMuY29tL35kbXEwMDA=" title="https:&#x2F;&#x2F;www.npmjs.com&#x2F;~dmq000"><i class="ic i-file"></i></span>
      <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9kLTg4LTYxLTgz" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;d-88-61-83"><i class="ic i-zhihu"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTgwMjc4OTk0OTE=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;8027899491"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vdS83NjI1OTAxNzE3" title="https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;7625901717"><i class="ic i-weibo"></i></span>
      <span class="exturl item email" data-url="bWFpbHRvOjMyNjc4MDc1MTRAcXEuY29t" title="mailto:3267807514@qq.com"><i class="ic i-envelope"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>介绍</a>
  </li>

    
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a>
  </li>

    
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

    
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>

    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a>
  </li>

    
  <li class="item">
    <a href="/links/" rel="section"><i class="ic i-magic"></i>工具</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2024/02/03/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2024/03/02/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>随机文章</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/ES6/" title="分类于 ES6">ES6</a>
</div>

    <span><a href="/2023/08/02/ES6/" title="ES6">ES6</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%BA%95%E5%B1%82%E6%9D%82%E8%AE%B0/" title="分类于 底层杂记">底层杂记</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E5%BA%95%E5%B1%82%E6%9D%82%E8%AE%B0/%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0/" title="分类于 工具函数">工具函数</a>
</div>

    <span><a href="/2023/06/02/%E5%BA%95%E5%B1%82%E6%9D%82%E8%AE%B0/" title="底层杂记与工具库函数">底层杂记与工具库函数</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Travis%E5%92%8CDocker/" title="分类于 Travis和Docker">Travis和Docker</a>
</div>

    <span><a href="/2023/12/02/Travis%20CI%E5%92%8CDocker%E7%9A%84%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" title="Travis和Docker的持续集成">Travis和Docker的持续集成</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/three-js/" title="分类于 three.js">three.js</a>
</div>

    <span><a href="/2023/10/24/ThreeJS/" title="three.js">three.js</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E4%B8%AD%E5%89%8D%E5%8F%B0%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="分类于 中前台解决方案">中前台解决方案</a>
</div>

    <span><a href="/2023/02/12/%E4%B8%AD%E5%89%8D%E5%8F%B0%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="中前台解决方案">中前台解决方案</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Blob/" title="分类于 Blob">Blob</a>
</div>

    <span><a href="/2024/05/17/Blob%E5%92%8CFile/" title="Blob、File和FileReader">Blob、File和FileReader</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/OSI%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/" title="分类于 OSI七层网络模型">OSI七层网络模型</a>
</div>

    <span><a href="/2024/05/27/OSI%E4%B8%83%E5%B1%82%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/" title="OSI七层网络模型">OSI七层网络模型</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%BC%80%E5%8F%91/" title="分类于 脚手架开发">脚手架开发</a>
</div>

    <span><a href="/2024/04/12/%E8%84%9A%E6%89%8B%E6%9E%B6/" title="脚手架开发">脚手架开发</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" title="分类于 前端工程化">前端工程化</a>
</div>

    <span><a href="/2024/03/29/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/" title="前端模块化">前端模块化</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E4%B8%9A%E5%8A%A1%E5%A4%84%E7%90%86/" title="分类于 业务处理">业务处理</a>
</div>

    <span><a href="/2024/03/29/%E6%9C%AC%E5%9C%B0%E9%A2%84%E8%A7%88%E5%9B%BE%E7%89%87/" title="本地预览图片">本地预览图片</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2022 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">dmq @ Web blog</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">955k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">14:28</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2024/03/02/自动化测试/',
    favicon: {
      show: "科技引领未来",
      hide: "欢迎与我交流"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://polyfill.alicdn.com/polyfill.min.js?features=Promise%2CArray.prototype.includes"></script>
<script src="//gcore.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>


  <script data-pjax>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?9ba187659e850a6910681214f0faa16b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</body>
</html>
