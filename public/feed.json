{
    "version": "https://jsonfeed.org/version/1",
    "title": "杜明清的个人博客",
    "subtitle": "👻欢迎一起交流学习👻",
    "icon": "https://dmqweb.cn/images/favicon.ico",
    "description": "",
    "home_page_url": "https://dmqweb.cn",
    "items": [
        {
            "id": "https://dmqweb.cn/2024/04/16/%E4%B8%89%E6%96%B9%E5%8C%85/",
            "url": "https://dmqweb.cn/2024/04/16/%E4%B8%89%E6%96%B9%E5%8C%85/",
            "title": "三方库",
            "date_published": "2024-04-16T08:33:16.000Z",
            "content_html": "<h1 id=\"脚手架开发\"><a class=\"anchor\" href=\"#脚手架开发\">#</a> <strong>脚手架开发</strong></h1>\n<p><strong>常见工具包</strong></p>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY29tbWFuZGVy\">Commander</span></strong></th>\n<th><strong>提供一个连贯的  <code>API</code> ，用于定义  <code>CLI</code>  应用程序的各个方面，如命令、选项、别名和帮助。简化了命令行应用程序的创建。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UveWFyZ3M=\">yargs</span></strong></td>\n<td><strong>脚手架开发框架，通过解析参数和生成优雅的用户界面来帮助您构建交互式命令行工具。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbGVybmE=\">lerna</span></strong></td>\n<td><strong>多 package 管理</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvaW5xdWlyZXI=\">Inquirer</span></strong></td>\n<td><strong>一个易于嵌入且美观的  <code>Node.js</code>  命令行界面。 提供了很棒的查询会话流程。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY2hhbGs=\">Chalk</span></strong></td>\n<td><strong> <code>Chalk</code>  是一个非常简单的库，创建它的目的很简单 —— 给你的终端字符串添加样式。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY29sb3Jz\">colors</span></strong></td>\n<td>打印 <code>不同颜色的log信息</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvb3Jh\">ora</span></strong></td>\n<td>命令行 <code>中高级的</code> 、 <code>功能丰富的高可定制化加载动画</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY2xpLXNwaW5uZXI=\">cli-spinner</span></strong></td>\n<td>命令行中 <code>轻量的符号加载动画</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbnBtbG9n\">npmlog</span></strong></td>\n<td><strong>执行 npm 的日志记录。它支持 <code>自定义级别和彩色输出</code> 。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvaW1wb3J0LWxvY2Fs\">import-local</span></strong></td>\n<td><strong>当与全局冲突的时候，比如全局和本地都有这个脚手架时可以使用， <code>判断使用的是否是本地版本</code> </strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZmluZHVw\">findup</span></strong></td>\n<td><strong> <code>向上查找指定文件</code> </strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcGF0aC1leGlzdHM=\">path-exists</span></strong></td>\n<td><strong> <code>判断文件是否存在</code> </strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZGVidWc=\">Debug</span></strong></td>\n<td><strong>一个很小的  <code>JavaScript</code>  调试实用程序。 只需将一个函数的名称传递给模块，它就会返回一个经过修饰的  <code>console.error</code>  版本，以便你将调试语句传递给该模块</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZnMtZXh0cmE=\">fs-extra</span></strong></td>\n<td>fs 模块的扩展，支持更多文件操作功能</td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvc2VtdmVy\">semver</span></strong></td>\n<td><code>版本比对工具</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZmlnbGV0\">figlet</span></strong></td>\n<td>输出一些独特的大型 <code>ASCII文本横幅</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvdXNlci1ob21l\">user-home</span></strong></td>\n<td>获取 <code>用户主目录</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZG90ZW52\">dotenv</span></strong></td>\n<td>获取 <code>环境变量</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvcm9vdC1jaGVjaw==\">root-check</span></strong></td>\n<td>检查是否是 <code>管理员权限启动并自动降级</code> ，防止后续因普通权限导致无法使用。</td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcGtnLWRpcg==\">pkg-dir</span></strong></td>\n<td>从某个目录开始向上查找，直到找到存在 <code>package.json</code>  的目录，并返回该目录。如果未找到则返回 null</td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbWluaW1pc3Q=\">minimist</span></strong></td>\n<td>用来 <code>解析命令行参数和选项的库</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbnBtaW5zdGFsbA==\">npminstall</span></strong></td>\n<td><code>安装npm上的包</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZG93bmxvYWQtZ2l0LXJlcG8=\">download-git-repo</span></strong></td>\n<td><code>安装git仓库中的包</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZWpz\">ejs</span></strong></td>\n<td><code>xml模板数据动态渲染</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZ2xvYg==\">glob</span></strong></td>\n<td>根据 <code>文件路径进行遍历和匹配文件</code> ，拿到文件的内容。</td>\n</tr>\n</tbody>\n</table>\n<p><strong>底层原理包</strong></p>\n<table>\n<thead>\n<tr>\n<th>readline（node 内置库）</th>\n<th>命令行的输入输出</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>events（node 内置库）</td>\n<td>事件驱动</td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvc3RyZWFt\">stream</span></strong></td>\n<td>输入输出流</td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYW5zaS1lc2NhcGVz\">ansi-escapes</span></strong></td>\n<td>自定义 <code>命令行文字样式</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvcnhqcw==\">rxjs</span></strong></td>\n<td><code>处理异步事件流</code></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYnVzYm95\">busboy</span></strong></td>\n<td><code>多文件上传底层库</code> ，尤其用于流式文件上传。</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"vue\"><a class=\"anchor\" href=\"#vue\">#</a> <strong>Vue</strong></h1>\n<h1 id=\"react\"><a class=\"anchor\" href=\"#react\">#</a> <strong>React</strong></h1>\n<table>\n<thead>\n<tr>\n<th><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvQGV4Y2FsaWRyYXcvZXhjYWxpZHJhdw==\">excalidraw</span></th>\n<th>画板、流程图和思维导图等</th>\n</tr>\n</thead>\n</table>\n<h1 id=\"nodejs\"><a class=\"anchor\" href=\"#nodejs\">#</a> <strong>Node.js</strong></h1>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\"><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZXhwcmVzcw==\">Express</span></strong></th>\n<th style=\"text-align:left\"><strong>轻量级 web 框架</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvQGhhcGkvaGFwaQ==\">Hapi</span></strong></td>\n<td style=\"text-align:left\"><strong>以最小的开销和完全开箱急用的功能构建强大的、拓展性强的应用程序</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvc2FpbHM=\">Sails</span></strong></td>\n<td style=\"text-align:left\"><strong>最流行的 Node.js 的 MVC 框架</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua29hanMubmV0Lw==\">Koa</span></strong></td>\n<td style=\"text-align:left\"><strong>下一代 web 开发框架</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZnMtZXh0cmE=\">Fs-extra</span></strong></td>\n<td style=\"text-align:left\"><strong>fs -extra <code>包含了</code>  Node.js <code> </code> fs <code>包中没有包含的方法，比如</code>  copy () <code>, </code> remove() <code>, </code> mkdirs()</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvbm9kZS1jYWNoZQ==\">Node-cache</span></strong></td>\n<td style=\"text-align:left\"><strong>一个简单的缓存模块，具有设置，获取和删除方法的功能，类似于<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZW1jYWNoZWQub3JnLw==\"> memcached</span>。 key 值可以具有一个超时设置（ttl），在此时间之后它们将过期并从缓存中删除。</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvc2hhcnA=\">sharp</span></strong></td>\n<td style=\"text-align:left\"><code>node图片处理</code> 解决方案</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbG9hZHRlc3Q=\">Loadtest</span></td>\n<td style=\"text-align:left\">node.js <code>压力测试工具</code></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"css\"><a class=\"anchor\" href=\"#css\">#</a> <strong>css</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvdGFpbHdpbmRjc3M=\">Tailwind</span></strong></th>\n<th><strong>原子化 css</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvc3R5bGVkLWNvbXBvbmVudHM=\">Styled-components</span></strong></td>\n<td><strong>css-in-js，js 中书写 css</strong></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"日志\"><a class=\"anchor\" href=\"#日志\">#</a> <strong>日志</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbW9yZ2Fu\">Morgan</span></strong></th>\n<th><strong>具体来说，它是一个  <code>HTTP</code>  请求记录器，存储  <code>HTTP</code>  请求，并为你提供有关应用程序如何使用以及可能存在潜在错误的简要信息。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvd2luc3Rvbg==\">Winston</span></strong></td>\n<td><strong>一个几乎所有内容的日志记录器，支持多种传输方式。它存储的时间比  <code>Morgan</code>  长，它也有一个更大的维护者社区和更多的下载。</strong></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"数据库\"><a class=\"anchor\" href=\"#数据库\">#</a> <strong>数据库</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbW9uZ29vc2U=\">Mongoose</span></strong></th>\n<th><strong> <code>Mongoose</code>  是一个  <code>MongoDB</code>  对象建模工具，设计用于在异步环境中工作。 <code>Mongoose</code>  支持  <code>Promise</code>  和回调。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvc2VxdWVsaXpl\">Sequelize</span></strong></td>\n<td><strong> <code>Sequelize</code>  是一个基于  <code>Promise</code>  的  <code>Node.js</code>   <code>ORM</code>  工具，适用于  <code>Postgres</code> 、MySQL、MariaDB、SQLite 和 Microsoft SQL Server。它具有可靠的事务支持、关系、即时和延迟加载、读取复制等特性。</strong></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"授权\"><a class=\"anchor\" href=\"#授权\">#</a> <strong>授权</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcGFzc3BvcnQ=\">Passport</span></strong></th>\n<th><strong> <code>Passport</code>  的目的是通过一组可扩展的插件 (称为策略) 对请求进行身份验证。向 <code>Passport</code>  提供一个身份验证请求， <code>Passport</code>  提供钩子来控制身份验证成功或失败时发生的操作。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYmNyeXB0\">Bcrypt</span></strong></td>\n<td><strong>它是可以帮助你生成哈希密码的库。 <code>Bcrypt</code>  是由  <code>Niels Provos</code>  和  <code>David Mazieres</code>  基于  <code>Blowfish cipher</code>  设计的密码哈希函数，并于 1999 年在 USENIX 上展出。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvanNvbndlYnRva2Vu\">JSONWebToken</span></strong></td>\n<td><strong> <code>JSON Web</code>  令牌 (JWT) 是一种开放的、行业标准的  <code>RFC 7519</code>  方法，用于在双方之间安全地表示声明。这个包允许你解码、验证和生成 JWT。</strong></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"静态网站生成\"><a class=\"anchor\" href=\"#静态网站生成\">#</a> <strong>静态网站生成</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZ2F0c2J5\">Gatsby</span></strong></th>\n<th><strong>一个现代的网站生成器，可以创建快速，高质量，动态的  <code>React</code>  应用程序，从博客到电子商务网站再到用户仪表板。具有很棒的插件生态系统和模板。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbmV4dA==\">NextJS</span></strong></td>\n<td><strong> <code>NextJS</code>  首先支持服务器渲染以及静态生成的内容。 你还可以将  <code>serverless</code>  功能定义为  <code>API</code>  端点。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbnV4dA==\">NuxtJS</span></strong></td>\n<td><strong>在  <code>Vue</code>  的生态系统中， <code>NuxtJS</code>  基本上是  <code>NextJS</code>  的替代品。 <code>NuxtJS</code>  的目标是让  <code>web</code>  开发功能强大，并且让开发者具有良好的开发意识。</strong></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"模板语法\"><a class=\"anchor\" href=\"#模板语法\">#</a> <strong>模板语法</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbXVzdGFjaGU=\">Mustache</span></strong></th>\n<th><strong> <code>Mustache</code>  是一种无逻辑的模板语法。它可以用于  <code>HTML</code> ，配置文件，源代码等任何东西。它的工作原理是使用 hash 或对象中提供的值在模板中展开标记。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvaGFuZGxlYmFycw==\">Handlebars</span></strong></td>\n<td><strong>使用模板和输入对象生成  <code>HTML</code>  或其他文本格式。 <code>Handlebars</code>  模板看起来像一个嵌入了把手表达式的正则文本。 <code>Handlebars</code>  很大程度上与  <code>Mustache</code>  模板兼容。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZWpz\">EJS</span></strong></td>\n<td><strong> <code>EJS</code>  是一种简单的模板语言，可让你使用简单的语法，快速的执行和简单的调试  <code>JavaScript</code>  来生成  <code>HTML</code>  标记。  <code>EJS</code>  拥有大量的活跃用户社区，并且该库正在积极开发中。</strong></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"mock数据\"><a class=\"anchor\" href=\"#mock数据\">#</a> <strong>mock 数据</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvdXVpZA==\">Uuid</span></strong></th>\n<th><strong>方便而且体积小的包，可以快速、轻松地生成更复杂的通用惟一标识符 (UUIDs)</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZmFrZXI=\">Faker</span></strong></td>\n<td><strong>实用的  <code>npm</code>  包，用于在浏览器和  <code>Node.js</code>  中制造大量假数据。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvanNvbi1zZXJ2ZXI=\">jsonServer</span></strong></td>\n<td><strong>mock 开发服务器数据</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbmFub2lk\">nanoid</span></strong></td>\n<td><code>字符串 ID 生成器</code> ，没有其余依赖。</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"表单和邮件\"><a class=\"anchor\" href=\"#表单和邮件\">#</a> <strong>表单和邮件</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvdmFsaWRhdG9y\">Validator</span></strong></th>\n<th><strong>便捷的字符串验证器，使程序更加健壮的库。许多有用方法，例如  <code>isEmail()</code> ，  <code>isCreditCard()</code> ， <code>isDate()</code>  和  <code>isURL()</code> 。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZm9ybWlr\">Formik</span></strong></td>\n<td><strong> <code>Formik</code>  是  <code>React</code>  和  <code>React Native</code>  的一个流行开源表单库。它具有易于使用、声明性和适应性的特点。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbXVsdGVy\">Multer</span></strong></td>\n<td><strong> <code>Multer</code>  是用于  <code>multipart/form-data</code>  数据格式的  <code>Node.js</code>  中间件，主要用于上传文件。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvbm9kZW1haWxlcg==\">Nodemailer</span></strong></td>\n<td><strong> <code>Nodemailer</code>  是  <code>Node.js</code>  应用程序的一个模块，允许轻松发送电子邮件。这个项目从 2010 年就开始了，现在它是大多数  <code>Node.js</code>  用户默认使用的解决方案。</strong></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"测试\"><a class=\"anchor\" href=\"#测试\">#</a> <strong>测试</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvamVzdA==\">Jest</span></strong></th>\n<th><strong> <code>Jest</code>  是一个令人愉快的  <code>JavaScript</code>  测试框架，专注于简洁明快。它允许你使用易于使用、熟悉且功能丰富的  <code>API</code>  编写测试，从而快速获得结果。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbW9jaGE=\">Mocha</span></strong></td>\n<td><strong> <code>Mocha</code>  是一个  <code>JavaScript</code>  测试框架，使得异步测试简单而有趣。 <code>Mocha</code>  测试是串行运行的，在将未捕获的异常映射到正确的测试用例的同时，允许进行灵活和准确的报告。</strong></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"代码规范\"><a class=\"anchor\" href=\"#代码规范\">#</a> <strong>代码规范</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZXNsaW50\">ESLint</span></strong></th>\n<th><strong> <code>ESLint</code>  是用于识别和报告  <code>ECMAScript / JavaScript</code>  代码中的书写方式的工具。  <code>ESLint</code>  是完全插件化的，每个规则都是一个插件，你可以在运行时添加更多内容。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcHJldHRpZXI=\">Prettier</span></strong></td>\n<td><strong> <code>Prettier</code>  是一种固执己见的代码格式化程序。它通过解析代码并使用自己的规则 (考虑到最大行的长度) 重新打印代码，以及在必要时包装代码，来强制执行一致的样式。</strong></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"打包和压缩\"><a class=\"anchor\" href=\"#打包和压缩\">#</a> <strong>打包和压缩</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvd2VicGFjaw==\">Webpack</span></strong></th>\n<th><strong>一个著名的功能强大的模块打包器。它的主要目的是将  <code>JavaScript</code>  文件打包以便在浏览器中使用，但它也能够转换、捆绑或打包任何资源。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvaHRtbC1taW5pZmllcg==\">HTML-Minifier</span></strong></td>\n<td><strong>轻巧，高度可配置且经过良好测试的基于  <code>Javascript</code>  的  <code>HTML</code>  压缩器 / 压缩器（支持  <code>Node.js</code> ）。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY2xlYW4tY3Nz\">Clean-CSS</span></strong></td>\n<td><strong>适用于  <code>Node.js</code>  平台和任何现代浏览器的快速高效的  <code>CSS</code>  优化器。 具有高度可配置和多种兼容模式。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvdWdsaWZ5LWpz\">UglifyJS2</span></strong></td>\n<td><strong> <code>JavaScript</code>  解析器，压缩程序和美化工具包。 它可以使用多个输入文件，并支持许多配置选项。</strong></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"进程管理\"><a class=\"anchor\" href=\"#进程管理\">#</a> <strong>进程管理</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvbm9kZW1vbg==\">Nodemon</span></strong></th>\n<th><strong>在  <code>Node.js</code>  应用程序的开发过程中使用的简单的监控脚本。对于开发非常有用，因为它非常容易重启，并且默认启用了文件监听</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcG0y\">PM2</span></strong></td>\n<td><strong>带有内置负载均衡的  <code>Node.JS</code>  应用程序的生产进程管理器。 更全面，更适合生产，给你很多参数以进行调整功能</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvY29uY3VycmVudGx5\">Concurrently</span></strong></td>\n<td><strong>简单而直接 —— 这是同时运行多个命令的有用工具。</strong></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"其他\"><a class=\"anchor\" href=\"#其他\">#</a> <strong>其他</strong></h1>\n<table>\n<thead>\n<tr>\n<th><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYXhpb3M=\">Axios</span></strong></th>\n<th><strong>基于  <code>Promise</code>  的  <code>HTTP</code>  客户端，用于浏览器和  <code>Node.js</code> 。 与  <code>JS</code>  内置 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0ZldGNoX0FQSQ==\">Fetch API</span> 相比，它易于设置，直观且简化了很多工作。</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong><a href=\"https//www.npmjs.com/package/socket.io\">Socket.io</a></strong></td>\n<td><strong> <code>Socket.IO</code>  支持实时，双向和基于事件的通信。 它可以在每个平台，浏览器或其他设备上运行，并同时关注可靠性和速度。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2Uvd3M=\">WS</span></strong></td>\n<td><strong>简单易用，快速且经过全面测试的  <code>WebSocket</code>  客户端和服务器实现。 一个很好的，不太抽象的， <code>Socket.io</code>  的替代方案</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZGF5anM=\">DayJS</span></strong></td>\n<td><strong> <code>DayJS</code>  是 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbW9tZW50\">MomentJS</span> （自 2020 年 9 月起处于维护模式）的一种快速、轻巧的替代方案。它们的  <code>API</code>  使用类似，如果你使用过 <code>MomentJS</code> ，则已经知道如何使用大多数  <code>DayJS</code> 。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbG9kYXNo\">Lodash</span></strong></td>\n<td><strong>现代化的  <code>JavaScript</code>  实用程序库，提供模块化，高性能以及其他功能。 公开关于  <code>JavaScript</code>  数组，对象和其他数据结构的许多有用方法。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvdW5kZXJzY29yZQ==\">Underscore</span></strong></td>\n<td><strong> <code>Underscore</code>  提供了许多常用的功能工具以及更专业的工具：函数绑定， <code>javascript</code>  模板，创建快速索引，深度相等测试等。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYXN5bmM=\">Async</span></strong></td>\n<td><strong> <code>Async</code>  是一个实用模块，它为异步  <code>JavaScript</code>  提供了直接、强大的功能。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbWFya2Vk\">Marked</span></strong></td>\n<td><strong>用于解析  <code>markdown</code>  而不需要缓存或长时间阻塞的低级编译器。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcmFuZG9tY29sb3I=\">Randomcolor</span></strong></td>\n<td><strong>一个用于生成有吸引力的随机颜色的小脚本。 你可以传递选项对象从而决定其产生的颜色类型。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvcGx1cmFsaXpl\">Pluralize</span></strong></td>\n<td><strong>该模块使用预先定义的规则列表，按顺序应用这些规则给指定单词单数或复数。 在许多情况下这很有用，例如基于用户输入的任何自动化。</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvZGVkZW50\">dedent</span></strong></td>\n<td><strong>从多行字符串中去除缩进（空格）</strong></td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbXM=\">ms</span></strong></td>\n<td>将易理解的时间转换为毫秒数。</td>\n</tr>\n<tr>\n<td><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvaG90a2V5cy1qcw==\">hotkeys-js</span></strong></td>\n<td><code>键盘事件</code> 使用库。</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "三方库",
                "三方库"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/04/16/%E5%89%8D%E7%AB%AF%E5%8F%91%E5%B8%83/",
            "url": "https://dmqweb.cn/2024/04/16/%E5%89%8D%E7%AB%AF%E5%8F%91%E5%B8%83/",
            "title": "前端发布",
            "date_published": "2024-04-16T04:44:33.000Z",
            "content_html": "<h1 id=\"发布体系\"><a class=\"anchor\" href=\"#发布体系\">#</a> 发布体系</h1>\n<p><strong>利用脚手架统一管理发布阶段</strong></p>\n<p><strong>利用脚手架做发布的优势</strong></p>\n<ul>\n<li>规范：利用统一发布规范，如 commiti 记录、分支名称、代码规范等</li>\n<li>效率：避免大量重复操作，浪费开发时间</li>\n<li>安全：构建和发布全部在云端操作，避免个人发布时带来的安全隐患</li>\n</ul>\n<p><strong>脚手架发布的流程？</strong></p>\n<ul>\n<li>GitF1low 自动化代码提交</li>\n<li>远程代码自动检查</li>\n<li>云端完成构建与发布操作</li>\n</ul>\n<h1 id=\"在此存档未完待续\"><a class=\"anchor\" href=\"#在此存档未完待续\">#</a> 在此存档，未完待续....</h1>\n",
            "tags": [
                "前端发布",
                "前端发布"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/04/16/%E5%89%8D%E7%AB%AF%E7%9B%91%E6%8E%A7/",
            "url": "https://dmqweb.cn/2024/04/16/%E5%89%8D%E7%AB%AF%E7%9B%91%E6%8E%A7/",
            "title": "前端监控",
            "date_published": "2024-04-16T04:36:51.000Z",
            "content_html": "<h1 id=\"为何要前端监控\"><a class=\"anchor\" href=\"#为何要前端监控\">#</a> 为何要前端监控？</h1>\n<p><strong>前端监控的数据有什么作用</strong></p>\n<ul>\n<li>流量数据监控，如：PV、UV、点击率、页面停留时长等</li>\n<li>自定义事件监控，如：曝光事件、滑动事件、请求事件等</li>\n<li>交易指标监控，如：成交额、转化率等</li>\n<li>其他综合分析，如：用户画像分析、流量漏斗、销量预测等</li>\n</ul>\n<p><strong>前端监控的三个阶段</strong></p>\n<ul>\n<li>初阶：使用第三方平台，百度、友盟、阿里云 ARMS 等</li>\n<li>中阶：自研前端监控库，缺乏完整的监控体系</li>\n<li>高阶：自研前端监控平台，具备完整的监控体系</li>\n</ul>\n<h1 id=\"在此存档未完待续\"><a class=\"anchor\" href=\"#在此存档未完待续\">#</a> 在此存档，未完待续....</h1>\n",
            "tags": [
                "前端监控",
                "前端监控"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/04/12/vue-router/",
            "url": "https://dmqweb.cn/2024/04/12/vue-router/",
            "title": "vue-router",
            "date_published": "2024-04-12T07:01:09.000Z",
            "content_html": "<h1 id=\"\"><a class=\"anchor\" href=\"#\">#</a> </h1>\n<h1 id=\"vue-router源码\"><a class=\"anchor\" href=\"#vue-router源码\">#</a> vue-router 源码</h1>\n<h3 id=\"vue-router路由模式\"><a class=\"anchor\" href=\"#vue-router路由模式\">#</a> vue-router 路由模式</h3>\n<h4 id=\"hash模式\"><a class=\"anchor\" href=\"#hash模式\">#</a> hash 模式（#）</h4>\n<p>SEO 不友好，资源不变，不会刷新。</p>\n<h4 id=\"history模式\"><a class=\"anchor\" href=\"#history模式\">#</a> history 模式（/）</h4>\n<p>SEO 友好，重新请求资源。</p>\n<p><strong>history 模式发布时出现的问题：</strong></p>\n<p>发布到服务器上时，点击路由跳转正常但是刷新后路由跳转 404，出现的原因刷新后跳转的根路径并不是当前项目的 index.html 导致资源路径不匹配单页面应用路由，采取的方法是<strong>每次请求资源都 fallback 到 index.html 文件</strong>，可以使用静态资源服务器的支持。（例如在 nginx 中 location 字段添加：<strong>try_files 字段</strong>）</p>\n<h3 id=\"vue-router内部处理\"><a class=\"anchor\" href=\"#vue-router内部处理\">#</a> vue-router 内部处理</h3>\n<h6 id=\"vue-router主体架构\"><a class=\"anchor\" href=\"#vue-router主体架构\">#</a> vue-router 主体架构：</h6>\n<p>当使用 vue.use (vue-router) 时，会执行 vue-router 导出的实例中的 install 方法，将 app 作为参数传入，内部会用 app.component 注册两个全局组件 RouterLink 和 RouterView，接着在 app.config.globalProperties 上设置<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mi>o</mi><mi>u</mi><mi>t</mi><mi>e</mi><mtext>和</mtext></mrow><annotation encoding=\"application/x-tex\">route和</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">e</span><span class=\"mord cjk_fallback\">和</span></span></span></span> router 属性，通过 app.provide 将 router 和 currentRoute 传递下去。</p>\n<h6 id=\"路由变化但不跳转原理\"><a class=\"anchor\" href=\"#路由变化但不跳转原理\">#</a> 路由变化但不跳转原理：</h6>\n<p>history.pushState 和 history.replaceState 方法，会改变地址栏的但不进行跳转。</p>\n<h6 id=\"history模式实现路由匹配\"><a class=\"anchor\" href=\"#history模式实现路由匹配\">#</a> history 模式实现路由匹配：</h6>\n<p>内部的 mather 函数会将 routes 中的 path 路径转为正则表达式，与当前的路由进行匹配，匹配成功就将对应的组件添加到 router-view 中。</p>\n<h6 id=\"router-view实现路由展示\"><a class=\"anchor\" href=\"#router-view实现路由展示\">#</a> router-view 实现路由展示：</h6>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> defineComponent <span class=\"token punctuation\">&#125;</span> from vue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> Home <span class=\"token keyword\">from</span> <span class=\"token string\">'../views/Home'</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 导入默认的全部组件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> routerView <span class=\"token operator\">=</span>  <span class=\"token function\">defineComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">\"routerView\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props <span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> slots <span class=\"token punctuation\">&#125;</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">//return h ('div',&#123;        // 不使用组件默认的方式</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">//     class:'routerViewClass',</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">//     onClick()&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">//         // 处理点击 逻辑</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\">//     &#125;,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token comment\">// &#125;,slots.default())</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token function\">h</span><span class=\"token punctuation\">(</span>Home<span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token function\">onClick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token comment\">// 处理对应的逻辑</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> routerView<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>路由 provide 一个 currentRoute（shallowRef 对象）将当前的路由路径捆绑在一起，传递下去，当 currentRoute 发生变化的时候就会改变相应的 router-view。</p>\n",
            "tags": [
                "vue-router原理",
                "vue-router原理"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/04/12/%E8%84%9A%E6%89%8B%E6%9E%B6/",
            "url": "https://dmqweb.cn/2024/04/12/%E8%84%9A%E6%89%8B%E6%9E%B6/",
            "title": "脚手架开发",
            "date_published": "2024-04-12T00:36:07.000Z",
            "content_html": "<h1 id=\"需求分析\"><a class=\"anchor\" href=\"#需求分析\">#</a> 需求分析</h1>\n<p><strong>为什么需要优化研发流程？</strong></p>\n<ul>\n<li>项目量级增加：几干行代码 -&gt; 几万行代码</li>\n<li>项目数量扩大：几个项目 -&gt; 几干个项目</li>\n<li>项目复杂度高：Wb 项目 -&gt;H5/PC/ 小程序 / 后端 / 脚手架</li>\n<li>团队人数增长：几个人 -&gt; 几百人</li>\n<li>传统的项目研发流程已经无法满足业务需求</li>\n</ul>\n<p><strong>项目创建流程思考</strong></p>\n<p>当团队较大时，让每一个团队成员开发创建项目体验趋于一致就非常重要。</p>\n<p><strong>项目创建流程</strong></p>\n<ul>\n<li>项目代码</li>\n<li>抽象出项目模板</li>\n<li>存储到数据库</li>\n<li>脚手架读取数据库</li>\n<li>根据脚手架创建新的项目</li>\n</ul>\n<p><strong>提升前端研发效率的手段</strong></p>\n<ul>\n<li>物料和模板</li>\n<li>低代码搭建</li>\n<li>等等</li>\n</ul>\n<p>从使用角度理解什么是脚手架？</p>\n<h1 id=\"脚手架简介\"><a class=\"anchor\" href=\"#脚手架简介\">#</a> 脚手架简介</h1>\n<p>脚手架本质是一个操作系统的客户端，它通过命令行执行，比如：</p>\n<p>vue create vue-test-app</p>\n<p>bash</p>\n<p>上面这条命令由 3 个部分组成：</p>\n<ul>\n<li>主命令：vue</li>\n<li>command:create</li>\n<li>command 的 param:vue-test-app</li>\n</ul>\n<p>它表示创建一个 vue 项目，项目的名称为 vue-test-app, 以上是最一个较为简单的脚手架命令，但实际场易<br />\n往更加复杂，比如：<br />\n当前目录已经有文件了，我们需要覆盖当前目录下的文件，强制进行安装 ue 项目，此时我们就可以输入：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>vue create vue-test-app <span class=\"token parameter variable\">--force</span></pre></td></tr></table></figure><p>这里的 - force 叫做 option, 用来辅助脚手架确认在特定场景下用户的选择（可以理解为配置）。还有一种场景<br />\n通过 vue create<br />\n 创建项目时，会自动执行 npm install 帮用户安装依赖，如果我们希望使用淘宝源来安装，<br />\n可以输入命令：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>vue create vue-test-app <span class=\"token parameter variable\">--force</span> <span class=\"token parameter variable\">-r</span> https://registry.npm.taobao.org</pre></td></tr></table></figure><p>这里的 - x 也叫做 option, 它与 --force 不同的是它使用 -，并且使用简写，这里的 - x 也可以替换成 --registry, 有的同学可能要问，为什么老师知道这个命令，其实我们输入下面的命令就可以看到 vue create 支持的所有 options:<br />\nvue create  --help</p>\n<p>-r  https:/registry.npm.taobao.org 后面的 https://registry.npm.taobao.org 成为 option 的 param, 其实任 - force 可以理解为：-force true,f 简写为：--force 或 - f</p>\n<h1 id=\"脚手架原理\"><a class=\"anchor\" href=\"#脚手架原理\">#</a> 脚手架原理</h1>\n<p><strong>脚手架的执行原理如下：</strong></p>\n<ul>\n<li>在终端输入 vue create vue-test-app</li>\n<li>终端解析出 vue 命令</li>\n<li>终端在环境变量中找到 ue 命令</li>\n<li>终端根据 vue 命令链接到实际文件 vue.js</li>\n<li>终端利用 node 执行 `ue.js</li>\n<li>vue.js 解析 command/options</li>\n<li>vue.js 执行 command</li>\n<li>执行完毕，退出执行</li>\n</ul>\n<p><strong>从应用的角度看如何开发一个脚手架</strong></p>\n<p>这里以 vue-cli 为例：</p>\n<ul>\n<li>开发 npm 项目，该项目中应包含一个 bin/vue.js 文件，并将这个项目发布到 npm</li>\n<li>将 npm 项目安装到 node 的 lib/node_modules</li>\n<li>在 node 的 bin 目录下配置 vue 软链接指向 lib/node modules/Qvue/cli/bin/vue.js</li>\n<li>这样我们在执行 vue 命令的时候就可以找到 vue.js 进行执行</li>\n</ul>\n<p><strong>还有很多疑问需要解答</strong></p>\n<ul>\n<li>\n<p>为什么全局安装 vue/cli 后会添加的命令为 vue?  （npm install -g @vue/cli）</p>\n</li>\n<li>\n<p>答：vue/cli 项目的 package.json 中的 bin 字段配置的名称为 vue。</p>\n</li>\n<li>\n<p>全局安装 vue/c1i 时发生了什么？</p>\n</li>\n<li>\n<p>答：全局 node_modules 中下载项目文件，并根据项目 package.json 中的 bin 字段配置可执行文件软链接。</p>\n</li>\n<li>\n<p>为什么 vue 指向一个 js 文件，我们却可以直接通过 vue 命令直接去执行它？</p>\n</li>\n<li>\n<p>答：js 文件配置了蛇棒（操作系统的接口），例如：</p>\n</li>\n<li>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token hashbang comment\">#!/usr/bin/env node</span></pre></td></tr></table></figure><p>通常使用环境变量中找 node 命令，因为每个电脑上的 node 文件位置不同，但是环境变量中都会有 node 软连接。</p>\n</li>\n</ul>\n<h1 id=\"脚手架的开发流程\"><a class=\"anchor\" href=\"#脚手架的开发流程\">#</a> 脚手架的开发流程</h1>\n<p><strong>脚手架开发流程详解</strong></p>\n<p>开发流程</p>\n<ul>\n<li>创建 npm 项目</li>\n<li>创建脚手架入口文件，最上方添加 #!/usr/bin/env node</li>\n<li>配置 package.json, 添加 bin 属性</li>\n<li>编写脚手架代码</li>\n<li>将脚手架发布到 npm</li>\n</ul>\n<p><strong>使用流程</strong></p>\n<ul>\n<li>\n<p>安装脚手架</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-g</span> your-own-cli</pre></td></tr></table></figure></li>\n<li>\n<p>使用脚手架</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>your-own-cli-binName</pre></td></tr></table></figure></li>\n</ul>\n<p><strong>脚手架开发难点解析</strong></p>\n<ul>\n<li>\n<p>分包：将复杂的系统拆分成若干个模块</p>\n</li>\n<li>\n<p>命令注册：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>- vue create</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>- vue <span class=\"token function\">add</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>- vue invoke</pre></td></tr></table></figure></li>\n<li>\n<p>参数解析：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>vue <span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">[</span>options <span class=\"token operator\">&lt;</span>params<span class=\"token operator\">></span></pre></td></tr></table></figure></li>\n<li>\n<p>options: 全称：--version、--help。简写为：-v   -h</p>\n</li>\n<li>\n<p>帮助文档：global help</p>\n</li>\n<li>\n<p>命令行交互</p>\n</li>\n<li>\n<p>日志打印</p>\n</li>\n<li>\n<p>命令行文字变色</p>\n</li>\n<li>\n<p>网络通信</p>\n</li>\n<li>\n<p>文件处理</p>\n</li>\n</ul>\n<h1 id=\"开发细节\"><a class=\"anchor\" href=\"#开发细节\">#</a> 开发细节</h1>\n<p><strong>两种链接本地文件的方式</strong></p>\n<ul>\n<li>\n<p>npm  link 命令会将命令执行的当前文件夹根据 bin 字段软连接到全局的 node_moduls。</p>\n</li>\n<li>\n<p>npm link 包名称 ，这个命令会将全局包添加软连接到当前项目的 node_modules 中。</p>\n</li>\n<li>\n<p>npm unlink 包名称 ，这个命令用于移除全局 node_modules 中指定的软连接。（不过这个命令不好用，建议使用 <code>npm uninstall -g </code> 包名称、或者 <code>npm remove -g </code> 包名称  代替）</p>\n</li>\n<li>\n<p>调试过程中，当本地包相互依赖时，可以使用 File: 路径进行指向。</p>\n<p><strong>两种方式的区别</strong></p>\n</li>\n</ul>\n<p>npm  link 的方式创建的软连接可以实时同步更改的文件，但是项目文件多了就不方便管理、很复杂，File 路径不能实时同步文件修改，需要执行 npm install，但是管理方便。</p>\n<h1 id=\"脚手架发布流程\"><a class=\"anchor\" href=\"#脚手架发布流程\">#</a> 脚手架发布流程</h1>\n<ul>\n<li>检查 package.json 中 name 和 bin 字段，name 字段不能和已存在的线上包名重复，</li>\n<li>检查版本号，是否需要更新</li>\n<li>npm login</li>\n<li>npm publish</li>\n</ul>\n<h1 id=\"npm新特性workspace\"><a class=\"anchor\" href=\"#npm新特性workspace\">#</a> npm 新特性：workspace</h1>\n<p><strong>作用</strong></p>\n<p>本地调试时，需要多次执行 npm  link，node15 版本推出 workspace，workspace 新特性可以帮助我们进行多 package 包管理，可以让多个 npm 包在同一个项目中进行开发和管理：</p>\n<ul>\n<li>将子包中所有的依赖包都提升到根目录进行安装，提升包的安装速度</li>\n<li>初始化 (npm install) 后自动将子包之间的依赖进行关联</li>\n<li>各个子包共享一些流程（eslint、githook、publish flow 等等）</li>\n</ul>\n<h1 id=\"lerna多package管理\"><a class=\"anchor\" href=\"#lerna多package管理\">#</a> Lerna 多 package 管理</h1>\n<h3 id=\"lerna简介\"><a class=\"anchor\" href=\"#lerna简介\">#</a> Lerna 简介</h3>\n<p><strong>原生脚手架开发痛点分析</strong>（Lerna 解决了哪些问题： ）</p>\n<p><strong>痛点一：重复操作</strong></p>\n<ul>\n<li>多 Package 本地 link</li>\n<li>多 Package 依赖安装</li>\n<li>多 Package. 单元测试</li>\n<li>多 Package 代码提交</li>\n<li>多 Package 代码发布</li>\n</ul>\n<p><strong>痛点二：版本一致性</strong></p>\n<ul>\n<li>发布时版本一致性</li>\n<li>发布后相互依赖板本升级</li>\n<li>package 越多，管理复杂度越高</li>\n</ul>\n<p><strong>简介：</strong></p>\n<p>Lerna 是一个优化基于 git+npm 的多 package 项目的管理工具。</p>\n<p><strong>优势：</strong></p>\n<ul>\n<li>大幅减少重复操作</li>\n<li>提升操作的标准化</li>\n</ul>\n<p>Lera 是架构优化的产物，它揭示了一个架构真理：项目复杂度提升后，就需要对项目进行架构优化。优化的主要目标往往都是以效能为核心。</p>\n<h3 id=\"lerna使用\"><a class=\"anchor\" href=\"#lerna使用\">#</a> Lerna 使用</h3>\n<p><strong>Lerna 开发脚手架流程如下：</strong></p>\n<ul>\n<li>\n<p>npm 上创建 group</p>\n</li>\n<li>\n<p>初始化 npm 项目</p>\n</li>\n<li>\n<p>安装 lerna</p>\n</li>\n<li>\n<p>package.json 中配置 workspaces</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"workspaces\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">\"packages/*\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//workspaces 字段允许指定一个或多个目录作为工作区。一、可以在父级目录的 package.json 中管理他们的依赖，从而较少体积。二、工作区每个包之间直接相互引用，有助于提高开发效率。三、工作区所有包共享版本控制历史。</span></pre></td></tr></table></figure></li>\n<li>\n<p>lerna init 初始化项目（创建了 git）</p>\n</li>\n<li>\n<p>配置 gitignore 排除不需要提交的文件</p>\n</li>\n<li>\n<p>--------------------------- 初始化完成</p>\n</li>\n<li>\n<p>lerna create 创建 package</p>\n</li>\n<li>\n<p>lerna add 安装依赖（最新版废弃），使用 npm install &lt;dependency&gt; --workspace  &lt;workspace &gt; 代替。</p>\n</li>\n<li>\n<p>lerna link 链接依赖（最新版废弃），workspace 自动链接。</p>\n</li>\n<li>\n<p>---------------------------- 项目创建完成</p>\n</li>\n<li>\n<p>lerna exec 执行 shell 脚本</p>\n</li>\n<li>\n<p>lerna run 执行 npm 命令</p>\n</li>\n<li>\n<p>lerna clean 清空依赖</p>\n</li>\n<li>\n<p>lerna bootstrap 重装依赖（最新版废弃），使用 npm install 代替</p>\n</li>\n<li>\n<p>---------------------------- 项目开发完成</p>\n</li>\n<li>\n<p>git push 提交到远程仓库</p>\n</li>\n<li>\n<p>lerna version 升级版本号</p>\n</li>\n<li>\n<p>lerna changed 查看上版本以来全部的变更。</p>\n</li>\n<li>\n<p>git add . 添加到 git 工作区</p>\n</li>\n<li>\n<p>lerna diff 查看 diff</p>\n</li>\n<li>\n<p>lerna publish 进行项目发布</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 默认是私有仓库，需要在 package.json 中进行配置：</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token property\">\"publishConfig\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token property\">\"access\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"public\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>---------------------------- 项目发布完成</p>\n</li>\n</ul>\n<p>这里注意 npm 最新版 workspace 特性的推广导致 lerna 许多命令在最新版被废弃。</p>\n<h3 id=\"lerna学习收获\"><a class=\"anchor\" href=\"#lerna学习收获\">#</a> Lerna 学习收获</h3>\n<ul>\n<li>熟悉 Yargs 脚手架开发框架</li>\n<li>熟悉多 Package 管理工具 Lerna 的使用方法和实现原理</li>\n<li>深入理解 Node.js 模块路径解析流程</li>\n</ul>\n<h4 id=\"一-yargs\"><a class=\"anchor\" href=\"#一-yargs\">#</a> <strong>一、yargs</strong></h4>\n<p><strong>脚手架构成</strong></p>\n<ul>\n<li>\n<p>bin:package,json 中配置 bin 属性，npm link 本地安装</p>\n</li>\n<li>\n<p>command: 命令</p>\n</li>\n<li>\n<p>options: 参数 (boolean/string/number)</p>\n</li>\n<li>\n<p>文件顶部增加  #！/usr/bin/env node</p>\n</li>\n</ul>\n<p><strong>脚手架初始化流程</strong></p>\n<ul>\n<li>\n<p>构造函数：Yargs (0</p>\n</li>\n<li>\n<p>常用方法：</p>\n</li>\n</ul>\n<ol>\n<li>\n<p>Yargs.options</p>\n</li>\n<li>\n<p>Yargs.option</p>\n</li>\n<li>\n<p>Yargs.group</p>\n</li>\n<li>\n<p>Yargs.demandCommand</p>\n</li>\n<li>\n<p>Yargs.recommendCommands</p>\n</li>\n<li>\n<p>Yargs.strict</p>\n</li>\n<li>\n<p>Yargs.fail</p>\n</li>\n<li>\n<p>Yargs.alias</p>\n</li>\n<li>\n<p>Yargs.wrap</p>\n</li>\n<li>\n<p>Yargs.epilogue</p>\n</li>\n</ol>\n<ul>\n<li>脚手架参数解析</li>\n</ul>\n<ol>\n<li>hideBin(process.argv)/Yargs.argv</li>\n<li>Yargs.parse(argv,options)</li>\n</ol>\n<ul>\n<li>命令注册方法</li>\n</ul>\n<ol>\n<li>Yargs.command(command,describe,builder,handler)</li>\n<li>Yargs.command({command,describe,builder,handler )</li>\n</ol>\n<h4 id=\"二-lerna实现原理\"><a class=\"anchor\" href=\"#二-lerna实现原理\">#</a> <strong>二、Lerna 实现原理</strong></h4>\n<p>Lerna 是基于 git+npm 的多 package 项目管理工具</p>\n<p><strong>实现原理：</strong></p>\n<ul>\n<li>通过 import-local 优先调用本地 lerna 命令</li>\n<li>通过 Yargs 生成脚手架，先注册全局属性，再注册命令，最后通过 parse 方法解析参数</li>\n<li>lerna 命令注册时需要传入 builder 和 handler 两个方法，builder 方法用于注册命令专属的 options</li>\n<li>handler 用来处理命令的业务逻辑</li>\n<li>lerna 通过配置 npm 本地依赖的方式来进行本地开发，具体写法是在 package.json 的依赖中写入：file:your-local--module-path, 在 lerna publish 时会自动将该路径替换</li>\n</ul>\n<h4 id=\"三-nodejs模块路径解析流程\"><a class=\"anchor\" href=\"#三-nodejs模块路径解析流程\">#</a> 三、Node.js 模块路径解析流程</h4>\n<ul>\n<li>\n<p>Node.js 项目模块路径解析是通过 require.resolve 方法来实现的</p>\n</li>\n<li>\n<p>require,resolve 就是通过 Module.reso1 veFileName 方法实现的</p>\n</li>\n<li>\n<p>require,resolve 实现原理：<strong>Module,resolveFileName 方法核心流程有 3 点：</strong></p>\n<ol>\n<li>\n<p>判断是否为内置模块</p>\n</li>\n<li>\n<p>通过 Module,resolveLookupPaths 方法生成 node_modules 可能存在的路径</p>\n</li>\n<li>\n<p>通过 Module,findPath 查询模块的真实路径</p>\n</li>\n</ol>\n<p><strong>Module,findPath 核心流程有 4 点：</strong></p>\n<ol>\n<li>\n<p>查询缓存（将 request 和 paths 通过 \\xoo 合并成 cacheKey)</p>\n</li>\n<li>\n<p>遍历 paths, 将 path 与 request 组成文件路径 basePath</p>\n</li>\n<li>\n<p>如果 basePath 存在则调用 fs,realPathSync 获取文件真实路径</p>\n</li>\n<li>\n<p>将文件真实路径缓存到 Module.pathCache (key 就是前面生成的 cacheKey)</p>\n</li>\n</ol>\n<p><strong>fs.realPathSync 核心流程有 3 点：</strong></p>\n</li>\n</ul>\n<ol>\n<li>\n<p>查询缓存（缓存的 key 为 p, 即 Module.findPath 中生成的文件路径）】</p>\n</li>\n<li>\n<p>从左往右遍历路径字符串，查询到 / 时，拆分路径，判断该路径是否为软链接，如果是软链接则查询真实链接，并生成新路径 P, 然后继续往后遍历，这里有 1 个细节需要特别注意：</p>\n<p>遍历过程中生成的子路径 base 会缓存在 knownHard 和 cache 中，避免重复查询</p>\n</li>\n<li>\n<p>遍历完成得到模块对应的真实路径，此时会将原始路径 original 作为 key, 真实路径作为 value, 保存到缓存中</p>\n</li>\n</ol>\n<ul>\n<li>\n<p>require.resolve,paths 等价于 Module.resolveLookupPaths，, 该方法用于获取所有 node_modules 可能存在的路径</p>\n</li>\n<li>\n<p>require.resolve,paths 实现原理：<br />\n如果路径为 /（根目录），直接返回【'/node modules'】否则，将路径字符串从后往前遍历，查询到 / 时，拆分路径，在后面加上 node_modules, 并传入一个 paths 数组，直至查询不到 / 后返回 paths 数组</p>\n</li>\n</ul>\n<h1 id=\"yargs\"><a class=\"anchor\" href=\"#yargs\">#</a> yargs</h1>\n<p><strong>yargs 使用简要介绍：</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token hashbang comment\">#! /usr/bin/env node</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 获得 yargs 构造实例</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> yargs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'yargs/yargs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 参数解析函数</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> hideBin <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'yargs/helpers'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">const</span> arg <span class=\"token operator\">=</span> <span class=\"token function\">hideBin</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">const</span> cli <span class=\"token operator\">=</span> <span class=\"token function\">yargs</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 配置命令：</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>cli</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">usage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Usage: $0 [command] &lt;options>'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 使用说明，$0 表示命令</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">demandCommand</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">'A command is required,pass --help to see info'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 最少一个次命令</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">strict</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 对于未知的命令行参数进行提示输出。</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">recommendCommands</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 查找提示近似命令</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">alias</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'help'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//options 别名</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">alias</span><span class=\"token punctuation\">(</span><span class=\"token string\">'v'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'version'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span>cli<span class=\"token punctuation\">.</span><span class=\"token function\">terminalWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 命令行输出宽度</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">epilog</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">welcomn use cli-core</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 结语</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">options</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// 注册多个 options 选项</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token literal-property property\">debug</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span><span class=\"token string\">\"boolean\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token literal-property property\">describe</span><span class=\"token operator\">:</span> <span class=\"token string\">\"bootstrap debug mode\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token literal-property property\">alias</span><span class=\"token operator\">:</span> <span class=\"token string\">\"d\"</span> <span class=\"token comment\">// 添加别名</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">option</span><span class=\"token punctuation\">(</span><span class=\"token string\">'registry'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// 添加单个选项</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token literal-property property\">hidden</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 不对外暴露命令</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span><span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token literal-property property\">describe</span><span class=\"token operator\">:</span><span class=\"token string\">\"define global registry\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token literal-property property\">alias</span><span class=\"token operator\">:</span><span class=\"token string\">'r'</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">group</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'debug'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Dev Options'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 对 Options 选项进行分类</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">group</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'registry'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"Extra Options\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">command</span><span class=\"token punctuation\">(</span><span class=\"token string\">'init [name]'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'init a project'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">yargs</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// 注册次命令，制定对应 options</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    yargs</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">option</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token literal-property property\">describe</span><span class=\"token operator\">:</span> <span class=\"token string\">'Name of a project'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token literal-property property\">alias</span><span class=\"token operator\">:</span> <span class=\"token string\">'n'</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">argv</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">command</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>    <span class=\"token comment\">// 第二种注册命令的方法（更加精细）</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token literal-property property\">command</span><span class=\"token operator\">:</span> <span class=\"token string\">'list'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token literal-property property\">aliases</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'ls'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'la'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'ll'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token literal-property property\">describe</span><span class=\"token operator\">:</span> <span class=\"token string\">'List local packages'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token function-variable function\">builder</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">yargs</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token comment\">//.... 操作</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token function-variable function\">handler</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">argv</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>argv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">;</span> <span class=\"token comment\">// 使用参数</span></pre></td></tr></table></figure><h1 id=\"commander\"><a class=\"anchor\" href=\"#commander\">#</a> commander</h1>\n<p><strong>commander 简单单例模式</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token hashbang comment\">#! /usr/bin/env node</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> commander <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'commander'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> pkg <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../package.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> program <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> commander<span class=\"token punctuation\">;</span> <span class=\"token comment\">//commander 单例，包含已注册好的基础命令</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>program</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">version</span><span class=\"token punctuation\">(</span>pkg<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><strong>commander 强大功能</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token hashbang comment\">#! /usr/bin/env node</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> commander <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'commander'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> pkg <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../package.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> program <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">commander<span class=\"token punctuation\">.</span>Command</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 手动实例化一个 commander 实例</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>program</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>pkg<span class=\"token punctuation\">.</span>bin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">usage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;command> [options]'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 使用说明</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">version</span><span class=\"token punctuation\">(</span>pkg<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 版本</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">option</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-d,--debug'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'是否开启调试模式'</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 配置 option 选项：选项，帮助信息，默认值</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">option</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-e,--envName &lt;envName>'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'获取变量名称'</span><span class=\"token punctuation\">)</span><span class=\"token comment\">//option 获得传参</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 解析参数</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 使用 command 注册命令</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">const</span> clone <span class=\"token operator\">=</span> program<span class=\"token punctuation\">.</span><span class=\"token function\">command</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clone &lt;source> [destination]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//&lt; 必选项 >，[可选项]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>clone</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string\">'clone a repository'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">option</span><span class=\"token punctuation\">(</span><span class=\"token string\">'-f,--force'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'是否强制克隆'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">source<span class=\"token punctuation\">,</span>destination<span class=\"token punctuation\">,</span>cmdObj</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'do clone'</span><span class=\"token punctuation\">,</span>source<span class=\"token punctuation\">,</span>destination<span class=\"token punctuation\">,</span>cmdObj<span class=\"token punctuation\">.</span>force<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// 使用 addCommand 注册子命令</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">const</span> service <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">commander<span class=\"token punctuation\">.</span>Command</span><span class=\"token punctuation\">(</span><span class=\"token string\">'service'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>service</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">command</span><span class=\"token punctuation\">(</span><span class=\"token string\">'start [port]'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string\">'start service at port'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">port</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'do service start'</span><span class=\"token punctuation\">,</span>port<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>service</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">command</span><span class=\"token punctuation\">(</span><span class=\"token string\">'stop'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string\">'stop service'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'stop service'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>program<span class=\"token punctuation\">.</span><span class=\"token function\">addCommand</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">// 参数解释和自动匹配功能</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>program</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">arguments</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;cmd> [options]'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 强制传入命令</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">description</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test command'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// 描述</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token literal-property property\">cmd</span><span class=\"token operator\">:</span> <span class=\"token string\">'命令'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token string\">'参数'</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cmd<span class=\"token punctuation\">,</span>options</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// 匹配全部命令</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>cmd<span class=\"token punctuation\">,</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">// 默认命令与命令转向功能</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>program</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">command</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install [name]'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'install package'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token literal-property property\">executableFile</span><span class=\"token operator\">:</span> <span class=\"token string\">'imooc-cli'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 将 install [name] 命令转向 imooc-cli</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token literal-property property\">isDefault</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 设置为默认命令</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token literal-property property\">hidden</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 命令不可见</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token punctuation\">.</span><span class=\"token function\">alias</span><span class=\"token punctuation\">(</span><span class=\"token string\">'i'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">// 高级定制 1：自定义 help 信息</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>program<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">helpInformation</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>program<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'--help'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my help information'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token comment\">// 高级定制 2：监听 debug</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>program<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'option:debug'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>program<span class=\"token punctuation\">.</span>debug<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">LOG_LEVEL</span> <span class=\"token operator\">=</span> <span class=\"token string\">'verbose'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">LOG_LEVEL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token comment\">// 高级定制 3：监听未知命令（与默认命令冲突）</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>program<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'command:*'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">obj</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'未知命令:'</span><span class=\"token operator\">+</span> obj<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token keyword\">const</span> avaliableCommands <span class=\"token operator\">=</span> program<span class=\"token punctuation\">.</span>commands<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cmd</span><span class=\"token operator\">=></span>cmd<span class=\"token punctuation\">.</span><span class=\"token function\">name</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'可用命令：'</span><span class=\"token operator\">+</span>avaliableCommands<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token comment\">// 最后要进行参数解析！</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>program<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token comment\">// 内置属性和方法</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>program<span class=\"token punctuation\">.</span>debug<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>program<span class=\"token punctuation\">.</span>envName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>program<span class=\"token punctuation\">.</span><span class=\"token function\">outputHelp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 内置方法，弹出帮助信息</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>program<span class=\"token punctuation\">.</span><span class=\"token function\">opts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 内置方法，返回 options 信息</span></pre></td></tr></table></figure><h1 id=\"require加载机制\"><a class=\"anchor\" href=\"#require加载机制\">#</a> require 加载机制</h1>\n<p><strong>require 直接加载.js、.json 和.node 文件，其余文件按照 js 语法进行加载</strong></p>\n<ol>\n<li>加载 js 文件，require 加载的 js 文件需要进行导出</li>\n<li>加载 json 文件，通过 JSON.parse 进行文件解析</li>\n<li>加载 node 文件，通过 process.dlopen 方法加载（node 文件是 C++ 语法）</li>\n<li>其余文件，使用 js 语法加载，此时语法错误的会报错。</li>\n</ol>\n<h1 id=\"node多进程\"><a class=\"anchor\" href=\"#node多进程\">#</a> node 多进程</h1>\n<h3 id=\"介绍\"><a class=\"anchor\" href=\"#介绍\">#</a> 介绍</h3>\n<p><strong>进程是资源分配的最小单位，线程是 CPU 调度的最小单位</strong></p>\n<p>什么是进程</p>\n<p>进程 (Process) 是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单</p>\n<p>位，是操作系统结构的基础。</p>\n<p>进程的概念主要有两点：</p>\n<ul>\n<li>第一，进程是一个实体。每一个进程都有它自己的地址空间。</li>\n<li>第二，进程是一个 “执行中的程序”，存在嵌套关系。</li>\n</ul>\n<p>node 多进程官方文档：</p>\n<p>中文版：<span class=\"exturl\" data-url=\"aHR0cDovL25vZGVpcy5jbi9hcGkvY2hpbGRfcHJvY2VzcyxodG1s\">http://nodeis.cn/api/child_process,html</span></p>\n<p><strong>操作系统会使用时会开辟一个 node 进程，每个 node 文件在运行时都会创建一个 child_process 进行，也就是 node.js 的子进程。</strong></p>\n<h3 id=\"child_precess用法\"><a class=\"anchor\" href=\"#child_precess用法\">#</a> child_precess 用法</h3>\n<p><strong>一、执行可执行文件。</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> cp <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'child_process'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 默认内置库</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//exec 方法，可以传执行命令，也可以传文件路径，但不支持给文件传参。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cp<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ls -al|grep node_modules'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span>stdout<span class=\"token punctuation\">,</span>stderr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span>stdout<span class=\"token punctuation\">,</span>stderr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//execFile 方法，传文件路径，并且支持给文件传参数。</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cp<span class=\"token punctuation\">.</span><span class=\"token function\">execFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ls'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token string\">'-al'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span>stdout<span class=\"token punctuation\">,</span>stderr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span>stdout<span class=\"token punctuation\">,</span>stderr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//spawn 方法，传入文件路径，以流式的方式输出，是 exec 和 execFile 的底层原理</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">const</span> child <span class=\"token operator\">=</span> cp<span class=\"token punctuation\">.</span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'npm'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>install<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token literal-property property\">cwd</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/User/dmq/Desktop/test'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>child<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">chunk</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'stdout'</span><span class=\"token punctuation\">,</span>chunk<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>child<span class=\"token punctuation\">.</span>stderr<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">chunk</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'stderr'</span><span class=\"token punctuation\">,</span>chunk<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><strong>exec 和 spawn 使用场景：</strong></p>\n<p>当文件操作过程复杂，并且需要频繁输出日志时，使用 spawn 进行流式操作。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> child <span class=\"token operator\">=</span> cp<span class=\"token punctuation\">.</span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'npm'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>install<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token literal-property property\">cwd</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/User/dmq/Desktop/test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token literal-property property\">stdio</span><span class=\"token operator\">:</span> <span class=\"token string\">'inherit'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 将输出传给父进程。</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 监听错误事件</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>child<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span><span class=\"token parameter\">e</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 监听退出事件</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>child<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'exit'</span><span class=\"token punctuation\">,</span><span class=\"token parameter\">e</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'命令执行成功'</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>child<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">chunk</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'stdout'</span><span class=\"token punctuation\">,</span>chunk<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>child<span class=\"token punctuation\">.</span>stderr<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">chunk</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'stderr'</span><span class=\"token punctuation\">,</span>chunk<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>当文件操作过程简单，需要直接输出时，使用 exec 方法</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cp<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token string\">'npm install'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token literal-property property\">cwd</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/User/dmq/Desktop/test'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span>stdout<span class=\"token punctuation\">,</span>stderr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>stdout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>stderr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><strong>二、执行指定 JS 文件（不支持回调）</strong></p>\n<p>fork 方法类似于 require 函数，但是区别在于 fork 方法会创建一个 node 子进程执行 JS 文件，使用独立的 v8 引擎去解析代码。</p>\n<p>index.js 文件：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> child <span class=\"token operator\">=</span> cp<span class=\"token punctuation\">.</span><span class=\"token function\">fork</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span><span class=\"token string\">'child.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>child<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello child process!'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    child<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 及时断开连接，防止主进程和子进程长期处于等待状态</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>child<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'main pid:'</span><span class=\"token punctuation\">,</span>process<span class=\"token punctuation\">.</span>pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>child.js 文件：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'child process pid:'</span><span class=\"token punctuation\">,</span>process<span class=\"token punctuation\">.</span>pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>process<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>process<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello main process'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"child_process源码\"><a class=\"anchor\" href=\"#child_process源码\">#</a> child_process 源码</h3>\n<p>疑问：</p>\n<ul>\n<li>exec、execFile、spanwn 和 fork 区别：\n<ul>\n<li>exec: 原理是调用 /bin/sh-c 执行我们传入的 shell 脚本，底层调用了 execFile</li>\n<li>execFile: 原理是直接执行我们传入的 file 和 args, 底层调用 spawn 创建和执行子进程，并建立了回调，一次性将所有的 stdout 和 stderr 结果返回</li>\n<li>spawn: 原理是调用了 internal/child_.process, 实例化了 ChildProcess 子进程对象，再调用 child.spawn 创建子进程并执行命令，底层是调用了 child._handle.spawn 执行 process_wrap 中的 spwn 方法，执行过程是异步的，执行完毕后通过 PIPE 进行单向数据通信，通信结束后会子进程发起 onexit 回调，同时 Socket 会执行 close 回调</li>\n<li>fork: 原理是通过 spawn 创建子进程和执行命令，通过 setupchannel 创建 IPC 用于子进程和父进程之</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"eggjsmongodb\"><a class=\"anchor\" href=\"#eggjsmongodb\">#</a> egg.js+mongodb</h1>\n<p><strong>1、egg.js</strong></p>\n<p>用于快速生成后端 api 的框架。</p>\n<p><strong>2、npm init egg 命令</strong></p>\n<p>当执行 <code>npm init egg</code>  命令时，npm 会自动找到 create-egg 这个包（其他包同理，找到 create - 包名），进行执行。<strong>当不想将脚手架安装到本地，而是在线上直接使用时，这个机制就显得十分重要。</strong></p>\n<p><strong>3、mongodb 数据库</strong></p>\n<p>非关系型数据库。</p>\n<ul>\n<li>\n<p><strong>云 mongodb</strong></p>\n<ul>\n<li>\n<p>云 mongodb 开通</p>\n</li>\n<li>\n<p>地址：https:/mongodb.console.aliyun.comL, 创建实例并付款即可</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>本地 mongodb</strong></p>\n<ul>\n<li>\n<p>地址：https:/www.runoob.com/mongodb/mongodb-tutorial.html</p>\n</li>\n<li>\n<p>mongodb 使用方法</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29iLmNvbS9tb25nb2RiL21vbmdvZGItZGF0YWJhc2VzLWRvY3VtZW50cy1jb2xsZWN0aW9ucy5odG1s\">https://www.runoob.com/mongodb/mongodb-databases-documents-collections.html</span></p>\n</li>\n</ul>\n</li>\n</ul>\n<p>4、egg.js 链接 mongodb 数据库</p>\n<p>utils/mongo.js</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> logger <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'npmlog'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>logger<span class=\"token punctuation\">.</span>level <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">LOG_LEVEL</span> <span class=\"token operator\">?</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">LOG_LEVEL</span> <span class=\"token operator\">:</span> <span class=\"token string\">'info'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>logger<span class=\"token punctuation\">.</span>heading <span class=\"token operator\">=</span> <span class=\"token string\">'pick'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 自定义头部</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>logger<span class=\"token punctuation\">.</span><span class=\"token function\">addLevel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">fg</span><span class=\"token operator\">:</span> <span class=\"token string\">'green'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">bold</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 自定义 success 日志</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>logger<span class=\"token punctuation\">.</span><span class=\"token function\">addLevel</span><span class=\"token punctuation\">(</span><span class=\"token string\">'notice'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">fg</span><span class=\"token operator\">:</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">bg</span><span class=\"token operator\">:</span> <span class=\"token string\">'black'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 自定义 notice 日志</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">const</span> MongoClient <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>MongoClient<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Mongo</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> dbName</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>url <span class=\"token operator\">=</span> url<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dbName <span class=\"token operator\">=</span> dbName<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      MongoClient<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token literal-property property\">useNewUrlParser</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>          <span class=\"token literal-property property\">useUnifiedTopology</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> client</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token keyword\">const</span> db <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">db</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>dbName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> db<span class=\"token punctuation\">,</span> client <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token function\">connectAction</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">docName<span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve<span class=\"token punctuation\">,</span> reject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> db<span class=\"token punctuation\">,</span> client <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">const</span> collection <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span>docName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token function\">action</span><span class=\"token punctuation\">(</span>collection<span class=\"token punctuation\">,</span> <span class=\"token parameter\">result</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>          logger<span class=\"token punctuation\">.</span><span class=\"token function\">verbose</span><span class=\"token punctuation\">(</span><span class=\"token string\">'result'</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>          <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>          logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>          <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">docName</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">connectAction</span><span class=\"token punctuation\">(</span>docName<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">collection<span class=\"token punctuation\">,</span> onSuccess<span class=\"token punctuation\">,</span> onError</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">projection</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">_id</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> docs</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>          <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>          <span class=\"token function\">onSuccess</span><span class=\"token punctuation\">(</span>docs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  <span class=\"token function\">insert</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">docName<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">connectAction</span><span class=\"token punctuation\">(</span>docName<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">collection<span class=\"token punctuation\">,</span> onSuccess<span class=\"token punctuation\">,</span> onError</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>      collection<span class=\"token punctuation\">.</span><span class=\"token function\">insertMany</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>          <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>          <span class=\"token function\">onSuccess</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">docName<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">connectAction</span><span class=\"token punctuation\">(</span>docName<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">collection<span class=\"token punctuation\">,</span> onSuccess<span class=\"token punctuation\">,</span> onError</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>      collection<span class=\"token punctuation\">.</span><span class=\"token function\">deleteOne</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>          <span class=\"token function\">onError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>          <span class=\"token function\">onSuccess</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>  <span class=\"token comment\">//   update(collection, data) &#123;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>  <span class=\"token comment\">//   &#125;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>  <span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">client</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    client <span class=\"token operator\">&amp;&amp;</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> Mongo<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>db.js</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> mongo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Mongodb</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb://dmq:dmq0216@127.0.0.1:27017/dbName'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dbName'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">mongo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string\">'project'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"inquirer源码\"><a class=\"anchor\" href=\"#inquirer源码\">#</a> inquirer 源码</h1>\n<h2 id=\"学习路径\"><a class=\"anchor\" href=\"#学习路径\">#</a> 学习路径</h2>\n<ul>\n<li>掌握一些库：readline（命令行读取）/events（事件驱动）/stream（输入输出流）/ansi-escapes（命令行文字样式）/rxjs（处理异步事件）</li>\n<li>掌握命令行交互的实现原理，并实现一个可交互的列表</li>\n<li>分析 inquirer 源码掌握其中的关键实现</li>\n</ul>\n<h1 id=\"ejsglob\"><a class=\"anchor\" href=\"#ejsglob\">#</a> ejs+glob</h1>\n<p>ejs 三方库用于 xml 动态模板渲染，glob 三方库用于根据 <code>文件路径进行遍历和匹配文件</code> ，拿到文件的内容。</p>\n<h1 id=\"ejs源码\"><a class=\"anchor\" href=\"#ejs源码\">#</a> ejs 源码</h1>\n<p>省略，详见官网</p>\n<h1 id=\"require源码\"><a class=\"anchor\" href=\"#require源码\">#</a> require 源码</h1>\n<p>省略，详见官网</p>\n<h1 id=\"代码复用实践\"><a class=\"anchor\" href=\"#代码复用实践\">#</a> 代码复用实践</h1>\n<p>** 代码复用目的：** 提高人效，降低开发成本。</p>\n<p><strong>计算公式</strong>为：<strong>节约工时 = 服用代码节约时间  *  代码复用系数  *  复用次数</strong></p>\n<p><strong>背后思考：</strong></p>\n<ul>\n<li>不同开发者、团队之间会产生了大量重复、通用的代码</li>\n<li>这些代码散落在各自团队的项目代码里</li>\n<li>复用的时候大家习惯于直接拷贝这些代码到项目中，因为这样做对个人成本最低（开发者往往更熟悉自己写的代码)，但是这种做法不利于团队之间代码共享，因为每个人开发不同的业务，对不同页面的熟悉程度不一样，而代码复用的宗旨就是要尽可能将团队中的开发着的整体水平拉齐</li>\n<li>所以需要通过工具化的方式降低代码复用的成本</li>\n</ul>\n",
            "tags": [
                "脚手架开发",
                "脚手架开发"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/04/12/%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9F%A5%E8%AF%86%E7%82%B9/",
            "url": "https://dmqweb.cn/2024/04/12/%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9F%A5%E8%AF%86%E7%82%B9/",
            "title": "复杂业务部署与优化",
            "date_published": "2024-04-12T00:33:58.000Z",
            "content_html": "<h1 id=\"软件生命周期\"><a class=\"anchor\" href=\"#软件生命周期\">#</a> 软件生命周期：</h1>\n<p><img data-src=\"/images/Snipaste_2024-04-16_12-54-33.jpg\" alt=\"/images/Snipaste_2024-04-16_12-54-33.jpg\" /></p>\n<h1 id=\"架构流程图\"><a class=\"anchor\" href=\"#架构流程图\">#</a> 架构流程图</h1>\n<p><img data-src=\"/images/Snipaste_2024-04-17_12-16-04.jpg\" alt=\"/images/Snipaste_2024-04-17_12-16-04.jpg\" /></p>\n<h1 id=\"复杂项目通用方案\"><a class=\"anchor\" href=\"#复杂项目通用方案\">#</a> 复杂项目通用方案</h1>\n<h4 id=\"业务的复杂度\"><a class=\"anchor\" href=\"#业务的复杂度\">#</a> 业务的复杂度</h4>\n<ul>\n<li>交互的复杂性</li>\n<li>数据结构和状态的复杂性</li>\n<li>多项目互相依赖的复杂性</li>\n<li>打包</li>\n<li>性能优化</li>\n<li>第三方库的使用和调研以及二次开发</li>\n</ul>\n<h4 id=\"流程的复杂度\"><a class=\"anchor\" href=\"#流程的复杂度\">#</a> 流程的复杂度</h4>\n<ul>\n<li>git flow</li>\n<li>lint 工具</li>\n<li>单元测试</li>\n<li>commit 信息</li>\n<li>PR revirew</li>\n<li>CI / CD</li>\n</ul>\n<h1 id=\"ci-cd的概念\"><a class=\"anchor\" href=\"#ci-cd的概念\">#</a> CI / CD 的概念</h1>\n<p>业务组件库的开发和发布是随着一些列任务进化的：</p>\n<ul>\n<li>本地 commit 钩子函数完成 commit 验证</li>\n<li>代码 push 到远端之后</li>\n<li>跑特定的 test（不仅仅是本机的 unit test，也可能有时间很长的 E2E test）</li>\n<li>test 通过之后检查是否有新的 tag，如果有就自动 publish 一个新的版本</li>\n<li>甚至还有更多，自动部署文档站点等等。</li>\n</ul>\n<p>这些任务如果手动操作，就费时费力，所以需要自动化进行。</p>\n<h4 id=\"cicontinuous-integration持续集成\"><a class=\"anchor\" href=\"#cicontinuous-integration持续集成\">#</a> CI（Continuous integration）持续集成</h4>\n<p>持续集成是指频繁地将代码集成到主干，一旦开发人员对应用所做的更改被合并，系统就会通过自动构建应用并运行不同级别的自动化测试（通常是单元测试和集成测试）来验证这些更改，确保这些更改没有对应用造成破坏。</p>\n<p>作用有：</p>\n<ul>\n<li>快速发现错误</li>\n<li>防止分支大幅偏离主干</li>\n</ul>\n<p>持续集成的目的就是让产品可以快速迭代，同时保持高质量。</p>\n<h4 id=\"cdcontinuous-delivery持续交付\"><a class=\"anchor\" href=\"#cdcontinuous-delivery持续交付\">#</a> CD（Continuous Delivery）持续交付</h4>\n<p>持续交付是指频繁地将软件的新版本，交付给质量团队或者用户，以供评审。</p>\n<h4 id=\"cdcontinuous-deployment持续部署\"><a class=\"anchor\" href=\"#cdcontinuous-deployment持续部署\">#</a> CD（Continuous Deployment）持续部署</h4>\n<p>持续部署是持续交付的下一步，指的是代码通过评审以后，自动部署到生产环境。</p>\n<h4 id=\"ci-cd两大服务\"><a class=\"anchor\" href=\"#ci-cd两大服务\">#</a> CI / CD 两大服务：</h4>\n<ul>\n<li>github actions</li>\n<li>travis-ci</li>\n</ul>\n<h1 id=\"列表排序解决方案\"><a class=\"anchor\" href=\"#列表排序解决方案\">#</a> 列表排序解决方案</h1>\n<p>列表排序原理：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">&lt;</span>template<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      <span class=\"token operator\">&lt;</span>ul <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"ul\"</span> @drop<span class=\"token operator\">=</span><span class=\"token string\">\"onDrop\"</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token operator\">&lt;</span>li </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            v<span class=\"token operator\">-</span><span class=\"token keyword\">for</span><span class=\"token operator\">=</span><span class=\"token string\">\"(item,index) in list\"</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token operator\">:</span>data<span class=\"token operator\">-</span>index<span class=\"token operator\">=</span><span class=\"token string\">\"index\"</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token operator\">:</span>key<span class=\"token operator\">=</span><span class=\"token string\">\"item.id\"</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            @dragover<span class=\"token operator\">=</span><span class=\"token string\">\"onDragover($event,index)\"</span> </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            @dragstartart<span class=\"token operator\">=</span><span class=\"token string\">\"dragstart($event,index)\"</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            @dragenter<span class=\"token operator\">=</span><span class=\"token string\">\"dragenter($event,index)\"</span> </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            draggable<span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token operator\">:</span><span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"[item.id==currentLi?'glost':'']\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span>swig￼<span class=\"token number\">0</span><span class=\"token operator\">--</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>template<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">&lt;</span>script setup<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">/*eslint-disable*/</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> ref <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"vue\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span>arrayMoveImmutable<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'array-move'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">let</span> currentLi <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">const</span> list <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">'列表1'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">'列表2'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">'列表3'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">'列表4'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">id</span><span class=\"token operator\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">'列表5'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">dragstart</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e<span class=\"token punctuation\">,</span>inde</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  currentLi<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> inde<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">dragenter</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e<span class=\"token punctuation\">,</span>ind</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>ind <span class=\"token operator\">!=</span> currentLi<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      list<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token function\">arrayMoveImmutable</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span>ind<span class=\"token punctuation\">,</span>currentLi<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      currentLi<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> ind<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onDrop</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>index<span class=\"token punctuation\">,</span><span class=\"token string\">'drop'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  list<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token function\">arrayMoveImmutable</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span>index<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span>currentLi<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>list<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onDragover</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e<span class=\"token punctuation\">,</span>inde</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  index<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> inde<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>script<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token operator\">&lt;</span>style  scoped<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">.</span>ul<span class=\"token operator\">></span>li<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token operator\">%</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> 50px<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token literal-property property\">border</span><span class=\"token operator\">:</span> 1px solid red<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">.</span>glost<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  box<span class=\"token operator\">-</span>shadow<span class=\"token operator\">:</span> 10px 10px 3px 3px gray<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>style<span class=\"token operator\">></span></pre></td></tr></table></figure><p>列表排序常用工具包：</p>\n<ul>\n<li>vue-draggable</li>\n<li>sortable.js</li>\n<li>array-move.js</li>\n</ul>\n<h1 id=\"拖动改变位置原理\"><a class=\"anchor\" href=\"#拖动改变位置原理\">#</a> 拖动改变位置原理</h1>\n<p>通过监听 mousedown 和 mousemove 事件，用 element.getBoundingClientRect 方法获得 x 和 y，left 和 top 等属性，改变对应元素的 top 和 left 属性。</p>\n<h1 id=\"拖动改变大小原理\"><a class=\"anchor\" href=\"#拖动改变大小原理\">#</a> 拖动改变大小原理</h1>\n<p>设置边框元素，边框元素的四个角添加圆点元素，监听 mousedown 事件和 mousemove 事件，并将最新的坐标赋值给元素的尺寸大小。</p>\n<h1 id=\"快捷键实现原理\"><a class=\"anchor\" href=\"#快捷键实现原理\">#</a> 快捷键实现原理</h1>\n<p>好用的快捷键第三方库：Hotkeys.js</p>\n<p>事件原理：keydown 事件的监听，通过 event.key 判断是那个快捷键，从而执行对应的操作。</p>\n<h1 id=\"撤销重做原理\"><a class=\"anchor\" href=\"#撤销重做原理\">#</a> 撤销重做原理</h1>\n<p>维护一个固定长度的 histories 数组和 historyIndex 指针，每次修改的时候添加一条记录（标识操作类型和数据）。回滚时改变 historyIndex 指针。</p>\n<h1 id=\"右键菜单原理\"><a class=\"anchor\" href=\"#右键菜单原理\">#</a> 右键菜单原理</h1>\n<p>在需要显示的区域拦截默认的右键点击事件，判断是否点击在组件元素上（通过 event.target），显示一个自定义菜单，其中包括操作项，显示在鼠标的位置（event.clientX 和 event.clientY），点击完成操作，通过 display:none 隐藏。</p>\n<h1 id=\"自动保存实现方案\"><a class=\"anchor\" href=\"#自动保存实现方案\">#</a> 自动保存实现方案</h1>\n<ul>\n<li>定时保存（语雀）</li>\n<li>实时保存（石墨）</li>\n</ul>\n<p>实现原理：添加 isDrity 字段标记数据是否有修改，当修改时将 isDirty 设置为 true，根据 isDIrty 的值设置定时器，定时触发保存逻辑。</p>\n<h1 id=\"dom元素截图实现方案\"><a class=\"anchor\" href=\"#dom元素截图实现方案\">#</a> DOM 元素截图实现方案</h1>\n<p>工具包：html2canvas</p>\n<p>实现原理：根据 DOM 元素的 styles 样式，通过 svg 的 foreignObject 元素引入 XML 命名空间的元素，然后创建一个 image 标签，将 svg 通过 url.createObjectURL 方法创建一个路径赋值给 image 标签的 src 属性，通过 canvas 画笔 的 drawImage 方法将 image 图片绘制到 canvas 画布上。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\"<span class=\"token operator\">&lt;</span>svg xmlns<span class=\"token operator\">=</span><span class=\"token string\">'http://www.w3.org/2000/svg'</span>width<span class=\"token operator\">=</span><span class=\"token string\">'400px'</span>height<span class=\"token operator\">=</span>'<span class=\"token number\">40</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token string\">\"&lt;foreignabject width='100%'height='100%'>\"</span><span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"&lt;div xmlns='http://ww.w3.org/1999/xhtml'>\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>element<span class=\"token punctuation\">.</span>innerHTML<span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"&lt;/div>\"</span><span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token string\">\"&lt;/foreignobject>\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token string\">\"&lt;/svg>\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">const</span> svg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span><span class=\"token string\">\"image/svg+xml;charset=utf-8\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createobjectURL</span><span class=\"token punctuation\">(</span>svg<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>image<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> url</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>image<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'load'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span>anvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"二维码生成方案\"><a class=\"anchor\" href=\"#二维码生成方案\">#</a> 二维码生成方案</h1>\n<ul>\n<li>工具包：node-qrcode</li>\n<li>ts 项目中需要安装额外的定义文件。</li>\n</ul>\n<p>简单原理：将数据变为二进制，然后通过 canvas 将二进制变为图像。</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>qrcode<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">width</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>128<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>128<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>canvas</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 将字符串转为二进制形式</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">toBianary</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">let</span> res <span class=\"token operator\">=</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span>str<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">let</span> charCode <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">charCodeAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">let</span> binaryCharCode <span class=\"token operator\">=</span> charCode<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            res <span class=\"token operator\">+=</span> binaryCharCode<span class=\"token punctuation\">.</span><span class=\"token function\">padStart</span><span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 绘制</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">drawQRCode</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text<span class=\"token punctuation\">,</span> canvas</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token keyword\">var</span> context <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token comment\">// 绘制黑白像素点</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> text<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">var</span> row <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">/</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">var</span> col <span class=\"token operator\">=</span> i <span class=\"token operator\">%</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">var</span> color <span class=\"token operator\">=</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"1\"</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"#000000\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"#FFFFFF\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        context<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> color<span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        context<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>col<span class=\"token punctuation\">,</span> row<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">var</span> qrcodeCanvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"qrcode\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token function\">drawQRCode</span><span class=\"token punctuation\">(</span><span class=\"token function\">toBianary</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://dmqweb.cn'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> qrcodeCanvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 示例：绘制一个简单的二维码</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h1 id=\"复制功能实现原理\"><a class=\"anchor\" href=\"#复制功能实现原理\">#</a> 复制功能实现原理</h1>\n<ul>\n<li>工具包：clipboard.js</li>\n<li>自带 type 定义文件</li>\n</ul>\n<p>实现原理：</p>\n<p>方案一：document.execCommand () 方法。内置一系列功能，包括复制文本（但<strong>前提是需要选中文本</strong>），可以使用不可见元素迂回。</p>\n<p>方案二：Clipboard API（ navigator.clipboard ），但是对于<strong>浏览器兼容性有待加强。</strong></p>\n<h1 id=\"下载文件原理\"><a class=\"anchor\" href=\"#下载文件原理\">#</a> 下载文件原理</h1>\n<ul>\n<li>工具包：FileSaver.js（小文件）</li>\n<li>StreamSaver.js（大文件）</li>\n</ul>\n<p>方案一：超链接 a 标签添加 download 属性，属性值为文件名，rel 属性设置打开页面的具体实现细节。（但前提是<strong> href 属性为当前同源情况下</strong>。）</p>\n<p>方案二：通过 axios 请求到图片地址，通过 URL.createObjectURL 创建为一个与 document 相绑定的地址，赋值给 a 标签即可。（不要忘记使用 URL.revokeObjectURL 将创建的地址移除。）</p>\n<p>方案三：通过 FileReader.readAsDataURL，创建一个 FileReader 实例，使用 readAsDataURL 读取对象返回一段 base64 格式的字符串，监听 reader 实例的 onload 事件，创建 a 标签将 reader.result 赋值给 a 标签的 href 属性。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function-variable function\">downloadFile</span><span class=\"token operator\">:</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span>fileName</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token comment\">// 传入被读取的 blob 对象</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsDataURL</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token comment\">// 读取完成的回调事件</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>       <span class=\"token keyword\">let</span> a <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>       a<span class=\"token punctuation\">.</span>download <span class=\"token operator\">=</span> fileName</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>       a<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">'none'</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>       <span class=\"token comment\">// 生成的 base64 编码</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>       <span class=\"token keyword\">let</span> url <span class=\"token operator\">=</span> reader<span class=\"token punctuation\">.</span>result</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>       a<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> url</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>       document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>       a<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>       document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>终极解决方案：由于通过 URL.createObjectURL 和 FileReader 都会先将数据保存到内存中，业务中经常需要后端验证 token 之后才能拿到文件，不能直接使用 a 标签。因此实际中可以先发送 ajax 请求验证 token，验证之后颁发一个过期时间短的 cookie，之后使用 a 标签进行下载即可。但是同样会受到 a 标签 download 属性跨域请求的限制。</p>\n<h1 id=\"应用部署的流程\"><a class=\"anchor\" href=\"#应用部署的流程\">#</a> 应用部署的流程</h1>\n<p><em><strong>构建</strong><br />\n Javascript 语言本身是不需要编译的。<br />\n但是现代的前端项目使用的语言和或者的模块系统都无法在浏览器中使用，都需要使用特定的<br />\n bundler 将源代码最终转换为浏览器支持的」avascript 代码。<br />\n<strong>不同的环境:</strong></em><br />\n 开发环境 (development) ：本地的测试环境<br />\n测试环境 (test 或者 staging）：线上的测试环境</p>\n<p>生产环境（production)：线上的生产环境</p>\n<p><strong>生产和开发环境的区别</strong><br />\n * 开发环境<br />\n * 会添加丰富的错误提示<br />\n可以使用 mock server 或者本地后端环境<br />\n添加各种便利的功能 - 比如 hot reload, 自动刷新<br />\n * 不太关心静态资源的大小，最好提供最丰富的调试信息 (sourcemap) 等。</p>\n<p><strong>生产环境</strong><br />\n稳定是最重要的原则<br />\n速度是第一要务<br />\n<strong>生产环境和测试环境的区别</strong><br />\n高度相似<br />\n使用的后端服务不一样</p>\n<p><strong>环境变量设置（按优先级）</strong></p>\n<ul>\n<li>跨平台设置环境变量工具包：cross-env</li>\n<li>命令中添加环境变量（平台限制）</li>\n<li>环境变量文件中配置</li>\n</ul>\n<p><strong>在项目根目录中放置下列文件来指定环境变量</strong><br />\n.env                                        #在所有的环境中被载入<br />\n.env.local                             #在所有的环境中被载入，但会被 git 忽略<br />\n env.[mode]                         #只在指定的模式中被载入<br />\n env.[mode].local             #只在指定的模式中被载入，但会被 git 忽略</p>\n<h1 id=\"webpack构建优化\"><a class=\"anchor\" href=\"#webpack构建优化\">#</a> webpack 构建优化</h1>\n<h3 id=\"bundler\"><a class=\"anchor\" href=\"#bundler\">#</a> Bundler：</h3>\n<p>将浏览器不支持的模块进行编译，转换，<br />\n合并最后生成的代码可以在浏览器端良好的运行的工具。</p>\n<h3 id=\"loaders\"><a class=\"anchor\" href=\"#loaders\">#</a> <strong>Loaders：</strong></h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWJwYWNrLmRvY3NjaGluYS5vcmcvY29uY2VwdHMvbG9hZGVycy8=\">https://webpack.docschina.org/concepts/loaders/</span><br />\nloader 用于对模块的源代码进行转换。loader 可以使你在 import 或 &quot;Ioad (加载)&quot; 模块时预处理文件。<br />\n<strong>多个 Loader</strong><br />\nmodule.rules 允许你在 webpack 配置中指定多个 loader。这种方式是展示 loader 的一种简明方式，并且有助于使代码变得简洁和易于维护。</p>\n<p><strong>webpack 中 loader 配置：</strong></p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>const path = require('path')</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>module.exports = <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    entry<span class=\"token operator\">:</span>'./main.js'<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    output<span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        path<span class=\"token operator\">:</span>path.resolve(dirname<span class=\"token punctuation\">,</span>'dist')<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        filename<span class=\"token operator\">:</span>bundle.js'<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>module<span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    rules<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        test<span class=\"token operator\">:</span>/八.css$/<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        use<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            loader<span class=\"token operator\">:</span>'style-loader'<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\">// 先写的 loader 后执行。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            loader<span class=\"token operator\">:</span>'css-loader'<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h6 id=\"原理\"><a class=\"anchor\" href=\"#原理\">#</a> 原理</h6>\n<p><strong>webpack 中 loader 原理：</strong></p>\n<p>在 webpack.config.js 的 module 字段的 rules 数组中进行配置：添加一个对象标识一个独立的匹配项，test 字段使用正则表示匹配的文件名，use 数组表示对应文件需要执行的 loader，webpack 在打包时会<strong>将文件内容传入并执行对应的 loader</strong>（是一个函数），<strong>执行 loader 函数后会将函数返回值包装成一个新的函数</strong>，因此 webpack 中的 loader 通常需要进行两次 module.exports。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 手写一个 md 文件的 loader</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> marked <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'marked'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 第三方库，用于将 md 转为 html</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> utils <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'loader-utils'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// 官方库，用于获取用户配置 loader 时传入的参数</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">markdownLoader</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">source</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> utils<span class=\"token punctuation\">.</span><span class=\"token function\">getOptions</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token function\">marked</span><span class=\"token punctuation\">(</span>source <span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span>  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">module.exports = </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> markdownLoader<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>配置：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span><span class=\"token string\">'./main.js'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>dirname<span class=\"token punctuation\">,</span><span class=\"token string\">'dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span>bundle<span class=\"token punctuation\">.</span>js'<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">八.css$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span><span class=\"token string\">'style-loader'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\">// 先写的 loader 后执行。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span><span class=\"token string\">'css-loader'</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">八.md$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'./markdonwn-loader'</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">headerIds</span><span class=\"token operator\">:</span><span class=\"token boolean\">false</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token comment\">// 其中 options 是给 loader 函数传入的第二个参数，loader 中可以使用 loader-utils 官方三方库进行接受</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>多个 Loader 串联</strong><br />\n最后的 loader 最早调用，将会传入原始资源内容。<br />\n第一个 loader 最后调用，期望值是传出 JavaScript 和 source map (可选)。<br />\n中间的 loader 执行时，会传入前一个 loader 传出的结果。<br />\n<strong>将 markdown 转换为 html:turndown</strong><br />\n 地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIub20vZG9tY2hyaXN0aWUvdHVybmRvd24=\">https://github.om/domchristie/turndown</span></p>\n<h3 id=\"plugins\"><a class=\"anchor\" href=\"#plugins\">#</a> <strong>plugins:</strong></h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWJwYWNrLmRvY3NjaGluYS5vcmcvY29uY2VwdHMvcGx1Z2lucy8=\">https://webpack.docschina.org/concepts/plugins/</span><br />\n 插件是 webpack 的支柱功能。webpack 自身也是构建开你在 webpack 配置中用到的相同的插件系统之上！插件目的在于解决 loader 无法实现的其他事。(我自己的理解，loader 解决的是各种不同资源的问题，plugins 更多解决的是项目整体的事情)</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>const path = require('path');</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>const HtmlWebpackPlugin = require('html-webpack-plugin');</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>module.exports = <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    entry<span class=\"token operator\">:</span>'./main.js'<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    output<span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        path<span class=\"token operator\">:</span>path.resolve(dirname<span class=\"token punctuation\">,</span>'dist')<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        filename<span class=\"token operator\">:</span>bundle.js'<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>module<span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    rules<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        test<span class=\"token operator\">:</span>/八.css$/<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        use<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            loader<span class=\"token operator\">:</span>'style-loader'<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\">// 先写的 loader 后执行。</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            loader<span class=\"token operator\">:</span>'css-loader'<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>plugins<span class=\"token operator\">:</span><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    new BundlesizeWebpackPlugin( <span class=\"token punctuation\">&#123;</span> sizeLimit<span class=\"token operator\">:</span><span class=\"token number\">3</span> <span class=\"token punctuation\">&#125;</span> )  <span class=\"token comment\">// 自己手写的插件（如下）</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    new webpack.ProgressPlugin()<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 显示打包过程（webpack 内置插件）</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    new HtmlwebpackPlugin()<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h6 id=\"原理-2\"><a class=\"anchor\" href=\"#原理-2\">#</a> 原理</h6>\n<p><strong>webpack 中 plugins 原理：</strong></p>\n<p>webpack 执行时会将 plugins 字段中的插件实例取出并将 webpack 实例传入并执行其<strong> apply 方法</strong>，通过 webpack 实例的 hooks 中的方法我们可以操控对应的钩子函数。</p>\n<p>官方的教程：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWJwYWNrLmpzLm9yZy9jb250cmlidXRlL3dyaXRpbmctYS1wbHVnaW4v\">https://webpack.js.org/contribute/writing-a-plugin/</span><br />\n<strong> 插件的格式</strong><br />\n一个 JavaScript 函数或 JavaScript 类<br />\n在它原型上定义的 apply 方法，会在安装插件时被调用，并被 webpack compiler 调用一次<br />\n指定一个触及到 webpack 本身的事件钩子，即 hooks, 用于特定时机处理额外的逻辑<br />\n Compiler Hooks 列表<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWJwYWNrLmlzLm9yZy9hcGkvY29tcGlsZXItaG9va3Mv\"> https://webpack.is.org/api/compiler-hooks/</span></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 手写一个 webpack 插件，打包文件超出限制时，报错。</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> resolve <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> statSync <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//fs 模块中同步读取文件信息</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">BundlesizeWebpackPlugin</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options <span class=\"token operator\">=</span> options<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">compiler</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 获取到传入的参数</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> sizeLimit <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        compiler<span class=\"token punctuation\">.</span>hooks<span class=\"token punctuation\">.</span>compile<span class=\"token punctuation\">.</span><span class=\"token function\">tap</span><span class=\"token punctuation\">(</span><span class=\"token string\">'BundleSizePlugin'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">compilationParams</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// 编译时钩子，参数是参数</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'compile阶段'</span><span class=\"token punctuation\">,</span>compilationParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        compiler<span class=\"token punctuation\">.</span>hooks<span class=\"token punctuation\">.</span>done<span class=\"token punctuation\">.</span><span class=\"token function\">tap</span><span class=\"token punctuation\">(</span><span class=\"token string\">'BundleSizePlugin'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">stats</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// 结束时钩子，参数是打包后的信息。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'done'</span><span class=\"token punctuation\">,</span>stats<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\">// 拿到打包后文件的路径和文件名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> path <span class=\"token punctuation\">,</span> filename <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> stats<span class=\"token punctuation\">.</span>compilation<span class=\"token punctuation\">.</span>outputOptions<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\">// 拼接成文件路径</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">const</span> bundlePath <span class=\"token operator\">=</span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\">// 获取到文件 size</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> size <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token function\">statSync</span><span class=\"token punctuation\">(</span>bundlePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">const</span> bundleSize <span class=\"token operator\">=</span> size <span class=\"token operator\">/</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>bundleSize <span class=\"token operator\">&lt;</span> sizeLimit<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Safe:Bundle-Size'</span><span class=\"token punctuation\">,</span>bundleSize<span class=\"token punctuation\">,</span><span class=\"token string\">'\\n Size Limit:'</span><span class=\"token punctuation\">,</span>sizeLimit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Unsafe:Bundle-Size'</span><span class=\"token punctuation\">,</span>bundleSize<span class=\"token punctuation\">,</span><span class=\"token string\">'\\n Size Limit:'</span><span class=\"token punctuation\">,</span>sizeLimit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span> </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> BundlesizeWebpackPlugin<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h3>\n<p><strong>Loaders 关注代码中的单个资源，Plugins 关注整体流程，可以接触到 webpack 构建流程中的<br />\n各个阶段并劫持做一些代码处理。</strong></p>\n<h1 id=\"node后端框架\"><a class=\"anchor\" href=\"#node后端框架\">#</a> node 后端框架</h1>\n<h2 id=\"nodejs后端框架调研\"><a class=\"anchor\" href=\"#nodejs后端框架调研\">#</a> Node.js 后端框架调研</h2>\n<p><strong>后端框架应该注意的三大问题</strong><br />\n路由 Routes<br />\n 请求 Request<br />\n 响应 Response</p>\n<h4 id=\"express\"><a class=\"anchor\" href=\"#express\">#</a> Express</h4>\n<p>官方网址：[https:l/expressis.com (https:expressis.com)<br />\n<strong> 安装</strong><br />\n官方网址：[<span class=\"exturl\" data-url=\"aHR0cHM6Ly9leHByZXNzaXMuY29tL3poLWNuL3N0YXJ0ZXIvaW5zdGFsbGluZy5odG1s\">https://expressis.com/zh-cn/starter/installing.html</span>](https:l/expressjs.com/zh-<br />\ncn/starter/installing.html)<br />\n 使用生成器安装，可以自动生成一系列的脚手架代码：[https:/expressjs.com/zh<br />\ncn/starter/generator.htmll(<span class=\"exturl\" data-url=\"aHR0cHM6Ly9leHByZXNzaXMuY29tL3poLWNuL3N0YXJ0ZXIvZ2VuZXJhdG9yLmh0bWw=\">https://expressis.com/zh-cn/starter/generator.html</span>)</p>\n<p><strong>优点</strong></p>\n<p>快速简单、易上手</p>\n<p><strong>缺点</strong></p>\n<ul>\n<li>路由响应中，很可能有：从外部请求数据的服务，有验证路由的请求参数，返回特定的格式。</li>\n<li>所有逻辑不分青红皂白的写在一起！很容易产生冗长的难以维护的代码。</li>\n<li>一些大型必备的模块，如第三方服务初始化，安全，日志都没有明确的标准。</li>\n</ul>\n<p><strong>Express 中间件：</strong></p>\n<p>Express 是一个基于中间件的框架，其余任务都会在中间件中执行，中间件是一个队列结构，先写入的任务先执行，中间件的写法是：app.use ()，当调用中间件时，会向传入的函数中传入 req,res 和 next 函数。</p>\n<p><strong>中间件可以完成的任务</strong></p>\n<ul>\n<li>执行任何代码。</li>\n<li>对请求和响应对象进行更改。</li>\n<li>结束请求 / 响应循环。</li>\n<li>调用堆栈中的下一个中间件。</li>\n</ul>\n<h4 id=\"koa2\"><a class=\"anchor\" href=\"#koa2\">#</a> Koa2</h4>\n<p><strong>官网地址</strong>：[https:I/koajs.com (https:/koajs.com)</p>\n<p><strong>Koa2 和 Express 的区别</strong></p>\n<ul>\n<li>使用 Promise (async,await) 代替 callback (node&gt;v7.6.0)</li>\n<li>使用 ctx (上下文对象) 封装 req (Request) 和 res (Response), 以及一些常用的功能。</li>\n<li><strong>完全不同的中间件机制</strong></li>\n<li><strong>更轻量级，没有捆绑任何中间件</strong></li>\n<li>官方文章：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2tvYWpzL2tvYS9ibG9iL21hc3Rlci9kb2NzL2tvYS12cy1leHByZXNzLm1k\">https://github.com/koajs/koa/blob/naster/docs/koa-vs-express.md</span></li>\n</ul>\n<p><strong>Koa2 中间件：</strong></p>\n<ol>\n<li>Koa2 中间件，由 Express 的队列模型（同步）转变为洋葱模型，当程序运行到 <code>await next()</code>  的时候就会暂停当前程序，进入下一个中间件，处理完之后才会仔回过头来继续处理。</li>\n<li>Koa2 洋葱模型解决的问题就是一个中间件可以调用其他中间件执行后，再继续自己的操作，Express 框架中 next () 执行后就直接到下一个中间件操作，无法退回。</li>\n</ol>\n<p><img data-src=\"/images/Snipaste_2024-04-22_14-30-49.jpg\" alt=\"Koa2中间件\" /></p>\n<p><strong>代码示例：</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> Koa <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'koa'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Koa</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token constant\">PORT</span> <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">await</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">await</span> <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PORT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">http://localhost:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span><span class=\"token constant\">PORT</span><span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>Koa2 特点：</strong></p>\n<ul>\n<li>响应机制的不同</li>\n<li>Express: 我们直接操作的是 res 对象，直接 res.send 之后就立即响应了。</li>\n<li>Koa2: 数据的响应是通过 ctx.body 进行设置，注意这里仅是设置并没有立即响应，而是在所有的中间件结束之后做了响应。</li>\n</ul>\n<p>** 缺点：**Koa2 在使用上有一定的缺点，因为太过于轻量使得在使用时需要手动处理很多操作，可以使用基于 Koa2 的上层框架（如：egg.js）</p>\n<h4 id=\"eggjs\"><a class=\"anchor\" href=\"#eggjs\">#</a> egg.js</h4>\n<p><strong>Express 和 Koa2 的不足</strong></p>\n<ul>\n<li>简单而且扩展性强，适合个人的比较小的项目</li>\n<li>没有约定，对于统一维护和开发非常不利</li>\n</ul>\n<p><strong>对于后端框架的需求</strong></p>\n<ul>\n<li>需要有一套优秀的统一的约定或者架构进行开发</li>\n<li>有丰富的扩展机制和可定制性</li>\n<li>Typescript 支持</li>\n</ul>\n<p><strong>egg.js</strong></p>\n<ul>\n<li>地址：[https:l/eggis.org/zh-cnI (https:l/eggjs.org/zh-cn) （基于 Koa2）</li>\n<li>阿里大厂出品，维护有保障。国内开发者开发，中文文档质量有保证。</li>\n<li><strong>约定优于配置，按照一套统一的约定进行应用开发。</strong></li>\n<li>一个插件只做一件事，高度可扩展的插件机制</li>\n<li>支持 Typescript</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>//nodejs版本10以上</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">npm</span> init egg <span class=\"token parameter variable\">--type</span><span class=\"token operator\">=</span>ts</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">npm</span> run dev</pre></td></tr></table></figure><p><strong>egg.js 概念：</strong></p>\n<ul>\n<li>\n<p>Application - 全局应用对象，只有一个实例。</p>\n</li>\n<li>\n<p>Context - 上下文对象，每次请求生成一个实例。</p>\n</li>\n<li>\n<p>Request - 请求对象，来自 Koa。</p>\n</li>\n<li>\n<p>Response - 响应对象，来自 Koa 的一个新的对象。</p>\n</li>\n<li>\n<p>Helper - 用来提供一些实用的 utility 函数。框架内置了几个简单的 Helper 函数。</p>\n</li>\n</ul>\n<h4 id=\"nestjs\"><a class=\"anchor\" href=\"#nestjs\">#</a> Nest.js</h4>\n<ul>\n<li>地址：<span class=\"exturl\" data-url=\"aHR0cHM6L2RvY3MubmVzdGlzLmNvbQ==\">https:/docs.nestjs.com</span></li>\n<li>内置并且完全支持 Typescript</li>\n<li>开箱即用的应用程序架构</li>\n<li>可扩展，松散耦合</li>\n<li>大量采用了装饰器的写法 <span class=\"exturl\" data-url=\"aHRwczovL2RvY3MubmVzdGlzLmNuLzgvY29udHJvbGxlcnM=\">https://docs.nestjs.cn/8/controllers</span></li>\n</ul>\n<h1 id=\"vueconfigjs\"><a class=\"anchor\" href=\"#vueconfigjs\">#</a> vue.config.js</h1>\n<p><strong>个性化构建结果 - vue.config,js</strong><br />\n 在基础的配置上，自定义构建的结果 - 可以使用 vue.config.js<br />\n 文档地址：https:l/cli.vuejs.org/zh/config#vue-config-js<br />\n 简介两个字段<br />\n *<strong>PublicPath</strong> - 部署应用包时的基本 URL, 这个配置对应的是 webpack 的 PublicPath 属性<br />\n★<br />\n默认值为 '/'，Vue CLI 会假设你的应用是被部署在一个域名的根路径上<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hYmMuY29tLw==\"> https://abc.com/</span><br />\n★<br />\n可以设置为子路径 - 如果你的应用被部署在 https:abc,com/sub/ 那么就设置为 '/sub'<br />\n* 可以设置为 CDN 路径 - 在我们的应用中，最后静态资源是要全部上传到 CDN 的，（脚手<br />\n架自动完成)，所以这里可以设置为一个 cDN 域名 -'https:l/oss.imooc-Iego.com/editor'<br />\n* 还可以设置为绝对路径 ('' 或者 './')，这样所有的资源都会被链接为相对路径</p>\n<p><strong>css.loaderOptions</strong> 属性<br />\n * 向 CSS 相关的 loader 传递选项<br />\n * Ant-design-vue 的样式变量：https:lww,antd,com docs/vue/customize-theme-cn<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Z1ZUNvbXBvbmVudC9hbnQtZGVzaWduLQ==\">https://github.com/vueComponent/ant-design-</span><br />\nyue/blob/master/components/style/themes/default.less<br />\n * 添加更多的 CSS 预处理器：<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbGkudnVlanMub3JnL3poL2d1aWRlL2Nzcy5odG1sIyVFOSVBMiU4NCVFNSVBNCU4NCVFNyU5MCU4NiVFNSU5OSVBOA==\">https://cli.vuejs.org/zh/guide/css.html# 预处理器</span><br />\n * 特别注意 less 和 Iess-loader 的版本问题。不要装最新的，建议选用：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//vue.config.js 配置：</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> isstaging <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">VUE_APP_STAGINE</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> isProduction <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token string\">'production'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token operator\">/</span>生产环境要使用0SS地址</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token operator\">/</span>其他环境都使用绝对路径</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token literal-property property\">publicPath</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span>isProduction <span class=\"token number\">6</span> <span class=\"token operator\">!</span>isStaging<span class=\"token punctuation\">)</span>'https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">oss.imooc-lego.com</span><span class=\"token regex-delimiter\">/</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token literal-property property\">css</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    \t<span class=\"token literal-property property\">loaderOptions</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    \t<span class=\"token literal-property property\">less</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    \t\t<span class=\"token literal-property property\">lessoptions</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    \t\t\t<span class=\"token literal-property property\">modifyVars</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>          \t\t <span class=\"token string-property property\">'primary-color'</span><span class=\"token operator\">:</span><span class=\"token string\">'#3E7FFF'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    \t\t\t<span class=\"token punctuation\">&#125;</span>，</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token literal-property property\">javascriptEnabled</span><span class=\"token operator\">:</span><span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    \t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    \t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token function-variable function\">configureWebpack</span><span class=\"token operator\">:</span> <span class=\"token parameter\">config</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        config<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        \t<span class=\"token keyword\">new</span> <span class=\"token class-name\">webpack<span class=\"token punctuation\">.</span>IgnorePlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>        <span class=\"token comment\">// 打包时忽略对应的文件</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token literal-property property\">resourceRegExp</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\.\\/locale$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token literal-property property\">contextRegExp</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">moment$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    \t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>isAnalyzeMode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    \t\tconfig<span class=\"token punctuation\">.</span>plugins<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    \t\t\t<span class=\"token keyword\">new</span> <span class=\"token class-name\">BundleAnalyzerPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span>    <span class=\"token comment\">// 添加打包后的文件分析工具（BundleAnalyzerPlugin）</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    \t\t\t\t<span class=\"token literal-property property\">analyzerMode</span> <span class=\"token operator\">:</span> <span class=\"token string\">'static'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    \t\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    \t\t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    \t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"项目构建优化\"><a class=\"anchor\" href=\"#项目构建优化\">#</a> 项目构建优化</h1>\n<p><strong>好用的 webpack 插件:webpack-bundle-analyzer</strong></p>\n<p>可视化 webpack 打包后的工具包大小，便于分析依赖和进行项目优化。如上 vue.config.js 中配置。</p>\n<p><strong>根据图表的优化步骤</strong></p>\n<p>一、看看有没有什么重复的模块，或者没有用的模块被打包到了最终的代码中<br />\n二、看看 package.json, 对比一下是否有应该在 devDeps 的模块，被错误的放置到了 deps 当中<br />\n三、检查是否有重复加载的模块，或者是功能大体相同的模块。<br />\n比如：使用<strong> es</strong> 版本的第三方库，享受 tree-shaking 的红利。<br />\n四、检查是否有没有用的模块是否打包到了最终的文件中，通过如下插件忽略对应的文件，从而 tree-shaking 掉忽略的文件（如国际化需要的各种语言包）, 详细配置如上 vue.config.js 中。</p>\n<p>*webpack ignore plugin <span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWJwYWNrLmpzLm9yZ2xwbHVnaW5zL2lnbm9yZS1wbHVnaW4vI3Jvb3Q=\">https://webpack.js.orglplugins/ignore-plugin/#root</span></p>\n<p><strong>将三方库中全部导入更换为按需导入</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span>Input<span class=\"token punctuation\">,</span>Dropdown<span class=\"token punctuation\">,</span>Slider<span class=\"token punctuation\">,</span>Select<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'Antd-vue'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> components <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>Input<span class=\"token punctuation\">,</span>Dropdown<span class=\"token punctuation\">,</span>Slider<span class=\"token punctuation\">,</span>Select<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">install</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">app</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    components<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        app<span class=\"token punctuation\">.</span><span class=\"token function\">component</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">&#123;</span> install <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 在 main.js 中导入，然后 app.use</span></pre></td></tr></table></figure><p><strong>浏览器缓存优化</strong></p>\n<p>一、项目即使是上线之后也会在后续追加或修改代码，如果分包较少重新上线后就不能使用浏览器缓存的文件，当分包数量较多时，就可以充分利用浏览器缓存。</p>\n<p>二、分包较多时可以使用浏览器支持平行加载多个文件的特性。（HTTP1 对同一域名并行请求的个数进行了限制，HTTP2 完全突破了这个限制）</p>\n<p><strong>手动分割第三方库为多个文件</strong></p>\n<p>webpack 的 config.optimization 中自带一些优化的配置项：</p>\n<ul>\n<li>minimize：压缩</li>\n<li>splitChunks：分包（可以配置 minSize 等）</li>\n<li>等等</li>\n</ul>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//vue.config.js 配置：</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">//.... 省略</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function-variable function\">configureWebpack</span><span class=\"token operator\">:</span> <span class=\"token parameter\">config</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        config<span class=\"token punctuation\">.</span>optimization<span class=\"token punctuation\">.</span>splitChunks <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token literal-property property\">maxInitialRequests</span><span class=\"token operator\">:</span> <span class=\"token number\">Infinity</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token literal-property property\">minSize</span><span class=\"token operator\">:</span> <span class=\"token number\">300</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token literal-property property\">chunks</span><span class=\"token operator\">:</span> <span class=\"token string\">'all'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token literal-property property\">cacheGroups</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token literal-property property\">antVendor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'ant-design-vue'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                    <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[\\\\/]node_modules[\\\\/](ant-design-vue)[\\\\/]</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token literal-property property\">canvasVendor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> 'html2canvas<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[\\\\/]node_modules[\\\\/](html2canvas)[\\\\/]</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token literal-property property\">vendor</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'vendor'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                    <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[\\\\/]node_modules[\\\\/](!html2canvas)(!ant-design-vue)[\\\\/]</span><span class=\"token regex-delimiter\">/</span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                all <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[\\\\/]node_modules[\\\\/]</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 匹配全部的 node_modules 中的文件</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                \t<span class=\"token function\">name</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">module</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">const</span> packageName <span class=\"token operator\">=</span> module<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[\\\\/]node_modules[\\\\/](.*?)([\\\\/]|$)</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">npm.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>packageName<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@'</span><span class=\"token punctuation\">,</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"项目运行优化\"><a class=\"anchor\" href=\"#项目运行优化\">#</a> 项目运行优化</h1>\n<p><strong>路由懒加载</strong></p>\n<p>使用 import 函数动态加载，配合魔法注释可以和 webpack 中的 bundler 相配合使用，例如：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* webpackChunkName: \"my-lodash\" */</span> <span class=\"token string\">'lodash'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">lodash</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>     <span class=\"token comment\">// ....</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><strong>改变 HTML 标题，增强 SEO</strong></p>\n<p>项目中动态添加标题的原理：使用 HtmlWebpackPlugin 插件，插入动态 js 语句进行占位，然后通过项目中 package.json 中的 name 进行替换。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//vue.config.js 配置：</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">//.... 省略</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token function-variable function\">chainWebpack</span><span class=\"token operator\">:</span> <span class=\"token parameter\">config</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>       config<span class=\"token punctuation\">.</span><span class=\"token function\">plugin</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">tap</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">args</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>           args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>title <span class=\"token operator\">=</span> <span class=\"token string\">'网站标题'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>           args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>desc <span class=\"token operator\">=</span> <span class=\"token string\">'网站详情描述'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>           <span class=\"token keyword\">return</span> args<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>       <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 记得添加 &lt;meta name=\"viewport\" content=\"&lt;%= htmlWebpackPlugin.options.desc %>\"></span></pre></td></tr></table></figure><p><strong>同构渲染方式</strong><br />\n服务端渲染和客户端渲染的区别就在于在哪里完成 html 完整文件的拼接：</p>\n<h3 id=\"客户端渲染\"><a class=\"anchor\" href=\"#客户端渲染\">#</a> 客户端渲染</h3>\n<p>客户端渲染由客户端完成 html 文件的拼接，服务端只负责提供数据。<br />\n优势：首屏加载快<br />\n劣势：不利于 SEO</p>\n<h3 id=\"服务端渲染\"><a class=\"anchor\" href=\"#服务端渲染\">#</a> 服务端渲染</h3>\n<p>服务端渲染由服务端完成 html 文件的凭借，客户端直接渲染即可<br />\n优势：利于 SEO，<br />\n劣势：白屏问题（获取 html 文件较慢）, 服务端压力大，占用 CPU 资源。</p>\n<h3 id=\"同构渲染\"><a class=\"anchor\" href=\"#同构渲染\">#</a> 同构渲染</h3>\n<p>服务端先通过服务端渲染，生成 html 以及初始化数据，客户端拿到代码和初始化数据，在客户端进行激活渲染。<br />\n优势：兼容了前端渲染的大部分优点（节省服务端资源、多终端适配渲染、局部刷新等），同时也具有服务端渲染首屏加载快，SEO 支持好的特点。<br />\n劣势：服务端必须是要 js 支持的语言，增加了整个系统的复杂度和维护成本。</p>\n<h1 id=\"部署与http优化\"><a class=\"anchor\" href=\"#部署与http优化\">#</a> 部署与 HTTP 优化</h1>\n<h3 id=\"部署\"><a class=\"anchor\" href=\"#部署\">#</a> <strong>部署</strong></h3>\n<p><strong>前端部署：https:llci,uejs,org/zh/guide/deployment.html</strong></p>\n<p>原理就是：将构建生成的产物直接烤贝到任何的静态文件服务器当中。</p>\n<p><strong>后端部署：https:/eggis.org/zh-cn/core/deployment.html</strong></p>\n<p>几乎没有构建过程：除非你用了 typescript 等需要编译的语言。</p>\n<p>方案一：直接将本地的源代码打个压缩包拷贝到目标服务器，然后启动服务器。</p>\n<p>方案二：在服务器中直接 pu 川源代码，install,. 然后启动服务器。</p>\n<h3 id=\"nginx反向代理\"><a class=\"anchor\" href=\"#nginx反向代理\">#</a> <strong>Nginx: 反向代理</strong></h3>\n<p><strong>Nginx</strong> 作为服务器软件，它的优点：</p>\n<ul>\n<li>特别适合前后端分离的项目</li>\n<li>保证安全</li>\n<li>非常快</li>\n<li>支持负载均衡</li>\n</ul>\n<p>使用：</p>\n<ul>\n<li>安装 nginx</li>\n<li>nginx    命令启动服务器</li>\n<li>nginx -s stop    命令关闭服务器</li>\n<li>nginx -v      命令查看配置信息</li>\n<li>nginx -s reload      命令重启服务</li>\n<li>配置 nginx.conf 文件</li>\n</ul>\n<h3 id=\"http缓存\"><a class=\"anchor\" href=\"#http缓存\">#</a> <strong>HTTP 缓存</strong></h3>\n<p>（若服务器使用 nginx，则在 nginx.conf 中配置）</p>\n<p>Expires <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRUUC9IZWFkZXJzL0V4cGlyZXM=\">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Expires</span><br />\n<strong>Expires 响应头包含日期 / 时间，即在此时候之后，响应过期</strong><br />\n使用 nginx 添加对应的响应头：expires 指令<br />\n文档地址：http:l/nginx.org/en/docs/http/ngx http headers module.html</p>\n<p>但是由于客户端时间和用户端时间并不总是相同的，于是有了 Cache-Control：</p>\n<p><strong>Cache-Control</strong>: 通用消息头字段，被用于在 http 请求和响应中，通过指定指令来实现缓存机制。<br />\n文档地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXI=\">https://developer</span> <span class=\"exturl\" data-url=\"aHR0cDovL21vemlsbGEub3JnL3poLUNOL2RvY3MvV2ViL0hUVFAvSGVhZGVycy9DYWNoZS1Db250cm9s\">mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control</span></p>\n<p>*<strong>Etag</strong>:ETagHTTP 响应头是资源的特定版本的标识符。这可以让缓存更高效，并节省带宽<br />\n因为如果内容没有改变，Wb 服务器不需要发送完整的响应，直接返回 304 表示可以使用缓存文件。<br />\n* 文档地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRUUC9IZWFkZXJzL0VUYWc=\">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag</span><br />\n<strong>Last-Modified</strong>: 是一个响应首部，其中包含源头服务器认定的资源做出修改的日期及时间。<br />\n文档地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRUUC9IZWFkZXJzL0xhc3QtTW9kaWZpZWQ=\">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified</span><br />\nnginx Etag:<span class=\"exturl\" data-url=\"aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfY29yZV9tb2R1bGUuaHRtbCNldGFn\">http://nginx.org/en/docs/http/ngx_http_core_module.html#etag</span><br />\n304 Not Modified <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSElUUC9TdGF0dXMvMzA0\">https://developer.mozilla.org/zh-CN/docs/Web/HITP/Status/304</span></p>\n<p>浏览器使用缓存：</p>\n<p><img data-src=\"/images/image.png\" alt=\"/images/image.png\" /></p>\n<h3 id=\"压缩算法\"><a class=\"anchor\" href=\"#压缩算法\">#</a> 压缩算法</h3>\n<p>压缩比对照表<br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9xdWl4ZGIuZ2l0aHViLmlvL3NxdWFzaC1iZW5jaG1hcmsvI3JhdGlvLXZzLWNvbXByZXNzaW9u\"> https://quixdb.github.io/squash-benchmark/#ratio-vs-compression</span></p>\n<h4 id=\"gzip\"><a class=\"anchor\" href=\"#gzip\">#</a> gzip</h4>\n<p><strong>一、动态压缩（服务器在返回静态文件之前，由服务器对每个请求压缩后再进行输出）</strong></p>\n<p>nginx 中启用 gzip：在 nginx.conf 中配置：</p>\n<ul>\n<li>gzip  on;        开启 gzip</li>\n<li>gzip_types     text/plain  application/javascript              设置那些文件需要压缩</li>\n<li>gzip_min_length   1k;         小于设置值不会压缩</li>\n<li>gzip_comp_level     1;          压缩级别</li>\n<li>等等</li>\n</ul>\n<p><strong>二、静态压缩（服务器直接使用压缩文件进行输出）</strong></p>\n<p>两个步骤</p>\n<ul>\n<li>生成压缩文件（gzip 命令或使用 webpack 插件 compression-webpack-plugin）</li>\n<li>在 ngin× 开启支持静态压缩的模块（例如 gzip_static  :  on）</li>\n</ul>\n<h4 id=\"brotli\"><a class=\"anchor\" href=\"#brotli\">#</a> Brotli</h4>\n<p><strong>一、动态压缩（服务器在返回静态文件之前，由服务器对每个请求压缩后再进行输出）</strong></p>\n<p><strong>使用前提</strong><br />\n浏览器支持：https:caniuse.com/brot 山 i<br />\n<strong>HTTPS 协议</strong><br />\n NGINX 对应的模块：https:/github.com/google/ngx._brot 山 i</p>\n<p>nginx 中启用 Brotli：在 nginx.conf 中配置：</p>\n<ul>\n<li>brotli  on;        开启 Brotli</li>\n<li>brotli_types     text/plain  application/javascript              设置那些文件需要压缩</li>\n<li>等等</li>\n</ul>\n<p><strong>二、静态压缩（服务器直接使用压缩文件进行输出，如上。）</strong></p>\n<h3 id=\"http优化\"><a class=\"anchor\" href=\"#http优化\">#</a> HTTP 优化</h3>\n<p>HTTP 是建立在 TCP 协议之上，所以<strong> HTTP 协议的瓶颈及其优化技巧都是基于 TCP 协议本身的特性</strong>，例如 tcp 建立连接的 3 次握手和断开连接的 4 次挥手以及每次建立连接带来的延迟时间。所以减少这些重新握手和至关重要。</p>\n<h4 id=\"keepalive属性\"><a class=\"anchor\" href=\"#keepalive属性\">#</a> keepAlive 属性</h4>\n<p>keepAlive 属性可以保持服务器端和客户端建立的会话连接，开启之后除首次建立连接外的其他请求不会进行<strong> DNS Lookup</strong>（NDS 域名解析）和<strong> Initial connection</strong>（三报文握手建立连接），可以在服务端文件中进行配置。</p>\n<p><strong>KeepAlive 的优点</strong></p>\n<ul>\n<li>TCP 连接更少，I 这样就会节约 TCP 连接在建立、释放过程中，主机和路由器上的 CPU 和内存开销。</li>\n<li>网络拥塞也减少了，拿到响应的延时也减少了</li>\n</ul>\n<h4 id=\"http2\"><a class=\"anchor\" href=\"#http2\">#</a> HTTP2</h4>\n<p><strong>使用 HTTP/2 提升性能</strong></p>\n<ul>\n<li>2010 年 SPDY <span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZQ==\">https://baike</span> <span class=\"exturl\" data-url=\"aHR0cDovL2JhaWR1LmNvbS9pdGVtL1NQRFklRTYlQkMlOTQlRTUlOEMlOTYlRTUlODglQjA=\">baidu.com/item/SPDY 演化到</span></li>\n<li>2015 HTTP/2 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXI=\">https://developer</span>,mozilla,org/zh-CN/docs/Glossary/HTTP_2</li>\n</ul>\n<p><strong>兼容性</strong></p>\n<p>需要浏览器支持 - https:/caniuse.com/http2</p>\n<p>需要 HTTPS 协议支持</p>\n<p><strong>主要特性</strong></p>\n<p>一、二进制协议：</p>\n<p>HTTP2 由原来的文本请求（报文）转变为二进制请求帧，加快传输</p>\n<p>二、多路复用：</p>\n<p><strong>HTTP2 多路复用解决了浏览器同一域名并行请求数量的限制。</strong></p>\n<p>在 HTTP/2 中引入了多路复用的技术。多路复用很好的解决了浏览器限制同一个域名下的请求数量的问题，同时也接更容易实现全速传输，毕竟开一个 TCP 连接都需要慢慢提升传输速度。</p>\n<p><strong>同个域名只需要占用一个 TCP 连接</strong>，使用一个连接并行发送多个请求和响应，<strong>消除了因多个 TCP 连接而带来的延时和内存消耗</strong>。</p>\n<p>三、Header 压缩复用</p>\n<p>TTP/2 在客户端和服务器端使用 “<strong>首部表</strong>” 来跟踪和存储之前发送的键一值对，对于相同的数据，不再通过每次请求和响应发送。</p>\n<p><strong>配置 HTTP2：</strong></p>\n<p>依 nginx 为例：在 server 字段的 listen 字段添加：listen   443   ssl   http2;</p>\n<h1 id=\"mongodb数据库\"><a class=\"anchor\" href=\"#mongodb数据库\">#</a> Mongodb 数据库</h1>\n<h3 id=\"基本操作\"><a class=\"anchor\" href=\"#基本操作\">#</a> <strong>基本操作</strong></h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 导入 Mongodb 客户端构造函数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> MongoClient<span class=\"token punctuation\">,</span>ObjectId<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mongodb\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建 mongo 实例 (传入 url)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MongoClient</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb://localhost:27017/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 执行函数，连接 mongodb 数据库</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 等待实例连接</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">const</span> db <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">db</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 创建数据库</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">command</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">ping</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//ping 命令</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connected'</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">const</span> userCollection <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 创建集合表</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// 数据的插入</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">//const result = await userCollection.insertOne (&#123;name:\"张三\",age:18&#125;)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">//const results = await userCollection.insertMany ([&#123;name:\"李四\",age:12&#125;,&#123;name:\"王五\",age:13&#125;]);</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">//console.log (result,results); // 返回影响的信息，id 等</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// 数据的查找</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">'张三'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">const</span> resultCursor <span class=\"token operator\">=</span>  userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//find 返回的是指针对象，不是结果</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// 将游标变为数组结果</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">const</span> results <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// console.log(results);</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">// 比较操作符 $lt 小于 $gt 大于</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">const</span> results2 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">$lt</span><span class=\"token operator\">:</span><span class=\"token number\">16</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">// console.log(results2);</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">// 逻辑操作符 $or</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">const</span> results3 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">$or</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">$gt</span><span class=\"token operator\">:</span><span class=\"token number\">12</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">\"王五\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// console.log(results3);</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">// 元素操作符  $exists 存在与否  $type 指定类型</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">const</span> results4 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">$type</span><span class=\"token operator\">:</span><span class=\"token string\">'number'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token comment\">// console.log(results4);</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">//limit  第二个参数传入 options 配置（projection 表示包含字段哪些字段）</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">const</span> result5 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">$type</span><span class=\"token operator\">:</span><span class=\"token string\">'number'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">limit</span><span class=\"token operator\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">skip</span><span class=\"token operator\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">sort</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">projection</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token comment\">// console.log(result5);</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">// 更新替换数据   update 更新数据  replaceOne 替换数据，修改操作要传具体更新操作符：</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">// 普通更新操作符： $set 设置值 $inc 增加 $rename 重命名 $unset 删除 </span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">// 数组更新操作符： $push 数组字段添加 $pop 删除 $all 包含 $regex 正则。属性符 .$ 属性占位符</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">const</span> result6 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">replaceOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">\"张三\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">\"Lebrown\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">const</span> result7 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">_id</span><span class=\"token operator\">:</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectId</span><span class=\"token punctuation\">(</span><span class=\"token string\">'6628b9876bac632e95ead1bb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">$set</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">\"updateOne\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">$inc</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span><span class=\"token number\">10</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">const</span> result8 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">_id</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectId</span><span class=\"token punctuation\">(</span><span class=\"token string\">'6628b9876bac632e95ead1bb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">$set</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token string-property property\">\"hobbies.0\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"golf\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">const</span> result9 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">_id</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectId</span><span class=\"token punctuation\">(</span><span class=\"token string\">'6628b9876bac632e95ead1bb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">hobbies</span><span class=\"token operator\">:</span><span class=\"token string\">'glof'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">$set</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token string-property property\">\"hobbies.$\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"golf-new\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token comment\">//console.log (result8);// 返回影响信息</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\">// 删除数据：deleteOne (filter) 和 deleteMany</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"mongodb高级\"><a class=\"anchor\" href=\"#mongodb高级\">#</a> <strong>mongodb 高级</strong></h3>\n<h5 id=\"索引\"><a class=\"anchor\" href=\"#索引\">#</a> 索引</h5>\n<p><strong>MongoDB 索引</strong></p>\n<ul>\n<li>索引 (Index)<strong> 为了提高查询效率</strong></li>\n<li>MongoDB 的文件类型：<strong>BSON</strong>,Binary JSON, 主要被用作 MongoDB 数据库中的数据存储和网络传输格式。</li>\n<li>假如没有索引，必须扫描这个巨大 BSON 对象集合中的每个文档并选取那些符合查询条件的记录，这样是低效的。</li>\n<li>索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中。</li>\n<li>为某个字段创建索引之后查找速度非常快，ObjectId 是自带的索引（ _ id _ ）。</li>\n</ul>\n<p><strong>创建索引</strong></p>\n<p>创建索引可以直接用 Navicate 等工具，也可以代码中使用：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//...... 省略</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 给 name 字段创建索引之前耗时很大，创建之后耗时很小</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> indexResult <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">\"James\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">explain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>indexResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 创建索引，属性表示字段，值表示升序降序</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">createIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//1 表示升序</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 取消索引</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">const</span> result1 <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">dropIndex</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name_1\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"聚合\"><a class=\"anchor\" href=\"#聚合\">#</a> 聚合</h5>\n<p>聚合操作将来自多个文档的值组合在一起，并且可以对分组数据执行各种操作以返回相应的结果。<br />\n<strong>linux 常用的管道写法：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ps</span> aux <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> mongo</pre></td></tr></table></figure><p><strong>聚合常用的操作符：</strong></p>\n<ul>\n<li>$group 将 collection 中的 document: 分组，可用于统计结果</li>\n<li>$natch 过滤数据，只输出符合结果的文档</li>\n<li>$project 修改输入文档的结构（例如重命名，增加、删除字段，创建结算结果等）</li>\n<li>$sot 将结果进行排序后输出</li>\n<li>$imit 限制管道输出的结果个数</li>\n<li>$skp 跳过制定数量的结果，并且返回剩下的结果</li>\n</ul>\n<p><strong>表达式操作符：</strong></p>\n<ul>\n<li>sum计算总和，{sum:1} 表示返回总和 ×1 的值（即总和的数量），使用 {<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><msup><mo>:</mo><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">sum:&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.751892em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mrel\">:</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span> 制定字段 '} 也能直接获取制定字段的值的总和</li>\n<li>$avg 求平均值</li>\n<li>$min 求 min 值</li>\n<li>$max 求 max 值</li>\n<li>$push 将结果文档中插入值到一个数组中</li>\n<li>$frst 根据文档的排序获取第一个文档数据</li>\n<li>$last 同理，获取最后一个数据</li>\n</ul>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//.....</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> pipeLine <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">$match</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">age</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">$gt</span> <span class=\"token operator\">:</span> <span class=\"token number\">30</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">$group</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">_id</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"$steam\"</span> <span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">total</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">$sum</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"$age\"</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">count</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">$sum</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">$sort</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">total</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cosnt result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> userCollection<span class=\"token punctuation\">.</span><span class=\"token function\">aggregate</span><span class=\"token punctuation\">(</span>pipeLine<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//....</span></pre></td></tr></table></figure><h5 id=\"多表联查\"><a class=\"anchor\" href=\"#多表联查\">#</a> 多表联查</h5>\n<p><strong>普通方式使用多表联查需要两次查询</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 导入 Mongodb 客户端构造函数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> MongoClient<span class=\"token punctuation\">,</span>ObjectId<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mongodb\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建 mongo 实例 (传入 url)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MongoClient</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb://localhost:27017/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 执行函数，连接 mongodb 数据库</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 等待实例连接</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">const</span> db <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">db</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 创建数据库</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">command</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">ping</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//ping 命令</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'connected'</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 获取表</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>     <span class=\"token keyword\">const</span> teamCollection <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'team'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>     <span class=\"token keyword\">const</span> playerCollection <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">collection</span><span class=\"token punctuation\">(</span><span class=\"token string\">'player'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>     <span class=\"token keyword\">const</span> netsTeam <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> teamCollection<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">team</span><span class=\"token operator\">:</span><span class=\"token string\">\"NETS\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>     <span class=\"token keyword\">const</span> netsPlayers <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> playerCollection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">team</span><span class=\"token operator\">:</span>netsTeam<span class=\"token punctuation\">.</span>_id<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>使用聚合中 $lookup 进行多表联查只需要一次查询：</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//...</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> pipeLine2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token literal-property property\">$match</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">team</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">$exists</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token literal-property property\">$lookup</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token literal-property property\">from</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"team\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token literal-property property\">localField</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"team\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token literal-property property\">foreignField</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">as</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"team\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">]</span> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">const</span> playerWithTeam <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> playerCollection<span class=\"token punctuation\">.</span><span class=\"token function\">aggregate</span><span class=\"token punctuation\">(</span>pipeLine2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>playerWithTeam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//...</span></pre></td></tr></table></figure><h3 id=\"数据库设计\"><a class=\"anchor\" href=\"#数据库设计\">#</a> 数据库设计</h3>\n<p><em>MongoDB 最佳设计实践：</em>[https:lwww.mongodb.Com/developer/article/mongodb-schema-design-best-practices/](<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubW9uZ29kYi5jb20vZGV2ZWxvcGVyL2FydGljbGUvbW9uZ29kYi0=\">https://www.mongodb.com/developer/article/mongodb-</span><br />\nschema-design-best-practices/)</p>\n<p>关键问题：数据产生关系的时候，选择内嵌还是引用？</p>\n<p><strong>内嵌模式：</strong></p>\n<p>优势：</p>\n<ul>\n<li>只需要一次查询就可以查询所有的信息。</li>\n<li>避免多集合查询。</li>\n<li>只需要一个操作就可以更新多个信息。</li>\n</ul>\n<p>劣势：</p>\n<ul>\n<li>单个文档太大，查询可能更耗时，获得的无关信息概率增大。</li>\n<li>针对每个文档，MongoDB 有一个 16M 的最大限制，内嵌太多，可能超过这个限制。</li>\n</ul>\n<p><strong>引用模式：</strong></p>\n<p>优势：</p>\n<ul>\n<li>将数据分散到不同文档，数据量会变小。</li>\n<li>不太会超过 16M 最大限制。</li>\n<li>每次查询取得不必要数据的慨率降低。</li>\n</ul>\n<p>劣势：需要多次查询才能获得最终数据</p>\n<p><strong>最佳设计实践：</strong></p>\n<ul>\n<li>\n<p>一对几个：推荐使用内嵌形式</p>\n</li>\n<li>\n<p>一对很多：推荐使用引用形式</p>\n<ul>\n<li>子集合中使用一个字段保存父集合的_id   ； 或者：</li>\n<li>父集合中使用一个数组保存子集合的_id</li>\n</ul>\n</li>\n<li>\n<p>一对亿万：只能子集合中使用一个字段保存父集合的_id</p>\n</li>\n</ul>\n<h3 id=\"访问权限管理\"><a class=\"anchor\" href=\"#访问权限管理\">#</a> <strong>访问权限管理</strong></h3>\n<p><strong>授权文档</strong>：https:/docs.mongodb.com/manual/core/authentication/<br />\n<strong> 内置的 Roles</strong>：https:/docs.mongodb.com/manual/reference/built-in-roles/</p>\n<p><strong>在 mongo 命令行中输入：</strong></p>\n<pre><code class=\"language-cmd\">show dbs\nuse admin\n# mongodb基于RBAC进行权限管理，设置roles可以设置相应的全选，见上。\ndb.createUser(&#123; user : 'root' , pwd : '123456' , roles : ['root'] &#125;) \ndb.auth('root','123456')\n# --auth 开启数据库的权限验证，也可以直接在mongo.conf中配置（先终止运行mongod）\nmongod --config /usr/local/etc/mongo.conf --auth\n# 操作配置了权限管理的数据库\nmongo -u &quot;root&quot; -p &quot;123456&quot; --authenticationDatabase &quot;admin&quot;\n</code></pre>\n<p><strong>初始化一个新数据库以后期望的步骤</strong></p>\n<ul>\n<li>创建 admin 级谜别的 root 用户 /roles:root</li>\n<li>创建对应的数据库 lego</li>\n<li>创建该数据库的管理员 dmq/roles:readWrite</li>\n<li>代码中，使用管理员 dmq 的用户名密码链接数据库并且完成操作。</li>\n</ul>\n<p>步骤如下：</p>\n<pre><code>show dbs\nuse lego\ndb.createUser(&#123; user : &quot;dmq&quot; , pwd : '123456' , roles : [&#123; role : &quot;readWrite&quot; , db : &quot;lego&quot; &#125;]&#125;)\n# 重启服务：mongod --config /usr/local/etc/mongo.conf --auth\n# 这样在mongodb的配置文件中设置用户信息，就保证只能读取数据库信息，保证了数据库的安全。（如果用户信息来自admin数据库就需要配置authSource:'admin'。）\n</code></pre>\n<h1 id=\"mongoose\"><a class=\"anchor\" href=\"#mongoose\">#</a> Mongoose</h1>\n<p><strong>出现的原因：</strong></p>\n<p>使用原生的 mongoDB nodejs driver 数据结构及其操作过于灵活，类似于 ORM：</p>\n<p><strong>mongoose：</strong>（mongoose 之于 mongodb 类似于 ts 之于 js，都是在原有的基础之上加一层抽象层，进行类型定义等操作）</p>\n<p>mongoose：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb25nb29zZWlzLmNvbS8=\">https://mongooseis.com/</span></p>\n<ul>\n<li>建立在 native mongoDB nodejs driver 之上</li>\n<li>提出 Modl, 数据模型的概念，用来约束集合中的数据结构</li>\n<li>非常多扩展的内容</li>\n<li>它是一个 ODM (Object Document Mapping) 工具。</li>\n</ul>\n<h3 id=\"orm\"><a class=\"anchor\" href=\"#orm\">#</a> ORM</h3>\n<p>ORM 指的是<strong> Object Relational Mapping 对象关系映射</strong>，针对于关系型数据库。</p>\n<p><strong>简单说，ORM 就是通过实例对象的语法，完成关系型数据库的操作的技术。</strong></p>\n<p><strong>ORM 优点</strong></p>\n<ul>\n<li>不需要再去写晦涩的 SQL 语句。</li>\n<li>使用面向对象的方式操作数据，代码量少，语义性好，容易理解。</li>\n<li>Classes 类 - Tables</li>\n<li>Objects 实例 - Records (表中的一行数据)</li>\n<li>Attributes 属性 - Records</li>\n<li>内置很多功能，数据验证，清洗，预处理等等操作。</li>\n</ul>\n<h3 id=\"odm\"><a class=\"anchor\" href=\"#odm\">#</a> ODM</h3>\n<p>ODM 指的是<strong> Object Document Mapping 对象文档映射</strong>。ODM 针对于 noSql 数据库，关注文档模型，mongoose 是 ODM 的一种实现，可以用于约束数据类型。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> User <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span><span class=\"token function\">model</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token literal-property property\">username</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">type</span> <span class=\"token operator\">:</span> string <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">type</span> <span class=\"token operator\">:</span> String <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//user object</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">const</span> newUser <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token literal-property property\">username</span><span class=\"token operator\">:</span><span class=\"token string\">\"john-doe\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span><span class=\"token string\">\"helloworld\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">await</span> newUser<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"egg-mongoose\"><a class=\"anchor\" href=\"#egg-mongoose\">#</a> egg-mongoose</h1>\n<p>详见源码，此处省略。</p>\n<h1 id=\"stream\"><a class=\"anchor\" href=\"#stream\">#</a> Stream</h1>\n<h3 id=\"介绍\"><a class=\"anchor\" href=\"#介绍\">#</a> 介绍</h3>\n<p>Stream 的官方文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ub2RlanM=\">https://nodejs</span>,org/api/stream.html<br />\n<strong> 流是 Node.js 中最好，也是最容易误解的慨念</strong><br />\n流就是数据的合集，数据可以是字符串也可以是数组，流的数据不是一次性全部获得的。</p>\n<p>大文件输出方式：</p>\n<ul>\n<li>\n<p>直接读取</p>\n<p>输入的文件 ------------ 读取到内存 ---------------- 输出文件内容</p>\n</li>\n<li>\n<p>流式读取</p>\n<p>输入的文件 ------------ 通过可读流读取到管道 ----------------- 通过可写流输出文件内容</p>\n</li>\n</ul>\n<p><strong>Node.js 支持流的内置模块：</strong></p>\n<p><strong>Readable Streams:</strong></p>\n<ul>\n<li>HTTP responses,on the client</li>\n<li>HTTP requests,on the server</li>\n<li>fs read streams</li>\n<li>zlib streams</li>\n<li>crypto streams</li>\n<li>TCP sockets</li>\n<li>child process stdout and stderr</li>\n<li>process.stdin</li>\n</ul>\n<p><strong>Writable  Streams:</strong></p>\n<ul>\n<li>HTTP requests,on the client</li>\n<li>HTTP responses,on the server</li>\n<li>fs write streams</li>\n<li>zlib streams</li>\n<li>crypto streams</li>\n<li>TCP sockets</li>\n<li>child process stdin</li>\n<li>process.stdout,process.stderr</li>\n</ul>\n<p><strong>流的类型：</strong></p>\n<ul>\n<li>Readable - 可读操作。</li>\n<li>Vritable - 可写操作。</li>\n<li>Duplex - 可读可写操作.</li>\n<li>Transform - 操作被写入数据，然后读出结果。</li>\n</ul>\n<h3 id=\"pipe\"><a class=\"anchor\" href=\"#pipe\">#</a> pipe</h3>\n<p><strong>流的流动：</strong></p>\n<p>可读流 Readable（数据源 input）----------------------pipe 管道 ---------------------------------------- 可写流 Writable（输出 output）</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> createReadStream<span class=\"token punctuation\">,</span> createWriteStream <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> readStream <span class=\"token operator\">=</span> <span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./a.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>readStream<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>可读流 Readable（数据源 input）-------------pipe 管道 --------------- 转换流 Transform----------------pipe 管道 ----------- 可写流 Writable（输出 output）</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> createReadStream<span class=\"token punctuation\">,</span> createWriteStream<span class=\"token punctuation\">,</span> write <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> readStream <span class=\"token operator\">=</span> <span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./a.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> writeStream <span class=\"token operator\">=</span> <span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./b.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>readStream<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>writeStream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"原理-3\"><a class=\"anchor\" href=\"#原理-3\">#</a> 原理</h3>\n<p><strong>流是基于 EventEmitter（事件），pipe 方法是基于事件封装的的语法糖，常见的事件有：</strong></p>\n<p><strong>Readable  Streams：可读流事件和函数</strong></p>\n<ul>\n<li>Events\n<ul>\n<li>data-- 当没有数据时触发</li>\n<li>end-- 没有更多的数据可读时触发</li>\n<li>error-- 在接受和写入过程中发生错误时触发</li>\n<li>finish-- 所有数据已被写入到底层系统时触发</li>\n<li>close</li>\n<li>readable</li>\n</ul>\n</li>\n<li>Functions\n<ul>\n<li>pipe() , unpipe()</li>\n<li>read() , unshift() , resume()</li>\n<li>pause() , isPaused()</li>\n<li>setEncoding()</li>\n</ul>\n</li>\n</ul>\n<p><strong>Writable  Streams：写入流事件和函数</strong></p>\n<ul>\n<li>Events\n<ul>\n<li>drain</li>\n<li>finish</li>\n<li>error</li>\n<li>close</li>\n<li>pipe/unpipe</li>\n</ul>\n</li>\n<li>Functions\n<ul>\n<li>write()</li>\n<li>end()</li>\n<li>cork() , uncork()</li>\n<li>setDefaultEncoding()</li>\n</ul>\n</li>\n</ul>\n<p><strong>pipe 方法原理：</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> createReadStream <span class=\"token punctuation\">,</span> createWriteStream <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> readStream <span class=\"token operator\">=</span> <span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./a.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> writeStream <span class=\"token operator\">=</span> <span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./b.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>readStream<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span> <span class=\"token punctuation\">,</span> <span class=\"token parameter\">chunk</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    writeStream<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>chunk<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>readStream<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'end'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    writeStream<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>压缩：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> createReadStream <span class=\"token punctuation\">,</span> createWriteStream <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'fs'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> createGzip <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'zlib'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> readStream <span class=\"token operator\">=</span> <span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./a.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> writeStream <span class=\"token operator\">=</span> <span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./b.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>readStream<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">createGzip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>writeStream<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>封装：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cosnt savePromise <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>readStream <span class=\"token punctuation\">,</span> writeStream <span class=\"token operator\">=</span> stdout<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span>reject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        readStream</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>writeStream<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'finish'</span><span class=\"token punctuation\">,</span>resolve<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        \t<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>reject<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"pipeline\"><a class=\"anchor\" href=\"#pipeline\">#</a> pipeline</h3>\n<p><strong>使用 pipe 方法有时会存在一个问题：</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//....</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./a.txt'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>stdout<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'finish'</span><span class=\"token punctuation\">,</span>finishFn<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span>errFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 这里监听的是 pipe 后的错误，对于 createReadStream 的错误则会卡死</span></pre></td></tr></table></figure><p><strong>于是推出了 pipeline 方法：</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//...</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">pipeLine</span><span class=\"token punctuation\">(</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">createReadStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./a.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>zlib<span class=\"token punctuation\">.</span><span class=\"token function\">createGzip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./b.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'pipeline failed'</span><span class=\"token punctuation\">,</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'successed'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"对象存储服务\"><a class=\"anchor\" href=\"#对象存储服务\">#</a> 对象存储服务</h1>\n<p><strong>自己完成静态文件存储的问题</strong></p>\n<ul>\n<li>Nod.js 不擅长处理静态文件的存储和展示，没有未静态文件做特殊的优化</li>\n<li>如果将图片生成多种处理格式要耗费大量的资源和空间</li>\n</ul>\n<p><strong>各三方比对</strong></p>\n<h3 id=\"阿里云oss\"><a class=\"anchor\" href=\"#阿里云oss\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYWxpeXVuLmNvbS9wcm9kdWN0Li9vc3M=\">阿里云 OSS</span></h3>\n<p><strong>特点</strong></p>\n<ul>\n<li>支持丰富的图片处理 https://help.aliyun.com/document._detail/44686.html</li>\n<li>egg.js 有对应的插件：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VnZ2pzL2VnZy1vc3M=\">https://github.com/eggjs/egg-oss</span></li>\n</ul>\n<p><strong>价格</strong></p>\n<ul>\n<li>下行流量 100GB 一年 352 元 https://common-buy.aliyun.com/?spm=5176.7933691.J_5253785160.1.2e394c59q3FIsA&amp;commodityCode=ossbag#/buy</li>\n<li>基本图片处理：每月 0-10TB: 免费 &gt; 10TB:0.025 元 / GB</li>\n</ul>\n<h3 id=\"七牛云kodo\"><a class=\"anchor\" href=\"#七牛云kodo\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucWluaXUuY29tL3ByaWNlcy9rb2Rv\">七牛云 KODO</span></h3>\n<p><strong>特点：</strong></p>\n<ul>\n<li>多媒体处理功能非常丰富 https://www.giniu.com/products/dora</li>\n<li>图片视频处理</li>\n<li>审核</li>\n<li>人工智能分析</li>\n</ul>\n<p><strong>价格：</strong></p>\n<ul>\n<li>外网流出 100GB - 年 278.4 元 https://qmall.qiniu.com/template./MTEy?spec_combo=MzE0NQ</li>\n<li>基本图片处理：每月 0-20TB: 免费 20TB 以上：0.025 元 / GB https:/www.qiniu.com/prices/dora</li>\n</ul>\n<h3 id=\"腾讯云cos\"><a class=\"anchor\" href=\"#腾讯云cos\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzQzNg==\">腾讯云 COS</span></h3>\n<p><strong>特点：</strong></p>\n<p>图像处理有一些新的亮点，比如自研的 TPG 压缩等</p>\n<p><strong>价格：</strong></p>\n<ul>\n<li>外网流出 100GB 一年 396 元 https://buy.cloud.tencent..com/price/cos#tab0-list1</li>\n<li>基本图片处理：每月 0-20TB: 免费 20TB 以上：0.025 元 / GB</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kb2N1bWVudC9wcm9kdWN0LzEyNDYvNDUyNzQ=\">https://cloud.tencent.com/document/product/1246/45274</span></li>\n<li>图片压缩：1 元 / 千次</li>\n</ul>\n<h1 id=\"ssr服务端渲染\"><a class=\"anchor\" href=\"#ssr服务端渲染\">#</a> SSR 服务端渲染</h1>\n<h3 id=\"介绍-2\"><a class=\"anchor\" href=\"#介绍-2\">#</a> 介绍</h3>\n<p><strong>SSR-Server Side Rendering</strong></p>\n<p>Vue 关于 SSR 的介绍：https:/sSr.uejs.org/zh</p>\n<p><strong>SSR 的优点</strong></p>\n<ul>\n<li>更好的 SEO</li>\n<li>更快的渲染时间 (Time to content)，</li>\n</ul>\n<p><strong>SSR 的缺点</strong></p>\n<ul>\n<li>\n<p>开发的限制，浏览器相关的操作只能在特定的钩子函数中使用</p>\n</li>\n<li>\n<p>SPA 应用完全静态化，而 SSR app 需要 Node.js Server 才能运行</p>\n</li>\n<li>\n<p>服务端负荷更高</p>\n</li>\n</ul>\n<p><strong>SSR 的实现：</strong></p>\n<ul>\n<li>\n<p>基本原理：@vue/server-renderer https:lv3.uejs.org/guide/ssr/getting-started.html#installation</p>\n</li>\n<li>\n<p>使用 createSSRApp,renderToString 以及 renderToStream 方法</p>\n</li>\n</ul>\n<p><strong>成熟的，大而全的 SSR 通用开发框架：</strong></p>\n<ul>\n<li>Nuxt.js <span class=\"exturl\" data-url=\"aHR0cHM6Ly9udXh0anMub3JnLw==\">https://nuxtjs.org/</span>  （Vue）</li>\n<li>React 类似的 Next.js https:/nextjs.orgl （React）</li>\n</ul>\n<h3 id=\"ssr\"><a class=\"anchor\" href=\"#ssr\">#</a> SSR</h3>\n<p>express 等框架的 res.render 方法可以渲染 html 模板，使用的是 nunjucks 库进行数据填充。</p>\n<p>index.html</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>no-js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>description<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>  //根据传入的props动态添加style样式</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\"></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>index.js  (依据 express 框架为例：)</p>\n<pre><code>//...res是响应参数\nres.render('index',function(err,html)&#123;\n\tres.send(html);\n&#125;)\n</code></pre>\n<h3 id=\"vue中ssr\"><a class=\"anchor\" href=\"#vue中ssr\">#</a> vue 中 SSR</h3>\n<p>1、vue3 有包：@vue/server-renderer，在 3.2.13 版本以上内置了，低于此版本需要自行安装。</p>\n<p>2、使用：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//.......... res 是服务端返回</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> pipeline <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'stream/promises'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> createSSRApp <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> renderToString <span class=\"token punctuation\">,</span> renderToNodeStream <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@vue/server-renderer'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">const</span> vueApp <span class=\"token operator\">=</span> <span class=\"token function\">createSSRApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function-variable function\">data</span><span class=\"token operator\">:</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">msg</span><span class=\"token operator\">:</span><span class=\"token string\">'hello world'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> <span class=\"token string\">'&lt;h1>&lt;/h1>'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">const</span> appContent <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">renderToString</span><span class=\"token punctuation\">(</span>vueApp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>res<span class=\"token punctuation\">.</span>type <span class=\"token operator\">=</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>res<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> appContent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 或者使用流式输出：</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">const</span> stream <span class=\"token operator\">=</span> <span class=\"token function\">renderToNodeStream</span><span class=\"token punctuation\">(</span>vueApp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>res<span class=\"token punctuation\">.</span>statys <span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">await</span> <span class=\"token function\">pipeline</span><span class=\"token punctuation\">(</span>stream<span class=\"token punctuation\">,</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h1 id=\"rbac权限验证\"><a class=\"anchor\" href=\"#rbac权限验证\">#</a> RBAC 权限验证</h1>\n<h3 id=\"介绍-3\"><a class=\"anchor\" href=\"#介绍-3\">#</a> 介绍</h3>\n<p><strong>权限验证的场景以及需求：</strong></p>\n<ul>\n<li>特定的角色的用户才能操作特定的资源</li>\n<li>不同的用户能操作同类资源的特定实体</li>\n<li>不同的用户操作特定资源的不同属性</li>\n</ul>\n<p><strong>谁 (User) 拥有什么权限 (Authority）去操作 (Operation) 哪些资源 (Resource)</strong><br />\n 根据角色完成权限的控制 - RBAC (role based access control)，其实就是在原本用户 ------- 权限的对应关系之上加一层中间层角色：用户 ------ 角色 ----- 权限。好处是使得用户和权限的对应关系更加清晰和易于掌控。</p>\n<h3 id=\"使用\"><a class=\"anchor\" href=\"#使用\">#</a> 使用</h3>\n<p>Node.js 实现 RBAC 的库：</p>\n<ul>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL29udXJ5L2FjY2Vzc2NvbnRyb2w=\">AccessControl.js（不推荐，不维护了）</span></p>\n<ul>\n<li>1.6k Star</li>\n<li>3 年没有更新，很多 issue 没人处理</li>\n<li>不支持 ts</li>\n</ul>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Nhc2Jpbi9ub2RlLWNhc2Jpbg==\">Casbin</span></p>\n<ul>\n<li>1.7k Star</li>\n<li>ts 编写，支持多种编程语言</li>\n<li>概念比较复杂，使用略繁琐</li>\n</ul>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N0YWxuaXkvY2FzbA==\">Casl</span></p>\n<ul>\n<li>\n<p>3.4k Star</p>\n</li>\n<li>\n<p>ts 编写</p>\n</li>\n<li>\n<p>简单易用，可读性良好</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"casl使用\"><a class=\"anchor\" href=\"#casl使用\">#</a> <strong>Casl 使用</strong></h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> AbilityBuilder <span class=\"token punctuation\">,</span> Ability <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@casl/ability'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Work</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">attrs</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>attrs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">const</span> templateWork <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Work</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">id</span> <span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">isTemplate</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">const</span> notWork <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Work</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">id</span> <span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">isTemplate</span> <span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">defineRules</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span> can <span class=\"token punctuation\">,</span> cannot <span class=\"token punctuation\">,</span>build <span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AbilityBuilder</span><span class=\"token punctuation\">(</span>Ability<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">can</span><span class=\"token punctuation\">(</span><span class=\"token string\">'read'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token function\">cannot</span><span class=\"token punctuation\">(</span><span class=\"token string\">'delete'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token function\">can</span><span class=\"token punctuation\">(</span><span class=\"token string\">'update'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Work'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">isTemplate</span><span class=\"token operator\">:</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>templateWork<span class=\"token punctuation\">.</span>constructor<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">const</span> rules <span class=\"token function\">defineRules</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">can</span><span class=\"token punctuation\">(</span><span class=\"token string\">'read'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">can</span><span class=\"token punctuation\">(</span><span class=\"token string\">'delete'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Work'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">can</span><span class=\"token punctuation\">(</span><span class=\"token string\">'update'</span><span class=\"token punctuation\">,</span>templateWork<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">can</span><span class=\"token punctuation\">(</span><span class=\"token string\">'update'</span><span class=\"token punctuation\">,</span>notWork<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"部署-2\"><a class=\"anchor\" href=\"#部署-2\">#</a> 部署</h1>\n<h3 id=\"传统模式\"><a class=\"anchor\" href=\"#传统模式\">#</a> 传统模式</h3>\n<p><strong>本地开发</strong><br />\n使用 egg-bin https:github.com/eggjs/egg-bin, 提供了便捷的方式在本地进行开发、调试、单元测试，它可以自动的监控文件的修改，然后重新运行对应的命令。<br />\n采用的配置文件是：config.default.ts<br />\n 启动开发环境命令为 <code>egg-bin dev</code> <br />\n<strong> 生产环境运行程序</strong><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wbTIua2V5bWV0cmljcy5pby8=\"> pm2-process manager</span></p>\n<p><code>node script.js pm2 start script.js</code></p>\n<p><strong>PM2 的优势：</strong></p>\n<ul>\n<li>cluster 模式运行</li>\n<li>自动重启 auto reload</li>\n<li>热替换 hot reload</li>\n<li>性能监控 Monitoring</li>\n</ul>\n<p><strong>egg.js 中有对应于 PM2 的内置方法：</strong></p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VnZ2pzL2VnZy1zY3JpcHRz\">egg-scripts</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2VnZ2pzL2VnZy1jbHVzdGVy\">egg-cluster</span></li>\n</ul>\n<p><strong>egg.js 生产环境启动和关闭</strong><br />\n <code>egg-scripts start egg-scripts stop</code></p>\n<p><strong>配置文件</strong><br />\n config.prod.ts config.default.ts<br />\n<strong> 编译过程</strong><br />\n需要手动将 ts 转换为 js, 借助<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3doeGF4ZXMvZWdnLXRzLWhlbHBlcg==\"> ets</span><br />\n <code>特别注意将项目中的typscript版本升级到4.4.3 </code></p>\n<p><code>npm run tsc</code></p>\n<h2 id=\"cluster模型\"><a class=\"anchor\" href=\"#cluster模型\">#</a> Cluster 模型</h2>\n<p><strong>Egg.js Cluster 模型的原理</strong><br />\n Egg.js 关于这部分内容的文档：https:l/eggjs.org/zh-cn/core/cluster-and-ipc.html<br />\n<strong> 为什么要采用 Cluster 模式</strong><br />\n JavaScript 代码是运行在单线程上的，那么如果用 Node.js 来做 Web Server, 就无法享受到多核运算的好处。<br />\n<strong>什么是 Cluster 模式</strong><br />\n文档：http:l/nodejs.cn/api/cluster.html</p>\n<p>Node.jS 的单个实例在单个线程中运行。为了利用多核系统，用户有时会想<br />\n要启动 Node.js 进程的集群来处理负载。</p>\n<ul>\n<li>在服务器上同时启动多个进程</li>\n<li>每个进程里都跑的是同一份源代码（将一个进程的工作分给多个进程去做）</li>\n<li>这些进程可以同时监听一个端口</li>\n</ul>\n<p><strong>Cluster 的运行模式：</strong></p>\n<p>Request-------------master_process 主进程 ---------------------workers 进程（多个）</p>\n<p><strong>进程间通信（IPC）：</strong></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU4JUExJThDJUU3JUE4JThCJUU5JTk2JTkzJUU5JTgwJTlBJUU4JUE4JThB\">IPC Inter-Process Communication</span></p>\n<p>IPC 指的是至少两个进程或线程间传送数据或信号的一些技术或者方法，Node.js 将其封装为基于事件的形式便于使用。</p>\n<p><strong>Cluster 使用：</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> http <span class=\"token keyword\">from</span> <span class=\"token string\">'http'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> cluster <span class=\"token keyword\">from</span> <span class=\"token string\">'cluster'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> cpus <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'os'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> process <span class=\"token keyword\">from</span> <span class=\"token string\">'process'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>cluster<span class=\"token punctuation\">.</span>isPrimary<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">master </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>process<span class=\"token punctuation\">.</span>pid<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\"> running</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">const</span> cpuLength <span class=\"token operator\">=</span> <span class=\"token function\">cpus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> cpuLength <span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        cluster<span class=\"token punctuation\">.</span><span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    cluster<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'exit'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">worker</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">worker </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>worker<span class=\"token punctuation\">.</span>process<span class=\"token punctuation\">.</span>pid<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\"> exited</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    http<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span>res</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">writeHead</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">8000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">worker </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>process<span class=\"token punctuation\">.</span>pid<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\"> started</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>cluster<span class=\"token punctuation\">.</span>workers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 获得子进程，可以通过 process.send 和 on ('message') 事件进行进程间通信。</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>egg.js 中对于 Cluster 的二次封装：</strong></p>\n<ul>\n<li>使用 egg-scripts 启动 master process</li>\n<li>使用 egg-cluster 启动和 CPU 核数相等的 app_worker process</li>\n<li>使用 egg-cluster 启动的一个独特的 agent_.worker process</li>\n</ul>\n<p><strong>进程守护</strong><br />\n考虑到生产环境的健壮性，必须保证进程异常的情况下怎样处理。<br />\n<strong>当代码抛出异常并没有被捕获的时候，worker 使用 process.on ('uncaughtException',handler) 来捕获对应的错误，这时进程处于不确定的状态，需要优雅退出。</strong></p>\n<p><strong>系统异常</strong><br />\n而当一个进程出现异常导致 crash 或者被系统杀死时，不像未捕获异常发生时我们还有机会让进程继续执行，Master 立刻 fork 一个新的 Worker。<br />\n<strong>Agent 机制</strong><br />\n有一些特殊性质的工作，不能多个 worker 一起合作，容易造成混乱。对于这种工作 egg.js 提供了一个新的 agent 进程来完成。</p>\n<p><strong>Egg.js 三种进程的总结：</strong></p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>进程数量</th>\n<th>作用</th>\n<th>稳定性</th>\n<th>是否运行业务代码</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Master 进程</td>\n<td>1</td>\n<td>进程管理，进程间消息转发</td>\n<td>非常高</td>\n<td>否</td>\n</tr>\n<tr>\n<td>Agent 进程</td>\n<td>1</td>\n<td>后台运行工作</td>\n<td>高</td>\n<td>少量</td>\n</tr>\n<tr>\n<td>Workers 进程</td>\n<td>CPU 核数</td>\n<td>执行业务代码</td>\n<td>一般</td>\n<td>是</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Cluster 模型和 Node 多进程的区别：</strong></p>\n<ul>\n<li>Cluster 模块可以将一个 node 进程分裂成多个子进程，每个子进程独立运行在 cpu 内核上，以提升应用程序的并发能力和性能，通过主进程和子进程之间的通信来实现负载均衡，处理并发请求。</li>\n<li>node 多进程使用 child_process 模块，其不具备负载均衡和通信机制，需要自行实现进程间通信和负载均衡逻辑。可用于处理长时操作，返回结果给主进程。</li>\n</ul>\n<p><strong>Node.js 压力测试工具：</strong></p>\n<p>模拟高并发场景：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvbG9hZHRlc3Q=\">Loadtest</span></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># n                   总过发送多少个请求</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># c concurrency       同时有几个客户端在发送请求</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># rps request per seconds   每秒发送多少个请求</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>loadtest <span class=\"token parameter variable\">-n</span> <span class=\"token number\">400</span> <span class=\"token parameter variable\">-c</span> <span class=\"token number\">10</span> <span class=\"token parameter variable\">--rps</span> <span class=\"token number\">200</span> http://mysite.com/</pre></td></tr></table></figure><h1 id=\"云服务器\"><a class=\"anchor\" href=\"#云服务器\">#</a> 云服务器</h1>\n<h4 id=\"购买\"><a class=\"anchor\" href=\"#购买\">#</a> 购买</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYWxpeXVuLmNvbS9wcm9kdWN0L2Vjcw==\">阿里云 ECS</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9wcm9kdWN0L2N2bQ==\">腾讯云 CVM</span></p>\n<p>价格（学生优惠）：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9hY3QvY2FtcHVzP2Zyb209MTQ1OTk=\">https://cloud.tencent.com/act/campus?from=14599</span> 12G 38</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHVhd2VpY2xvdWQuY29tL3Byb2R1Y3QvZWNzLmh0bWw=\">华为云 ECS</span></p>\n<h4 id=\"登录\"><a class=\"anchor\" href=\"#登录\">#</a> 登录</h4>\n<p><strong>为什么使用 root 登录时一个不好的实践</strong></p>\n<ul>\n<li>有非常多的 bot 会尝试使用 root+pwd 的 ssh 方式暴力登录机器，当尝试成功以后，黑客就会控制整个系统。</li>\n<li><em>假如使用特定用户名 + pwd,bot 需要先猜测用户名 (N 次)，然后是密码 (M 次)，这样复杂度提升到 N</em>M</li>\n<li>root 可以造成更大的危害，影响整个系统，而某个特定用户只能影响它的文件系统</li>\n</ul>\n<p><strong>创建一个用户账号进行登录</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 远程登录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">ssh</span> root@xxx.xx.xx.xx</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 添加用户以及设置密码</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>adduser dmq</pre></td></tr></table></figure><p><strong>设置该用户拥有 sudo 权限，给予它在登录以后切换到 root 的能力</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 修改权限，u 表示所有者，w 表示写权限 + 表示添加</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">chmod</span> u+w /etc/sudoers</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 编辑文件</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">vim</span> /etc/sudoers</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 找到  `root ALL=(ALL)  ALL`</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 再加一行  `dmq ALL=(ALL)  ALL`</span></pre></td></tr></table></figure><p><strong>使用新用户登录并且测试权限</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ssh</span> dmq@xxx.xx.xx.xx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 可以使用 su 直接切换为 root 用户</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 也可以使用 sudo 快捷的使用 root 权限进行操作</span></pre></td></tr></table></figure><p><strong>禁止使用 root 远程登录 ssh</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 修改 ssh 配置</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">vim</span> /etc/ssh/sshd_config I</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 修改 yes 为 no</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>PermitRootLogin no</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 重启 sshd 服务</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">service</span> sshd restart</pre></td></tr></table></figure><p><strong>可选：不使用密码登录</strong><br />\n为什么使用密码登录有时候是一个不好的实践？<br />\n<strong>非常简单：用户经常使用非常错误（简单的）用户密码，全球最常用的密码是 123456 以及 bc123, 而且用户会在多个账户大量重复使用，所以黑客从别的地方盗取的密码很可能在其他账户也可以使用</strong></p>\n<p><strong>使用 SSH kev 讲行登录</strong><br />\n SSH key 采角了经典的非对称加密技术，可以使用工具创建一个公钥和私钥，你可以将公钥放置在任何的服务器当中，在本地保留私钥。在 ssh 登录的时候，SSH 验证公钥和私钥的合法性，当合法的时候，就可以免密码登录了。证书由 1024Bits 到 4096Bits（128 到 512 字符) 的随机字符组成，<br />\n要比你自己的密码安全的多。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#创建 ssh key pair</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ssh-keygen <span class=\"token parameter variable\">-t</span> rsa <span class=\"token parameter variable\">-b</span> <span class=\"token number\">4096</span> <span class=\"token parameter variable\">-C</span> <span class=\"token string\">\"your email@example.com\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>windows可以使用putty或者git scma软件生成，备注网址：</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>https://www.jianshu.com/p/95262f5eba7a</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 本地 ssh 证书的位置</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>-/.ssh/id rsa</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-/.ssh/id rsa.pub</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 登录远程机器</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">ssh</span> viking@xxx.xx.xx.xx</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 创建受信任的登录密钥</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 这个文件当中的公钥会被当前的主机设置为信任方</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">touch</span> -/.ssh/authorized keys</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 将 id rsa.pub 的文本内容黏贴进来</span></pre></td></tr></table></figure><p><strong>可选，关闭密码登录服务器的功能</strong></p>\n<pre><code class=\"language-bash#修改ssh配置\">vim /etc/ssh/sshd config\n#修改为no\nPasswordAuthentication no\n#重启服务\nservice sshd i restart\n</code></pre>\n<h4 id=\"使用-2\"><a class=\"anchor\" href=\"#使用-2\">#</a> 使用</h4>\n<p><strong>准备云服务器必备软件</strong></p>\n<ul>\n<li>nodejs (16)</li>\n<li>MongoDB</li>\n<li>Redis</li>\n<li>Git</li>\n</ul>\n<p><strong>Linux 发行版的两大家族</strong></p>\n<ul>\n<li>Debian (完全免费的 Linux 发行版)-Ubuntu (基于 Debian, 更加容易上手)-apt 包管理系统 - 软件格式为 deb 包大</li>\n<li>Red Hat (商用 Linux 发行版)-CentOS (Red Hat 减去收费软件)-yum 包管理系统 - 软件格式为 rpm</li>\n</ul>\n<p><strong>软件安装</strong><br />\n<strong>安装 Node.js</strong><br />\n1 安装 nvm 管理 node 版本 https://github.com/nvm-sh/nvm<br />\n2 使用包管理器安装 node 最新版本 https://github.com/nodesource/distributions/blob/master/README.md#deb</p>\n<p><strong>安装 MongoDB</strong><br />\n1 从源代码下载安装，回顾之前的内容<br />\n 2 使用包管理器安装<br />\n Ubuntu:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC90dXRvcmlhbC9pbnN0YWxsLW1vbmdvZGItb24tdWJ1bnR1Lw==\">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/</span><br />\nCentos:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC90dXRvcmlhbC9pbnN0YWxsLW1vbmdvZGItb24tcmVkLWhhdC8=\">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/</span></p>\n<p><strong>安装 Redis</strong><br />\n*1 从源代码下载安装，回顾之前的基础知识<br />\n * 2 使用包管理器安装<br />\n CentOS:<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGlnaXRhbG9jZWFuLmNvbS9jb21tdW5pdHkvdHV0b3JpYWxzL2hvdy10by1pbnN0YWxsLXNlY3VyZS1yZWRpcy1jZW50b3MtNw==\">https://www.digitalocean.com/community/tutorials/how-to-install-secure-redis-centos-7</span><br />\nUbuntu:<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGlnaXRhbG9jZWFuLmNvbS9jb21tdW5pdHkvdHV0b3JpYWxzL2hvdy10by1pbnN0YWxsLWFuZC1zZWN1cmUtcmVkaXMtb24tdWJ1bnR1LTE4LTA0\">https://www.digitalocean.com/community/tutorials/how-to-install-and-secure-redis-on-ubuntu-18-04</span></p>\n<h4 id=\"管理\"><a class=\"anchor\" href=\"#管理\">#</a> 管理</h4>\n<p><strong>使用 service 或者 systemctl 管理服务</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># systemd 模块 - https://en.wikipedia.org/wiki/Systemd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">service</span>  服务名称<span class=\"token punctuation\">(</span>mongod<span class=\"token punctuation\">)</span>  操作指令<span class=\"token punctuation\">(</span>status/start/stop/restart<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>systemctl  操作指令<span class=\"token punctuation\">(</span>start/stop/status/restart/reload<span class=\"token punctuation\">)</span>  服务名称service</pre></td></tr></table></figure><h1 id=\"普通部署\"><a class=\"anchor\" href=\"#普通部署\">#</a> 普通部署</h1>\n<p><strong>在服务器上部署并运行</strong></p>\n<ul>\n<li>\n<p>1 登录远程机器，使用普通用户。</p>\n</li>\n<li>\n<p>2 在自己的目录下面，clone 代码</p>\n</li>\n<li>\n<p>3 安装对应的依赖</p>\n<ul>\n<li>\n<p>可以使用 sharp 淘宝 mirror 来安装比较大的二进制文件。</p>\n</li>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zaGFycC5waXhlbHBsdW1iaW5nLmNvbS9pbnN0YWxsI2NoaW5lc2UtbWlycm9y\">https://sharp.pixelplumbing.com/install#chinese-mirror</span></p>\n</li>\n</ul>\n</li>\n<li>\n<p>4 创建并且设置.env 文件</p>\n</li>\n<li>\n<p>5 开启云服务对应的端口 (7001) 访问。</p>\n<ul>\n<li>\n<p>阿里云：左侧导航 “本实例安全组”，“配置规则”，“手动添加 &quot; 端口</p>\n</li>\n<li>\n<p>其他云平台请自行查看。</p>\n</li>\n</ul>\n</li>\n<li>\n<p>6 启动服务器</p>\n<ul>\n<li>\n<p>确认 mongo,redis 在运行状态</p>\n</li>\n<li>\n<p>npm run tsc</p>\n</li>\n<li>\n<p>npm run start</p>\n</li>\n</ul>\n</li>\n</ul>\n<p>于此可以完成基本的项目部署，但是这种部署方式启动和更新时过于复杂，存在如下问题：</p>\n<p>三个问题</p>\n<ul>\n<li>前置软件的安装，它们在不同操作系统中安装的方式，启动的脚本，预设初始的方式有可能都不相同，这就给我们造成一个很大的困扰，假如你在多台机器上部署的话，可能会遇到各种各样的问题。</li>\n<li>项目需要运行一系列对应的命令才能启动</li>\n<li>项目更新的问题，需要一系列手动的步骤，这是一个非常繁琐，而且容易出错的步骤。有没有更方便的方式可以完成这个过程呢？\n<ul>\n<li>完成对应的 pu 川代码，更新依赖，启动应用的过程</li>\n<li>是在特定的提交自动触发这个过程</li>\n</ul>\n</li>\n</ul>\n<p>想要更加方便的进行部署可以使用如下工具：</p>\n<h2 id=\"docker\"><a class=\"anchor\" href=\"#docker\">#</a> <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS9wcm9kdWN0cy9kb2NrZXItZGVza3RvcA==\">Docker</span></h2>\n<h3 id=\"介绍-4\"><a class=\"anchor\" href=\"#介绍-4\">#</a> 介绍</h3>\n<p><strong>问题</strong><br />\n我们希望有一个工具可以帮我们一键智能部署，假如你要部署在多台不同的机器上，可以不用在担心不同系统，不同版本的差异，以及运行之前需要安装不同软件的痛苦。<br />\n<strong>解决</strong><br />\n当红的虚拟化软件：<span class=\"exturl\" data-url=\"aHR0cHM6L3d3dy5kb2NrZXIuY29tbA==\">Docker</span><br />\nDocker 的进化</p>\n<p><img data-src=\"/images/Snipaste_2024-04-26_20-27-53.jpg\" alt=\"Docker的进化\" /></p>\n<ul>\n<li>传统虚拟机，虚拟硬件以后，需要在上面安装一个完整的操作系统。</li>\n<li>Docker: 推出了容器的概念，每个容器不需要安装完成的操作系统，里面的进程直接运行在 Docker 创造的宿主内核中，不需要虚拟硬件。</li>\n</ul>\n<p><strong>Docker 的优点</strong></p>\n<ul>\n<li>更快速的启动速度</li>\n<li>更少的资源占用</li>\n<li>一致的运行环境，使用户不关注操作系统而只关心应用程序。</li>\n<li>微服务架构，docker 天生适配微服务架构（Docker 有助于将一个复杂系统分解成一系列可组合的部分，这让用户可以用更离散的方式来思考其服务。用户可以在不影响全局的前提下重组软件，使其各部分更易于管理和可插拔。）</li>\n<li>用户可以更准确地控制构建环境的状态，Docker 构建比传统软件构建方法更具有可重现性和可复制性。使持续交付的实现变得更容易。</li>\n</ul>\n<h3 id=\"docker-images\"><a class=\"anchor\" href=\"#docker-images\">#</a> <strong>Docker  images</strong></h3>\n<p>可以在 https:/hub.docker.com/search?g=&amp;type=image 中获取各种官方的镜像，并且可以上传你自己的自定义镜像<br />\n Docker 镜像仓库获取镜像的命令是 docker pull</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 下载镜像</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> pull <span class=\"token operator\">&lt;</span>image-name<span class=\"token operator\">></span>:<span class=\"token operator\">&lt;</span>tag<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 查看以及下载的镜像</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">docker</span> images</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 删除镜像</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">docker</span> rmi <span class=\"token operator\">&lt;</span>image-id<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 上传</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">docker</span> push <span class=\"token operator\">&lt;</span>username<span class=\"token operator\">></span>/<span class=\"token operator\">&lt;</span>repository<span class=\"token operator\">></span>:<span class=\"token operator\">&lt;</span>tag<span class=\"token operator\">></span></pre></td></tr></table></figure><p><strong>使用镜像代理：</strong></p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"registry-mirrors\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">\"https://docker.mirrors.ustc.edu.cn/\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token string\">\"https://reg-mirror.qiniu.com\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><h3 id=\"docker-container\"><a class=\"anchor\" href=\"#docker-container\">#</a> <strong>Docker Container</strong></h3>\n<p><strong>启动 Docker 容器</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-p</span> 主机端口:镜像端口 <span class=\"token parameter variable\">--name</span> 容器名称 镜像名称</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 例如：（--name 容器名称省略）</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">81</span>:80 nginx</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># -d  后台运行</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># -p  端口映射，81 为主机的端口，80 为镜像端口</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># --name 自定义容器名称</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 镜像名称，假如本地没有，会自动 pull 一次镜像进行下载。</span></pre></td></tr></table></figure><p><strong>其他命令</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 查看所有容器</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span>  <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 停止容器</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">docker</span> stop container-id</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 删除容器</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token function\">rm</span> container-id</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 启动已终止容器</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">docker</span> container start container-id</pre></td></tr></table></figure><p><strong>进入容器内部</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> <span class=\"token operator\">&lt;</span>container-id<span class=\"token operator\">></span> <span class=\"token builtin class-name\">command</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter variable\">-i</span> <span class=\"token builtin class-name\">:</span> 即使没有附加也保持STDIN 打开</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter variable\">-t</span> <span class=\"token builtin class-name\">:</span> 分配一个伪终端</pre></td></tr></table></figure><h3 id=\"持久化容器数据\"><a class=\"anchor\" href=\"#持久化容器数据\">#</a> <strong>持久化容器数据</strong></h3>\n<p>使用 - v 参数，可以设定一个数据的映射关系，将本地的文件映射到容器中对应的文件中去。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-p</span> <span class=\"token number\">81</span>:80 <span class=\"token parameter variable\">-v</span> host:container image-name</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#例如：将本地数据卷映射到容器中</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-v</span> /data/db:/data/db mongo</pre></td></tr></table></figure><p><strong>创建对应的数据卷 volumn</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 创建数据卷</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> volume create <span class=\"token operator\">&lt;</span>volumn-name<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#例如：docker volume create mongo</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 使用 volumn 数据卷</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-v</span> <span class=\"token operator\">&lt;</span>volumn-name<span class=\"token operator\">></span>:/data/db mongo</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 例如：docker run -d -v mongo:/data/db mongo</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 检查数据卷</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">docker</span> volume inspect <span class=\"token operator\">&lt;</span>volumn-name<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 删除数据卷</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">docker</span> volume remove mongo</pre></td></tr></table></figure><h3 id=\"dockerfile自定义镜像\"><a class=\"anchor\" href=\"#dockerfile自定义镜像\">#</a> Dockerfile 自定义镜像</h3>\n<p>Docker image 中的镜像虽然非常多，但是不能完全符合自己项目的全部需求，可以自定义构建一个自己的镜像。</p>\n<p>Dockerfile 是一个特殊的文本文件，其中包括一系列指令，用于构建对应的镜像。</p>\n<p><strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9idWlsZGVyLyNmcm9t\">指令</span></strong></p>\n<p><strong>Dockerfile 示例：</strong></p>\n<figure class=\"highlight dockerfile\"><figcaption data-lang=\"Docker\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 指定基础镜像，从 node14 开始构建</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:14</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 创建对应的文件夹，作为项目运行的位置</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> mkdir -p /usr/src/app</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 指定工作区，后面的运行任何命令都是在这个工作区中完成的</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /usr/sec/app</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 从本地拷贝对应的文件 到 工作区</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">COPY</span> server.js /usr/src/app</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 执行安装命令</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm install --registry=https://registry.npm.taobao.org</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> npm run tsc</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#告知当前 Docker image 暴露的是 3000 端☐</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 3000</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#执行启动命令，一个 Dockerfile 只能有一个</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">CMD</span> node server.js</span></pre></td></tr></table></figure><p><strong>构建：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 这里特别注意上下文的概念，不要在根目录使用 Dockerfi1e</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> build <span class=\"token punctuation\">[</span>选项<span class=\"token punctuation\">]</span> <span class=\"token operator\">&lt;</span>上下文路径/URL/-<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 例如：(在项目文件夹中运行)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> test-node <span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p><strong>.dockerignore 文件用于忽略 docker 中需要打包进镜像的文件</strong></p>\n<p><strong>.dockerignore 示例：</strong></p>\n<figure class=\"highlight dockerfile\"><figcaption data-lang=\"Docker\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Microbundle cache</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>.rpt2_cache/</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>.rts2_cache_cjs/</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>.rts2_cache_es/</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>.rts2_cache_umd/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Optional REPL history</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>.node_repl_history</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># Output of 'npm pack'</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>*.tgz</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># Yarn Integrity file</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>.yarn-integrity</pre></td></tr></table></figure><p><strong>多个容器相互通信：</strong></p>\n<p>要点：Docker 中每一个 container 应该只完成一个工作，并且将它做好。</p>\n<p><strong>优点：</strong></p>\n<ul>\n<li>解耦，这样不同的服务和后端代砀都可以完全分离开来，方便管理以及未来的扩展。</li>\n<li>服务的更新以及升级都是完全独立的。</li>\n<li>在一个 container 中，启动多个不同的进程，需要一个进程管理器</li>\n</ul>\n<p><strong>通信过程：</strong></p>\n<p>docker 容器之间不能直接进行访问，而是应该通过 docker 网络进行访问。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 创建 docker 网络</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> network create <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 在创建的 docker 网络中启动服务</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--network</span> <span class=\"token builtin class-name\">test</span> <span class=\"token parameter variable\">--name</span> mongo <span class=\"token parameter variable\">-p</span> <span class=\"token number\">27017</span>:27017 mongo</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 将原来项目中的的 ip 地址替换为 docker 的 name 名称</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 例如原来为：mongodb://localhost:27017/api  的地址要替换为： mongodb://mongo:27017/api</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 只有在同一个 docker 网络中启动的项目间才能进行访问。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--network</span> <span class=\"token builtin class-name\">test</span> <span class=\"token parameter variable\">--name</span> use <span class=\"token parameter variable\">-p</span> <span class=\"token number\">80</span>:3000 use</pre></td></tr></table></figure><p>如果每个容器都要这样操作一遍就会显得非常麻烦，这时就需要使用 Docer compose 工具（配置 docker-compose.yml 文件）</p>\n<p>Docker compose 工具</p>\n<p>Docker compose 是 Docker 官方推出的工具，用来管理和共享多个容器的应用，Mac 系统和 Windows 系统安装客户端时自带。<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29tcG9zZS9pbnN0YWxsLw==\">Linux 需要单独安装</span>。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker-compose</span> version</pre></td></tr></table></figure><p><strong>配置：</strong></p>\n<ul>\n<li>docker compose 通过一个特殊的 yml 文件，进行配置，这个文件必须命名为<strong> docker-compose.yml</strong></li>\n<li>docker-compose 所有的字段参考文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vY29tcG9zZS9jb21wb3NlLWZpbGUvY29tcG9zZS1maWxlLXYzLw==\">https://docs.docker.com/compose/compose-file/compose-file-v3/</span></li>\n</ul>\n<p><strong>docker-compose.yml 文件配置示例：</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span> <span class=\"token comment\"># docker 指令版本</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 要启动的服务</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">test-mongo</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 服务名称，这里的服务名称对应着容器通信时的前缀！</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo <span class=\"token comment\"># 使用的镜像名称</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">-</span>mongo <span class=\"token comment\"># 容器名称</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 使用的数据卷映射</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">'.docker-volumes/mongo/data:/data/db'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 端口映射</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">-</span> 27017<span class=\"token punctuation\">:</span><span class=\"token number\">27017</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 设置环境变量</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">-</span> MONGO_INITDB_ROOT_USERNAME=admin  <span class=\"token comment\"># 内置的环境变量，可以初始化添加一个 User</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">-</span> MONGO_INITDB_ROOT_PASSWORD=pass</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">env_file</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 设置环境变量文件，将敏感信息放置到环境变量文件中</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> .env</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">test-use</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 第二个项目，注意对齐关系</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 配置所依赖的服务</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">-</span> test<span class=\"token punctuation\">-</span>mongo</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 设置构建配置</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> . <span class=\"token comment\"># 操作上下文为当前目录</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token key atrule\">dockerfile</span><span class=\"token punctuation\">:</span> Dockerfile <span class=\"token comment\"># 基于 Dockerfile 进行构建</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">-</span>use<span class=\"token punctuation\">-</span>image</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">-</span>use</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">-</span> 7001<span class=\"token punctuation\">:</span><span class=\"token number\">7001</span></pre></td></tr></table></figure><p><strong>启动以及关闭：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 启动</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker-compose</span> up <span class=\"token parameter variable\">-d</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 关闭</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">docker-compose</span> down</pre></td></tr></table></figure><h3 id=\"数据库配置\"><a class=\"anchor\" href=\"#数据库配置\">#</a> 数据库配置</h3>\n<p><strong>数据库准备工作</strong></p>\n<ul>\n<li>数据库配置，初始化工作，比如插入一些特定的数据</li>\n<li>避免使用 root 用户去启动服务，从而提高安全性（配置数据库访问权限）</li>\n</ul>\n<p><strong>特殊的初始化数据库的位置：/docker-entrypoint-initdb.d（这个文件夹中的脚本会在容器启动前自动执行）</strong></p>\n<ul>\n<li>\n<p>可以创建 js 文件或者 sh 文件（shell）进行执行。</p>\n</li>\n<li>\n<p>mongoDB：https:hub.docker,com/_/mongo</p>\n</li>\n<li>\n<p>Postgres:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9fbHBvc3RncmVz\">https://hub.docker.com/_lpostgres</span></p>\n</li>\n<li>\n<p>特别注意，只有在数据库没有被创建的情况下，也就是<strong>数据库的文件夹是空的情况下</strong>，脚本才会被执行。</p>\n</li>\n</ul>\n<p><strong>docker-compose.yml 文件中配置 env_file 为当前文件夹下的.env 文件。</strong></p>\n<p>可以使用 js 文件或者 sh 文件，但是由于此文件在其余文件之前运行，此时 js 文件中通过 process.env 获取不到所需要的环境变量，可以选用 sh 文件。</p>\n<p><strong>Shell 中 EOF&lt;&lt; 的用法</strong><br />\n在 Shell 中我们通常将 EOF 与 &lt; 结合使用，表示，二债的输入作为子命令或子 Shell 的输入，直到遇到 EOF 为止，再返回到主调 Shell。.</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mongo <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>use admin</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>db.auth('root','123456')</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>use lego</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>db.createUser(&#123;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tuser: '<span class=\"token variable\">$MONGO_DB_USERNAME</span>',</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tpwd: '<span class=\"token variable\">$MONGO_DB_PASSWORD</span>',</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\troles: [&#123;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\trole: 'readWrite',</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\tdb: 'lego'</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t&#125;]</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>&#125;)</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>db.createCollection('works')</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>db.works.insertMany([</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t&#123;</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  \t\tid:19,</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  \t\ttitle:'测试标题',</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  \t\tname:'张三'</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t&#125;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>])</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>EOF</span></pre></td></tr></table></figure><h3 id=\"优化镜像大小\"><a class=\"anchor\" href=\"#优化镜像大小\">#</a> 优化镜像大小</h3>\n<p><strong>Docker 镜像构建优化：使用 alpine 版本的镜像</strong></p>\n<p>优化镜像大小  ：   什么是 Alpine Linux:https:l/alpinelinux.orgl</p>\n<p><strong>Alpine 的优点</strong></p>\n<ul>\n<li>\n<p>Small 小</p>\n<ul>\n<li>\n<p>默认软件包，alpine 选择 busybox</p>\n</li>\n<li>\n<p>C 运行库，一般会用 glibc,alpine 选择 musl</p>\n</li>\n</ul>\n</li>\n<li>\n<p>最简依赖，Simple</p>\n<ul>\n<li>\n<p>很多内置软件的插件都去掉。</p>\n</li>\n<li>\n<p>国际化内容都被删除</p>\n</li>\n</ul>\n</li>\n<li>\n<p>Secure 安全</p>\n</li>\n</ul>\n<p><strong>使用 alpine 版本的镜像可以大大减小镜像的体积。</strong></p>\n<p><strong>DockerBuild 构建提速</strong></p>\n<p>docker 中运行命令是基于一层一层的，当修改文件之后，COPY 后的缓存全部失效，这时就会重新执行后续命令，使用不了缓存，导致构建速度很慢。此时可以将原来 COPY 文件夹，改为 COPY 具体的文件（进行拆分），以更好地使用缓存。</p>\n<h3 id=\"部署-3\"><a class=\"anchor\" href=\"#部署-3\">#</a> 部署</h3>\n<p><strong>安装 Docker（有的云服务可以自定义安装）</strong></p>\n<p>Ubuntu：（需要使用 root 账户进行安装）</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVub29i\">https://www.runoob</span>..com/docker/ubuntu-docker-install.html</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2luc3RhbGwvdWJ1bnR1Lw==\">https://docs.docker.com/engine/install/ubuntu/</span></li>\n</ul>\n<p><strong>配置用户组</strong><br />\n因为是 root 安装，普通用户执行对应的命令的时候有可能会报错：<br />\n <code>Can't connect to docker daemonGot permission denied while trying to connect to the Docker daemonsocket at unix:///var/run/docker.sock</code></p>\n<p><strong>需要将对应的用户添加到 docker 的用户组中。</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#usermod 命令修改用户账户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#a--append 添加 - G--groups</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>组的名称</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">sudo</span> usermod-aG docker你的用户名</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#如果组不存在，添加对应的 docker 组</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">groupadd</span> <span class=\"token function\">docker</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#查看一个用户所属的组</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">groups</span></pre></td></tr></table></figure><p><strong>添加下载镜像：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># root</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">vim</span> /etc/docker/daemon.json</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token string\">\"registry-mirrors\"</span><span class=\"token builtin class-name\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token string\">\"https://docker.mirrors.ustc.edu.cn/\"</span>,</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token string\">\"https://reg-mirror.qiniu.com\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p><strong>运行：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 拉最新的代码</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">git</span> pull</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 先查看目前端口是否被占用</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 如果被占用，释放端口</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 或者改变 docker-compose,yml 的映射端口</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">docker-compose</span> up <span class=\"token parameter variable\">-d</span></pre></td></tr></table></figure><h1 id=\"yaml语言\"><a class=\"anchor\" href=\"#yaml语言\">#</a> YAML 语言</h1>\n<p>YAML<br />\n (YAML Ain't a Markup Language) 是一种标记语言，它使用空格作为缩进，看起来非常的简洁，可读性非常的好，非常适合一些内容大纲和配置文件。他最终是通过工具转化为 JSON 文件的，但是 YAML 的可读性比 JSON 强很多，因此复杂的配置文件一般使用 YAML。</p>\n<p><strong>例如：</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 字符串不用加引号</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> value</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">boolean</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 字符串不用加引号，但是加上也不会报错</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">quote_string</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'quote String'</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 多行字符串使用 literal block 语法：也就是竖线</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">mutiple_string</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  line one</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  line two</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  line three</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># collection types 集合类型</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 使用缩进表示层级关系，最好使用两个空格，不是两个空格也没关系，对齐就行</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">person</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dmq</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token key atrule\">age</span><span class=\"token punctuation\">:</span> <span class=\"token number\">18</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token key atrule\">address</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">city</span><span class=\"token punctuation\">:</span> 上海</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># sequences 数组或者列表</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key atrule\">hobbies</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">-</span> Item 1</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">-</span> Item 2</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> weson</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> xyz</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">address</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token key atrule\">city</span><span class=\"token punctuation\">:</span> 北京</pre></td></tr></table></figure><h1 id=\"github-action\"><a class=\"anchor\" href=\"#github-action\">#</a> Github Action</h1>\n<p>Github 官方的 CI/CD 工具，作为 github 的亲儿子，和 github 几乎是完美的无缝衔接的，功能非常强大。</p>\n<p>CI   CD 常用工具：</p>\n<ul>\n<li>Github actions <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vZW4vYWN0aW9ucw==\">https://docs.github.com/en/actions</span></li>\n<li>Travis <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudHJhdmlzLWNpLmNvbS8=\">https://www.travis-ci.com/</span></li>\n<li>CircleCl <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaXJjbGVjaS5jb20v\">https://circleci.com/</span></li>\n<li>Jenkins <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamVua2lucy5pby8=\">https://www.jenkins.io/</span></li>\n<li>优势讨论：htps:/www.zhihu.com/question/306195033/answer/1870322118</li>\n</ul>\n<p><img data-src=\"/images/Snipaste_2024-04-27_18-37-04.jpg\" alt=\"/images/Snipaste_2024-04-16_12-54-33.jpg\" /></p>\n<p><strong>Workflow</strong><br />\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vY24vYWN0aW9ucy9sZWFybi1naXRodWItYWN0aW9ucy91bmRlcnN0YW5kaW5nLWdpdGh1Yi1hY3Rpb25zI3dvcmtmbG93cw==\">https://docs.github.com/cn/actions/learn-github-actions/understanding-github-actions#workflows</span><br />\nWorkflow 是一个可配置的自动化流程，可以包含多个 jobs, 通过一个在 repo 当中的 yml 文件来定义对应的流程，一个 repo 可以包含多个 workflow。<br />\n<strong>Events</strong><br />\nEvent 是触发 workflow 的特殊事件，比如 pull request,push 或者 issue, 也可以完全自定义，完整列表请看：https:/docs.github.com/cn/actions/learn-github-actions/events-that-trigger-workflows</p>\n<p><strong>Jobs</strong></p>\n<p>Job 是 Workflow 当中一系列的可执行步骤，每个 Job 是在同一个 runner 中进行的（(Runner 是指处于 github 的一台特殊的虚拟机，支持各种操作系统)，每个步骤或者是一个 shell 脚本，抑或是一个可执行的 action, 每个步骤是按顺序执行，并且互相依赖的。</p>\n<p><img data-src=\"Snipaste_2024-04-27_19-54-06.jpg\" alt=\"/images/Snipaste_2024-04-16_12-54-33.jpg\" /></p>\n<p><strong>Actions</strong></p>\n<p>Action 是 github actions 中的一个自定义应用，它可以运行一系列复杂的并且常用的任务，使用 action 可以帮我们减少在 workflow 中写重复代码，Github 提供了非常多常用的 action, 可以在<span class=\"exturl\" data-url=\"aHR0cHM6Z2l0aHViLmNvbS9tYXJrZXRwbGFjZT90eXBlPWFjdGlvbnM=\">这里查阅</span>，同时我们也可以写自己的 action。</p>\n<p><strong>github secrets</strong></p>\n<p>项目中有的私密信息不希望公开暴露，通常的做法是将私密信息写道 env 文件中，使用 gitingore 将其忽略掉，这里还有一个做法就是 github secrets，在 github 官网设置 github secret，然后在文件中直接书写变量。</p>\n<p><strong>例如：.github 文件夹下 workflow 文件夹下创建一个 yml 文件，写入：</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Github Actions Demo</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>push<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">Check-Github-actions</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"triggered by a $&lt;<span class=\"token tag\">!--swig</span>￼5<span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span><span class=\"token punctuation\">></span> event\"</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"running on a $&lt;<span class=\"token tag\">!--swig</span>￼6<span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span><span class=\"token punctuation\">></span> server hosted by github\"</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> check out repo code</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2 <span class=\"token comment\"># 在工作流程中检出代码仓库的内容、确保工作流程始终使用一致的代码版本</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"the $&lt;<span class=\"token tag\">!--swig</span>￼7<span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span><span class=\"token punctuation\">></span> has been cloned\"</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> List files in the repo</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          ls $</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token key atrule\">width</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>          <span class=\"token key atrule\">repository</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'vikingmute/lego-bricks'</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> List files in the repo</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          ls $</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v2</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'16'</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> node <span class=\"token punctuation\">-</span>v</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install <span class=\"token punctuation\">-</span>g typescript</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> tsc <span class=\"token punctuation\">-</span>v</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token key atrule\">SECRET-SSH-ACTIONS</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token comment\">#使用 ssh-action 完成远程登陆：文档地址：https://github.com/appleboy/ssh-action</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> appleboy/ssh<span class=\"token punctuation\">-</span>action@master </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>          <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> $&lt;<span class=\"token tag\">!--swig</span>￼10<span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span><span class=\"token punctuation\">></span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            username: $</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            password: $</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            script_stop: true</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            script: |</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>              pwd</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>              ls -l</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>              touch secret.txt</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>              echo $ >> secret.txt</span></pre></td></tr></table></figure><h1 id=\"自动化部署\"><a class=\"anchor\" href=\"#自动化部署\">#</a> 自动化部署</h1>\n<h2 id=\"推送远程镜像仓库\"><a class=\"anchor\" href=\"#推送远程镜像仓库\">#</a> 推送远程镜像仓库</h2>\n<p><strong>普通线上更新流程：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 每次代码更新以后，登录到 ssh 服务器</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 关闭服务</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker-compose</span> down</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 更新代码</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">git</span> pull</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 假如有.env，的更新需要重新设置，env 文件</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 重新 build 应用镜像</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">docker-compose</span> build lego-backend</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 重启服务</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">docker-compose</span> up <span class=\"token parameter variable\">-d</span></pre></td></tr></table></figure><p><strong>弊端：</strong></p>\n<ul>\n<li>\n<p>初次上线和更新属于两步</p>\n</li>\n<li>\n<p>初次上线需要特别的操作，就是之前手动部署上线的运行的过程</p>\n<ul>\n<li>\n<p>clone 代码</p>\n</li>\n<li>\n<p>设置环境变量.env</p>\n</li>\n<li>\n<p>docker-compose up -d</p>\n</li>\n</ul>\n</li>\n</ul>\n<p><strong>追求的成果：</strong></p>\n<p><strong>每次提交，可以自动一次性的部署到任何服务器，实现初次启动或者更新的效果，这才是一个完美的 devops 的流程</strong></p>\n<p><strong>解决方案：</strong></p>\n<p>将上面本地的镜像存在于 docker hub 服务器中，这样每次就不用重新 build，而是直接拉取。</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">lego-redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    image<span class=\"token punctuation\">:</span>redis<span class=\"token punctuation\">:</span><span class=\"token number\">6</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">lego-mongo</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    image<span class=\"token punctuation\">:</span>mongo<span class=\"token punctuation\">:</span>latest</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">lego-backend</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    image<span class=\"token punctuation\">:</span>lego<span class=\"token punctuation\">-</span>backend</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#我们需要每次手动的 build 镜像，也就说镜像只存在于本地</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">...</span><span class=\"token punctuation\">...</span>context<span class=\"token punctuation\">:</span>.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    dockerfile<span class=\"token punctuation\">:</span>Dockerfile</pre></td></tr></table></figure><p><strong>改为：</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 更好的方案</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 不需要任何代码库中的文件，只需要一个 docker-compose,yml 文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 就可以轻松的在任何服务器运行</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">lego-redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    image<span class=\"token punctuation\">:</span>redis<span class=\"token punctuation\">:</span><span class=\"token number\">6</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  lego<span class=\"token punctuation\">-</span>mongo</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    image<span class=\"token punctuation\">:</span>mongo<span class=\"token punctuation\">:</span>latest</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">lego-backend</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 不需要 build, 而是存在于 docker hub 服务器中，可以每次直接拉取</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    image<span class=\"token punctuation\">:</span>lego<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">:</span>1.0.1</pre></td></tr></table></figure><p><strong>docker hub 免费版有限制，推荐使用阿里云容器镜像服务：</strong></p>\n<p><strong><span class=\"exturl\" data-url=\"aHR0cHM6bFd3dy5hbGl5dW4uY29tL3Byb2R1Y3QvYWNy\">阿里云容器镜像服务 ACR</span></strong><br />\n 个人版完全免费</p>\n<p>创建镜像仓库之后，需要将本地镜像推送到 ACR 仓库中：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 来到镜像仓库的基本信息页面</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 登录</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">docker</span> login <span class=\"token parameter variable\">--username</span><span class=\"token operator\">=</span>用户名 registry.cn-hangzhou.aliyuncs.com</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># tag 两种方式：</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 1: 使用 tag bui1d</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">docker</span> build--tag <span class=\"token string\">\"registry.cn-hangzhou.aliyuncs.com/dmq00/test:[镜像版本号]\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 2: 给 build 好的打 tag</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">docker</span> tag <span class=\"token punctuation\">[</span>ImageId<span class=\"token punctuation\">]</span> registry.cn-hangzhou.aliyuncs.com/dmq00/test:<span class=\"token punctuation\">[</span>镜像版本号<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 查看镜像是否 build 完成</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">docker</span> images</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 推送镜像</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">docker</span> push registry.cn-hangzhou.aliyuncs.com/dmq00/test:<span class=\"token punctuation\">[</span>镜像版本号<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 在阿里云 ACR 界面检查看是否已经存在</span></pre></td></tr></table></figure><h2 id=\"github-actions自动部署\"><a class=\"anchor\" href=\"#github-actions自动部署\">#</a> Github Actions 自动部署</h2>\n<p><strong>使用 github actions 加成自动化部署：当推送代码到 github 仓库时，让我们的代码自动提交镜像到镜像仓库。</strong></p>\n<p><strong>大体分为两步</strong></p>\n<ul>\n<li>\n<h6 id=\"在github服务器上build-image并且push\"><a class=\"anchor\" href=\"#在github服务器上build-image并且push\">#</a> 在 github 服务器上 build image 并且 push</h6>\n</li>\n<li>\n<p><strong>使用 docker-compose-online 文件在服务器上运行应用</strong></p>\n</li>\n</ul>\n<p><strong>第一步详细流程分析，在 github runner 上运行</strong></p>\n<ul>\n<li>\n<p>checkout 代码（在 github 服务器上）</p>\n</li>\n<li>\n<p>创建.env 文件，并且添加两个环境变量 (upload to OSS 需要两个对应的信息)</p>\n</li>\n<li>\n<p>使用阿里云 ACR 完成 docker login</p>\n</li>\n<li>\n<p>使用正确的阿里云 tag 进行 docker build</p>\n<ul>\n<li>怎样每次 push 生成特殊的 tag？是一个后续的问题</li>\n</ul>\n</li>\n<li>\n<p>docker push</p>\n</li>\n</ul>\n<p>例如：【1】在项目文件夹.github/workflow 下创建 yml 文件，写入：</p>\n<pre><code>name: build image,push to ACR\non: [push]\njobs:\n  build-and-push:\n    runs-on: ubuntu-latest\n    steps:\n      # checkout 代码\n      - uses: actions/checkout@v2\n      # 创建env文件\n      - run: touch .env\n      # 使用“ &gt;&gt; ”添加信息\n      - run: echo ALC_ACCESS_KEY=$&#123;&#123; secrets.ALC_ACCESS_KEY &#125;&#125; &gt;&gt; .env\n      - run: echo ALC_SECRET_KEY=$&#123;&#123; secrets.ALC_SECRET_KEY &#125;&#125; &gt;&gt; .env\n      # 使用阿里云ACR 完成 docker login\n      - name: Login to Aliyun ACR\n        uses: aliyun/acr-login@v1 # 使用专属的镜像\n        with:\n          login-server: https://registry.cn-hangzhou.aliyuncs.com\n          region-id: cn-hangzhou # 查看官网自己仓库的信息\n          username: &quot;$&#123;&#123; secrets.ACR_USERNAME &#125;&#125;&quot;\n          password: &quot;$&#123;&#123; secrets.ACR_PASSWORD &#125;&#125;&quot;\n        # 使用正确的阿里云 tag 进行 docker build\n        - name: Build image for Docker\n          run: docker build --tag &quot;registry.cn-hangzhou.aliyuncs.com/dmq00/test:0.0.2&quot;\n        - name: Push Image to ACR\n          run: docker push registry.cn-hangzhou.aliyuncs.com/dmq00/test:0.0.2\n</code></pre>\n<p>这样就能保证代码 push 到 github 上之后自动将镜像推送到 docker 镜像仓库，结合 dockerfile 文件就能保证使用 docker 镜像时自动执行命令，安装对应依赖并执行项目。</p>\n<p><strong>第二步详细流程分析，在服务器上部署对应的代码并且运行</strong></p>\n<ul>\n<li>\n<p>checkout 代码</p>\n</li>\n<li>\n<p>创建.env 文件，添加多个环境变量。(应用所有需要的环境变量)，github  secrets 中添加。</p>\n</li>\n<li>\n<p>创建文件夹，拷贝如下文件到文件夹内</p>\n<ul>\n<li>.env</li>\n<li>docker-compose-online.yml</li>\n<li>mongo-entrypoint 文件夹</li>\n</ul>\n</li>\n<li>\n<p>将新建的文件夹拷贝到服务器 (SCP) 当中</p>\n<ul>\n<li>使用 https:/github.com/appleboy/scp-action</li>\n</ul>\n</li>\n<li>\n<p>SSH 到服务器中</p>\n<ul>\n<li>进入拷贝的文件夹内</li>\n<li>登录阿里云 ACR</li>\n<li>停止服务 docker-compose down （第一次的话，没有启动也不会报错）</li>\n<li>启动服务 docker-compose up</li>\n<li>清理工作可选，保证安全（删除.env 文件，登出 docker 账户）</li>\n</ul>\n</li>\n</ul>\n<p><strong>后续过程需要完成：</strong></p>\n<ul>\n<li>\n<p>在 push tags 的时候才触发对应的 job</p>\n<p>：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vY24vYWN0aW9ucy9sZWFybi1naXRodWItYWN0aW9ucy9ldmVudHMtdGhhdC10cmlnZ2VyLXdvcmtmbG93cw==\">https://docs.github.com/cn/actions/learn-github-actions/events-that-trigger-workflows</span></p>\n</li>\n<li>\n<p>怎样获取对应的每次提交相关的特殊信息</p>\n<p>：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vZW4vYWN0aW9ucy9sZWFybi1naXRodWItYWN0aW9ucy9jb250ZXh0cw==\">https://docs.github.com/en/actions/learn-github-actions/contexts</span></p>\n</li>\n<li>\n<p>使用这个特殊信息，在对应的 docker-compose-online.yml 中进行替换，将要启动的版本替换为将要构建的版本。</p>\n</li>\n</ul>\n",
            "tags": [
                "复杂业务部署与优化",
                "复杂业务部署与优化"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/30/jest/",
            "url": "https://dmqweb.cn/2024/03/30/jest/",
            "title": "jest",
            "date_published": "2024-03-30T12:33:01.000Z",
            "content_html": "<h1 id=\"jest测试\"><a class=\"anchor\" href=\"#jest测试\">#</a> jest 测试</h1>\n<p>市面上有很多测试框架，例如：mocha 、jasmine、vue test utils、vitest、react testing library 和 testing frameworks for jacascript 等，但语法和思想大致相同，现在依 jest 框架进行简单的使用</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * jest 简单的语法</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * expect  toBe 语法</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tow plus to 4'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token operator\">+</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> * toEqual 语法，递归检查对象或数组的每个字段</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'object assignment'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">\"张三\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    data<span class=\"token punctuation\">[</span><span class=\"token string\">'age'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">18</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span><span class=\"token string\">\"张三\"</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">age</span><span class=\"token operator\">:</span><span class=\"token number\">18</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> * expect  not  toBe</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'adding is not 0'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> j<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>j<span class=\"token operator\">&lt;</span><span class=\"token number\">5</span><span class=\"token punctuation\">;</span>j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"27\"></td><td><pre> * 检查指定空类型（null,undefined,defined，true 和 false）</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toBe null'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">const</span> n <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toBe defined'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token keyword\">const</span> n <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toBe Undefined'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">let</span> n<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeUndefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toBe Truthy'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">const</span> n <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">const</span> m <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">&amp;&amp;</span> m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeTruthy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'toBe falsy'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">const</span> n <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">const</span> m <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">&amp;&amp;</span> m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeFalsy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"52\"></td><td><pre> * jest 对 0 进行精确测试的结果</pre></td></tr><tr><td data-num=\"53\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'zero'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token keyword\">const</span> z <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBeNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 非 null</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//defined</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBeUndefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBeTruthy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 非 true</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeFalsy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//false</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"63\"></td><td><pre> * jest 测试数字</pre></td></tr><tr><td data-num=\"64\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'two and two'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeGreaterThan</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeGreaterThanOrEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeLessThanOrEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">4.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeLessThanOrEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"75\"></td><td><pre> * toBeCloseTo 检查浮点数相等</pre></td></tr><tr><td data-num=\"76\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test float number'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> <span class=\"token number\">0.1</span> <span class=\"token operator\">+</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token comment\">//expect (value).toBe (0.3)  报错，因为计算机精度的原因</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeCloseTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"83\"></td><td><pre> * toMatch 根据正则表达式检查字符串</pre></td></tr><tr><td data-num=\"84\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test reg'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'team'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toMatch</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">I</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Christoph'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatch</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">stop</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello world'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lo w'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"91\"></td><td><pre> * toContain 测试数组和可迭代对象</pre></td></tr><tr><td data-num=\"92\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token keyword\">const</span> List <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'c'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'d'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'list to be'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>List<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toContain</span><span class=\"token punctuation\">(</span><span class=\"token string\">'c'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>List<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toContain</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"99\"></td><td><pre> * 测试异步代码</pre></td></tr><tr><td data-num=\"100\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token keyword\">const</span> testPromise <span class=\"token operator\">=</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token comment\">//1 使用 return</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'return异步代码'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    <span class=\"token keyword\">return</span> testPromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre><span class=\"token comment\">//2 使用 async 和 await 语法</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">fetchMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>        <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>            <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'async and await'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre><span class=\"token comment\">//expect.assertions 验证是否调用了一定数量的断言，确保兑现的承若通过测试</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre><span class=\"token comment\">//catch 捕捉（确保 Promise 不会被兑现）</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre><span class=\"token comment\">// test('catch fails with errors',()=>&#123;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre><span class=\"token comment\">//     return fetchData2().catch(e=>expect(e).toMatch('error'))</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre><span class=\"token comment\">// &#125;)</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre></pre></td></tr><tr><td data-num=\"126\"></td><td><pre><span class=\"token comment\">// 3 使用回调函数 done</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'done to async'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>    testPromise<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>    <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token comment\">// 4 .resolves 匹配器等待 Promise 解析（reject 则失败）</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.resolves匹配器'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>testPromise<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>resolves<span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"138\"></td><td><pre> * beforeEach 和 afterEach 钩子函数</pre></td></tr><tr><td data-num=\"139\"></td><td><pre> * 当每一个测试之前或之后都需要调用相同的方法就可以使用这两个钩子函数</pre></td></tr><tr><td data-num=\"140\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre></pre></td></tr><tr><td data-num=\"142\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"143\"></td><td><pre> * describe 块</pre></td></tr><tr><td data-num=\"144\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre></pre></td></tr><tr><td data-num=\"146\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"147\"></td><td><pre> * test.only 只运行一个测试</pre></td></tr><tr><td data-num=\"148\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>test<span class=\"token punctuation\">.</span><span class=\"token function\">only</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test only'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test only'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'t o'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "TDD",
                "jest"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/30/%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E9%93%BE%E6%8E%A5/",
            "url": "https://dmqweb.cn/2024/03/30/%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E9%93%BE%E6%8E%A5/",
            "title": "本地文件链接",
            "date_published": "2024-03-30T11:31:00.000Z",
            "content_html": "<h1 id=\"链接本地文件的方式\"><a class=\"anchor\" href=\"#链接本地文件的方式\">#</a> 链接本地文件的方式</h1>\n<h3 id=\"npm-link\"><a class=\"anchor\" href=\"#npm-link\">#</a> npm link</h3>\n<p>1、带有 package.json 文件的文件夹内运行：npm link ，即可在用户全局中创建该文件夹的全局链接。</p>\n<p>2、在需要使用文件的地方执行：npm link  文件名，注意文件名是 package.json 中的 name 字段值。</p>\n<h3 id=\"file路径\"><a class=\"anchor\" href=\"#file路径\">#</a> file 路径</h3>\n<p>在需要使用的 package.json 的 dependence 中添加：文件名：&quot;file:  ....&quot;，添加上 file 路径指向本地文件。</p>\n<h3 id=\"区别\"><a class=\"anchor\" href=\"#区别\">#</a> 区别：</h3>\n<p>两种方式的区别在于如果项目较为简单，使用 file: 路径即可解决，但如果项目较为复杂，且文件包括文件地址需要不断移动时，使用 npm  link 的方式更好。</p>\n",
            "tags": [
                "脚手架开发",
                "脚手架 cli"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/29/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/",
            "url": "https://dmqweb.cn/2024/03/29/%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96/",
            "title": "前端模块化",
            "date_published": "2024-03-29T14:34:14.000Z",
            "content_html": "<h1 id=\"modules模块化\"><a class=\"anchor\" href=\"#modules模块化\">#</a> modules 模块化</h1>\n<h3 id=\"模块化的优点\"><a class=\"anchor\" href=\"#模块化的优点\">#</a> 模块化的优点：</h3>\n<p>可维护性、可复用性。</p>\n<h4 id=\"模块化的发展\"><a class=\"anchor\" href=\"#模块化的发展\">#</a> 模块化的发展</h4>\n<p>1、ES6 之前没有模块化时，浏览器环境需要使用 script 进行引入 js 文件<br />\n 2、后来使用全局变量 + 命名空间（namespace）处理，就是使用 IIFE 自动执行函数创建一个函数作用域，赋值给一个全局变量。<br />\n这样做的缺点是：依赖于全局变量，污染全局变量，不安全。<br />\n依赖于约定命名空间来避免冲突，可靠性不高。<br />\n需要手动管理依赖并控制执行顺序，容易出错。<br />\n需要在最终上线前手动合并所有用到的模块。<br />\n3、node 端模块系统：Common.js，缺点是浏览器端无法使用<br />\n 4、AMD (Asynchronous module definition) 异步加载模块定义，CMD (模块标准)<br />\n 采用异步方式加载，需要全局环境定义 require 和 define，不需要引入其他的变量。<br />\n5、ES6 modules、引入和暴露方式更加多样，支持复杂的静态分析和静态、动态导入。</p>\n<h1 id=\"bundler打包工具\"><a class=\"anchor\" href=\"#bundler打包工具\">#</a> Bundler 打包工具</h1>\n<h3 id=\"诞生原因\"><a class=\"anchor\" href=\"#诞生原因\">#</a> 诞生原因：</h3>\n<p>使用 import export 这种异步加载方式在大多数浏览器中无法使用。</p>\n<h3 id=\"常见工具\"><a class=\"anchor\" href=\"#常见工具\">#</a> 常见工具</h3>\n<p>一、<strong>Webpack</strong>（单 JS 文件入口），Webpack 采用代码分割、异步加载等技术，可以将多个模块打包成一个或者多个 bundle,，构建的产物是一个函数。Webpack 主要用于构建复杂的前端项目，如 Web 应用、SPA 单页面应用等，支持模块化开发、代码分割、资源优化和静态文件处理等功能。。</p>\n<p>二、<strong>rollup</strong> 用静态的方式分析代码，对未使用的代码更加彻底的进行树摇优化，输出的 bundle 更加的精简。</p>\n<p>三、<strong>snowpack</strong>（使用于新版浏览器）<br />\n1、出现的原因（其他 Bundler 的问题）：<br />\n当资源越来越多时，打包的速度会越来越慢，大中型项目中，启动时间可能达到好几分钟。（vite 的理念来源于 snowpack，充分使用了新版浏览器支持 es modules 的特性。）<br />\n2、优势：<br />\nsnowpack 利用新版浏览器支持 es modules 的特性，开发模式不会被打包，每个文件编译一次，永久被缓存，当一个文件修改的时候就只需要重新 build 那一个文件。（适用于新版浏览器）<br />\n四、<strong>vite</strong><br />\nvite 基于 snowpack 的理念（利用新版浏览器支持 es modules 的特性），基于 esbuild，采用 rollup 进行构建 ，开发模式不会打包，每个文件当使用时才会去加载，修改时只需要重新 build 那一个文件。<br />\n五、<strong>vue-cli</strong><br />\nvue-cli 底层基于 webpack，webpack 通过导入导出的语句分析整个项目，将目标代码转化成兼容浏览器的 js 代码，只有打包后的几个文件，这个过程需要耗费一些时间。</p>\n<h1 id=\"webpack配置支持es-module\"><a class=\"anchor\" href=\"#webpack配置支持es-module\">#</a> webpack 配置支持 ES Module</h1>\n<p>webpack 默认只支持 CommonJS 规范，配置支持 ES Module 规范，需要进行如下配置：<br />\n一：将 ES Module 语法的 js 文件通过 webpack 进行打包即可。<br />\n二：webpack 默认 target 为 web，在使用 node 内置库时会报错，可以修改 target 属性。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token string\">'./bin/core.js'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span><span class=\"token string\">'/dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'core.js'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token literal-property property\">mode</span><span class=\"token operator\">:</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 改变打包模式</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token string\">'node'</span> <span class=\"token comment\">// 进入 node 环境，默认是 web</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>三、webpack 配置 babel-loader，兼容低版本 node<br />\n 方案一：安装 babel-loader、@babel/core、@babel/preset-env（有时需要 @babel/plugin-transform-runtime 插件）</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token string\">'./bin/core.js'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span><span class=\"token string\">'/dist'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'core.js'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token literal-property property\">mode</span><span class=\"token operator\">:</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 改变打包模式</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token string\">'node'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 进入 node 环境，默认是 web</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.js$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// 使用 babel-loader</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-env'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                        <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                            <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                                <span class=\"token string\">'@babel/plugin-transform-runtime'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                                    <span class=\"token literal-property property\">corejs</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                                    <span class=\"token literal-property property\">regenerator</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                                    <span class=\"token literal-property property\">useESModules</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                                    <span class=\"token literal-property property\">helpers</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>方案二：node.js 实验功能<br />\n将 js 后缀更改为 mjs 后缀，即可（需要 node 版本为 14 以上）, 小于 14 版本的时候，node 执行时需要加上 --experimental-modules 参数，例如：<br />\n <code>node --experimental-modules index.js</code></p>\n",
            "tags": [
                "前端工程化",
                "ESModules"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/29/TDD/",
            "url": "https://dmqweb.cn/2024/03/29/TDD/",
            "title": "TDD测试驱动开发",
            "date_published": "2024-03-29T13:47:28.000Z",
            "content_html": "<h1 id=\"tddtest-drive-development测试驱动开发\"><a class=\"anchor\" href=\"#tddtest-drive-development测试驱动开发\">#</a> TDD (test drive development) 测试驱动开发</h1>\n<h3 id=\"测试驱动开发的口号\"><a class=\"anchor\" href=\"#测试驱动开发的口号\">#</a> 测试驱动开发的口号：</h3>\n<p>测试先行</p>\n<h3 id=\"测试驱动开发的目标\"><a class=\"anchor\" href=\"#测试驱动开发的目标\">#</a> 测试驱动开发的目标：</h3>\n<p>保证代码的简洁可用</p>\n<h3 id=\"tdd-的规则\"><a class=\"anchor\" href=\"#tdd-的规则\">#</a> TDD 的规则</h3>\n<p>在 TDD 的过程中，需要遵循两条简单的规则：</p>\n<p>仅在自动测试失败时才编写新代码。<br />\n消除重复设计（去除不必要的依赖关系），优化设计结构（逐渐使代码一般化）。</p>\n<p>第一条规则的言下之意是每次只编写刚刚好使测试通过的代码，并且只在测试运行失败的时候才编写新的代码，因为每次增加的代码少，即使有问题定位起来也非常快，确保我们可以遵循小步快跑的节奏；第二条规则就是让小步快跑更加踏实，在自动化测试的支撑下，通过重构环节消除代码的坏味道来避免代码日渐腐烂，为接下来编码打造一个舒适的环境。<br />\n关注点分离是这两条规则隐含的另一个非常重要的原则。其表达的含义指在编码阶段先达到代码 “可用” 的目标，在重构阶段再追求 “简洁” 目标，每次只关注一件事</p>\n<h3 id=\"采用-tdd-的动机\"><a class=\"anchor\" href=\"#采用-tdd-的动机\">#</a> 采用 TDD 的动机</h3>\n<p>控制编程过程中的忧虑感。</p>\n<p>有一个有趣的想象，当我感觉压力越大，自身就越不想去做足够多的测试。当知道自己做的测试不够时，就会增加自身的压力，因为我担心自己写的代码有 BUG，对自己编写的代码不够自信，这是一种心态上的变化。此时测试是开发人员的试金石，可以将对压力的恐惧变为平日的琐事，采用自动化测试，就有机会选择恐惧的程度。</p>\n<p>把控编程过程中的反馈与决策之间的差距。</p>\n<p>如果我做了一周的规划，并且量化成一个个可操作的任务写到 to-do list，然后使用测试驱动编码，把完成的任务像这样划掉，那么我的工作目标将变得非常清晰，因为我明确工期，明确待办事项，明确难点，可以在持续细微的反馈中有意识地做一些适当的调整，比如添加新的任务，删除冗余的测试；还有一点更加让人振奋，我可以知道我大概什么时候可以完工。项目经理对软件开发进度可以更精确的把握。</p>\n<p>标注：本文摘抄自：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTAzNzgwOTcwOTIxOTkx\">https://juejin.cn/post/6844903780970921991</span><br />\n 感兴趣可自行进行查看</p>\n",
            "tags": [
                "开发模式",
                "开发模式"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/29/%E6%9C%AC%E5%9C%B0%E9%A2%84%E8%A7%88%E5%9B%BE%E7%89%87/",
            "url": "https://dmqweb.cn/2024/03/29/%E6%9C%AC%E5%9C%B0%E9%A2%84%E8%A7%88%E5%9B%BE%E7%89%87/",
            "title": "本地预览图片",
            "date_published": "2024-03-29T13:20:56.000Z",
            "content_html": "<h1 id=\"图片上传预览\"><a class=\"anchor\" href=\"#图片上传预览\">#</a> 图片上传预览</h1>\n<p>业务中经常有上传图片的需求在，有时我们需要去尽快预览要上传的图片，此时会有两种常见的方法：</p>\n<h3 id=\"urlcreateobjecturl\"><a class=\"anchor\" href=\"#urlcreateobjecturl\">#</a> URL.createObjectURL</h3>\n<p>直接返回，同步执行，会为图片文件创建一个地址，存储在 document 中，并且不会被垃圾回收机制所回收。清除方式只有 unload 事件或 revokeObjectURL 进行手动清除。</p>\n<h3 id=\"filereaderreadasdataurl\"><a class=\"anchor\" href=\"#filereaderreadasdataurl\">#</a> FileReader.readAsDataURL</h3>\n<p>通过回调的形式返回，异步执行，将图片文件转为 base64 格式，可以通过链接形式直接引用，会依据垃圾回收机制进行回收，<br />\n2</p>\n",
            "tags": [
                "业务处理",
                "业务",
                "图片"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/02/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/",
            "url": "https://dmqweb.cn/2024/03/02/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/",
            "title": "前端性能优化",
            "date_published": "2024-03-02T04:24:04.000Z",
            "content_html": "<h1 id=\"5-1-前端性能优化\"><a class=\"anchor\" href=\"#5-1-前端性能优化\">#</a> 5-1 前端性能优化</h1>\n<h2 id=\"课程介绍\"><a class=\"anchor\" href=\"#课程介绍\">#</a> 课程介绍</h2>\n<p>任何小型企业，博主或成长型公司在网上出现时面临的最大挑战之一就是 “页面加载时间” 问题。除非您能确保尽可能快速无缝地加载每个页面，您才可以拥有世界上最好最引人注目的网站，否则您仍然无法赢得关注者的尊重和忠诚度。</p>\n<p>根据当今网络上的所有主要浏览器公司的说法，如果每个网站都想要排名靠前，表现良好并确保客户满意，那么每个网站都需要快。毕竟，如果您的网页加载速度很慢，那么您会立即增加客户开始在其他地方搜索信息，而不是坚持下去的风险。</p>\n<p>这也是为什么很多公司去找专门的技术人员来做 SEO（<strong>Search Engine Optimization</strong>），即搜索引擎优化。 因为，页面的加载会影响到爬虫的爬取，页面加载速度是一项非常重要的指标。况且，页面优化直接影响到了用户体验。所以学习前端性能优化势在必行。</p>\n<p><strong>经常有面试官会问：从用户输入浏览器输入 url 到页面最后呈现 有哪些过程？有什么办法能优化页面性能？</strong></p>\n<p>答案大致如下：</p>\n<ol>\n<li>用户输入 URL 地址</li>\n<li>浏览器解析 URL 解析出主机名</li>\n<li>浏览器将主机名转换成服务器 ip 地址（浏览器先查找本地 DNS 缓存列表 没有的话 再向浏览器默认的 DNS 服务器发送查询请求 同时缓存）</li>\n<li>浏览器将端口号从 URL 中解析出来</li>\n<li>浏览器建立一条与目标 Web 服务器的 TCP 连接（三次握手）</li>\n<li>浏览器向服务器发送一条 HTTP 请求报文</li>\n<li>服务器向浏览器返回一条 HTTP 响应报文</li>\n<li>关闭连接 浏览器解析文档</li>\n<li>如果文档中有资源 重复 6 7 8 动作 直至资源全部加载完毕</li>\n</ol>\n<p><img data-src=\"./assets/image-20190619100048897.png\" alt=\"/images/image-20190619100048897\" /></p>\n<p>再深一点层次：会问到<strong>渲染机制</strong>，重排、重绘</p>\n<p>重排：</p>\n<ol>\n<li>\n<p>定义：DOM 结构中的各个元素都有自己的盒子 (模型)，这些都需要浏览器根据各种样式来计算并根据计算结果将元素放到它该出现的位置，这个过程称之为 reflow。</p>\n</li>\n<li>\n<p>触发 Reflow：</p>\n<ul>\n<li>当你增加、删除、修改 DOM 结点时，会导致 Reflow 或 Repaint</li>\n<li>当你移动 DOM 的位置，或是搞个动画的时候</li>\n<li>当你修改 CSS 样式的时候</li>\n<li>当你 Resize 窗口的时候 (移动端没有这个问题)，或者是滚动的时候</li>\n<li>当你修改网页的</li>\n</ul>\n<blockquote>\n<p>最常问：如何减少 Reflow? 或者避免 Reflow？</p>\n</blockquote>\n</li>\n</ol>\n<p>重绘：</p>\n<ol>\n<li>\n<p>定义：当各种盒子的位置、大小以及其他属性，例如颜色、字体大小等都确定下来后，浏览器于是便把这些元素都按照各自的特性绘制了一遍，于是页面的内容出现了，这个过程称之为 repaint。</p>\n<blockquote>\n<p>页面要呈现的内容，通通都绘制到页面上。</p>\n</blockquote>\n</li>\n<li>\n<p>触发 Repaint</p>\n<ul>\n<li>DOM 改动</li>\n<li>CSS 改动</li>\n</ul>\n<blockquote>\n<p>最常问：如何避免最小程序的 Repaint？</p>\n</blockquote>\n</li>\n</ol>\n<p>既然页面的性能优化这么重要，** 你知道有哪些原因是影响页面性能的？** 比如...</p>\n<ul>\n<li>HTTP 请求</li>\n<li>复杂的页面逻辑 (JS 设计)</li>\n<li>重度的 DOM 操作</li>\n<li>服务端响应</li>\n<li>大量的数据</li>\n</ul>\n<p>...</p>\n<p><strong>有哪些办法可以加速我们的页面性能？比如...</strong></p>\n<ul>\n<li>资源压缩与合并（代码打包）</li>\n<li>异步加载</li>\n<li>CDN</li>\n<li>DNS 预解析</li>\n<li>缓存</li>\n</ul>\n<p>...</p>\n<p><strong>本课程的主要内容：</strong></p>\n<ul>\n<li>页面加载缓慢原因分析</li>\n<li>性能优化原则</li>\n<li>优化工具介绍</li>\n<li>浏览器的工作机制，了解一些基本常识的原理：\n<ol>\n<li>为什么要将 js 放到页脚部分</li>\n<li>引入样式的几种方式的权重</li>\n<li>css 属性书写顺序建议</li>\n<li>何种类型的 DOM 操作是耗费性能的</li>\n</ol>\n</li>\n</ul>\n<p><strong>学习本门课你能收获什么？</strong></p>\n<ul>\n<li>前端页面优化，为成为 SEO 路添砖加瓦</li>\n<li>写出优质代码，页面性能蹭蹭蹭的往上走</li>\n<li>面试如果提到页面优化，可以娓娓道来，牛皮吹的飞起...</li>\n<li>几种常见的页面优化工具的使用 PageSpeed，JSPerf</li>\n</ul>\n<p><strong>课程准备：</strong></p>\n<ul>\n<li>注册 github 账号</li>\n</ul>\n<h2 id=\"页面性能优化\"><a class=\"anchor\" href=\"#页面性能优化\">#</a> 页面性能优化</h2>\n<p>前端性能优化可以分为两大部分：浏览器部分、代码部分。</p>\n<p>浏览器部分又可以分为：</p>\n<ul>\n<li>网络层面</li>\n<li>浏览器渲染层面</li>\n<li>服务端层面</li>\n</ul>\n<p>代码部分又可以分为：</p>\n<ul>\n<li>构建层面</li>\n<li>编码层面</li>\n<li>机制 (SSR，英文 Server Side Render：服务器端渲染)</li>\n<li>规范</li>\n</ul>\n<p>首先来看看浏览器部分：前端的页面主要在浏览器上运行着，那么我们追根溯源，从浏览器的原理开始，研究如何进行页面性能优化。</p>\n<h3 id=\"浏览器\"><a class=\"anchor\" href=\"#浏览器\">#</a> 浏览器</h3>\n<p>目前使用的主流浏览器有五个：Internet Explorer、Firefox、Safari、Chrome 浏览器和 Opera。本文中以开放源代码浏览器为例，即 Firefox、Chrome 浏览器和 Safari（部分开源）。根据 <span class=\"exturl\" data-url=\"aHR0cDovL2dzLnN0YXRjb3VudGVyLmNvbS8=\">StatCounter 浏览器统计数据</span>，目前（2019 年 6 月）Firefox、Safari 和 Chrome 浏览器的总市场占有率 62.7%。由此可见，如今开放源代码浏览器在浏览器市场中占据了非常坚实的部分。</p>\n<p><img data-src=\"./assets/image-20190618165435861.png\" alt=\"/images/image-20190618165435861\" /></p>\n<h4 id=\"浏览器的主要作用\"><a class=\"anchor\" href=\"#浏览器的主要作用\">#</a> 浏览器的主要作用</h4>\n<p>浏览器的主要功能就是向服务器发出请求，在浏览器窗口中展示您选择的网络资源。这些网络资源包括以下内容：</p>\n<ul>\n<li>HTML</li>\n<li>CSS</li>\n<li>JavaScript 的</li>\n<li>媒体（图片，视频等）</li>\n</ul>\n<p>也可以分为 HTML 文档 (HTML/CSS/JS)、PDF、图片、视频和其他类型。</p>\n<p>浏览器解释并显示 HTML 文件的方式是在 HTML 和 CSS 规范中指定的。这些规范由网络标准化组织 W3C（万维网联盟）进行维护。<br />\n多年以来，各浏览器都没有完全遵从这些规范，同时还在开发自己独有的扩展程序，这给网络开发人员带来了严重的兼容性问题。如今，大多数的浏览器都是或多或少地遵从规范。</p>\n<p>浏览器的用户界面有很多彼此相同的元素，其中包括：</p>\n<ul>\n<li>用来输入 URI 的地址栏</li>\n<li>前进和后退按钮</li>\n<li>书签设置选项</li>\n<li>用于刷新和停止加载当前文档的刷新和停止按钮</li>\n<li>用于返回主页的主页按钮</li>\n</ul>\n<p>奇怪的是，浏览器的用户界面并没有任何正式的规范，这是多年来的最佳实践自然发展以及彼此之间相互模仿的结果。HTML5 也没有定义浏览器必须具有的用户界面元素，但列出了一些通用的元素，例如地址栏、状态栏和工具栏等。</p>\n<p><strong>有一些比较有趣的事情：</strong></p>\n<p>Safari 是乔布斯在 2003 年的 Macworld 大会发布的，9 年过去了，08 年才发展起来的 Chrome 用了不到 Safari 一半的时间远远把 Safari 甩在了后面，这让 Safari 情何以堪。</p>\n<p>两大浏览器都是基于苹果的布局引擎 Webkit，按道理 Safari 是占优势的，因为两者都分别是自己操作系统的默认浏览器，许多人就顺便使用了，懒得去下载别的浏览器。</p>\n<p>许多人可能会想，这还不简单，Chrome 运行于 Windows 操作系统，而 Safari 大部分时候都用于苹果自己的系统，Windows .VS. OS X，哪个使用人群广？很显然是前者，所以 Chrome 当然比 Safari 发真快，<strong>可是，实际上 Safari 要比 Chrome 更早登陆 Windows。</strong></p>\n<p>在 2007 年六月，Safari for Windows Beta 版就已经发布，正式版于 2008 年三月发布，而 Chrome 直到 2008 年的九月才发布，Chrome 只用了一年的时间就超过了 Safari。</p>\n<p>大量 Benchmark 测试表明 Chrome 不管在网页打开还是 JavaScript 表现方面，速度都最快。</p>\n<p>但是，当 Safari 发布 Windows 版的时候，测试结果也是一样的，不管在 Mac 还是 PC 上测试，那时候都是最快的，如果仅仅是因为速度，那么 Safari 在 2007 年六月的表现就应该和 chrome 在 2008 年九月的时候一样。</p>\n<p>难道 Chrome 胜在插件？也许，不过 Safari 在 2010 年年中的时候也有了许多插件，当然，Chrome 的插件质量更好更丰富，如果这也足够让 Safari 落后于 Chrome，那么开发商们可能早就将游戏植入 Chrome，而且，Firefox 也先于 Chrome 和 Safari 植入插件，现在不也败给了 Chrome 吗？</p>\n<p>主要原因：</p>\n<ol>\n<li>Safari 用起来不舒服，google 推广给力</li>\n<li>独特的用户体验 (UI、交互、云、Google 全家桶)</li>\n</ol>\n<p><strong>那么 Safari 就一文不值了？</strong></p>\n<p>但是，Mac 上的用户使用 safari 更加的省电、省资源，稳定性会更好。** 插件不需要爬梯子！！！** 更低的学习成本。</p>\n<p><strong>IE (Internet Explorer) 的黑历史：</strong></p>\n<p>IE 浏览器的开发应该是在 1994 年中开始的，那是我还在读大学。微软为了对抗当时的主流浏览器 NetScape，准备开发自己的浏览器并在 Windows 中默认捆绑销售。但是，留给微软的时间并不充裕，他们没时间从零开始，于是和 Spyglass 合作开发，于是，计算机历史上最著名也最臭名昭著的浏览器 IE 诞生了。因为强大的功能和捆绑策略，IE 迅速击败了 NetScape，成为浏览器市场的绝对霸主。</p>\n<p>在 2002 年，IE 已经拥有了 95% 的市场份额，几乎打败了所有的竞争对手。大为僵，又不思进取，于是颠覆者前仆后继。Firefox 开始迅速崛起，Chrome 后来居上，反观 IE，出现了各种安全漏洞和兼容性问题。2006 年，IE 被评为 “史上第八糟科技产品”。在相当长的时间里，<strong>IE 浏览器是前端程序员员的噩梦</strong>。</p>\n<p>带给我们的思考：</p>\n<ul>\n<li>软件迭代更新的重要性 (居安思危)</li>\n<li>用户体验、用户感知的重要性 (人性化产品)</li>\n<li>互联网时代，什么都是可以替代的</li>\n<li>分享、免费、共筑共赢才是互联网的精神</li>\n</ul>\n<h4 id=\"浏览器的组成结构\"><a class=\"anchor\" href=\"#浏览器的组成结构\">#</a> 浏览器的组成结构</h4>\n<p><img data-src=\"./assets/layers.png\" alt=\"img\" /></p>\n<ol>\n<li>\n<p><strong>用户界面（User Interface）</strong> - 包括地址栏、前进 / 后退按钮、书签菜单等。除了浏览器主窗口显示的您请求的页面外，其他显示的各个部分都属于用户界面。</p>\n</li>\n<li>\n<p><strong>浏览器引擎（Browser engine）</strong> - 在用户界面和渲染引擎之间传送指令。</p>\n</li>\n<li>\n<p><strong>渲染引擎（Rendering engine）</strong> - 负责显示请求的内容。如果请求的内容是 HTML，它就负责解析 HTML 和 CSS 内容，并将解析后的内容显示在屏幕上。</p>\n<blockquote>\n<p>也可以叫呈现引擎（Rendering Engine）或者布局引擎（Layout Engine）</p>\n</blockquote>\n<p>默认情况下，渲染引擎可显示 HTML 和 XML 文档与图片。通过插件（或浏览器扩展程序），还可以显示其他类型的内容；例如，使用 PDF 查看器插件就能显示 PDF 文档。但是在本章中，我们将集中介绍其主要用途：显示使用 CSS 格式化的 HTML 内容和图片。</p>\n<p>浏览器（Firefox、Chrome 浏览器和 Safari）是基于两种渲染引擎构建的。Firefox 使用的是 Gecko，这是 Mozilla 公司 “自制” 的渲染引擎。而 Safari 和 Chrome 浏览器使用的都是 WebKit。</p>\n<table>\n<thead>\n<tr>\n<th>浏览器</th>\n<th>渲染引擎（开发语言）</th>\n<th>脚本引擎（开发语言）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Chrome</td>\n<td>Blink (c++)</td>\n<td>V8 (c++)</td>\n</tr>\n<tr>\n<td>Opera</td>\n<td>Blink (c++)</td>\n<td>V8 (c++)</td>\n</tr>\n<tr>\n<td>Safari</td>\n<td>Webkit (c++)</td>\n<td>JavaScript Core (nitro)</td>\n</tr>\n<tr>\n<td>FireFox</td>\n<td>Gecko (c++)</td>\n<td>SpiderMonkey (c/c++)</td>\n</tr>\n<tr>\n<td>Edge</td>\n<td>EdgeHTML (c++)</td>\n<td>Chakra JavaScript Engine (c++)</td>\n</tr>\n<tr>\n<td>IE</td>\n<td>Trident (c++)</td>\n<td>Chakra JScript Engine (c++)</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>Firefox 在 2017 年启用了新的 web 引擎 Quantum，Quantum 以 Gecko 引擎为基础，同时利用了 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5pbS8/dGFyZ2V0PWh0dHBzJTNBJTJGJTJGZ2l0aHViLmNvbSUyRnJ1c3QtbGFuZyUyRnJ1c3Q=\">Rust</span> 的良好并发性和 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlcnZvL3NlcnZv\">Servo</span> 的高性能组件，为 Firefox 带来了更多的并行化和 GPU 运算，让 Firefox 更快更可靠。</p>\n<p>2015 年 3 月，微软将放弃自家 Edge：转而开发 Chromium 内核浏览器。</p>\n</blockquote>\n<p>它们的开发时间轴：</p>\n<p><img data-src=\"./assets/image-20190618172835156.png\" alt=\"/images/image-20190618172835156\" /></p>\n<p>WebKit 是一种开放源代码渲染引擎，起初用于 Linux 平台，随后由 Apple 公司进行修改，从而支持苹果机和 Windows。有关详情，请参阅 <span class=\"exturl\" data-url=\"aHR0cDovL3dlYmtpdC5vcmcv\">webkit.org</span></p>\n</li>\n<li>\n<p><strong>网络（Networking）</strong> - 用于网络调用，比如 HTTP 请求。其接口与平台无关，并为所有平台提供底层实现。</p>\n</li>\n<li>\n<p><strong>用户界面后端（UI Backend）</strong> - 用于绘制基本的窗口小部件，比如组合框和窗口。其公开了与平台无关的通用接口，而在底层使用操作系统的用户界面方法。</p>\n</li>\n<li>\n<p><strong>JavaScript 解释器（JavaScript Interpreter）</strong>。用于解析和执行 JavaScript 代码，如 V8 引擎。</p>\n<p>JS 引擎线程负责解析 Javascript 脚本，运行代码。</p>\n<p><strong>JS 引擎一直等待任务队列中任务的到来，然后加以处理，一个 Tab 页（renderer 进程）中只有一个 JS 线程在运行</strong></p>\n</li>\n<li>\n<p><strong>数据存储（Data Persistence）</strong>。这是持久层。浏览器需要在硬盘上保存各种数据，例如 Cookie。新的 HTML 规范 (HTML5) 定义了 “网络数据库”，这是一个完整（但是轻便）的浏览器内数据库。</p>\n</li>\n</ol>\n<h4 id=\"浏览器是多进程的\"><a class=\"anchor\" href=\"#浏览器是多进程的\">#</a> 浏览器是多进程的</h4>\n<blockquote>\n<p>进程线程简单的理解：进程里面可以有多个线程，进程就是 QQ，线程就是会话。</p>\n</blockquote>\n<ul>\n<li>浏览器是多进程的</li>\n<li>浏览器之所以能够运行，是因为系统给它的进程分配了资源（cpu、内存）</li>\n<li>简单点理解，每打开一个 Tab 页，就相当于创建了一个独立的浏览器进程。</li>\n</ul>\n<p>浏览器里面的进程：</p>\n<ol>\n<li>\n<p>Browser 进程：浏览器的主进程（负责协调、主控），只有一个。作用有</p>\n<ul>\n<li>负责浏览器界面显示，与用户交互。如前进，后退等</li>\n<li>负责各个页面的管理，创建和销毁其他进程</li>\n<li>将 Renderer 进程得到的内存中的 Bitmap，绘制到用户界面上</li>\n<li>网络资源的管理，下载等</li>\n</ul>\n</li>\n<li>\n<p>第三方插件进程：每种类型的插件对应一个进程，仅当使用该插件时才创建</p>\n</li>\n<li>\n<p>GPU 进程：最多一个，用于 3D 绘制等</p>\n</li>\n<li>\n<p>渲染进程（浏览器内核）（Renderer 进程，内部是多线程的）</p>\n<ul>\n<li>默认每个 Tab 页面一个进程，互不影响。</li>\n<li>主要作用为页面渲染，脚本执行，事件处理等</li>\n</ul>\n</li>\n</ol>\n<p>渲染进程是多线程的：</p>\n<ol>\n<li>\n<p>GUI 渲染线程</p>\n<ul>\n<li>负责渲染浏览器界面，解析 HTML，CSS，构建 DOM 树和 RenderObject 树，布局和绘制等。</li>\n<li><strong>当界面需要重绘（Repaint）或由于某种操作引发回流 (reflow) 时，该线程就会执行</strong></li>\n<li>注意，GUI 渲染线程与 JS 引擎线程是互斥的，当 JS 引擎执行时 GUI 线程会被挂起（相当于被冻结了），GUI 更新会被保存在一个队列中等到 JS 引擎空闲时立即被执行。</li>\n</ul>\n</li>\n<li>\n<p>js 引擎线程</p>\n<ul>\n<li>也称为 JS 内核，负责处理 Javascript 脚本程序。（例如 V8 引擎）</li>\n<li>JS 引擎线程负责解析 Javascript 脚本，运行代码。</li>\n<li><strong>JS 引擎一直等待任务队列中任务的到来，然后加以处理，一个 Tab 页（renderer 进程）中只有一个 JS 线程在运行</strong></li>\n<li><strong>同样注意，GUI 渲染线程与 JS 引擎线程是互斥的。所以如果 JS 执行的时间过长，要放在 body 下面，否则就会导致页面渲染加载阻塞。</strong></li>\n</ul>\n</li>\n<li>\n<p>事件触发线程</p>\n<ul>\n<li>管理着事件队列</li>\n<li>监听事件，符合条件时把回调函数放入事件队列中</li>\n</ul>\n</li>\n<li>\n<p>定时触发器线程</p>\n<ul>\n<li>setInterval 与 setTimeout 在此线程中计时完毕后，把回调函数放入事件队列中</li>\n<li><strong>浏览器定时计数器并不是由 JavaScript 引擎计数的</strong>，（因为 JavaScript 引擎是单线程的，如果处于阻塞线程状态就会影响记计时的准确），因此通过单独线程来计时并触发定时（计时完毕后，添加到事件队列中，等待 JS 引擎空闲后执行）</li>\n<li>注意，W3C 在 HTML 标准中规定，规定要求<strong> setTimeout 中低于 4ms 的时间间隔算为 4ms</strong>。</li>\n</ul>\n</li>\n<li>\n<p>异步 http 请求线程</p>\n<ul>\n<li>检测到 XHR 对象状态变化时，将回调函数放入事件队列中</li>\n<li>将检测到状态变更时，如果设置有回调函数，异步线程就<strong>产生状态变更事件</strong>，将这个回调再放入事件队列中。再由 JavaScript 引擎执行。</li>\n</ul>\n<p>了解 一下，执行线：</p>\n<p><img data-src=\"./assets/image-20190619165952240.png\" alt=\"/images/image-20190619165952240\" /></p>\n</li>\n</ol>\n<p><strong>渲染线程与 JS 引擎线程互斥</strong></p>\n<p>由于 JavaScript 是可操纵 DOM 的，如果在修改这些元素属性同时渲染界面（即 JS 线程和 UI 线程同时运行），那么渲染线程前后获得的元素数据就可能不一致了。</p>\n<p>因此为了防止渲染出现不可预期的结果，浏览器设置 GUI 渲染线程与 JS 引擎为互斥的关系，当 JS 引擎执行时 GUI 线程会被挂起， GUI 更新则会被保存在一个队列中等到 JS 引擎线程空闲时立即被执行。</p>\n<p>举一个简单的例子：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>ie=edge<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token comment\">// 页面上的 hello world 不会变成红色</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"app\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"red\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      hello world!</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><strong>JS 阻塞页面加载</strong></p>\n<p>从上述的互斥关系，可以推导出，JS 如果执行时间过长就会阻塞页面。</p>\n<p>譬如，假设 JS 引擎正在进行巨量的计算，此时就算 GUI 有更新，也会被保存到队列中，等待 JS 引擎空闲后执行。 然后，由于巨量计算，所以 JS 引擎很可能很久很久后才能空闲，自然会感觉到巨卡无比。</p>\n<p>所以，要尽量避免 JS 执行时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞的感觉。</p>\n<p>总结一下：</p>\n<ul>\n<li>css 加载不会阻塞 DOM 树解析（异步加载时 DOM 照常构建），但会阻塞 render 树渲染（渲染时需等 css 加载完毕，因为 render 树需要 css 信息）</li>\n<li>Javascript 阻塞 DOM 解析</li>\n</ul>\n<h4 id=\"浏览器的渲染机制\"><a class=\"anchor\" href=\"#浏览器的渲染机制\">#</a> 浏览器的渲染机制</h4>\n<p>对于渲染，我们首先需要了解一个概念：设备刷新率。</p>\n<p>设备刷新率是设备屏幕渲染的频率，通俗一点就是，把屏幕当作墙，设备刷新率就是多久重新粉刷一次墙面。基本我们平常接触的设备，如手机、电脑，它们的默认刷新频率都是 60FPS，也就是屏幕在 1s 内渲染 60 次，约 16.7ms 渲染一次屏幕。</p>\n<p>这就意味着，我们的浏览器最佳的渲染性能就是所有的操作在一帧 16.7ms 内完成，能否做到一帧内完成直接决定着渲染性，影响用户交互。</p>\n<p>渲染引擎一开始会从网络层获取请求文档的内容，内容的大小一般限制在 8000 个块以内。</p>\n<p>然后进行如下所示的<strong>基本流程</strong>：</p>\n<p><img data-src=\"./assets/flow.png\" alt=\"img\" /></p>\n<p>渲染引擎将开始解析 HTML 文档，并将各标记逐个转化成 “内容树” 上的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsvI0RPTQ==\">DOM</span> 节点。同时也会解析外部 CSS 文件以及样式元素中的样式数据。HTML 中这些带有视觉指令的样式信息将用于创建另一个树结构：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsvI1JlbmRlcl90cmVlX2NvbnN0cnVjdGlvbg==\">呈现树</span>。</p>\n<p>呈现树包含多个带有视觉属性（如颜色和尺寸）的矩形。这些矩形的排列顺序就是它们将在屏幕上显示的顺序。</p>\n<p>呈现树构建完毕之后，进入 “<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsvI2xheW91dA==\">布局</span>” 处理阶段，也就是为每个节点分配一个应出现在屏幕上的确切坐标。下一个阶段是<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsvI1BhaW50aW5n\">绘制</span> - 渲染引擎会遍历呈现树，由用户界面后端层将每个节点绘制出来。</p>\n<p>需要着重指出的是，这是一个渐进的过程。为达到更好的用户体验，渲染引擎会力求尽快将内容显示在屏幕上。它不必等到整个 HTML 文档解析完毕之后，就会开始构建呈现树和设置布局。在不断接收和处理来自网络的其余内容的同时，渲染引擎会将部分内容解析并显示出来。</p>\n<blockquote>\n<p>那么我们知道了，CSSOM 树和 DOM 树合并成渲染树，然后用于计算每个可见元素的布局，并输出给绘制流程，将像素渲染到屏幕上。优化上述每一个步骤对实现最佳渲染性能至关重要。</p>\n</blockquote>\n<p>具体的流程：</p>\n<ul>\n<li>DOM 树与 CSSOM 树合并后形成渲染树。</li>\n<li>渲染树只包含渲染网页所需的节点。</li>\n<li>布局计算每个对象的精确位置和大小。</li>\n<li>最后一步是绘制，使用最终渲染树将像素渲染到屏幕上。</li>\n</ul>\n<p><img data-src=\"./assets/render-tree-construction.png\" alt=\"DOM CSSOM RenderTree\" /></p>\n<blockquote>\n<p>请注意  <code>visibility: hidden</code>  与  <code>display: none</code>  是不一样的。前者隐藏元素，但元素仍占据着布局空间（即将其渲染成一个空框），而后者 ( <code>display: none</code> ) 将元素从渲染树中完全移除，元素既不可见，也不是布局的组成部分。</p>\n</blockquote>\n<p>我们以 webkit 的渲染作为示例：</p>\n<p><img data-src=\"./assets/webkitflow.png\" alt=\"img\" /></p>\n<p>我们可以使用调试工具来看一个真实的例子：</p>\n<p><img data-src=\"./assets/image-20190618182337662.png\" alt=\"/images/image-20190618182337662\" /></p>\n<p><code>script</code>  标签的处理</p>\n<p>JS 可以操作 DOM 来修改 DOM 结构，可以操作 CSSOM 来修改节点样式，这就导致了浏览器在解析 HTML 时，一旦碰到 <code>script</code> ，就会立即停止 HTML 的解析（而 CSS 不会），执行 JS，再返还控制权。</p>\n<p>事实上，JS 执行前不仅仅是停止了 HTML 的解析，它还必须等待 CSS 的解析完成。当浏览器碰到 <code>script</code>  元素时，发现该元素前面的 CSS 还未解析完，就会等待 CSS 解析完成，再去执行 JS。</p>\n<p>JS 阻塞了 HTML 的解析，也阻塞了其后的 CSS 解析，整个解析进程必须等待 JS 的执行完成才能够继续，这就是所谓的 JS 阻塞页面。一个 script 标签，推迟了 DOM 的生成、CSSOM 的生成以及之后的所有渲染过程，从性能角度上讲，将 <code>script</code>  放在页面底部，也就合情合理了。</p>\n<p>简单来说：渲染线程与 JS 引擎线程是互斥的，当 JS 引擎执行时渲染线程会被挂起（相当于被冻结了），渲染更新会被保存在一个队列中等到 JS 引擎空闲时立即被执行。</p>\n<p>总结一下：</p>\n<p>浏览器的渲染流程分为：</p>\n<ul>\n<li>DOM 树构建</li>\n<li>CSSOM 树构建</li>\n<li>RenderObject 树构建</li>\n<li>布局</li>\n<li>绘制</li>\n</ul>\n<h4 id=\"重排reflow与重绘repaint\"><a class=\"anchor\" href=\"#重排reflow与重绘repaint\">#</a> 重排 reflow 与重绘 repaint</h4>\n<p><strong>重排 reflow</strong></p>\n<p>reflow 指的是重新计算页面布局。</p>\n<p>某个节点 reflow 时会重新计算节点的尺寸和位置，而且还有可能触发其子节点、祖先节点和页面上的其他节点 reflow。在这之后再触发一次 repaint。</p>\n<p>当 render tree 中的一部分 (或全部) 因为元素的规模尺寸，布局，隐藏等改变而需要重新构建。这就称为回流，每个页面至少需要一次回流，就是在页面第一次加载的时候。</p>\n<p>导致 reflow 的操作</p>\n<ul>\n<li>调整窗口大小</li>\n<li>改变字体</li>\n<li>增加或者移除样式表</li>\n<li>内容变化，比如用户在 input 框中输入文字</li>\n<li>激活 CSS 伪类，比如 :hover (IE 中为兄弟结点伪类的激活)</li>\n<li>操作 class 属性</li>\n<li>脚本操作 DOM</li>\n<li>计算 offsetWidth 和 offsetHeight 属性</li>\n<li>设置 style 属性的值</li>\n</ul>\n<p>触发页面重布局的一些 css 属性</p>\n<ul>\n<li>盒子模型相关属性会触发重布局\n<ul>\n<li><code>width</code></li>\n<li><code>height</code></li>\n<li><code>padding</code></li>\n<li><code>margin</code></li>\n<li><code>display</code></li>\n<li><code>border-width</code></li>\n<li><code>border</code></li>\n<li><code>min-height</code></li>\n</ul>\n</li>\n<li>定位属性及浮动也会触发重布局\n<ul>\n<li><code>top</code></li>\n<li><code>bottom</code></li>\n<li><code>left</code></li>\n<li><code>right</code></li>\n<li><code>position</code></li>\n<li><code>float</code></li>\n<li><code>clear</code></li>\n</ul>\n</li>\n<li>改变节点内部文字结构也会触发重布局\n<ul>\n<li><code>text-align</code></li>\n<li><code>overflow-y</code></li>\n<li><code>font-weight</code></li>\n<li><code>overflow</code></li>\n<li><code>font-family</code></li>\n<li><code>line-height</code></li>\n<li><code>vertical-align</code></li>\n<li><code>white-space</code></li>\n<li><code>font-size</code></li>\n</ul>\n</li>\n</ul>\n<p><strong>重绘 repaint</strong></p>\n<p>repiant 或者 redraw 遍历所有的节点检测各节点的可见性、颜色、轮廓等可见的样式属性，然后根据检测的结果更新页面的响应部分。</p>\n<p>当 render tree 中的一些元素需要更新属性，而这些属性只是影响元素的外观，风格，而不会影响布局的，比如 background-color。则就叫称为重绘</p>\n<p>只触发重绘不触发重排的一些 CSS 属性：</p>\n<ul>\n<li><code>color</code></li>\n<li><code>border-style</code> 、 <code>border-radius</code></li>\n<li><code>visibility</code></li>\n<li><code>text-decoration</code></li>\n<li><code>background</code> 、 <code>background-image</code> 、 <code>background-position</code> 、 <code>background-repeat</code> 、 <code>background-size</code></li>\n<li><code>outline</code> 、 <code>outline-color</code> 、 <code>outline-style</code> 、 <code>outline-width</code></li>\n<li><code>box-shadow</code></li>\n</ul>\n<p>我们来看一个例子：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> bstyle <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">;</span> <span class=\"token comment\">// cache</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>bstyle<span class=\"token punctuation\">.</span>padding <span class=\"token operator\">=</span> <span class=\"token string\">\"20px\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// reflow, repaint</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>bstyle<span class=\"token punctuation\">.</span>border <span class=\"token operator\">=</span> <span class=\"token string\">\"10px solid red\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//  再一次的 reflow 和 repaint</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>bstyle<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// repaint</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>bstyle<span class=\"token punctuation\">.</span>backgroundColor <span class=\"token operator\">=</span> <span class=\"token string\">\"#fad\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// repaint</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>bstyle<span class=\"token punctuation\">.</span>fontSize <span class=\"token operator\">=</span> <span class=\"token string\">\"2em\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// reflow, repaint</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// new DOM element - reflow, repaint</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span><span class=\"token function\">createTextNode</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dude!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>当然，我们的浏览器是聪明的，它不会像上面那样，你每改一次样式，它就 reflow 或 repaint 一次。一般来说，浏览器会把这样的操作积攒一批，然后做一次 reflow，这又叫异步 reflow 或增量异步 reflow。但是有些情况浏览器是不会这么做的，比如：resize 窗口，改变了页面默认的字体，等。对于这些操作，浏览器会马上进行 reflow。</p>\n<p>但是有些时候，我们的脚本会阻止浏览器这么干，比如：如果我们请求下面的一些 DOM 值：</p>\n<p><strong>减少重绘与重排：</strong></p>\n<p>重绘和回流在实际开发中是很难避免的，我们能做的就是尽量减少这种行为的发生。</p>\n<ul>\n<li>\n<p>js 尽量少访问 dom 节点和 css 属性，尽量不要过多的频繁的去增加，修改，删除元素，因为这可能会频繁的导致页面 reflow，可以先把该 dom 节点抽离到内存中进行复杂的操作然后再 display 到页面上。(虚拟 DOM)</p>\n</li>\n<li>\n<p>减少不必要的 DOM 层级（DOM depth）。改变 DOM 树中的一级会导致所有层级的改变，上至根部，下至被改变节点的子节点。这导致大量时间耗费在执行 reflow 上面。</p>\n</li>\n<li>\n<p>不要通过父级来改变子元素样式，最好直接改变子元素样式，改变子元素样式尽可能不要影响父元素和兄弟元素的大小和尺寸</p>\n</li>\n<li>\n<p>尽量通过 class 来设计元素样式，切忌用 style 多次操作单个属性</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// bad</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> left <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>top <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>left <span class=\"token operator\">=</span> left <span class=\"token operator\">+</span> <span class=\"token string\">\"px\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>top  <span class=\"token operator\">=</span> top  <span class=\"token operator\">+</span> <span class=\"token string\">\"px\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// Good</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>el<span class=\"token punctuation\">.</span>className <span class=\"token operator\">+=</span> <span class=\"token string\">\" theclassname\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// Good</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>el<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>cssText <span class=\"token operator\">+=</span> <span class=\"token string\">\"; left: \"</span> <span class=\"token operator\">+</span> left <span class=\"token operator\">+</span> <span class=\"token string\">\"px; top: \"</span> <span class=\"token operator\">+</span> top <span class=\"token operator\">+</span> <span class=\"token string\">\"px;\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>尽可能的为产生动画的 HTML 元素使用  <code>fixed</code>  或  <code>absolute</code>  的  <code>position</code>  ，那么修改他们的 CSS 是不会 Reflow 的。</p>\n</li>\n<li>\n<p>img 标签要设置高宽，以减少重绘重排</p>\n</li>\n<li>\n<p>把 DOM 离线后修改，如将一个 dom 脱离文档流，比如 <code>display：none</code>  ，再修改属性，这里只发生一次回流。</p>\n</li>\n<li>\n<p>尽量用  <code>transform</code>  来做形变和位移，不会造成回流</p>\n</li>\n<li>\n<p>权衡速度的平滑。比如实现一个动画，以 1 个像素为单位移动这样最平滑，但 reflow 就会过于频繁，CPU 很快就会被完全占用。如果以 3 个像素为单位移动就会好很多。</p>\n</li>\n<li>\n<p>不要用 tables 布局的另一个原因就是 tables 中某个元素一旦触发 reflow 就会导致 table 里所有的其它元素 reflow。在适合用 table 的场合，可以设置 table-layout 为 auto 或 fixed，</p>\n</li>\n<li>\n<p>避免不必要的复杂的 CSS 选择器，尤其是后代选择器（descendant selectors），因为为了匹配选择器将耗费更多的 CPU。</p>\n</li>\n</ul>\n<blockquote>\n<p>PS:  display:none 会触发 reflow，而 visibility:hidden 只会触发 repaint，因为没有发现位置变化。</p>\n</blockquote>\n<p>总结一下：</p>\n<p>重排：元素的尺寸变了、位置变了</p>\n<p>重绘：元素的颜色、背景、边框、轮廓变了，但是，元素的几何尺寸没有变。</p>\n<p>Reflow 的成本比 Repaint 的成本高得多的多。DOM Tree 里的每个结点都会有 reflow 方法，一个结点的 reflow 很有可能导致子结点，甚至父点以及同级结点的 reflow。在一些高性能的电脑上也许还没什么，但是如果 reflow 发生在手机上，那么这个过程是非常痛苦和耗电的。</p>\n<h3 id=\"页面加载缓慢的原因\"><a class=\"anchor\" href=\"#页面加载缓慢的原因\">#</a> 页面加载缓慢的原因</h3>\n<p><img data-src=\"./assets/browser-rendering.gif\" alt=\"browser-rendering\" /></p>\n<p><img data-src=\"./assets/backend-generation.gif\" alt=\"backend-generation\" /></p>\n<p><img data-src=\"./assets/wpo-front-backend.png\" alt=\"wpo-front-backend\" /></p>\n<h4 id=\"浏览器部分\"><a class=\"anchor\" href=\"#浏览器部分\">#</a> 浏览器部分</h4>\n<ul>\n<li>\n<p>网络层面</p>\n<ol>\n<li>\n<p>过多的 HTTP 请求</p>\n<p>打开一个网页的时候，后台程序的响应并不所需太多时间，等待的时间主要花费在下载网页元素上了，即 HTML、CSS、JavaScript、Flash、图片等。据统计，每增加一个元素，网页载入的时间就会增加 25-40 毫秒（具体取决于用户的带宽情况）。</p>\n</li>\n<li>\n<p>资源访问带宽小</p>\n<p>两方面，一方面是客户端的带宽，一方面是服务器端的带宽。</p>\n</li>\n<li>\n<p>网页元素 (图片、视频、样式) 太大</p>\n</li>\n</ol>\n</li>\n<li>\n<p>浏览器渲染层面</p>\n<ol>\n<li>\n<p>渲染阻塞：</p>\n<p>浏览器想要渲染一个页面就必须先构建出 <code>DOM</code>  树与 <code>CSSOM</code>  树，如果 <code>HTML</code>  与 <code>CSS</code>  文件结构非常庞大与复杂，这显然会给页面加载速度带来严重影响。</p>\n<p>所谓渲染阻塞资源，即是对该资源发送请求后还需要先构建对应的 <code>DOM</code>  树或 <code>CSSOM</code>  树，这种行为显然会延迟渲染操作的开始时间。</p>\n<p>JS 阻塞与 CSS 阻塞：</p>\n<p><strong>HTML、CSS、JavaScript 都是会对渲染产生阻塞的资源，HTML 是必需的（没有 DOM 还谈何渲染），但还可以从 CSS 与 JavaScript 着手优化，尽可能地减少阻塞的产生。</strong></p>\n</li>\n<li>\n<p>重复渲染</p>\n</li>\n<li>\n<p>DNS 解析</p>\n</li>\n</ol>\n</li>\n<li>\n<p>服务端层面</p>\n<ol>\n<li>硬件配置低：这个是双向的</li>\n<li>服务器软件，比如防火墙、内网策略等</li>\n<li>未对 Nginx 这类 web 服务器进行配置优化</li>\n<li>CPU 占满、数据库未优化</li>\n<li>代码问题，代码效率，代码性能</li>\n<li>包含了过多的分析类工具</li>\n</ol>\n</li>\n</ul>\n<h4 id=\"代码部分\"><a class=\"anchor\" href=\"#代码部分\">#</a> 代码部分</h4>\n<ul>\n<li>\n<p>构建层面</p>\n<p>未对代码进行打包、压缩、兼容性优化。</p>\n<p>未合并重复的请求、代码。</p>\n</li>\n<li>\n<p>编码层面</p>\n<p>没有良好的编码习惯，错误的编排 JS 与 CSS</p>\n<p>for 循环、迭代、同步、重定向、阻塞请求</p>\n<p>未删除重复、无用的代码</p>\n<p>未对逻辑业务复杂的代码进行重构，了解设计模式，对业务进行疏理</p>\n</li>\n<li>\n<p>机制 (SSR，英文 Server Side Render：服务器端渲染)</p>\n<p>未加入 Async 异步机制</p>\n<p>未思考页面加载、用户体验</p>\n</li>\n<li>\n<p>规范</p>\n<p>CSS 规范</p>\n<p>HTML 规范 / HTML5 规范</p>\n<p>Airbnb 代码规范等。</p>\n</li>\n</ul>\n<h3 id=\"优化原则\"><a class=\"anchor\" href=\"#优化原则\">#</a> 优化原则</h3>\n<h4 id=\"尽量减少http请求\"><a class=\"anchor\" href=\"#尽量减少http请求\">#</a> 尽量减少 HTTP 请求</h4>\n<p>在浏览器 (客户端) 和服务器发生通信时，就已经消耗了大量的时间，尤其是在网络情况比较糟糕的时候，这个问题尤其的突出。</p>\n<p>一个正常 HTTP 请求的流程简述：如在浏览器中输入 &quot;<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy54eHh4eHguY29t\">www.xxxxxx.com</span>&quot; 并按下回车，浏览器再与这个 URL 指向的服务器建立连接，然后浏览器才能向服务器发送请求信息，服务器在接受到请求的信息后再返回相应的信息，浏览器接收到来自服务器的应答信息后，对这些数据解释执行。</p>\n<p>而当我们请求的网页文件中有很多图片、CSS、JS 甚至音乐等信息时，将会频繁的与服务器建立连接，与释放连接，这必定会造成资源的浪费，且每个 HTTP 请求都会对服务器和浏览器产生性能负担。</p>\n<p>网速相同的条件下，下载一个 100KB 的图片比下载两个 50KB 的图片要耗费的网络资源更多。所以，请减少 HTTP 请求。</p>\n<p><strong>具体的方法：</strong></p>\n<ol>\n<li>\n<p>组合文件，优化图片，使用 sprites 设计风格：将背景图片合并成一个文件，通过 <code>background-image</code>  和  <code>background-position</code>  控制显示；</p>\n<p>确保您的图像不大于它们所需的图像，它们采用正确的文件格式（PNG 通常更适用于少于 16 种颜色的图形，而 JPEG 通常更适合照片）并且它们是针对 Web 压缩的。</p>\n<p>使用 CSS sprites 在网站上经常使用的图像创建模板，如按钮和图标。CSS sprites 将您的图像组合成一个大图像，一次加载所有（这意味着更少的 HTTP 请求），然后只显示您想要显示的部分。这意味着您通过不让用户等待加载多个图像来节省加载时间。</p>\n<p>有一些在线工具：</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zcHJpdGVjb3cuY29tLw==\">Sprite Cow</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc3ByaXRlYm94Lm5ldC8=\">Spritebox</span></li>\n</ul>\n</li>\n<li>\n<p>肉联图片，使用 <code>data:URL</code>  方案将图像数据嵌入实际页面中。这可以增加 HTML 文档的大小。将内嵌图像组合到（缓存的）样式表中是一种减少 HTTP 请求并避免增加页面大小的方法。</p>\n</li>\n<li>\n<p>简化页面的设计</p>\n</li>\n</ol>\n<h4 id=\"使用内容传送网络cdn\"><a class=\"anchor\" href=\"#使用内容传送网络cdn\">#</a> 使用内容传送网络 CDN</h4>\n<p>内容分发网络（CDN），也称为内容传送网络，是用于分发传送内容的负载的服务器网络。从本质上讲，您网站的副本存储在多个地理位置不同的数据中心，以便用户可以更快，更可靠地访问您的网站。</p>\n<p>对于初创公司和私人网站来说，CDN 服务的成本可能过高，但随着您的目标受众变得越来越大并变得更加全球化，CDN 对于实现快速响应时间是必要的。</p>\n<p>请记住，最终用户响应时间的 80-90％用于下载页面中的所有组件：图像，样式表，脚本，Flash 等。这是<em> Performance Golden Rule</em>。而不是从重新设计应用程序架构的艰巨任务开始，最好首先分散您的静态内容。这不仅可以大大缩短响应时间，而且由于内容交付网络，它更容易实现。</p>\n<p>内容传送网络（CDN）是分布在多个位置的 Web 服务器的集合，以更有效地向用户传送内容。选择用于向特定用户传送内容的服务器通常基于网络接近度的度量。例如，选择具有最少网络跳数的服务器或具有最快响应时间的服务器。</p>\n<blockquote>\n<p>CDN 服务商有很多，这里就不再多说：专门做 CDN 服务器的蓝讯、网宿、帝联、快网，还有阿里云、腾讯云、华为云等。国外如<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ha2FtYWkuY29tLw==\"> Akamai Technologies</span>，<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5lZGdlY2FzdC5jb20v\">EdgeCast</span> 或<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5sZXZlbDMuY29tL2luZGV4LmNmbT9wYWdlSUQ9MzY=\"> level3</span></p>\n</blockquote>\n<p>除了去购买一些 CDN 服务商的服务以外，对于大多数开发者，可以使用公共 CDN 网络上的资源，如以下的方式去使用 CDN 加速：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- google --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">&lt;!-- cdnjs --></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">&lt;!-- qiniu cloud --></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">&lt;!-- other cdn --></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token attr-name\">crossorigin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>anonymous<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token attr-name\">integrity</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://lib.baomitu.com/jquery/3.4.1/jquery.min.js<span class=\"token punctuation\">\"</span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h4 id=\"避免空src或者是href值\"><a class=\"anchor\" href=\"#避免空src或者是href值\">#</a> 避免空 src 或者是 href 值</h4>\n<p>空的 src 和 href 都会导致多余的 HTTP 请求，虽然不影响加载时间，但是会对服务器产生不必要的流量和压力。浏览器仍然会向服务器发起一个 HTTP 请求：</p>\n<ul>\n<li>IE 向页面所在的目录发送请求</li>\n<li>Safari、Chrome、Firefox 向页面本身发送请求</li>\n<li>Opera 不执行任何操作</li>\n</ul>\n<p>空的 src 的 image 严重的以至于影响整个网站的用户体验，空  <code>src</code>  产生请求的后果不容小憩：</p>\n<ul>\n<li>给服务器造成意外的流量负担，尤其时日 PV 较大时；</li>\n<li>浪费服务器计算资源；</li>\n<li>可能产生报错。</li>\n</ul>\n<p>有两种形式：</p>\n<ol>\n<li>\n<p>HTML 形式</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure></li>\n<li>\n<p>JavaScript 形式</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> img <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>img<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n</ol>\n<p>解决办法：</p>\n<ol>\n<li>删除空的 <code>src</code>  和 <code>href</code>  标签</li>\n<li>给 <code>a</code>  标签的 <code>href</code>  属性，连接到实际的页面：</li>\n</ol>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#nogo<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>##<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>###<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>void(0);<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>void(0)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>;<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"3\">\n<li>禁止跳转，添加 <code>cursor:pointer</code>  样式</li>\n</ol>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\"></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token selector\">a</span><span class=\"token punctuation\">&#123;</span><span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> pointer<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span><span class=\"token punctuation\">></span></span>点击一<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token special-attr\"><span class=\"token attr-name\">onclick</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value javascript language-javascript\"><span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>点击二<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><ol start=\"4\">\n<li>给 <code>a</code>  标签创建一个带有描述信息的 <code>href</code>  属性，并监控 <code>click</code>  事件调用 <code>preventDefault()</code>  函数。</li>\n</ol>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#Something_De scriptive<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>my_id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Trigger<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#my_id\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 取消单击事件的默认动作以阻止链接的跳转。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">//  其他的代码</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>优点：</p>\n<ul>\n<li>让 <code>&lt;a&gt;</code>  够响应键盘事件并获得焦点（从而屏幕阅读器能够读出背后的内容，增强可访问性）</li>\n<li>优雅降级，在网络连接很差，还没有加载到 CSS 的时候， <code>&lt;a&gt;</code>  依然有手型与正常的 link 样式。</li>\n</ul>\n<h4 id=\"gzip的组件\"><a class=\"anchor\" href=\"#gzip的组件\">#</a> gzip 的组件</h4>\n<p>所有现代浏览器都支持  <code>gzip</code>  压缩并会为所有 HTTP 请求自动协商此类压缩。启用  <code>gzip</code>  压缩可大幅缩减所传输的响应的大小（最多可缩减 90%），从而显著缩短下载相应资源所需的时间、减少客户端的流量消耗并加快网页的首次呈现速度。</p>\n<p>从 HTTP / 1.1 开始，Web 客户端表示支持使用 HTTP 请求中的 Accept-Encoding 标头进行压缩。</p>\n<pre><code>Accept-Encoding：gzip，deflate\n</code></pre>\n<p>压缩包括 XML 和 JSON 在内的任何文本响应都是值得的。不应对图像和 PDF 文件进行 gzip 压缩，因为它们已经过压缩。试图对它们进行 gzip 不仅会浪费 CPU，还可能会增加文件大小。</p>\n<p>比如，在 nginx 中开启 gzip 压缩：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 开启 gzip</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">gzip</span> on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 启用 gzip 压缩的最小文件，小于设置值的文件将不会压缩</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>gzip_min_length 1k<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># gzip 压缩级别，1-10，数字越大压缩的越好，也越占用 CPU 时间，后面会有详细说明</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>gzip_comp_level <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 进行压缩的文件类型。javascript 有多种形式。其中的值可以在 mime.types 文件中找到。</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png font/ttf font/otf image/svg+xml<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 是否在 http header 中添加 Vary: Accept-Encoding，建议开启</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>gzip_vary on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 禁用 IE 6 gzip</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>gzip_disable <span class=\"token string\">\"MSIE [1-6]\\.\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>其他 web 容器启动 gzip 的方法：</p>\n<ul>\n<li>Apache：使用 <span class=\"exturl\" data-url=\"aHR0cDovL2h0dHBkLmFwYWNoZS5vcmcvZG9jcy9jdXJyZW50L21vZC9tb2RfZGVmbGF0ZS5odG1s\">mod_deflate</span></li>\n<li>Nginx：使用 <span class=\"exturl\" data-url=\"aHR0cDovL25naW54Lm9yZy9lbi9kb2NzL2h0dHAvbmd4X2h0dHBfZ3ppcF9tb2R1bGUuaHRtbA==\">ngx_http_gzip_module</span></li>\n<li>IIS：<span class=\"exturl\" data-url=\"aHR0cDovL3RlY2huZXQubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2NjNzcxMDAzKHY9V1MuMTApLmFzcHg=\">配置 HTTP 压缩功能</span></li>\n</ul>\n<h4 id=\"css放在顶部js放在底部\"><a class=\"anchor\" href=\"#css放在顶部js放在底部\">#</a> CSS 放在顶部，JS 放在底部</h4>\n<p>把 Javascript 脚本在底部，删除阻止渲染的 JavaScript<br />\n 在 HTML 文件 <code>&lt;body&gt;</code>  中指定外部样式表和内联样式块可能对浏览器的渲染性能产生不利影响。</p>\n<ol>\n<li>浏览器阻塞渲染网页直到所有外部的样式表都已被下载。</li>\n<li>（用 <code>&lt;style&gt;</code>  标记指定的）内联样式块可能会导致 reflows 和页面跳动。<br />\n因此，把外部样式表和内联样式块放在页面的 <code>&lt;head&gt;</code>  中是很重要的。通过确保样式表首先被下载和解析，可以让浏览器逐步渲染页面。</li>\n</ol>\n<p>具体做法：</p>\n<ul>\n<li>\n<p>将内联样式块和 <code>&lt;link&gt;</code>  元素从页面 <code>&lt;body&gt;</code>  移动到页面 <code>&lt;head&gt;</code>  中。</p>\n<p>HTML 4.01 规范（第 12.3 节）规定，始终把使用 <code>&lt;link&gt;</code>  标签的外部样式表放在 <code>&lt;head&gt;</code>  部分里，还要确保您指定的样式有正确的顺序。</p>\n</li>\n<li>\n<p>把 <code>&lt;style&gt;</code>  区块放在 <code>&lt;head&gt;</code>  部分里。</p>\n</li>\n<li>\n<p>使用 css 媒体类型</p>\n</li>\n</ul>\n<p>如果可以让 <code>CSS</code>  资源只在特定条件下使用，这样这些资源就可以在首次加载时先不进行构建 <code>CSSOM</code>  树，只有在符合特定条件时，才会让浏览器进行阻塞渲染然后构建 <code>CSSOM</code>  树。</p>\n<p><code>CSS</code>  的媒体查询正是用来实现这个功能的，它由媒体类型以及零个或多个检查特定媒体特征状况的表达式组成。</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">&lt;!-- 没有使用媒体查询，这个 css 资源会阻塞渲染  --></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span>    <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">&lt;!-- all 是默认类型，它和不设置媒体查询的效果是一样的 --></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span>    <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>all<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">&lt;!-- 动态媒体查询， 将在网页加载时计算。</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>根据网页加载时设备的方向，portrait.css 可能阻塞渲染，也可能不阻塞渲染。--></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>portrait.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>orientation:portrait<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">&lt;!-- 只在打印网页时应用，因此网页首次在浏览器中加载时，它不会阻塞渲染。 --></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>print.css<span class=\"token punctuation\">\"</span></span>    <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>print<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>使用媒体查询可以让 CSS 资源不在首次加载中阻塞渲染，但不管是哪种 CSS 资源它们的下载请求都不会被忽略，浏览器仍然会先下载 CSS 文件。</p>\n<p><strong>把 Javascript 脚本在底部，删除阻止渲染的 JavaScript</strong></p>\n<p>浏览器必须通过在呈现页面之前解析 HTML 来构建 DOM 树。如果您的浏览器在此过程中遇到脚本，则必须先停止并执行它，然后才能继续。</p>\n<p>具体做法：</p>\n<p>将脚本定义或引用放置到 <code>&lt;body&gt;</code>  底部。<br />\n <code>&lt;script defer=&quot;defer&quot;&gt;</code>  defer 属性规定是否对脚本执行进行延迟， 脚本将在页面完成解析时执行。</p>\n<p><img data-src=\"./assets/bVcQV0.jpeg\" alt=\"请输入图片描述\" /></p>\n<p>蓝色线代表网络读取，红色线代表执行时间，这俩都是针对脚本的；绿色线代表 HTML 解析。</p>\n<p>此图告诉我们以下几个要点：</p>\n<ol>\n<li><code>defer</code>  和  <code>async</code>  在网络读取（下载）这块儿是一样的，都是异步的（相较于 HTML 解析）</li>\n<li>它俩的差别在于脚本下载完之后何时执行，显然  <code>defer</code>  * 是最接近我们对于应用脚本加载和执行的要求的</li>\n<li>关于  <code>defer</code> ，此图未尽之处在于它是按照加载顺序执行脚本的，这一点要善加利用</li>\n<li><code>async</code>  则是一个乱序执行的主，反正对它来说脚本的加载和执行是紧紧挨着的，所以不管你声明的顺序如何，只要它加载完了就会立刻执行</li>\n<li>仔细想想， <code>async</code>  对于应用脚本的用处不大，因为它完全不考虑依赖（哪怕是最低级的顺序执行），不过它对于那些可以不依赖任何脚本或不被任何脚本依赖的脚本来说却是非常合适的，最典型的例子：Google Analytics</li>\n</ol>\n<h4 id=\"减少dns查找\"><a class=\"anchor\" href=\"#减少dns查找\">#</a> 减少 DNS 查找</h4>\n<p>用户访问网站的过程如下：</p>\n<ol>\n<li>\n<p>在地址栏输入网站地址，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS13d3ctZW84ZS5leGFtcGxlLmNvbQ==\">如 www.example.com</span>;</p>\n</li>\n<li>\n<p>本地 DNS 得到这个请求，查询本地 DNS 缓存，如果有这条记录，则直接返回对应的 IP；否则，请求网络上的 DNS 服务器，得到相应的 IP，返回给客户机，并缓存这条记录；</p>\n</li>\n<li>\n<p>浏览器向得到的 IP 发起建立连接请求，得到响应后建立连接，请求数据；</p>\n</li>\n<li>\n<p>Server 端计算所需数据，并返回给 client 端；</p>\n</li>\n<li>\n<p>client 端，即浏览器，解析数据并显示在浏览器窗口中，至此，请求完成。</p>\n</li>\n</ol>\n<p>在 一次请求中，DNS 解析可以占到请求时间的三分之一左右（这点有待验证），所以如果可以缩短 DNS 解析时间，就可以加快页面的打开速度。</p>\n<p>缩短 DNS 解析的 方法可以<strong>通过延长 DNS 缓存的时间</strong>，<strong>选用更快的 DNS Server</strong>，<strong>减少域名总数</strong>（例如原来有 5 个 img server，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1pbWcxLXVoNWY1NHJvaC54eHgueG4tLWNvbWltZzUtem8wdC54eHguY29t\">分别为 img1.xxx.com 至 img5.xxx.com</span>，则现在可以减少到 3 个）等等，但是减少域名个数又会降低资源并行下载的数量， 因为同一域名最多可以并行下载两个资源，所以这里需要一个折衷方案，作者的建议就是将资源分布在大于等于 2 但小于等于 4 个域名上（这个也有待验证，例如针 对多大的系统选用多少个域名是最合理的等）。</p>\n<p><strong>使用 DNS 预解析</strong></p>\n<p>这里会有一些兼容性问题，可以参见：<span class=\"exturl\" data-url=\"aHR0cDovL2Nhbml1c2UuY29tLyNmZWF0PWxpbmstcmVsLWRucy1wcmVmZXRjaA==\">http://caniuse.com/#feat=link-rel-dns-prefetch</span></p>\n<p><img data-src=\"./assets/sdfdsf.png\" alt=\"sdfdsf\" /></p>\n<p>在网页体验中我们常会遇到这种情况，即在调用百度联盟、谷歌联盟以及当前网页所在域名外的域名文件时会遇到请求延时非常严重的情况。那么有没有方法去解决这种请求严重延时的现象呢？</p>\n<p>一般来说这种延时的原因不会是对方网站带宽或者负载的原因，那么到底是什么导致了这种情况呢。湛蓝试着进行推测，假设是 DNS 的问题，因为 DNS 解析速度很可能是造成资源延时的最大原因。在页面 header 中添加了以下代码（用以 DNS 预解析）：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>x-dns-prefetch-control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>on<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dns-prefetch<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://bdimg.share.baidu.com<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dns-prefetch<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://nsclick.baidu.com<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dns-prefetch<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://hm.baidu.com<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>dns-prefetch<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>http://eiv.baidu.com<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><p>dns-prefetch 需慎用，多页面重复 DNS 预解析会增加重复 DNS 查询次数。</p>\n<p>使用场景：</p>\n<ol>\n<li>新用户访问，后端可以通过 Cookie 判断是否为首次进入站点，对于这类用户，DNS Prefetch 可以比较明显地提升访问速度</li>\n<li>登录页，提前在页面上进行下一跳页用到资源的 DNS Prefetch</li>\n<li>页面中的静态资源在不同的 domain 下，如 CSS、JS、图片等文件</li>\n<li>电商网站的商品页大量载入不同 domain 下的商品图，如淘宝</li>\n<li>手机网页</li>\n<li>大型网站</li>\n<li>js 或服务端重定向</li>\n</ol>\n<blockquote>\n<p>Chrome 中的一些指令：</p>\n<ul>\n<li><code>chrome://histograms/DNS.PrefetchQueue</code> ：查看队列状态</li>\n<li><code>chrome://histograms/DNS</code> ：查看从浏览器启动到上一页的 DNS 记录</li>\n<li><code>chrome://dns</code> ：查看个域名 DNS 统计</li>\n<li><code>chrome://net-internals/#dns</code> ：清除 host 缓存</li>\n</ul>\n</blockquote>\n<h4 id=\"压缩资源\"><a class=\"anchor\" href=\"#压缩资源\">#</a> 压缩资源</h4>\n<ul>\n<li>\n<p>压缩 js，css，image</p>\n<p><strong>通过对外部资源进行压缩可以大幅度地减少浏览器需要下载的资源量，它会减少关键路径长度与关键字节，使页面的加载速度变得更快。</strong></p>\n<p><strong>对数据进行压缩其实就是使用更少的位数来对数据进行重编码</strong>。如今有非常多的压缩算法，且每一个的作用领域也各不相同，它们的复杂度也不相同，不过在这里我不会讲压缩算法的细节，感兴趣的朋友可以自己 Google。</p>\n<p>在对 <code>HTML</code> 、 <code>CSS</code>  和 <code>JavaScript</code>  这些文件进行压缩之前，还需要先进行一次冗余压缩。<strong>所谓冗余压缩，就是去除多余的字符，例如注释、空格符和换行符</strong>。这些字符对于程序员是有用的，毕竟没有格式化的代码可读性是非常恐怖的，但它们对于浏览器是没有任何意义的，去除这些冗余可以减少文件的数据量。</p>\n<p>小图片采用 base64 的格式，直接嵌入代码中，可以帮我们减少 http 请求，但是同样，这个会造成我们代码的提及变大。请求的速度会减慢，这个需要平衡。</p>\n<p>常用工具：webpack，gulp</p>\n<blockquote>\n<p>浏览器接收到服务器返回的 HTML、CSS 和 JavaScript 字节数据并对其进行解析和转变成像素的渲染过程被称为 <code>关键渲染路径</code> 。通过优化关键渲染路径即可以缩短浏览器渲染页面的时间。</p>\n</blockquote>\n</li>\n<li>\n<p>删除重复的脚本，类似 <code>tree-shaking</code></p>\n<p>在一个页面中重复引用一个脚本可能存在的问题：浏览器会重复下载并执行脚本文件。</p>\n</li>\n<li>\n<p>使用合适大小的图片</p>\n<p>如果你只需要一个小图，就不要传一个大图。例如你实际需要显示的是一个 60x60 的头像，就不要传一个 100x100 的然后再通过设置宽高将它缩小为 60x60 的。原因很简单，这样会消耗不必要的带宽和系统资源。</p>\n</li>\n<li>\n<p>减少 DOM 元素的数量</p>\n<p>复杂页面意味着要下载更多字节，这也意味着 JavaScript 中的 DOM 访问速度更慢。如果您想要添加事件处理程序，例如，在页面上循环 500 或 5000 个 DOM 元素，则会有所不同。</p>\n</li>\n<li>\n<p>使用异步加载，async、defer</p>\n<blockquote>\n<p>服务端渲染也是一种减少浏览器资源消耗，减少页面重排重绘，也是一种现行 MVVM 框架单页应用最主要的 SEO 优化手段。</p>\n</blockquote>\n</li>\n</ul>\n<h4 id=\"避免3xx4xx\"><a class=\"anchor\" href=\"#避免3xx4xx\">#</a> 避免 3xx/4xx</h4>\n<p><strong>避免重定向</strong></p>\n<p>3xx 是重定向相关的 HTTP 响应代码</p>\n<p>重定向的意思是，用户的原始请求（例如请求 A）被重定向到其他的请求（例如请求 B）。</p>\n<p>每次页面重定向到另一个页面时，您的访问者都会面临等待 HTTP 请求 - 响应周期完成的额外时间。例如，如果移动重定向模式如下所示：</p>\n<p><code>example.com</code>  - &gt;  <code>www.example.com</code>  - &gt;  <code>m.example.com</code>  - &gt;  <code>m.example.com/home</code> ，这两个额外重定向中的每一个都会使您的页面成为可能加载速度慢。</p>\n<p>HTTP 重定向通过  <code>301</code> / <code>302</code>  状态码实现。</p>\n<pre><code>HTTP/1.1 301 Moved Permanently  \nLocation: http://example.com/newuri  \nContent-Type: text/html  \n</code></pre>\n<p><code>301 Moved Permanently</code> ，这个状态码标识用户所请求的资源被移动到了另外的位置，客户端接收到此响应后，需要发起另外一个请求去下载所需的资源。</p>\n<p><code>302 Found</code> ，这个状态码标识用户所请求的资源被找到了，但不在原始位置，服务器会回复其他的一个位置，客户端收到此响应后，也需要发起另外一个请求去下载所需的资源。</p>\n<p>客户端收到服务器的重定向响应后，会根据响应头中  <code>Location</code>  的地址再次发送请求。重定向会影响用户体验，尤其是多次重定向时，用户在一段时间内看不到任何内容，只看到浏览器进度条一直在刷新。</p>\n<p>有时重定向无法避免，在糟糕也比抛出  <code>404</code>  好。虽然通过 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5pbS8/dGFyZ2V0PWh0dHBzJTNBJTJGJTJGZW4ud2lraXBlZGlhLm9yZyUyRndpa2klMkZNZXRhX3JlZnJlc2g=\">HTML meta refresh</span> 和 JavaScript 也能实现，但首选 HTTP  <code>3xx</code>  跳转，以保证浏览器「后退」功能正常工作（也利于 SEO）。</p>\n<p><strong>常见的优化办法：</strong></p>\n<ul>\n<li>\n<p>最浪费的重定向经常发生、而且很容易被忽略：URL 末尾应该添加  <code>/</code>  但未添加。比如，访问  <code>http://astrology.yahoo.com/astrology</code>  将被 301 重定向到  <code>http://astrology.yahoo.com/astrology/</code> （注意末尾的  <code>/</code> ）。如果使用 Apache，可以通过  <code>Alias</code>  或  <code>mod_rewrite</code>  或  <code>DirectorySlash</code>  解决这个问题。</p>\n</li>\n<li>\n<p>网站域名变更：CNAME 结合  <code>Alias</code>  或  <code>mod_rewrite</code>  或者其他服务器类似功能实现跳转。</p>\n</li>\n<li>\n<p>在定义链接地址的 href 属性的时候，尽量使用最完整的、直接的地址。例如：<br />\n使用  <code>www.cnblogs.com</code>  而不是 <code>cnblogs.com</code> <br />\n 使用 <code>cn.bing.com</code>  而不是 <code>bing.com</code> <br />\n 使用 <code>www.google.com.hk</code>  而不是 <code>google.com</code> <br />\n 使用 <code>www.mysite.com/products/</code>  而不是 <code>www.mysite.com/products</code></p>\n</li>\n</ul>\n<p><strong>避免 404 浏览器找不到资源的情况发生</strong></p>\n<p>发出 HTTP 请求并获得无用的响应（即 404 Not Found）是完全没必要的。特别糟糕的是当外部 JavaScript 的链接错误并且结果是 404 时。首先，此下载将阻止并行下载。接下来，浏览器可能会尝试解析 404 响应主体，就像它是 JavaScript 代码一样，这样就带来的性能的浪费。</p>\n<p><strong>404 的影响：</strong></p>\n<p>有时候，404 错误发生了，用户可能根本没有感觉到。例如</p>\n<ul>\n<li>例如请求 favicon.ico 文件，或者请求了某个不存在的脚本文件、样式表、图片文件，页面还是会按照正常的方式进行呈现。</li>\n<li>丢失的脚本文件、样式表、图片文件，会导致页面的某些行为、界面效果出现异常（也可能不是很明显）</li>\n<li>最大的问题可能是性能方面的影响。尤其是如果请求一个不存在的脚本文件，因为浏览器在请求脚本文件的时候，即便是返回 404，它也会尝试去按照 Javascript 的方式解析响应中的内容。这无疑会增加很多处理的时间，而因为该文件不存在，所以这些都是无用功。</li>\n</ul>\n<p>看得到的影响：</p>\n<ul>\n<li>如果用户请求的某个页面不存在，那么他将收到明确的回应</li>\n<li>默认情况下，他将收到一个标准的错误页面（请注意：不少用户会被这个页面吓到）</li>\n</ul>\n<p><strong>常见的优化办法：</strong></p>\n<p>404 意味着 Not Found，意思是说未找到资源。既然如此，那么至少会有两种原因导致 404 错误：</p>\n<ul>\n<li>该资源按理说是要有，但我们没有提供。用户按照正常的方式来请求，所以资源找不到。\n<ul>\n<li>为网站提供 favicon.ico 这种经常可能会被忽略的资源</li>\n<li>使用一些检查工具：比如 Link checker</li>\n</ul>\n</li>\n<li>该资源本来就不存在，用户按照不正常的方式来请求，当然还是找不到。\n<ul>\n<li>避免用户收藏绝对地址，给后期更新带来隐患。可以使用地址 Rewrite 来重写，或者在设计阶段定义一些灵活友好的地址</li>\n<li>使用 Routing 技术，配置路由规则。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"ajax优化\"><a class=\"anchor\" href=\"#ajax优化\">#</a> AJAX 优化</h4>\n<p><strong>使 Ajax 可缓存</strong></p>\n<p>AJAX=Asynchronous JavaScript And XML，AJAX 不是新的编程语言，而是一种使用现有标准的新方法。<br />\nAJAX 是与服务器交换数据并更新部分网页的艺术，在不重新加载整个页面的情况下。</p>\n<p>由于 AJAX 其实也是需要发起请求，然后服务器执行，并将结果（通常是 JSON 格式的）发送给浏览器进行最后的呈现或者处理，所以对于网站设计优化的角度而言，我们同样需要考虑对这些请求，是否可以尽可能的利用到缓存的功能来提高性能。</p>\n<p>对于 AJAX 而言，有一些特殊性，并不是所有的 AJAX 请求都是可以缓存的。</p>\n<ol>\n<li><code>POST</code>  的请求，是不可以在客户端缓存的，每次请求都需要发送给服务器进行处理，每次都会返回状态码 200。（这里可以优化的是，服务器端对数据进行缓存，以便提高处理速度）</li>\n<li><code>GET</code>  的请求，是可以（并且默认）在客户端进行缓存的，除非指定了不同的地址，否则同一地址的 AJAX 请求，不会重复再服务器执行，而是返回 304。</li>\n</ol>\n<p>有的时候，我们可能希望 <code>GET</code>  请求不被缓存，有几种做法来达到这样的目的。</p>\n<ol>\n<li>每次调用的时候，请求不同的地址（可以在原始地址后面添加一个随机的号码）。</li>\n<li>如果你所使用的是 jquery 的话，则可以考虑禁用 AJAX 的缓存。</li>\n</ol>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$<span class=\"token punctuation\">.</span><span class=\"token function\">ajaxSetup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">cache</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>axios 中</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span>\t<span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">,</span><span class=\"token string-property property\">'Cache-Control'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'no-cache'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/post'</span><span class=\"token punctuation\">,</span>config<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><strong>使用 GET 的 Ajax 请求</strong></p>\n<p>在使用 XMLHttpRequest（目前的 AJAX 都是基于它实现的）的时候，浏览器中的 POST 实现为两步走的过程，首先发送头部信息，然后再发送数据。但如果是使用 GET 的话，就只有一个 TCP 的包发送出去（除非有大量的 Cookie），这样无疑可以提高性能。</p>\n<p>但是 get 有容量限制，大于 2K (对 get 的限制 IE 是 2K，firefox、chrome 是 4K) 的内容只能用 post。</p>\n<h4 id=\"cookie优化\"><a class=\"anchor\" href=\"#cookie优化\">#</a> Cookie 优化</h4>\n<ul>\n<li>\n<p>减小 cookie 大小</p>\n<p>减小 cookie 的大小，因为在发请求时浏览器会将 cookie 信息发送到 server 端，所以应该只在 cookie 中存必要的信息且越长度越小越好。在 写 cookie 的时候要记得给 cookie 设置一个合理的过期时间及域</p>\n</li>\n<li>\n<p>对一些静态资源不需要使用 cookie 的单独设置域</p>\n<p>当浏览器发出静态图像请求并将 cookie 与请求一起发送时，服务器对这些 cookie 没有任何用处。因此，他们只会毫无理由地创建网络流量。您应该确保使用无 cookie 请求请求静态组件。创建一个子域并在那里托管所有静态组件。</p>\n<p>如果您的域名是 <code>www.example.org</code> ，您可以托管您的静态组件 <code>static.example.org</code> 。但是，如果您已经在顶级域上设置了 cookie  <code>example.org</code>  而不是 <code>www.example.org</code> ，则所有请求都  <code>static.example.org</code>  将包含这些 cookie。在这种情况下，您可以购买一个全新的域，在那里托管您的静态组件，并保持此域无 cookie。雅虎 用途 <code>yimg.com</code> ，YouTube 使用 <code>ytimg.com</code> ，亚马逊使用 <code>images-amazon.com</code>  等。</p>\n<p>在无 cookie 域上托管静态组件的另一个好处是，某些代理可能拒绝缓存使用 cookie 请求的组件。在相关说明中，如果您想知道是否应该使用 <code>example.org</code>  或 <code>www.example.org</code>  作为主页，请考虑 cookie 的影响。</p>\n<blockquote>\n<p>省略 www 会让您别无选择，只能写入 cookie  <code>*.example.org</code> ，因此出于性能原因，最好使用 www 子域并将 cookie 写入该子域。</p>\n</blockquote>\n</li>\n</ul>\n<p>归类一下：</p>\n<ul>\n<li>去除不必要的 Cookie；</li>\n<li>尽量压缩 Cookie 大小；</li>\n<li>注意设置 Cookie 的 domain 级别，如无必要，不要影响到 sub-domain；</li>\n<li>设置合适的过期时间。</li>\n</ul>\n<h4 id=\"利用缓存\"><a class=\"anchor\" href=\"#利用缓存\">#</a> 利用缓存</h4>\n<p>浏览器会缓存大量信息（样式表，图像，JavaScript 文件等），以便当访问者返回您的站点时，浏览器不必重新加载整个页面。然后设置 “expires” 标题，以表示希望缓存该信息的时间。在许多情况下，除非您的网站设计经常更改，否则一年是合理的时间段。</p>\n<p><strong>利用浏览器缓存 ，为链接或者资源，添加 Expires 或 Cache-Control 头</strong></p>\n<ul>\n<li>对于静态组件：通过设置远期未来 <code>Expires</code>  标头实现 “永不过期” 策略</li>\n<li>对于动态组件：使用适当的 <code>Cache-Control</code>  标头来帮助浏览器处理条件请求</li>\n</ul>\n<p>格式：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Expires <span class=\"token operator\">=</span> <span class=\"token string\">\"Expires\"</span> <span class=\"token string\">\":\"</span> HTTP-date</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># e.g.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Expires: Thu, 01 Dec <span class=\"token number\">1994</span> <span class=\"token number\">16</span>:00:00 GMT </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#（必须是 GMT 格式）</span></pre></td></tr></table></figure><p>通过 HTTP 的 META 设置 expires 和 cache-control</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Cache-Control<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>max-age=7200<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Expires<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Mon, 01 Aug 2019 00:00:00 GMT<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></pre></td></tr></table></figure><p>上述设置仅为举例，实际使用其一即可。这样写的话仅对该网页有效，对网页中的图片或其他请求无效，并不会做任何 <code>cache</code> 。<br />\n这样客户端的请求就多了，尽管只是检查 <code>Last-modified</code>  状态的东西，但是请求一多对浏览速度必定有影响。</p>\n<p><code>Cache-Control</code>  的参数包括:</p>\n<ul>\n<li><strong>max-age=</strong>[单位：秒 seconds] — 设置缓存最大的有效时间。类似于  <code>Expires</code> , 但是这个参数定义的是时间大小（比如：60）而不是确定的时间点。单位是 [秒 seconds].</li>\n<li><strong>s-maxage=</strong>[单位：秒 seconds] — 类似于  <code>max-age</code> , 但是它只用于公享缓存 (e.g., proxy) .</li>\n<li><strong>public</strong> — 响应会被缓存，并且在多用户间共享。正常情况，如果要求 <span class=\"exturl\" data-url=\"aHR0cDovL2JhaWtlLmJhaWR1LmNvbS92aWV3LzIwNzY0MDguaHRt\">HTTP 认证</span>，响应会自动设置为 private.</li>\n<li><strong>private</strong> — 响应只能够作为私有的缓存 (e.g., 在一个浏览器中)，不能再用户间共享。</li>\n<li><strong>no-cache</strong> — 响应不会被缓存，而是实时向服务器端请求资源。这一点很有用，这对保证<span class=\"exturl\" data-url=\"aHR0cDovL2JhaWtlLmJhaWR1LmNvbS92aWV3LzIwNzY0MDguaHRt\"> HTTP 认证</span>能够严格地禁止缓存以保证安全性很有用（这是指页面与 public 结合使用的情况下）. 既没有牺牲缓存的效率，又能保证安全。</li>\n<li><strong>no-store</strong> — 在任何条件下，响应都不会被缓存，并且不会被写入到客户端的磁盘里，这也是基于安全考虑的某些敏感的响应才会使用这个。</li>\n<li><strong>must-revalidate</strong> — 响应在特定条件下会被重用，以满足接下来的请求，但是它必须到服务器端去验证它是不是仍然是最新的。</li>\n<li><strong>proxy-revalidate</strong> — 类似于  <code>must-revalidate</code> , 但不适用于代理缓存.</li>\n</ul>\n<p><strong>把 css 与 js 使用外联的方式进行使用</strong></p>\n<p>建议将 css 和 js 以外联方式引用以充分利用 <code>cache</code> ，只有一个例外就是针对首页，首页可以采用内联来减少 http 请求数，加快页面显示速度，文中说首 页内联的原因是首页被人们访问的次数不会太多，而且样式一般比较特殊，不像其它页面一样有相同的页面模板（因为就有相同的样式部分），所以首页的样式可以 内联。并且应该在首页加载完成之后，再在后台动态加载后续页面的 css 和 js，以提高后续页面的访问速度。</p>\n<p>如果站点上的用户每个会话有多个页面查看，并且您的许多页面重复使用相同的脚本和样式表，则缓存的外部文件可能会带来更大的潜在好处。</p>\n<blockquote>\n<p>对于现在的单页面的应用，更适合于动态加载的方案</p>\n</blockquote>\n<p><strong>缓存 favicon.ico，并设置最好小于 1k</strong></p>\n<p>favicon.ico 是一个保留在服务器根目录中的图片，为了减轻拥有 favicon.ico 的带来的性能问题，请确保：</p>\n<ul>\n<li>优化它的大小，最好不到 1K。</li>\n<li>设置 Expires 标头，使其缓存。</li>\n</ul>\n<p><strong>配置的 ETag</strong></p>\n<p>ETag，全程为： <code>Entity Tag</code> ，意思是实体标签，它属于 HTTP 协议的一部分，也就是所有的 Web 服务器都应该支持这个特性。它的作用是用一个特殊的字符串来标识某个资源的 “版本”，客户端（浏览器）请求的时候，比较 ETag 如果一致，则表示该资源并没有被修改过，客户端（浏览器）可以使用自己缓存的版本，避免重复下载。<br />\n它比 last-modified date 更具有弹性，例如某个文件在 1 秒内修改了 10 次，Etag 可以综合 Inode (文件的索引节点 (inode) 数)，MTime (修改时间) 和 Size 来精准的进行判断，避开 UNIX 记录 MTime 只能精确到秒的问题。 服务器集群使用，可取后两个参数。使用 ETags 减少 Web 应用带宽和负载。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">响应标</th>\n<th style=\"text-align:left\">优势 和特点</th>\n<th style=\"text-align:left\">劣势 和可能的问题</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Expires</td>\n<td style=\"text-align:left\">- HTTP 1.0 就有，简单易用。 - 服务器通过这个 Header 告诉浏览器，某资源直到某个时间才会过期，所以在没有过期之前，浏览器就直接使用本地的缓存了。</td>\n<td style=\"text-align:left\">- 因为这是时间是由服务器发送的（UTC），但如果服务器时间和客户端事件存在不一致，可能会有些问题。 - 可能存在版本的问题，因为如果在到期之前修改过了，客户端是不会知道的。 - Cache-Control 中的 max-age 可以实现类似的效果，但更加好，因为 max-age 是一个以秒为单位的时间数，而不是具体的时间，所以不存在上面提到的第一个问题。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Cache-Contro</td>\n<td style=\"text-align:left\">- 服务器通过一个 Header（Last-Modified）告诉浏览器，某资源最后修改的时间。 - 浏览器在请求的时候，包含一个 Header（If-Modified-Since）, 然后服务器可以进行比较，如果在该时间后没有修改过，则返回 304。 - 它比 Expires 多很多选项设置</td>\n<td style=\"text-align:left\">- Last-Modified 也是一个时间，但该时间只能精确到秒，如果在同一个秒中有多次修改（这个在现在的环境下应该确实是可能的），则可能会发生问题。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ETag</td>\n<td style=\"text-align:left\">- 可以更加精确地判断资源是否被修改，因为它不是一个时间值，而是对时间经过处理的一个长整型数值（当然具体算法我们目前还不得而知）。 - 浏览器发起新请求时需要包含 If-None-Match。</td>\n<td style=\"text-align:left\">- 如果部署在服务器场环境中，配置不当的话，可能每个服务器会对相同的资源生成不一样的 ETag，这样就增加了重复下载的可能性。</td>\n</tr>\n</tbody>\n</table>\n<p>我们来看一个真实的例子：</p>\n<p><img data-src=\"./assets/image-20190619145105413.png\" alt=\"/images/image-20190619145105413\" /></p>\n<p>其他的一些缓存使用：</p>\n<ul>\n<li>使用本地缓存，缓存部分常用用户数据、公开数据</li>\n<li>缓存机制设计：缓存 + 过期时间</li>\n</ul>\n<p>总结一下：</p>\n<ul>\n<li>添加 Expires 或 Cache-Control</li>\n<li>Etag</li>\n<li>缓存 favicon.ico</li>\n<li>外联 js/css</li>\n</ul>\n<h4 id=\"缩短服务器响应时间\"><a class=\"anchor\" href=\"#缩短服务器响应时间\">#</a> 缩短服务器响应时间</h4>\n<p>服务器响应时间受到访问流量，每个页面使用的资源，服务器使用的软件以及硬件本身的影响。要改善服务器响应时间，请查找性能瓶颈，如慢速数据库查询，慢速路由或缺少足够的内存并修复它们。最佳服务器响应时间低于 200 毫秒。</p>\n<p>很多潜在因素都可能会延缓服务器响应，例如缓慢的应用逻辑、缓慢的数据库查询、缓慢的路由、框架、库、资源 CPU 不足或内存不足。您需要充分考虑所有这些因素，才能改善服务器的响应用时。 若想找出服务器响应用时过长的原因，首先要进行衡量。然后，准备好相关数据，并参阅有关如何解决该问题的相应指导。当解决问题后，您必须继续衡量服务器响应用时，并设法应对任何会在将来出现的性能瓶颈问题。</p>\n<ol>\n<li><strong>收集并检查</strong>现有性能和数据。若无可用内容，请使用自动化的网络应用监测解决方案（市面上有托管的开源版本，适用于大多数平台）进行评估，或添加自定义的方法。</li>\n<li><strong>找出并修复</strong>首要的性能瓶颈问题。如果 z 您使用的是热门网页框架或内容管理平台，请参阅与性能优化最佳做法相关的文档。</li>\n<li><strong>监测并提醒</strong>任何会在将来出现的性能衰退问题！</li>\n</ol>\n<blockquote>\n<p>通常来说，服务器的响应时间由数据库的问题居多，还有错误的程序设计 (比如：烂用 for 循环去查数据库)。</p>\n</blockquote>\n<h3 id=\"优化工具\"><a class=\"anchor\" href=\"#优化工具\">#</a> 优化工具</h3>\n<h4 id=\"google-page-speed\"><a class=\"anchor\" href=\"#google-page-speed\">#</a> Google Page Speed</h4>\n<p>Google Page Speed 以帮助开发人员和网站所有者确保他们的网页尽可能顺畅，快速地运行。</p>\n<p><strong>Google Page Speed 特点：</strong></p>\n<ul>\n<li>在 CSS 方面更加注重细节，对于 CSS 选择器，Google Page Speed 提供了大量有用的建议</li>\n<li>页面速度活动功能类似于加载计时器评估，但它实时提供图表，因此可以在任何给定时间准确查看网站上发生的情况。</li>\n<li>自动优化：使用 PageSpeed 模块，可以将 Google 与您的 Nginx 或 Apache 网站服务器集成，以自动优化您的网站。</li>\n<li>优化库集成：可以找到 PageSpeed 模块背后优化建议，允许设计和构建自己的工具。</li>\n</ul>\n<p>对于某些人来说，Google Page Speed 将是显而易见的选择，因为它可以与其他对维护网站性能至关重要的 Google 工具一起使用，例如 Google Analytics。</p>\n<h4 id=\"jsperf-benchmarkjs\"><a class=\"anchor\" href=\"#jsperf-benchmarkjs\">#</a> JsPerf &amp; Benchmark.js</h4>\n<p>经常看到项目中有一个 benchmark 的文件夹，那么这个 benchmark 是干嘛用的？</p>\n<p>JsPerf 在线：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qc3BlcmYuY29tLw==\">https://jsperf.com/</span></p>\n<p>JsPerf Github 地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2pzcGVyZi9qc3BlcmYuY29t\">https://github.com/jsperf/jsperf.com</span></p>\n<p>Benchmark.js 网址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2Jlc3RpZWpzL2JlbmNobWFyay5qcw==\">https://github.com/bestiejs/benchmark.js</span></p>\n<p>BenchMark.js 可以本地安装，而 JsPerf.js 是线上使用的。</p>\n<p>HTML 中引入：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lodash.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>platform.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>benchmark.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>或者使用 <code>npm</code> :</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token punctuation\">&#123;</span>sudo -H<span class=\"token punctuation\">&#125;</span> <span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> <span class=\"token function\">npm</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>$ <span class=\"token function\">npm</span> i <span class=\"token parameter variable\">--save</span> benchmark</pre></td></tr></table></figure><p>下面是一个具体的用例：</p>\n<p>Reg vs IndexOf</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> suite <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Benchmark<span class=\"token punctuation\">.</span>Suite</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// add tests</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>suite<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'RegExp#test'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">o</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'String#indexOf'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token string\">'Hello World!'</span><span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'o'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// add listeners</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cycle'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fastest is '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fastest'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// run async</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'async'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// logs:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">// => RegExp#test x 4,161,532 +-0.99% (59 cycles)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// => String#indexOf x 6,139,623 +-1.00% (131 cycles)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// => Fastest is String#indexOf</span></pre></td></tr></table></figure><p>再来看一个 call 与 apply 的对比：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> Benchmark <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'benchmark'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> suite <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Benchmark<span class=\"token punctuation\">.</span>Suite</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">arr1</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">str2</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 添加测试</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>suite<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'arr1'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">arr1</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'str2'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token function\">str2</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// add listeners</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cycle'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fastest is '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fastest'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pluck</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// run async</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'async'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>benckmark 是对 js 运行能效的一个对比测试，让你能够知道自己的 JS 代码中与其他方案对比的时候，是否有优化的空间。当然，这些新的方案，需要自己去编写去测试。同样，也可以在 JsPerf 的官网上去看其他的测试结果。</p>\n<p>执行办法 ：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>npm init <span class=\"token operator\">-</span>y</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>npm install <span class=\"token operator\">-</span><span class=\"token constant\">S</span> benchmark</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>touch test<span class=\"token punctuation\">.</span>js <span class=\"token comment\">//Linux</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>node test<span class=\"token punctuation\">.</span>js</pre></td></tr></table></figure><h2 id=\"代码优化写出优质的代码\"><a class=\"anchor\" href=\"#代码优化写出优质的代码\">#</a> 代码优化 —— 写出优质的代码</h2>\n<p>命题很大，但是我们要简化来谈一下。</p>\n<p>代码优化，先要写出优质的代码，有几点原则：</p>\n<ul>\n<li>使用辅助应用对代码进行检查，Eslint 等</li>\n<li>使用预编译工具，如 less，sass，stylus。</li>\n<li>使用官方的开发规范：命名规范、注释、使用规范、文档规范</li>\n<li>写出逻辑上易于阅读的代码：设计模式、代码结构、文档编排 (目录结构)</li>\n<li>代码审查</li>\n<li>单元测试</li>\n<li>异常与错误机制</li>\n</ul>\n<p>之后就是练习与阅读，阅读别人的代码，学习别人的精华，了解别人代码中的缺点。使用 JsPerf 或者 benchemark 去对比优化性能。</p>\n<p>前端代码规范：Airbnb，github，Google，腾讯，阿里等。</p>\n<h2 id=\"jsperf\"><a class=\"anchor\" href=\"#jsperf\">#</a> JsPerf</h2>\n<h3 id=\"jsperf使用简介\"><a class=\"anchor\" href=\"#jsperf使用简介\">#</a> JsPerf 使用简介</h3>\n<h4 id=\"线上使用方案\"><a class=\"anchor\" href=\"#线上使用方案\">#</a> 线上使用方案</h4>\n<p>需要使用 Github 进行登录：</p>\n<p><img data-src=\"./assets/image-20190618210408261.png\" alt=\"/images/image-20190618210408261\" /></p>\n<p>点击 <code>Login with Github to Create Test Cases</code> :</p>\n<p><img data-src=\"./assets/image-20190619103010414.png\" alt=\"/images/image-20190619103010414\" /></p>\n<p>登录之后，进入授权页面：</p>\n<p><img data-src=\"./assets/image-20190619103140822.png\" alt=\"/images/image-20190619103140822\" /></p>\n<p>登录过后，就可以创建自己的测试用例啦：</p>\n<p>\u0001<img data-src=\"./assets/image-20190619143549467.png\" alt=\"/images/image-20190619143549467\" /></p>\n<h4 id=\"线下使用方案\"><a class=\"anchor\" href=\"#线下使用方案\">#</a> 线下使用方案：</h4>\n<p>环境准备：</p>\n<ul>\n<li>Mysql</li>\n<li>Nodejs</li>\n</ul>\n<p>创建过程：</p>\n<ol>\n<li>\n<p>安装 Mysql</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mysql <span class=\"token parameter variable\">-uroot</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">\"CREATE DATABASE jsperf; GRANT ALL ON jsperf.* TO 'jsuser'@'localhost' IDENTIFIED BY 'jspass'; FLUSH PRIVILEGES;\"</span></pre></td></tr></table></figure></li>\n<li>\n<p>在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYnJvd3NlcnNjb3BlLm9yZy8=\">Browserscope.org</span> 注册一个 API key ，在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYnJvd3NlcnNjb3BlLm9yZy91c2VyL3NldHRpbmdz\">the settings page</span> 页面中.</p>\n</li>\n<li>\n<p>注册一个 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NldHRpbmdzL2FwcGxpY2F0aW9ucy9uZXc=\">new OAuth GitHub application</span>. 使用 callback URL 留空。复制 &quot;Client ID&quot; 和 &quot;Client Secret&quot; 到 github 的页面上。</p>\n</li>\n<li>\n<p>使用 <code>npm install</code>  安装</p>\n</li>\n<li>\n<p>配置 <code>.env</code>  的文件</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">NODE_ENV</span><span class=\"token operator\">=</span>development</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># from Prerequisites step 1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">MYSQL_USER</span><span class=\"token operator\">=</span>jsuser</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">MYSQL_PASSWORD</span><span class=\"token operator\">=</span>jspass</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">MYSQL_DATABASE</span><span class=\"token operator\">=</span>jsperf</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># from Prerequisites step 2</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">BROWSERSCOPE</span><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># from Prerequisites step 3</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">GITHUB_CLIENT_ID</span><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">GITHUB_CLIENT_SECRET</span><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">GITHUB_CALLBACK</span><span class=\"token operator\">=</span>http://localhost:3000</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">BELL_COOKIE_PASS</span><span class=\"token operator\">=</span>password-should-be-32-characters</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token assign-left variable\">COOKIE_PASS</span><span class=\"token operator\">=</span>password-should-be-32-characters</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># customizable but not recommended for local development</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># SCHEME=http</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># DOMAIN=localhost</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># PORT=3000</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># MYSQL_HOST=localhost</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># MYSQL_PORT=3306</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\"># LOGGLY_TOKEN=</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># LOGGLY_SUBDOMAIN=</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># REDIS_HOST=</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># REDIS_PORT=</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># REDIS_PASSWORD=</span></pre></td></tr></table></figure><ol start=\"6\">\n<li>运行 <code>npm start</code></li>\n</ol>\n<h3 id=\"代码示例for-vs-foreach\"><a class=\"anchor\" href=\"#代码示例for-vs-foreach\">#</a> 代码示例 for vs foreach</h3>\n<p>我们对比一下 for 与 foreach</p>\n<p><img data-src=\"./assets/screencapture-jsperf-2019-06-18-21_15_29.png\" alt=\"screencapture-jsperf-2019-06-18-21_15_29\" /></p>\n<p>测试过程：</p>\n<p><img data-src=\"./assets/image-20190618211820471.png\" alt=\"/images/image-20190618211820471\" /></p>\n<p>测试结果：</p>\n<p><img data-src=\"./assets/image-20190618211915799.png\" alt=\"/images/image-20190618211915799\" /></p>\n<p>这里有一个更全面的对比结果：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qc3BlcmYuY29tL2Zvci12cy1mb3JlYWNoLzc1\">https://jsperf.com/for-vs-foreach/75</span></p>\n<p><img data-src=\"./assets/image-20190618213130251.png\" alt=\"/images/image-20190618213130251\" /></p>\n<p><img data-src=\"./assets/image-20190618213201840.png\" alt=\"/images/image-20190618213201840\" /></p>\n<p>还有一些比较有意思的测试：</p>\n<p>可以通过浏览：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qc3BlcmYuY29tL3BvcHVsYXI=\">https://jsperf.com/popular</span> 进行查看</p>\n<p><img data-src=\"./assets/image-20190619143653346.png\" alt=\"/images/image-20190619143653346\" /></p>\n<h3 id=\"前端项目优化实践\"><a class=\"anchor\" href=\"#前端项目优化实践\">#</a> 前端项目优化实践</h3>\n<p>我们来对比下 Date () 与 Moment () 中的 format</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> Benchmark <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'benchmark'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> moment <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'moment'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">Date</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">Format</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">fmt</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">var</span> o <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token string-property property\">\"M+\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 月份</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string-property property\">\"d+\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 日</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token string-property property\">\"h+\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getHours</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 小时</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token string-property property\">\"m+\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMinutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 分</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token string-property property\">\"s+\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSeconds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 秒</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token string-property property\">\"q+\"</span><span class=\"token operator\">:</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 季度</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string-property property\">\"S\"</span><span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMilliseconds</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 毫秒</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(y+)</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>fmt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> fmt <span class=\"token operator\">=</span> fmt<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getFullYear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">-</span> RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> k <span class=\"token keyword\">in</span> o<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"(\"</span> <span class=\"token operator\">+</span> k <span class=\"token operator\">+</span> <span class=\"token string\">\")\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>fmt<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> fmt <span class=\"token operator\">=</span> fmt<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">.</span>length <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"00\"</span> <span class=\"token operator\">+</span> o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span> <span class=\"token operator\">+</span> o<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token keyword\">return</span> fmt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">var</span> suite <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Benchmark<span class=\"token punctuation\">.</span>Suite</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// add tests</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>suite<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Date format'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Format</span><span class=\"token punctuation\">(</span><span class=\"token string\">'yyyy-MM-dd hh:mm:ss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Moment format'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">'YYYY-MM-DD HH:mm:ss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token comment\">// add listeners</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cycle'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'complete'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Fastest is '</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fastest'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token comment\">// run async</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token string-property property\">'async'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>输出结果 ：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Moment <span class=\"token function\">format</span> x <span class=\"token number\">73,570</span> ops/sec ±4.93% <span class=\"token punctuation\">(</span><span class=\"token number\">82</span> runs sampled<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Fastest is Moment <span class=\"token function\">format</span></pre></td></tr></table></figure><h2 id=\"pagespeed\"><a class=\"anchor\" href=\"#pagespeed\">#</a> PageSpeed</h2>\n<h3 id=\"pagespeed简介\"><a class=\"anchor\" href=\"#pagespeed简介\">#</a> PageSpeed 简介</h3>\n<p>PageSpeed Insights 的 Chrome 扩展是由谷歌官方开发的一款可以分析页面载入的各个方面，包括资源、网络、DOM 以及时间线等等信息的插件，也提供在线访问方式。</p>\n<h4 id=\"使用google-pagespeed-insights\"><a class=\"anchor\" href=\"#使用google-pagespeed-insights\">#</a> 使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vc3BlZWQvcGFnZXNwZWVkL2luc2lnaHRzLw==\"> Google PageSpeed Insights</span></h4>\n<p>打开 https://developers.google.com/speed/pagespeed/insights/</p>\n<p>输入需要分析的网址即可，这里面需要注意必须在公网可以访问到网址。</p>\n<p><img data-src=\"./assets/image-20190619212956061.png\" alt=\"/images/image-20190619212956061\" /></p>\n<h4 id=\"使用chrome插件mozila插件\"><a class=\"anchor\" href=\"#使用chrome插件mozila插件\">#</a> 使用 Chrome 插件 / Mozila 插件</h4>\n<p><img data-src=\"./assets/image-20190619203556941.png\" alt=\"/images/image-20190619203556941\" /></p>\n<p>下载安装办法：</p>\n<ol>\n<li>\n<p>使用插件 ID: <code>djfpadpbeemogokhllpiakdeadpoclan</code>  到 https://chrome-extension-downloader.com/ 来下载</p>\n<p>打开：<span class=\"exturl\" data-url=\"Y2hyb21lOi8vZXh0ZW5zaW9ucy8=\">chrome://extensions/</span></p>\n<p>把 <code>ctx</code>  文件拖进去</p>\n</li>\n<li>\n<p>如果有梯子，那么直接在商店里面搜索</p>\n</li>\n</ol>\n<p>插件使用：</p>\n<p><img data-src=\"./assets/image-20190619212836235.png\" alt=\"/images/image-20190619212836235\" /></p>\n<h3 id=\"前端项目优化实践-2\"><a class=\"anchor\" href=\"#前端项目优化实践-2\">#</a> 前端项目优化实践</h3>\n<h2 id=\"补充学习\"><a class=\"anchor\" href=\"#补充学习\">#</a> 补充学习</h2>\n<h3 id=\"编码-解码形成dom树的过程\"><a class=\"anchor\" href=\"#编码-解码形成dom树的过程\">#</a> 编码、解码形成 DOM 树的过程</h3>\n<p>浏览器从网络或硬盘中获得 <code>HTML</code>  字节数据后会经过一个流程将字节解析为 <code>DOM</code>  树：</p>\n<ul>\n<li>编码： <strong>先将 HTML 的原始字节数据转换为文件指定编码的字符。</strong></li>\n<li>令牌化： 然后<strong>浏览器会根据 HTML 规范来将字符串转换成各种令牌</strong>（如 <code>&lt;html&gt;</code> 、 <code>&lt;body&gt;</code>  这样的标签以及标签中的字符串和属性等都会被转化为令牌，每个令牌具有特殊含义和一组规则）。令牌记录了标签的开始与结束，通过这个特性可以轻松判断一个标签是否为子标签（假设有 <code>&lt;html&gt;</code>  与 <code>&lt;body&gt;</code>  两个标签，当 <code>&lt;html&gt;</code>  标签的令牌还未遇到它的结束令牌 <code>&lt;/html&gt;</code>  就遇见了 <code>&lt;body&gt;</code>  标签令牌，那么 <code>&lt;body&gt;</code>  就是 <code>&lt;html&gt;</code>  的子标签）。</li>\n<li>生成对象： <strong>接下来每个令牌都会被转换成定义其属性和规则的对象（这个对象就是节点对象）。</strong></li>\n<li>构建完毕： <strong>DOM 树构建完成，整个对象集合就像是一棵树形结构</strong>。可能有人会疑惑为什么 <code>DOM</code>  是一个树形结构，这是因为标签之间含有复杂的父子关系，树形结构正好可以诠释这个关系（ <code>CSSOS</code>  同理，层叠样式也含有父子关系。例如：  <code>div p &#123;font-size: 18px&#125;</code> ，会先寻找所有 <code>p</code>  标签并判断它的父标签是否为 <code>div</code>  之后才会决定要不要采用这个样式进行渲染）。</li>\n</ul>\n<p>整个 <code>DOM</code>  树的构建过程其实就是： <strong>字节 -&gt; 字符 -&gt; 令牌 -&gt; 节点对象 -&gt; 对象模型</strong>，下面将通过一个示例 <code>HTML</code>  代码与配图更形象地解释这个过程。</p>\n<p>如下面的这段 HTML</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width,initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Critical Path<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Hello <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>web performance<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> students!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>awesome-photo.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"./assets/63503acbly1fk2te7tuh0j20nv0dbjtl.jpg\" alt=\"DOM Rendering\" /></p>\n<h3 id=\"优化工作清单\"><a class=\"anchor\" href=\"#优化工作清单\">#</a> 优化工作清单</h3>\n<p>当小伙伴们出现了页面性能问题时，或者在设计我们的应用之前，就可以参考如下的条目进行快速检查。</p>\n<ul>\n<li>页面内容\n<ul>\n<li>减少 HTTP 请求数</li>\n<li>减少 DNS 查询</li>\n<li>避免重定向</li>\n<li>缓存 Ajax 请求</li>\n<li>延迟加载</li>\n<li>预先加载</li>\n<li>减少 DOM 元素数量</li>\n<li>划分内容到不同域名</li>\n<li>尽量减少 iframe 使用</li>\n<li>避免 404 错误</li>\n</ul>\n</li>\n<li>服务器\n<ul>\n<li>使用 CDN</li>\n<li>添加 Expires 或 Cache-Control 响应头</li>\n<li>启用 Gzip</li>\n<li>配置 Etag</li>\n<li>尽早输出缓冲</li>\n<li>Ajax 请求使用 GET 方法</li>\n<li>避免图片 src 为空</li>\n</ul>\n</li>\n<li>Cookie\n<ul>\n<li>减少 Cookie 大小</li>\n<li>静态资源使用无 Cookie 域名</li>\n</ul>\n</li>\n<li>CSS\n<ul>\n<li>把样式表放在  <code>&lt;head&gt;</code>  中</li>\n<li>不要使用 CSS 表达式</li>\n<li>使用  <code>link</code>  替代  <code>@import</code></li>\n<li>不要使用 filter</li>\n</ul>\n</li>\n<li>JavaScript\n<ul>\n<li>把脚本放在页面底部</li>\n<li>使用外部 JavaScript 和 CSS</li>\n<li>压缩 JavaScript 和 CSS</li>\n<li>移除重复脚本</li>\n<li>减少 DOM 操作</li>\n<li>使用高效的事件处理</li>\n</ul>\n</li>\n<li>图片\n<ul>\n<li>优化图片</li>\n<li>优化 CSS Sprite</li>\n<li>不要在 HTML 中缩放图片</li>\n<li>使用体积小、可缓存的 favicon.ico</li>\n</ul>\n</li>\n<li>移动端\n<ul>\n<li>保持单个文件小于 25 KB</li>\n<li>打包内容为分段（multipart）文档</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"优化关键渲染路径\"><a class=\"anchor\" href=\"#优化关键渲染路径\">#</a> 优化关键渲染路径</h3>\n<p>假设有一个 <code>HTML</code>  页面，它只引入了一个 <code>CSS</code>  外部文件：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width,initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Hello <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>web performance<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> students!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>awesome-photo.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>它的关键渲染路径如下：</p>\n<p><img data-src=\"./assets/63503acbly1fk56dzdbn9j20nr068dga.jpg\" alt=\"img\" /></p>\n<p>首先浏览器要先对服务器发送请求获得 <code>HTML</code>  文件，得到 <code>HTML</code>  文件后开始构建 <code>DOM</code>  树，在遇见 <code>&lt;link&gt;</code>  标签时浏览器需要向服务器再次发出请求来获得 <code>CSS</code>  文件，然后则是继续构建 <code>DOM</code>  树和 <code>CSSOM</code>  树，浏览器合并出渲染树，根据渲染树进行布局计算，执行绘制操作，页面渲染完成。</p>\n<p>有以下几个用于描述关键渲染路径性能的词汇：</p>\n<ul>\n<li>关键资源：可能阻塞网页首次渲染的资源（上图中为 2 个， <code>HTML</code>  文件与外部 <code>CSS</code>  文件 <code>style.css</code> ）。</li>\n<li>关键路径长度： 获取关键资源所需的往返次数或总时间（上图为 2 次或以上，一次获取 <code>HTML</code>  文件，一次获取 <code>CSS</code>  文件，这个次数基于 <code>TCP</code>  协议的最大拥塞窗口，一个文件不一定能在一次连接内传输完毕）。</li>\n<li>关键字节：所有关键资源文件大小的总和（上图为 <code>9KB</code> ）。</li>\n</ul>\n<p>接下来，案例代码的需求发生了变化，它新增了一个 <code>JavaScript</code>  文件。</p>\n<pre><code>&lt;html&gt;\n  &lt;head&gt;\n    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;\n    &lt;link href=&quot;style.css&quot; rel=&quot;stylesheet&quot;&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;p&gt;Hello &lt;span&gt;web performance&lt;/span&gt; students!&lt;/p&gt;\n    &lt;div&gt;&lt;img src=&quot;awesome-photo.jpg&quot;&gt;&lt;/div&gt;\n    &lt;script src=&quot;app.js&quot;&gt;&lt;/script&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<p><a href=\"http://wx1.sinaimg.cn/large/63503acbly1fk56e0i20xj20or06ygmi.jpg\"><img data-src=\"http://wx1.sinaimg.cn/large/63503acbly1fk56e0i20xj20or06ygmi.jpg\" alt=\"img\" /></a></p>\n<p><code>JavaScript</code>  文件阻塞了 <code>DOM</code>  树的构建，并且在执行 <code>JavaScript</code>  脚本时还需要先等待构建 <code>CSSOM</code>  树，上图的关键渲染路径特性如下：</p>\n<ul>\n<li>关键资源： 3（ <code>HTML</code> 、 <code>style.css</code> 、 <code>app.js</code> ）</li>\n<li>关键路径长度： 2 或以上（浏览器会在一次连接中一起下载 <code>style.css</code>  和 <code>app.js</code> ）</li>\n<li>关键字节：11KB</li>\n</ul>\n<p>现在，我们要优化关键渲染路径，首先将 <code>&lt;script&gt;</code>  标签添加异步属性 <code>async</code> ，这样浏览器的 <code>HTML</code>  解析器就不会阻塞这个 <code>JavaScript</code>  文件了。</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width,initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Hello <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>web performance<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> students!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>awesome-photo.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app.js<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">async</span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"./assets/63503acbly1fk56e0sokqj20oj074ab1.jpg\" alt=\"img\" /></p>\n<ul>\n<li>关键资源：2（ <code>app.js</code>  为异步加载，不会成为阻塞渲染的资源）</li>\n<li>关键路径长度： 2 或以上</li>\n<li>关键字节： 9KB（ <code>app.js</code>  不再是关键资源，所以没有算上它的大小）</li>\n</ul>\n<p>接下来对 <code>CSS</code>  进行优化，比如添加上媒体查询。</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width,initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>style.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">media</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>print<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Hello <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>web performance<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span> students!<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>awesome-photo.jpg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app.js<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">async</span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><img data-src=\"./assets/63503acbly1fk56e15x4jj20ny082mxu.jpg\" alt=\"img\" /></p>\n<ul>\n<li>关键资源：1（ <code>app.js</code>  为异步加载， <code>style.css</code>  只有在打印时才会使用，所以只剩下 <code>HTML</code>  一个关键资源，也就是说当 <code>DOM</code>  树构建完毕，浏览器就会开始进行渲染）</li>\n<li>关键路径长度：1 或以上</li>\n<li>关键字节：5KB</li>\n</ul>\n<p><strong>优化关键渲染路径就是在对关键资源、关键路径长度和关键字节进行优化</strong>。关键资源越少，浏览器在渲染前的准备工作就越少；同样，关键路径长度和关键字节关系到浏览器下载资源的效率，它们越少，浏览器下载资源的速度就越快。</p>\n<h3 id=\"其他js在线测试网站\"><a class=\"anchor\" href=\"#其他js在线测试网站\">#</a> 其他 JS 在线测试网站\u0010</h3>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qc2JlbmNoLm1lLw==\">jsbench.me</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2pzYmVuLmNoLw==\">jsben.ch</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWFzdXJldGhhdC5uZXQv\">measurethat.net</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93ZWJwYWdldGVzdC5vcmcv\">webpagetest.org</span></li>\n</ul>\n<h3 id=\"参考资料\"><a class=\"anchor\" href=\"#参考资料\">#</a> 参考资料</h3>\n<ol>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbDVyb2Nrcy5jb20vemgvdHV0b3JpYWxzL2ludGVybmFscy9ob3dicm93c2Vyc3dvcmsv\">浏览器的工作原理：新式网络浏览器幕后揭秘</span> <strong>强烈推荐</strong></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vd2ViL2Z1bmRhbWVudGFscy9wZXJmb3JtYW5jZS9jcml0aWNhbC1yZW5kZXJpbmctcGF0aC9yZW5kZXItdHJlZS1jb25zdHJ1Y3Rpb24=\">渲染树构建、布局及绘制</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb3ouY29tL2Jsb2cvaW1wcm92aW5nLXNlYXJjaC1yYW5rLWJ5LW9wdGltaXppbmcteW91ci10aW1lLXRvLWZpcnN0LWJ5dGU=\">优化第一个字节的时间</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3F6Y3N1L2FydGljbGUvZGV0YWlscy83Mjg2MTg5MQ==\">TCP 的三次握手与四次挥手（详解 + 动图）</span>推荐</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tLzIwMTYvMTIvMDIvcGVyZm9ybWFuY2UtdHVubmluZy5odG1s\">常见性能优化策略的总结</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb3ouY29tL2xlYXJuL3Nlby9wYWdlLXNwZWVk\">Page Speed</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzAxMWUwYzUxODgyNTJlYTY2YWZkZmEjaGVhZGluZy02OA==\">web 性能优化篇</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YTk2NmJkMTZmYjlhMDYzNTE3MmE1MGE=\">2018 前端性能优化清单</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzQ2Y2JhZWU1MWQ0NTNmNDU2MTJhMmM=\">（译）2019 年前端性能优化清单 — 上篇</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzQ3MWVhZmYyNjVkYTYxNmQ1NDdjOGM=\">（译）2019 年前端性能优化清单 — 中篇</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzQ3M2NkYWU1MWQ0NTUxOGQ0NzAxZmY=\">（译）2019 年前端性能优化清单 — 下篇</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vc3BlZWQvZG9jcy9pbnNpZ2h0cy9ydWxlcw==\">PageSpeed Insights 规则</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zeWx2YW5hc3N1bi5naXRodWIuaW8vMjAxNy8xMC8wMy8yMDE3LTEwLTAzLUJyb3dzZXJDcml0aWNhbFJlbmRlcmluZ1BhdGgv\">浏览器渲染过程与性能优化</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8yNjhjN2YzZGQ3YTY=\">如何提升 CSS 选择器性能</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaHRtbC5jbi9hcmNoaXZlcy85NTE3\">前端性能优化：2018 年 JavaScript 开销及优化工具和方法</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YTY1NDdkMGYyNjVkYTNlMjgzYTFkZjc=\">从浏览器多进程到 JS 单线程，JS 运行机制最全面的一次梳理</span>推荐</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vZW50cnkvNWFkODZjMTZmMjY1ZGE1MDVhNzdkY2E0\">彻底理解浏览器的缓存机制</span> 推荐 2</li>\n</ol>\n",
            "tags": [
                "前端性能优化",
                "性能优化"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/",
            "url": "https://dmqweb.cn/2024/03/02/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/",
            "title": "自动化测试",
            "date_published": "2024-03-02T02:04:04.000Z",
            "content_html": "<h1 id=\"5-3-自动化测试\"><a class=\"anchor\" href=\"#5-3-自动化测试\">#</a> 5-3 自动化测试</h1>\n<h2 id=\"介绍\"><a class=\"anchor\" href=\"#介绍\">#</a> 介绍</h2>\n<p>在前端界，浏览器兼容性是让工程师们头疼的问题，对于经验丰富的人来说，很清楚浏览器有哪些坑，但是对于大部分程序员，最可怕的是代码明明在这个浏览器运行得很好，但是到了另一个浏览器中就不能正常运行了。对于这部分的程序员，保障代码能正常运行的方法便是能尽早发现问题，然后将其解决。</p>\n<p><strong>前端项目如何做测试？</strong></p>\n<ul>\n<li>测试同学：功能测试，性能测试，测试用例</li>\n<li>前端同学：单元测试，常用于组件库、AP 等 (Jest、Mocha), 上线项目如何做测试？</li>\n</ul>\n<p><strong>上线项目如何进行测试</strong></p>\n<ul>\n<li>利用前端监控，进行监控项目稳定性和性能，并上报前端日志</li>\n<li>稳定性：如 ljserror、白屏检测等</li>\n<li>性能：如秒开率、首屏渲染时长、接请求时长等</li>\n<li>前端日志：如 console.log、API 请求记录等</li>\n</ul>\n<p><strong>为什么需要自动化测试？</strong></p>\n<p>项目经过不断的开发，最终肯定会趋于稳定，在<strong>适当的时机下</strong>引入自动化测试能及早发现问题，<strong>保证产品的质量</strong>。</p>\n<p>测试作为完整的开发流程中最后的一环，是保证产品质量重要的一环。而前端测试一般在产品开发流程中属于偏后的环节，在整个开发架构中属于较高层次，前端测试更加偏向于 GUI 的特性，因此前端的测试难度很大。</p>\n<p>测试的目的：</p>\n<ul>\n<li>有利于写出高质量的代码，尽早发现问题</li>\n<li>有利于代码的扩展</li>\n<li>有利于代码的维护</li>\n</ul>\n<p><strong>本课程的学习路径：</strong></p>\n<ul>\n<li>学习基础的概念，清晰测试不同的应用场景</li>\n<li>学习不同的前端测试工具，了解如何进行选择</li>\n<li>在项目中进行实践</li>\n</ul>\n<p><strong>本课程的主要内容：</strong></p>\n<ul>\n<li>介绍测试框架的分类</li>\n<li>单元测试工具介绍：Mocha，Jest，AVA，Karma</li>\n<li>E2E 测试工具介绍：Nightmare</li>\n</ul>\n<p><strong>本课程的学习准备：</strong></p>\n<ul>\n<li>IDE vscode，node  LTS</li>\n<li>包管理工具：yarn, cnpm</li>\n</ul>\n<h2 id=\"前端自动化测试\"><a class=\"anchor\" href=\"#前端自动化测试\">#</a> 前端自动化测试</h2>\n<p>测试是一个庞大的主题，包括各种分类的测试，诸如黑盒测试 / 白盒测试、单元测试 / 集成测试 / 端到端测试等。通常程序员在测试自己的代码的时候用得最多的便是单元测试，但是因为测试也是需要代价，很多人是不喜欢写测试的，甚至是一点都不写。</p>\n<p>那么是什么原因让大家不愿意写呢？</p>\n<ol>\n<li>不熟悉</li>\n<li>浪费时间</li>\n<li>知识不成体系</li>\n<li>团队氛围</li>\n<li>缺少实践</li>\n</ol>\n<p>我们要从基础的东西学起，打消对测试的恐惧。</p>\n<h3 id=\"测试的分类\"><a class=\"anchor\" href=\"#测试的分类\">#</a> 测试的分类</h3>\n<p>在多浏览器的自动化测试，我们多半是进行端到端的测试工作，一小部分是大粒度的单元测试。端到端测试测试模拟用户的行为。在 Web 应用程序中，他们会启动服务器，打开浏览器，模拟用户的行为进行点击、输入、提交等动作，断言浏览器中发生了特定的事情或者是得到了期待的结果，从而让我们相信功能可以正常的运行。</p>\n<p>而单元测试根据代码单元的公共 API 运行它们。这些测试需要创建一个类的实例，使用特定的输入调用它的方法，断言被调用的方法达到了预期的效果。在下文中我们会看到这两种测试的实践，当然有时候区分度并不大，可能无法明显地区分哪些是端对端测试哪些是单元测试，有时候他们是混合起来的，不过只要记住我们的目标是保证功能可以正常运行救足够了。</p>\n<p>按照软件工程自底而上的概念，前端测试一般分为单元测试（Unit Testing ）、集成测试（Integration Testing）和端到端测试（E2E Testing）。从下面的图可以看出，从底向上测试的复杂度将不断提高，另一方面测试的收益反而不断降低的。</p>\n<p><img data-src=\"assets/16415de723a8d411.png\" alt=\"img\" /></p>\n<blockquote>\n<p>关于软件测试分类，可见<a href=\"#%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E7%9A%84%E5%88%86%E7%B1%BB\">软件测试的分类</a></p>\n</blockquote>\n<h3 id=\"测试工具对比\"><a class=\"anchor\" href=\"#测试工具对比\">#</a> 测试工具对比</h3>\n<p>在进行项目实践前，很重要的一项工作是选择合适的技术栈。好比在前端开发时应该选择 React，Vue 还是 Angular 作为框架一样，前端的测试工作也需要选择一套技术栈。很多时候大家在制定技术栈时容易走偏，在选择技术框架时不是选择最合适的框架，而是选择最热门的框架。当然一定程度上热门的框架能反应其受欢迎程度，可能是因为其出众的优点，如较高的开发效率、高效的渲染特性或者是活跃的社区。在前端开发中，很容易有这样的感受，就是只要半个月没有关注业界的最新动态，就感觉恍若隔世，新的解决方案层出不穷，让人喘不过气。</p>\n<p>经过几年的前端洗礼之后，就已经过了慌乱的年纪，再也不会盲目地追寻新技术，而转向关注技术背后解决的痛点，原理等。</p>\n<p><img data-src=\"assets/v2-af09ebe8167f63a49ea49287fe04526f_hd-20190706122102737.jpg\" alt=\"img\" /></p>\n<h4 id=\"如何选择测试框架\"><a class=\"anchor\" href=\"#如何选择测试框架\">#</a> 如何选择测试框架</h4>\n<p>测试框架基本上都做了一件事儿：</p>\n<ul>\n<li>描述你要测试的东西</li>\n<li>对其进行测试</li>\n<li>判断是否符合预期</li>\n</ul>\n<p>选择框架会考虑下面的点：</p>\n<ul>\n<li>\n<p>测试框架是否有简明的语法与文档。</p>\n<p>Mocha、Jasmine、Jest、AVA、Karma、Nightmare</p>\n</li>\n<li>\n<p>断言 (Assertions)：用于判断结果是否符合预期。有些框架需要单独的断言库。</p>\n<p>Should.js、chai、expect.js 等等，断言库提供了很多语义化的方法来对值做各种各样的判断。当然也可以不用断言库，Node.js 中也可以直接使用原生 assert 库。</p>\n</li>\n<li>\n<p>适合 TDD / BDD：是否适合 测试驱动型 / 行为驱动型 的测试风格。</p>\n<blockquote>\n<p>BDD (Bebavior Driven Developement，行为驱动测试) 和 TDD (Testing Driven Developement，测试驱动开发)</p>\n</blockquote>\n<p>BDD 和 TDD 均有各自的适用场景，BDD 一般更偏向于系统功能和业务逻辑的自动化测试设计，而 TDD 在快速开发并测试功能模块的过程中则更加高效，以快速完成开发为目的。下面我们看下 BDD 和 TDD 具体的特点：</p>\n<p>BDD 的特点：</p>\n<ul>\n<li>从业务逻辑的角度定义具体的输入与预期输出，以及可衡量的目标；</li>\n<li>尽可能覆盖所有的测试用例情况；</li>\n<li>描述一系列可执行的行为，根据业务的分析来定义预期输出。例如，expect, should, assert；</li>\n<li>设定关键的测试通过节点输出提示，便于测试人员理解；</li>\n<li>最大程度的交付出符合用户期望的产品，避免输出不一致带来的问题。</li>\n</ul>\n<p>TDD 的特点：</p>\n<ul>\n<li>需求分析，快速编写对应的输入输出测试脚本；</li>\n<li><strong>仅在自动测试失败时才编写新代码</strong>。</li>\n<li>重构去除不必要的依赖关系，然后重复测试，最终让程序符合所有要求。</li>\n</ul>\n</li>\n<li>\n<p>异步测试：有些框架对异步测试支持良好。</p>\n</li>\n<li>\n<p>使用的语言：大部分 js 测试框架使用 js。</p>\n</li>\n<li>\n<p>用于特定目的：每个框架可能会擅长处理不同的问题。</p>\n<p>是要测试单个功能、单个组件、还是集成化测试？</p>\n<p>是要测试 GUI 逻辑、交互？</p>\n<p>是要测试非功能性指标？兼容性？</p>\n</li>\n<li>\n<p>社区是否活跃。</p>\n</li>\n</ul>\n<h4 id=\"测试工具的类型\"><a class=\"anchor\" href=\"#测试工具的类型\">#</a> 测试工具的类型</h4>\n<p>测试工具可分为以下功能。有些只为我们提供了一种功能，有些功能为我们提供了一种组合。</p>\n<p>为了实现最灵活的集合功能，通常使用多种工具的组合。</p>\n<ul>\n<li>\n<p>提供 UI 界面或者 CLI 工具：（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLw==\">Karma</span>，<span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\">Jasmine</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=\">TestCafe</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=\">Cypress</span>）</p>\n<p><strong>CLI 工具</strong>会给出一系列测试，以及运行这些测试所需的各种配置和脚手架（运行什么浏览器，使用什么 babel 插件，如何格式化输出等）</p>\n</li>\n<li>\n<p>提供测试框架（形成文件目录）：(<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2NoYWpzLm9yZy8=\">Mocha</span>, <span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\">Jasmine</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2N1Y3VtYmVyL2N1Y3VtYmVyLWpz\">Cucumber</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=\">TestCafe</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=\">Cypress</span>)</p>\n</li>\n<li>\n<p>提供断言：（<span class=\"exturl\" data-url=\"aHR0cDovL2NoYWlqcy5jb20v\">Chai</span>，<span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\">Jasmine</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>，<span class=\"exturl\" data-url=\"aHR0cDovL3VuZXhwZWN0ZWQuanMub3JnLw==\">Unexpected</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=\">TestCafe</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=\">Cypress</span>）</p>\n<p><strong>断言函数</strong>检查测试返回的结果是否符合预期</p>\n</li>\n<li>\n<p>生成，展示测试结果（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2NoYWpzLm9yZy8=\">Mocha</span>，<span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\">Jasmine</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLw==\">Karma</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=\">TestCafe</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=\">Cypress</span>）</p>\n</li>\n<li>\n<p>快照测试（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YQ==\">Ava</span>）</p>\n<p>快照测试 (snapshot testing)，测试 UI 或数据结构是否和之前完全一致，通常 UI 测试不在单元测试中</p>\n</li>\n<li>\n<p>提供仿真（<span class=\"exturl\" data-url=\"aHR0cDovL3Npbm9uanMub3JnLw==\">Sinon</span>，<span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\">Jasmine</span>，<span class=\"exturl\" data-url=\"aHR0cDovL2FpcmJuYi5pby9lbnp5bWUvZG9jcy9hcGkv\">enzyme</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly90ZXN0ZG91YmxlLmNvbS8=\">testdouble</span>）</p>\n<p>仿真 (mocks, spies, and stubs)：获取方法的调用信息，模拟方法，模块，甚至服务器</p>\n</li>\n<li>\n<p>生成测试覆盖率报告 (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9nb3R3YXJsb3N0LmdpdGh1Yi5pby9pc3RhbmJ1bC8=\">Istanbul</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9mYWNlYm9vay5naXRodWIuaW8vamVzdC8=\">Jest</span>, <span class=\"exturl\" data-url=\"aHR0cDovL2JsYW5rZXRqcy5vcmcv\">Blanket</span>)</p>\n</li>\n<li>\n<p>提供类浏览器环境 (<span class=\"exturl\" data-url=\"aHR0cDovL25pZ2h0d2F0Y2hqcy5vcmcv\">Nightwatch</span>, <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5uaWdodG1hcmVqcy5vcmcv\">Nightmare</span>, <span class=\"exturl\" data-url=\"aHR0cDovL3BoYW50b21qcy5vcmcv\">Phantom</span><strong>,</strong> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dvb2dsZUNocm9tZS9wdXBwZXRlZXI=\">Puppeteer</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0RldkV4cHJlc3MvdGVzdGNhZmU=\">TestCafe</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3lwcmVzcy5pby8=\">Cypress</span>)</p>\n</li>\n<li>\n<p>可视化回归工具 (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcHBsaXRvb2xzLmNvbS8=\">Applitools</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wZXJjeS5pby8=\">Percy</span>, <span class=\"exturl\" data-url=\"aHR0cDovL2JiYy1uZXdzLmdpdGh1Yi5pby93cmFpdGgv\">Wraith</span>, <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3dlYmRyaXZlcmlvLWJvbmV5YXJkL3dlYmRyaXZlcmNzcw==\">WebdriverCSS</span>)</p>\n</li>\n</ul>\n<h4 id=\"单元测试类工具\"><a class=\"anchor\" href=\"#单元测试类工具\">#</a> 单元测试类工具</h4>\n<p>npm trends: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtdHJlbmRzLmNvbS9tb2NoYS12cy1qZXN0LXZzLWF2YS12cy1qYXNtaW5lLWNvcmU=\">点击链接</span></p>\n<p><img data-src=\"assets/image-20190706101634263.png\" alt=\"/images/image-20190706101634263\" /></p>\n<p><strong>Karma</strong></p>\n<p>Karma 是一个 Runner（即运行环境），具体详细的介绍见 <a href=\"#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83&amp;%E5%B8%AE%E6%89%8BKarma\">后面的章节 Karma</a></p>\n<blockquote>\n<p>A test runner is the library or tool that picks up an assembly (or a source code directory) that contains unit tests, and a bunch of settings, and then executes them and writes the test results to the console or log files.<br />\nthere are many runners for different languages. See Nunit and MSTest for C#, or Junit for Java.</p>\n</blockquote>\n<p>karma 设计目标主要有下面四点：</p>\n<blockquote>\n<p>高效<br />\n扩展性<br />\n运行在真实设备<br />\n无缝的使用流程</p>\n</blockquote>\n<p>karma 是一个典型的 C/S 程序，包含 client 和 server ，通讯方式基于 Http ，通常情况下，客户端和服务端基本都运行在开发者本地机器上。</p>\n<p>一个服务端实例对应一个项目，假如想同时运行多个项目，得同时开启多个服务端实例。</p>\n<p>Karma 的<strong>优点</strong>是能通过插件和配置的方式集成大部分的主流的测试框架和前端库，能方便的一次在多浏览器环境执行测试用例，并集成了测试覆盖率生成功能，生成页面形式覆盖率报告并能导出不同形式的覆盖率报告数据。</p>\n<p>它的<strong>缺点</strong>是，对测试页面环境的搭建和资源文件的加载不是常见的形式，最开始搭建环境时会有很多跟预期不一致的情况，配置不直观。</p>\n<p><strong>Jasmine</strong></p>\n<p>Jasmine 带有 assertions (断言)，spies (用来模拟函数的执行环境) 和 mocks (mock 工具)，Jasmine 初始化设置简单，同时，如果你需要一些单元功能的时候你仍然可以加一些库进来。</p>\n<p><strong>Mocha</strong></p>\n<p>Mocha 是一个灵活的库，提供给开发者的只有一个基础测试结构。然后，其它功能性的功能如 assertions， spies 和 mocks，这些功能<strong>需要引用添加其它库</strong> / 插件来完成。</p>\n<p><strong>Jest</strong></p>\n<p>被 Facebook 和各种 React 应用推荐和使用，Jest 得到了很好的支持。Jest 也被发现是一个非常快速的测试库在平行测试报告中。</p>\n<p>对于小型项目来说你可能在开始的时候不用过多担心，而性能的提高，对于希望全天持续部署的大型应用 app 来说是非常之好的。</p>\n<p>而开发人员主要是用 Jest 去测试 React 应用，Jest 可以很容易地集成到其它应用程序中充许你使用更独特的特性在其它地方</p>\n<p>快照测试是一个非常好用的工具，去确保你的应用 UI 不会有超出预期的错误，在产品发布替换的期间发生。虽然大部分功能，专门设计都是使用在 React 上。</p>\n<p>Jest 有着很广阔的 API 。</p>\n<p><strong>AVA</strong></p>\n<p>AVA 它的优势是 JavaScript 的异步特性和并发运行测试.</p>\n<p>利用了 JavaScript 的异步特性优势，优化了在部署的时间等待</p>\n<p>保留了简单的 API 为你提供你所需要的功能。</p>\n<p>如果搭配 mocking 来使用它会显得更加友好，但是必须安装一个单独的库。</p>\n<h4 id=\"e2e测试类工具\"><a class=\"anchor\" href=\"#e2e测试类工具\">#</a> E2E 测试类工具</h4>\n<p>npm trends: <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubnBtdHJlbmRzLmNvbS9jeXByZXNzLXZzLW5pZ2h0bWFyZS12cy1uaWdodHdhdGNoLXZzLXRlc3RjYWZlLXZzLXdlYmRyaXZlcmlv\">点击链接</span></p>\n<p><img data-src=\"assets/image-20190706100636750.png\" alt=\"/images/image-20190706100636750\" /></p>\n<h3 id=\"最佳实践\"><a class=\"anchor\" href=\"#最佳实践\">#</a> 最佳实践</h3>\n<p>测试有很多好处，但不代表一上来就要写出 100% 场景覆盖的测试用例。</p>\n<p><strong>最佳的实践：基于投入产出比来做测试</strong></p>\n<p>由于维护测试用例也是一大笔开销（毕竟没有多少测试会专门帮前端写业务测试用例，而前端使用的流程自动化工具更是没有测试参与了）。</p>\n<p>对于像基础组件、基础模型之类的不常变更且复用较多的部分，可以考虑去写测试用例来保证质量。个</p>\n<p>先写少量的测试用例覆盖到 80%+ 的场景，保证覆盖主要使用流程。</p>\n<p>一些极端场景出现的 bug 可以在迭代中形成测试用例沉淀，场景覆盖也将逐渐趋近 100%。</p>\n<p>但对于迭代较快的业务逻辑以及生存时间不长的活动页面之类的就别花时间写测试用例了，维护测试用例的时间大了去了，成本太高。</p>\n<p>大型项目，可以使用 Jest 快速形成配置并且开始单元测试。</p>\n<p>需要测试快照，则可以选择 Jest 或者 Ava。</p>\n<p>对于配置性要求高，对测试框架性能有要求的可以选择 mocha。</p>\n<p>对模拟还原浏览器业务操作有很大的需求的，可以选择 nightmare</p>\n<p>配合 CI 工具完成自动化测试、测试覆盖率、测试结果推送。</p>\n<h2 id=\"喜欢简单选择mocha\"><a class=\"anchor\" href=\"#喜欢简单选择mocha\">#</a> 喜欢简单，选择 Mocha</h2>\n<p><a href=\"https://mochajs.org/\"> <code>Mocha</code> </a>（发音 &quot;摩卡&quot;）诞生于 2011 年，是现在最流行的 JavaScript 测试框架之一，在浏览器和 Node 环境都可以使用。所谓 &quot;测试框架&quot;，就是运行测试的工具。通过它，可以为 JavaScript 应用添加测试，从而保证代码的质量。</p>\n<h3 id=\"安装\"><a class=\"anchor\" href=\"#安装\">#</a> 安装</h3>\n<p>全局安装 Mocha</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-g</span> mocha</pre></td></tr></table></figure><p>项目中也安装 Mocha</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev mocha</pre></td></tr></table></figure><p>在 package.json 中加入下面脚本：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token string\">\"scripts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">\"test\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"mocha\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Chai 是一个针对 Node.js 和浏览器的行为驱动测试和测试驱动测试的<strong>断言库</strong>，可与任何 JavaScript 测试框架集成。它是 Mocha 的好帮手～～</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev chai</pre></td></tr></table></figure><p>在 package.json 中加入下面脚本：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"关于断言\"><a class=\"anchor\" href=\"#关于断言\">#</a> 关于断言</h3>\n<p><code>expect</code>  断言的优点是很接近自然语言，下面是一些例子。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 相等或不相等</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">+</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span> <span class=\"token operator\">+</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>deep<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">bar</span><span class=\"token operator\">:</span> <span class=\"token string\">'baz'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 布尔值为 true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'everthing'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// typeof</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">a</span><span class=\"token punctuation\">(</span><span class=\"token string\">'string'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token string\">'bar'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">an</span><span class=\"token punctuation\">(</span><span class=\"token string\">'object'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>an<span class=\"token punctuation\">.</span><span class=\"token function\">instanceof</span><span class=\"token punctuation\">(</span>Foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// include</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">include</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foobar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">contain</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">foo</span><span class=\"token operator\">:</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">hello</span><span class=\"token operator\">:</span> <span class=\"token string\">'universe'</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>include<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// empty</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>empty<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>empty<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>empty<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">// match</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foobar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^foo</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>两种使用方式：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// commonjs</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> expect <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>expect</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// es6</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> expect <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'chai'</span></pre></td></tr></table></figure><h3 id=\"测试案例\"><a class=\"anchor\" href=\"#测试案例\">#</a> 测试案例</h3>\n<p>其中 index.js 为我们的被测试代码：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 加法函数</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @param &#123;第一个数&#125; a </pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @param &#123;第二个数&#125; b </pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span>b</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> a<span class=\"token operator\">+</span>b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports<span class=\"token operator\">=</span>addNum<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>新建测试脚本 <code>test/demo.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> expect <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>expect<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> addNum <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../src/index'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试index.js'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试addNum函数'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两数相加结果为两个数字的和'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">// 以上语法为 chai 的 expect 语法，它还有 should 语法和 asset 语法。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 等价的意思</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">var</span> addNum<span class=\"token operator\">=</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../src/index'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试index.js'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试addNum函数'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两数相加结果为两个数字的和'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>       <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!==</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"两数相加结果不为两个数字的和\"</span><span class=\"token punctuation\">)</span>；</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>       <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"mocha测试命令\"><a class=\"anchor\" href=\"#mocha测试命令\">#</a> Mocha 测试命令</h3>\n<p>如果想测试单一的测试 js，可以用：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mocha test/index.test.js</pre></td></tr></table></figure><p>或者多个 js</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mocha test/index.test.js test/add.test.js</pre></td></tr></table></figure><p>当然也可以用通配符测试某个文件夹下所有的 js 和 jsx：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># node 通配符</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>mocha <span class=\"token string\">'test/some/*.@(js|jsx)'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># shell 通配符</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>mocha test/unit/*.js</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>mocha spec/<span class=\"token punctuation\">&#123;</span>my,awesome<span class=\"token punctuation\">&#125;</span>.js</pre></td></tr></table></figure><h3 id=\"es6语法支持\"><a class=\"anchor\" href=\"#es6语法支持\">#</a> ES6 语法支持</h3>\n<p>在上面我们用的并非是 ES6 的语法，那么让我们把其中的代码都改为 ES6 的语法。<br />\n其中 index.js 为：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> * 加法函数</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> * @param &#123;第一个数&#125; a </pre></td></tr><tr><td data-num=\"4\"></td><td><pre> * @param &#123;第二个数&#125; b </pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  addNum</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>而 index.test.js 为：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> expect <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'chai'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> addNum <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../src/index'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试index.js'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试addNum函数'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两个参数相加结果为两个数字的和'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两个参数相加结果不为和以外的数'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>此时直接运行 mocha 肯定是不行的，我们现需要安装一下 babel：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev @babel/cli @babel/core @babel/node @babel/register @babel/preset-env chai mocha nodemon</pre></td></tr></table></figure><p>然后，在项目目录下面，新建一个.babelrc 文件：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@babel/preset-env\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>接着讲 package.json 中的脚本改为：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha --require @babel/register\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>命令变得更加简单了</p>\n<h3 id=\"更多用法\"><a class=\"anchor\" href=\"#更多用法\">#</a> 更多用法</h3>\n<h4 id=\"超时\"><a class=\"anchor\" href=\"#超时\">#</a> 超时</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>--timeout, -t, <span class=\"token parameter variable\">--timeouts</span>  Specify <span class=\"token builtin class-name\">test</span> <span class=\"token function\">timeout</span> threshold <span class=\"token punctuation\">(</span>in milliseconds<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>                                                        <span class=\"token punctuation\">[</span>number<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>default: <span class=\"token number\">2000</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>官方默认的超时是 2000 毫秒，即 2s。</p>\n<p>有三种方式来修改超时：</p>\n<p><code>--no-timeout</code>  参数或者 <code>debug</code>  模式中，全局禁用了超时；</p>\n<p><code>--timeout</code>  后面接时间（毫秒），全局修改了本次执行测试用例的超时时间；</p>\n<p>在测试用例里面，使用 <code>this.timeout</code>  方法：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should take less than 500ms'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>在<a href=\"#%E9%92%A9%E5%AD%90%E6%96%B9%E6%B3%95%EF%BC%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0%EF%BC%89\">钩子方法</a>里面使用：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a suite of tests'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// A very long environment setup.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">,</span> <span class=\"token number\">2500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><blockquote>\n<p>同样，可以使用 ``this.timeout (0) <code> </code> 去禁用超时。</p>\n</blockquote>\n<h4 id=\"钩子方法生命周期函数\"><a class=\"anchor\" href=\"#钩子方法生命周期函数\">#</a> 钩子方法（生命周期函数）</h4>\n<p>Mocha 在 describe 块之中，提供测试用例的四个钩子：before ()、after ()、beforeEach () 和 afterEach ()。它们会在指定时间执行。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试index.js'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token function\">before</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"在本区块的所有测试用例之前执行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token function\">after</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"在本区块的所有测试用例之后执行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"在本区块的每个测试用例之前执行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span>console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"在本区块的每个测试用例之后执行\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试addNum函数'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'两数相加结果为两个数字的和'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      assert<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token function\">addNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"异步测试\"><a class=\"anchor\" href=\"#异步测试\">#</a> 异步测试</h4>\n<p>Mocha 本身是支持异步测试的。只需要为 <code>describe</code>  回调函数添加一个 <code>done</code>  参数， 成功时调用 <code>done()</code> ，失败时调用 <code>done(err)</code> 。例如：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> expect <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'chai'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>expect<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'db'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#get'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        db<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> foo</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token function\">done</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>foo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><ul>\n<li>如果未调用 <code>done</code>  函数，Mocha 会一直等待直到超时。</li>\n<li>如果未添加 <code>done</code>  参数，Mocha 会直接返回成功，不会捕获到异步的断言失败。例如：</li>\n</ul>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#get'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>运行上述测试<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2NoYWpzLm9yZy8=\"> Mocha</span> 总会提示 Passing。</p>\n<blockquote>\n<p>Mocha 怎么知道是否要等待异步断言呢？因为 JavaScript 中的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRnVuY3Rpb24=\"> Function</span> 有一个 <code>length</code>  属性， 通过它可以获得该函数的形参个数。Mocha 通过传入回调的 <code>length</code>  来判断是否需要等待。</p>\n</blockquote>\n<p>或者， <code>done()</code>  您可以返回<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvUHJvbWlzZQ==\"> Promise</span>，而不是使用回调。如果您正在测试的 API 返回 promises 而不是回调，可以这样进行使用：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">return</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">return</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>tobi<span class=\"token punctuation\">,</span> loki<span class=\"token punctuation\">,</span> jane<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#find()'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'respond with matching records'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">return</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'User'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>should<span class=\"token punctuation\">.</span>eventually<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>同样，可以使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4vZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvU3RhdGVtZW50cy9hc3luY19mdW5jdGlvbg==\"> async /await</span>，您还可以编写如下的异步测试：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">await</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">await</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>tobi<span class=\"token punctuation\">,</span> loki<span class=\"token punctuation\">,</span> jane<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#find()'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'responds with matching records'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">const</span> users <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'User'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    users<span class=\"token punctuation\">.</span>should<span class=\"token punctuation\">.</span>have<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><blockquote>\n<p>需要 Babel 支持～～～</p>\n</blockquote>\n<h3 id=\"示例项目\"><a class=\"anchor\" href=\"#示例项目\">#</a> 示例项目</h3>\n<h4 id=\"创建项目安装依赖\"><a class=\"anchor\" href=\"#创建项目安装依赖\">#</a> 创建项目 &amp; 安装依赖</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// 初始化一个nodejs项目</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">npm</span> init <span class=\"token parameter variable\">-y</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>// 安装依赖</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev @babel/cli @babel/core @babel/node @babel/register @babel/preset-env chai mocha nodemon</pre></td></tr></table></figure><p>形成 package.json</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"projects\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.js\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token property\">\"keywords\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token property\">\"author\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ISC\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token property\">\"@babel/cli\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.5.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token property\">\"@babel/core\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.5.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token property\">\"@babel/node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.5.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token property\">\"@babel/preset-env\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.5.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token property\">\"@babel/register\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.4.4\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token property\">\"chai\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.2.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token property\">\"mocha\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^6.1.4\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token property\">\"nodemon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.19.1\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"测试过程\"><a class=\"anchor\" href=\"#测试过程\">#</a> 测试过程</h4>\n<p>新建一个待测试的方法 <code>./src/index.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sayHello</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token string\">\"Hello world!!!\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// ES6 语法</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> sayHello</pre></td></tr></table></figure><p>测试脚本 <code>./test/index.spec.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> expect <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"chai\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> sayHello <span class=\"token keyword\">from</span> <span class=\"token string\">\"../src/index\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index test\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sayHello function\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should say Hello guys!\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token keyword\">const</span> str <span class=\"token operator\">=</span> <span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello guys!\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><code>package.json</code>  中的脚本：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// \"start\": \"nodemon ./src/index.js\",  // 针对 ES5 语法</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"start:babel\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nodemon --exec babel-node ./src/index.js\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"test:watch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha --require @babel/register --watch\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha --require @babel/register\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"babel src --out-dir ./dist --source-maps\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"serve\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node ./dist/index.js\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token property\">\"debug\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node --inspect-brk ./dist/index.js\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>开始测试： <code>npm run test</code></p>\n<p>报错了，因为期望的值与实际值不一致。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Hello world<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  index <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    sayHello <span class=\"token keyword\">function</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> should say Hello guys<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token number\">0</span> passing <span class=\"token punctuation\">(</span>9ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token number\">1</span> failing</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> index <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>       sayHello <span class=\"token keyword\">function</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>         should say Hello guys<span class=\"token operator\">!</span>:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      AssertionError: expected <span class=\"token string\">'Hello world!!!'</span> to equal <span class=\"token string\">'Hello guys!'</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      + expected - actual</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token parameter variable\">-Hello</span> world<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      +Hello guys<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      at Context.equal <span class=\"token punctuation\">(</span>test/index.spec.js:9:22<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>修改测试脚本，或者修改 index.js 文件：</p>\n<p>修改 <code>./test/index.spec.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> expect <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"chai\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> sayHello <span class=\"token keyword\">from</span> <span class=\"token string\">\"../src/index\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"index test\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sayHello function\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should say Hello world!!!\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token keyword\">const</span> str <span class=\"token operator\">=</span> <span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello world!!!\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>再次测试：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">></span> mocha <span class=\"token parameter variable\">--require</span> @babel/register</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Hello world<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  index <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    sayHello <span class=\"token keyword\">function</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      ✓ should say Hello world<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token number\">1</span> passing <span class=\"token punctuation\">(</span>6ms<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>使用 <code>mochawesome</code>  展示你的测试结果：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev mochawesome</pre></td></tr></table></figure><p>然后在 <code>package.json</code>  的 <code>scripts</code>  中添加如下内容，</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token property\">\"report\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha --require @babel/register --reporter mochawesome\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>使用方式：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> run report</pre></td></tr></table></figure><p>形成出来的报告在浏览器中打开：</p>\n<p><img data-src=\"assets/image-20190707212821248.png\" alt=\"/images/image-20190707212821248\" /></p>\n<p>在 Vscode 中可以安装 Live Server 这个插件快速打开：</p>\n<p><img data-src=\"assets/image-20190707212923919.png\" alt=\"/images/image-20190707212923919\" /></p>\n<h2 id=\"开箱即用jest\"><a class=\"anchor\" href=\"#开箱即用jest\">#</a> 开箱即用 Jest</h2>\n<p>Jest 是由 Facebook 发布的开源的、基于<span class=\"exturl\" data-url=\"aHR0cDovL2phc21pbmUuZ2l0aHViLmlvLw==\"> Jasmine</span> 的 JavaScript 单元测试框架。Jest 源于 Facebook 的构想，用于快速、可靠地测试 Web 聊天应用。它吸引了公司内部的兴趣，Facebook 的一名软件工程师 Jeff Morrison 半年前又重拾这个项目，改善它的性能，并将其开源。Jest 的目标是减少开始测试一个项目所要花费的时间和认知负荷，因此它提供了大部分你需要的现成工具：快速的命令行接口、Mock 工具集以及它的自动模块 Mock 系统。此外，如果你在寻找隔离工具例如 Mock 库，大部分其它工具将让你在测试中（甚至经常在你的主代码中）写一些不尽如人意的样板代码，以使其生效。Jest 与 Jasmine 框架的区别是在后者之上增加了一些层。最值得注意的是，运行测试时，Jest 会自动模拟依赖。Jest 自动为每个依赖的模块生成 Mock，并默认提供这些 Mock，这样就可以很容易地隔离模块的依赖。</p>\n<p>Jest 支持 Babel，我们将很轻松的使用 ES6 的高级语法</p>\n<p>Jest 支持 webpack，非常方便的使用它来管理我们的项目</p>\n<p>Jest 支持 TypeScript，书写测试用例更加严谨</p>\n<ol>\n<li>\n<p>简化 API</p>\n<p>Jest 既简单又强大，内置支持以下功能：</p>\n<ul>\n<li>灵活的配置：比如，可以用文件名通配符来检测测试文件。</li>\n<li>测试的事前步骤 (Setup) 和事后步骤 (Teardown)，同时也包括测试范围。</li>\n<li>匹配表达式 (Matchers)：能使用期望 <code>expect</code>  句法来验证不同的内容。</li>\n<li>测试异步代码：支持承诺 (promise) 数据类型和异步等待 <code>async</code>  /  <code>await</code>  功能。</li>\n<li>模拟函数：可以修改或监查某个函数的行为。</li>\n<li>手动模拟：测试代码时可以忽略模块的依存关系。</li>\n<li>虚拟计时：帮助控制时间推移。</li>\n</ul>\n</li>\n<li>\n<p>性能与隔离</p>\n<p>Jest 文档里写道：</p>\n<p>Jest 能运用所有的工作部分，并列运行测试，使性能最大化。终端上的信息经过缓冲，最后与测试结果一起打印出来。沙盒中生成的测试文件，以及自动全局状态在每个测试里都会得到重置，这样就不会出现两个测试冲突的情况。</p>\n<p>Mocha 用一个进程运行所有的测试，和它比较起来，Jest 则完全不同。要在测试之间模拟出隔离效果，我们必须要引入几个测试辅助函数来妥善管理清除工作。这种做法虽然不怎么理想，但 99% 的情况都可以用，因为测试是按顺序进行的。</p>\n</li>\n<li>\n<p>沉浸式监控模式</p>\n<p>快速互动式监控模式可以监控到哪些测试文件有过改动，只运行与改动过的文件相关的测试，并且由于优化作用，能迅速放出监控信号。设置起来非常简单，而且还有一些别的选项，可以用文件名或测试名来过滤测试。我们用 Mocha 时也有监控模式，不过没有那么强大，要运行某个特定的测试文件夹或文件，就不得不自己创造解决方法，而这些功能 Jest 本身就已经提供了，不用花力气。</p>\n</li>\n<li>\n<p>代码覆盖率 &amp; 测试报告</p>\n<p>Jest 内置有代码覆盖率报告功能，设置起来易如反掌。可以在整个项目范围里收集代码覆盖率信息，包括未经受测试的文件。</p>\n<p>要使完善 Circle CI 整合，只需要一个自定义报告功能。有了 Jest，用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21pY2hhZWxsZWVhbGxlbi9qZXN0LWp1bml0LXJlcG9ydGVy\"> jest-junit-reporter</span> 就可以做到，其用法和 Mocha 几乎相同。</p>\n</li>\n<li>\n<p>快照功能</p>\n<p>快照测试的目的不是要替换现有的单元测试，而是要使之更有价值，让测试更轻松。在某些情况下，某些功能比如 React 组件功能，有了快照测试意味着无需再做单元测试，但同样这两者不是非此即彼。</p>\n</li>\n</ol>\n<h3 id=\"安装-2\"><a class=\"anchor\" href=\"#安装-2\">#</a> 安装</h3>\n<p>新建文件夹然后通过 npm 命令安装：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev jest</pre></td></tr></table></figure><p>或者通过 yarn 来安装：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> <span class=\"token parameter variable\">--dev</span> jest</pre></td></tr></table></figure><p>然后就可以开始测试了</p>\n<p>也可用 <code>npm install -g jest</code>  进行全局安装；并在 package.json 中指定 test 脚本：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"jest\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Jest 的测试脚本名形如 <code>.test.js</code> ，不论 Jest 是全局运行还是通过 <code>npm test</code>  运行，它都会执行当前目录下所有的 <code>*.test.js</code>  或  <code>*.spec.js</code>  文件、完成测试。</p>\n<p>ES6 语法支持：</p>\n<ol>\n<li>安装依赖</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> <span class=\"token parameter variable\">--dev</span> babel-jest @babel/core @babel/preset-env</pre></td></tr></table></figure><ol start=\"2\">\n<li>配置 <code>.babelrc</code></li>\n</ol>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"presets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token string\">\"@babel/preset-env\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"targets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>          <span class=\"token property\">\"node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"current\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>接下来就可以使用 ES6 的语法了～～～</p>\n<p>更多高阶的 ES6/7/8… 语法，可以参见：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWJlbGpzLmlvLw==\">babel 官网</span></p>\n<p>关于 Typescript 的支持，可以参见 ：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qZXN0anMuaW8vZG9jcy9lbi9nZXR0aW5nLXN0YXJ0ZWQjdXNpbmctdHlwZXNjcmlwdA==\">Using Typescript</span></p>\n<h3 id=\"举个例子\"><a class=\"anchor\" href=\"#举个例子\">#</a> 举个例子</h3>\n<p>关于 test suite 与 test case：</p>\n<p><img data-src=\"assets/w80140jb42.jpg\" alt=\"img\" /></p>\n<p>describe 属于 test suite 的描述，而每个 test 或者 it 则描述了每个 test case。</p>\n<p>例如： <code>math.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">add</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> b<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">multiple</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">*</span> b<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>测试脚本： <code>math.test.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> math <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/math'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"math\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token keyword\">let</span> a</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">let</span> b</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    a <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    b <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#should return result as a+b\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// test code</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> math<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#should return result as a*b\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">//test code</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> math<span class=\"token punctuation\">.</span><span class=\"token function\">multiple</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>test suite 可以进行嵌套：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bar\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo bar\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token comment\">//test code</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>test case 也可以脱离 test suite 独立运行：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// hello.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token string\">'Hello world'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// hello.test.js</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> hello <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello.js'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should get \"Hello world\"'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">hello</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hello world'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 测试成功</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//expect (hello ()).toBe ('Hello') // 测试失败</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"mock与spy\"><a class=\"anchor\" href=\"#mock与spy\">#</a> Mock 与 Spy</h3>\n<p><strong>mock</strong> 测试就是在测试过程中，对于某些不容易构造或者不容易获取的对象，用一个虚拟的对象来创建以便测试的测试方法。</p>\n<p>Mock 是单元测试中经常使用的一种技术。单元测试，顾名思义测试的重点是某个具体单元。但是在实际代码中，代码与代码之间，模块与模块之间总是会存在着相互引用。这个时候，剥离出这种单元的依赖，让测试更加独立，使用到的技术就是 Mock。</p>\n<p><strong>为什么要使用 Mock 函数？</strong></p>\n<p>在项目中，一个模块的方法内常常会去调用另外一个模块的方法。在单元测试中，我们可能并不需要关心内部调用的方法的执行过程和结果，只想知道它是否被正确调用即可，甚至会指定该函数的返回值。此时，使用 Mock 函数是十分有必要。</p>\n<p>Mock 函数提供的以下三种特性，在我们写测试代码时十分有用：</p>\n<ul>\n<li>捕获函数调用情况</li>\n<li>设置函数返回值</li>\n<li>改变函数的内部实现</li>\n</ul>\n<p><img data-src=\"assets/8u3cp5kz2s.png\" alt=\"img\" /></p>\n<p>举个例子：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// math.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getFooResult</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token comment\">// foo logic here</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getBarResult</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">// bar logic here</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// caculate.js</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> getFooResult<span class=\"token punctuation\">,</span> getBarResult <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./math\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getFooBarResult</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getFooResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token function\">getBarResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>此时，getFooResult () 和 getBarResult () 就是 getFooBarResult 这个函数的依赖。如果我们关注的点是 getFooBarResult 这个函数，我们就应该把 getFooResult 和 getBarResult Mock 掉，剥离这种依赖。下面是一个使用 Jest 进行 Mock 的例子。</p>\n<p><code>jest.fn()</code>  是\b创建 Mock 函数最简单的方式，如果没有定义函数内部的实现， <code>jest.fn()</code>  会返回 <code>undefined</code>  作为返回值。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'测试jest.fn()调用'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token keyword\">let</span> mockFn <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token function\">mockFn</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token comment\">// 断言 mockFn 的执行后返回 undefined</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeUndefined</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token comment\">// 断言 mockFn 被调用</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token comment\">// 断言 mockFn 被调用了一次</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeCalledTimes</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token comment\">// 断言 mockFn 传入的参数为 1, 2, 3</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>mockFn<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><strong>情景一：设置函数 的返回值</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// calculate.test.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> getFooBarResult <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./calculate\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> fooBar <span class=\"token keyword\">from</span> <span class=\"token string\">'./math'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getResult should return result getFooResult() + getBarResult()'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">//mock add 方法和 multiple 方法</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  fooBar<span class=\"token punctuation\">.</span>getFooBarResult <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  fooBar<span class=\"token punctuation\">.</span>getBarResult <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">getFooBarResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>Mock 其实就是一种 Spies，在 Jest 中使用 spies 来 “spy”(窥探) 一个函数的行为。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qZXN0anMuaW8vZG9jcy9lbi9tb2NrLWZ1bmN0aW9uLWFwaS5odG1sI2NvbnRlbnQ=\">Jest 文档</span>对于 spies 的解释:</p>\n<blockquote>\n<p>Mock 函数也称为 “spies”，因为它们让你窥探一些由其他代码间接调用的函数的行为，而不仅仅是测试输出。你可以通过使用  <code>jest.fn()</code>  创建一个 mock 函数。</p>\n</blockquote>\n<p>简单来说，一个 spy 是另一个内置的能够记录对其调用细节的函数：调用它的次数，使用什么参数。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// calculate.test.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> getFooBarResult <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./calculate\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> fooBar <span class=\"token keyword\">from</span> <span class=\"token string\">'./math'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'getResult should return result getFooResult() + getBarResult()'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">//mock add 方法和 multiple 方法</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  fooBar<span class=\"token punctuation\">.</span>getFooResult <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  fooBar<span class=\"token punctuation\">.</span>getBarResult <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">getFooBarResult</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token comment\">// 监控 getFooResult 和 getBarResult 的调用情况.</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fooBar<span class=\"token punctuation\">.</span>getFooResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>fooBar<span class=\"token punctuation\">.</span>getBarResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>情景二：捕获函数调用情况</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// bot method</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> bot <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token function-variable function\">sayHello</span><span class=\"token operator\">:</span> <span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>name<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// test.js</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bot\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should say hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">const</span> spy <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>bot<span class=\"token punctuation\">,</span> <span class=\"token string\">\"sayHello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    bot<span class=\"token punctuation\">.</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Michael\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Michael\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    spy<span class=\"token punctuation\">.</span><span class=\"token function\">mockRestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>我们通过  <code>jest.spyOn</code>  创建了一个监听  <code>bot</code>  对象的  <code>sayHello</code>  方法的 spy。它就像间谍一样监听了所有对  <code>bot#sayHello</code>  方法的调用。由于创建 spy 时，Jest 实际上修改了  <code>bot</code>  对象的  <code>sayHello</code>  属性，所以在断言完成后，我们还要通过  <code>mockRestore</code>  来恢复  <code>bot</code>  对象原本的  <code>sayHello</code>  方法。</p>\n<p>Jest 的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qZXN0anMuaW8vZG9jcy9lbi9qZXN0LW9iamVjdCNqZXN0c3B5b25vYmplY3QtbWV0aG9kbmFtZQ==\"> spyOn 介绍</span></p>\n<p><strong>情景三：修改函数的内容实现</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> bot <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token function-variable function\">sayHello</span><span class=\"token operator\">:</span> <span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>name<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">!</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bot\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should say hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">const</span> spy <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>bot<span class=\"token punctuation\">,</span> <span class=\"token string\">\"sayHello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hello mix </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>name<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    bot<span class=\"token punctuation\">.</span><span class=\"token function\">sayHello</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Michael\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Michael\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    spy<span class=\"token punctuation\">.</span><span class=\"token function\">mockRestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>使用 spyOn 方法，还可以去修改 Math.random 这样的函数</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">,</span> <span class=\"token string\">\"random\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>举个例子：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// getNum.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getNum</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">index</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> arr<span class=\"token punctuation\">[</span>index <span class=\"token operator\">%</span> <span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">return</span> arr<span class=\"token punctuation\">[</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// num.test.js</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> getNum <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../src/getNum'</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getNum\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should select numbber based on index if provided\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">getNum</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"should select a random number based on Math.random if skuId not available\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">const</span> spy <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">spyOn</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">,</span> <span class=\"token string\">\"random\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockImplementation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">getNum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>spy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    spy<span class=\"token punctuation\">.</span><span class=\"token function\">mockRestore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"cli命令\"><a class=\"anchor\" href=\"#cli命令\">#</a> CLI 命令</h3>\n<pre><code>➜ npx jest --help\nUsage: jest [--config=&lt;pathToConfigFile&gt;] [TestPathPattern]\n\n选项：\n  --help, -h                    显示帮助信息                              [布尔]\n  --version, -v                 Print the version and exit                [布尔]\n  --config, -c                  The path to a jest config file specifying how to\n                                find and execute tests. If no rootDir is set in\n                                the config, the directory containing the config\n                                file is assumed to be the rootDir for the\n                                project.This can also be a JSON encoded value\n                                which Jest will use as configuration.   [字符串]\n  --coverage                    Indicates that test coverage information should\n                                be collected and reported in the output.  [布尔] \n  --timers                      Setting this value to fake allows the use of\n                                fake timers for functions such as setTimeout.\n                                                                        [字符串]\n  --verbose                     Display individual test results with the test\n                                suite hierarchy.                          [布尔]\n  --watch                       Watch files for changes and rerun tests related\n                                to changed files. If you want to re-run all\n                                tests when a file has changed, use the\n                                `--watchAll` option.                      [布尔]\n  --watchAll                    Watch files for changes and rerun all tests. If\n                                you want to re-run only the tests related to the\n                                changed files, use the `--watch` option.  [布尔]\n...\n</code></pre>\n<p>常见使用：</p>\n<p><code>--verbose</code>  显示详细的测试信息，包括测试 suite 和 case：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜ npx jest <span class=\"token parameter variable\">--verbose</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre> PASS  test/mock.test.js</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  bot</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    ✓ should say hello <span class=\"token punctuation\">(</span>7ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  console.log test/mock.test.js:10</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    Hello mix Michael</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> PASS  test/domain.test.js</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  getImageDomain</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    ✓ should <span class=\"token keyword\">select</span> domain based on skuId <span class=\"token keyword\">if</span> provided <span class=\"token punctuation\">(</span>1ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    ✓ should <span class=\"token keyword\">select</span> a random domain based on Math.random <span class=\"token keyword\">if</span> skuId not available <span class=\"token punctuation\">(</span>1ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  console.log test/sayhello.test.js:3</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    Hello Michael<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre> PASS  test/sayhello.test.js</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  bot</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    ✓ should say hello <span class=\"token punctuation\">(</span>6ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre> PASS  test/num.test.js</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  getNum</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    ✓ should <span class=\"token keyword\">select</span> numbber based on index <span class=\"token keyword\">if</span> provided <span class=\"token punctuation\">(</span>1ms<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    ✓ should <span class=\"token keyword\">select</span> a random number based on Math.random <span class=\"token keyword\">if</span> skuId not available</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> PASS  test/math.test.js</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  math</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    ✓ <span class=\"token comment\">#should return result as a+b (1ms)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    ✓ <span class=\"token comment\">#should return result as a*b (4ms)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>Test Suites: <span class=\"token number\">5</span> passed, <span class=\"token number\">5</span> total</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>Tests:       <span class=\"token number\">8</span> passed, <span class=\"token number\">8</span> total</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>Snapshots:   <span class=\"token number\">0</span> total</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>Time:        <span class=\"token number\">1</span>.075s</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>Ran all <span class=\"token builtin class-name\">test</span> suites.</pre></td></tr></table></figure><p><code>--watch</code>  和 <code>--watchAll</code>  用来监听测试文件的变化</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Ran all <span class=\"token builtin class-name\">test</span> suites.</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Watch Usage</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> › Press f to run only failed tests.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> › Press o to only run tests related to changed files.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> › Press p to filter by a filename regex pattern.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> › Press t to filter by a <span class=\"token builtin class-name\">test</span> name regex pattern.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> › Press q to quit <span class=\"token function\">watch</span> mode.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> › Press Enter to trigger a <span class=\"token builtin class-name\">test</span> run.</pre></td></tr></table></figure><p><code>--coverage</code>  用来形成测试覆盖率报告</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>-----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>-------------------<span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>File       <span class=\"token operator\">|</span>  % Stmts <span class=\"token operator\">|</span> % Branch <span class=\"token operator\">|</span>  % Funcs <span class=\"token operator\">|</span>  % Lines <span class=\"token operator\">|</span> Uncovered Line <span class=\"token comment\">#s |</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>-------------------<span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>All files  <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> getNum.js <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre> math.js   <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>      <span class=\"token number\">100</span> <span class=\"token operator\">|</span>                   <span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>----------<span class=\"token operator\">|</span>-------------------<span class=\"token operator\">|</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Test Suites: <span class=\"token number\">5</span> passed, <span class=\"token number\">5</span> total</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Tests:       <span class=\"token number\">8</span> passed, <span class=\"token number\">8</span> total</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Snapshots:   <span class=\"token number\">0</span> total</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>Time:        <span class=\"token number\">1</span>.497s</pre></td></tr></table></figure><h3 id=\"jest在react-vue项目中的应用\"><a class=\"anchor\" href=\"#jest在react-vue项目中的应用\">#</a> Jest 在 React、Vue 项目中的应用</h3>\n<p>在 <code>create-react-app</code>  中的应用：</p>\n<p>安装对应的依赖：</p>\n<pre><code>npm install react-test-renderer enzyme enzyme-adapter-react-16 \n</code></pre>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FpcmJuYi9lbnp5bWU=\">Enzyme</span> 是一个非常棒的 React 组件测试测试库。</p>\n<blockquote>\n<p>Enzyme is a JavaScript Testing utility for React that makes it easier to test your React Components' output. You can also manipulate, traverse, and in some ways simulate runtime given the output.</p>\n<p>Enzyme's API is meant to be intuitive and flexible by mimicking jQuery's API for DOM manipulation and traversal</p>\n</blockquote>\n<p>需要注意的两点是：</p>\n<ul>\n<li>需要配置 Adapter，不同的 React 的 Adapter 不同</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>Enzyme Adapter Package</th>\n<th>React semver compatibility</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>enzyme-adapter-react-16</code></td>\n<td><code>^16.4.0-0</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-16.3</code></td>\n<td><code>~16.3.0-0</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-16.2</code></td>\n<td><code>~16.2</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-16.1</code></td>\n<td><code>~16.0.0-0 || ~16.1</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-15</code></td>\n<td><code>^15.5.0</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-15.4</code></td>\n<td><code>15.0.0-0 - 15.4.x</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-14</code></td>\n<td><code>^0.14.0</code></td>\n</tr>\n<tr>\n<td><code>enzyme-adapter-react-13</code></td>\n<td><code>^0.13.0</code></td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>\n<p>需要初始化配置 <code>setUpTests.js</code></p>\n<p>官方文档在 Package.json 中设置 jest 配置，已经过时，Jest 框架最新会默认加载文件 <code>src/setUpTests.js</code></p>\n</li>\n<li>\n<pre><code class=\"language-react\">import &#123; configure &#125; from 'enzyme';\nimport Adapter from 'enzyme-adapter-react-16'\n\nconfigure(&#123; adapter: new Adapter() &#125;)\n</code></pre>\n</li>\n</ul>\n<p>在 vue 工程化项目中：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"@vue/cli-plugin-unit-jest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.9.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"@vue/test-utils\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.0-beta.29\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token property\">\"babel-core\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"7.0.0-bridge.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token property\">\"babel-eslint\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^10.0.1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token property\">\"babel-jest\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^23.6.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token property\">\"babel-preset-env\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.7.0\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>添加如上依赖，</p>\n<p>配置 scripts:</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token string-property property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token string-property property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"vue-cli-service test:unit\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>配置 <code>jest.config.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token comment\">// 处理 vue 结尾的文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token literal-property property\">moduleFileExtensions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token string\">'js'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token string\">'jsx'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string\">'vue'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token comment\">//es6 转义</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token literal-property property\">transform</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token string-property property\">'^.+\\\\.vue$'</span><span class=\"token operator\">:</span> <span class=\"token string\">'vue-jest'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string-property property\">'.+\\\\.(css|styl|less|sass|scss|svg|png|jpg|ttf|woff|woff2)$'</span><span class=\"token operator\">:</span> <span class=\"token string\">'jest-transform-stub'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token string-property property\">'^.+\\\\.jsx?$'</span><span class=\"token operator\">:</span> <span class=\"token string\">'babel-jest'</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token literal-property property\">transformIgnorePatterns</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token string\">'/node_modules/'</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token comment\">//cli 配置了 webpack 别名</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token literal-property property\">moduleNameMapper</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token string-property property\">'^@/(.*)$'</span><span class=\"token operator\">:</span> <span class=\"token string\">'&lt;rootDir>/src/$1'</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token literal-property property\">snapshotSerializers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token string\">'jest-serializer-vue'</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token literal-property property\">testMatch</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token string\">'**/tests/unit/**/*.spec.(js|jsx|ts|tsx)|**/__tests__/*.(js|jsx|ts|tsx)'</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token literal-property property\">testURL</span><span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost/'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  <span class=\"token literal-property property\">watchPlugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token string\">'jest-watch-typeahead/filename'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token string\">'jest-watch-typeahead/testname'</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>写一个测试用例：</p>\n<pre><code>\n</code></pre>\n<h2 id=\"简约之美ava\"><a class=\"anchor\" href=\"#简约之美ava\">#</a> 简约之美 AVA</h2>\n<p>简单的说 ava 是 mocha 的替代品：</p>\n<ul>\n<li>es6 语法支持更好，对 aysnc/await 有支持</li>\n<li>执行效率更高，使用 io 并发，就必须保证测试的原子性</li>\n<li>语义上更简单，集众家之长</li>\n</ul>\n<p>虽然 JavaScript 是单线程，但在 Node.js 里由于其异步的特性使得 IO 可以并行。AVA 利用这个优点让你的测试可以并发执行，这对于 IO 繁重的测试特别有用。另外，测试文件可以在不同的进程里并行运行，让每一个测试文件可以获得更好的性能和独立的环境。</p>\n<h3 id=\"ava特点\"><a class=\"anchor\" href=\"#ava特点\">#</a> AVA 特点</h3>\n<ul>\n<li>\n<p>轻量和高效</p>\n</li>\n<li>\n<p>简单的测试语法</p>\n</li>\n<li>\n<p>并发运行测试</p>\n</li>\n<li>\n<p>强制编写<strong>原子测试</strong></p>\n<p>一旦开始，就一直运行到结束，中间不会切换到另一个测试</p>\n</li>\n<li>\n<p>没有隐藏的全局变量</p>\n</li>\n<li>\n<p>为每个测试文件隔离环境</p>\n</li>\n<li>\n<p><strong>用 ES2015 编写测试</strong></p>\n</li>\n<li>\n<p>支持 Promise</p>\n</li>\n<li>\n<p>支持 Generator</p>\n</li>\n<li>\n<p>支持 Async</p>\n</li>\n<li>\n<p>支持 Observable</p>\n</li>\n<li>\n<p>强化断言信息</p>\n</li>\n<li>\n<p>可选的 TAP 输出显示</p>\n<p><img data-src=\"assets/tap-reporter.png\" alt=\"img\" /></p>\n</li>\n<li>\n<p>简明的堆栈跟踪</p>\n</li>\n</ul>\n<h3 id=\"安装开始\"><a class=\"anchor\" href=\"#安装开始\">#</a> 安装 &amp; 开始</h3>\n<p>情景一：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// 创建一个ava项目</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">npm</span> init ava</pre></td></tr></table></figure><p>形成 package.json</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"awesome-package\"</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t<span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ava\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token property\">\"ava\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^1.0.0\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>情景二：（推荐）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> init <span class=\"token parameter variable\">-y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>// <span class=\"token function\">npm</span> <span class=\"token operator\">&amp;</span> cnpm</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-D</span> ava</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>// <span class=\"token function\">yarn</span> </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> ava <span class=\"token parameter variable\">-D</span></pre></td></tr></table></figure><p>测试 ava 正常安装：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜ npx ava <span class=\"token parameter variable\">--version</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2.2</span>.0</pre></td></tr></table></figure><h3 id=\"第一个ava测试例子\"><a class=\"anchor\" href=\"#第一个ava测试例子\">#</a> 第一个 ava 测试例子</h3>\n<p>流程：</p>\n<ol>\n<li>引用 ava 的测试 API</li>\n<li>执行测试</li>\n<li>使用断言</li>\n</ol>\n<p>创建 <code>test.js</code>  文件</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> test <span class=\"token keyword\">from</span> <span class=\"token string\">'ava'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">testfn</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a <span class=\"token operator\">+</span> b</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello ava'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  t<span class=\"token punctuation\">.</span><span class=\"token function\">pass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'my first test'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token keyword\">const</span> str <span class=\"token operator\">=</span> <span class=\"token string\">'hello ava!!!!'</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  t<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> <span class=\"token string\">'hello ava!!!!'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'add method'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">testfn</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  t<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ava 自动搜索如下文件结尾的文件：</p>\n<ul>\n<li><code>**/test.js</code></li>\n<li><code>**/test-*.js</code></li>\n<li><code>**/*.spec.js</code></li>\n<li><code>**/*.test.js</code></li>\n<li><code>**/test/**/*.js</code></li>\n<li><code>**/tests/**/*.js</code></li>\n<li><code>**/__tests__/**/*.js</code></li>\n</ul>\n<p>ava 中的断言：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>.pass(<span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>.fail(<span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>.assert(value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>.truthy(value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>.falsy(value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>.<span class=\"token boolean\">true</span>(value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>.<span class=\"token boolean\">false</span>(value<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>.is(value<span class=\"token punctuation\">,</span> expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>.not(value<span class=\"token punctuation\">,</span> expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>.deepEqual(value<span class=\"token punctuation\">,</span> expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>.notDeepEqual(value<span class=\"token punctuation\">,</span> expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>.deepEqual()。</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>.throws(fn<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>.throwsAsync(thrower<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>.notThrows(fn<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>.notThrowsAsync(nonThrower<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>.regex(contents<span class=\"token punctuation\">,</span> regex<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>.notRegex(contents<span class=\"token punctuation\">,</span> regex<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>.snapshot(expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>.snapshot(expected<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>options<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span>)</pre></td></tr></table></figure><h3 id=\"cli命令-2\"><a class=\"anchor\" href=\"#cli命令-2\">#</a> CLI 命令</h3>\n<p>使用 <code>--help</code>  命令去查看 ava 支持的 cli 参数</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜ npx ava <span class=\"token parameter variable\">--help</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  Testing can be a drag. AVA helps you get it done.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  Usage</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    ava <span class=\"token punctuation\">[</span><span class=\"token operator\">&lt;</span>file<span class=\"token operator\">></span> <span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  Options</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    --watch, <span class=\"token parameter variable\">-w</span>             Re-run tests when tests and <span class=\"token builtin class-name\">source</span> files change</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    --match, <span class=\"token parameter variable\">-m</span>             Only run tests with matching title <span class=\"token punctuation\">(</span>Can be repeated<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    --update-snapshots, <span class=\"token parameter variable\">-u</span>  Update snapshots</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    --fail-fast             Stop after first <span class=\"token builtin class-name\">test</span> failure</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    --timeout, <span class=\"token parameter variable\">-T</span>           Set global <span class=\"token function\">timeout</span> <span class=\"token punctuation\">(</span>milliseconds or human-readable, e.g. 10s, 2m<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    --serial, <span class=\"token parameter variable\">-s</span>            Run tests serially</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    --concurrency, <span class=\"token parameter variable\">-c</span>       Max number of <span class=\"token builtin class-name\">test</span> files running at the same <span class=\"token function\">time</span> <span class=\"token punctuation\">(</span>Default: CPU cores<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    --verbose, <span class=\"token parameter variable\">-v</span>           Enable verbose output</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    --tap, <span class=\"token parameter variable\">-t</span>               Generate TAP output</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token parameter variable\">--color</span>                 Force color output</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    --no-color              Disable color output</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    --reset-cache           Reset AVA's compilation cache and <span class=\"token builtin class-name\">exit</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token parameter variable\">--config</span>                JavaScript <span class=\"token function\">file</span> <span class=\"token keyword\">for</span> AVA to <span class=\"token builtin class-name\">read</span> its config from, instead of using package.json</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                            or ava.config.js files</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  Examples</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    ava</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    ava test.js test2.js</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    ava test-*.js</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    ava <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  The above relies on your shell expanding the glob patterns.</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  Without arguments, AVA uses the following patterns:</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    **/test.js **/test-*.js **/*.spec.js **/*.test.js **/test/**/*.js **/tests/**/*.js **/__tests__/**/*.js</pre></td></tr></table></figure><h4 id=\"文件匹配\"><a class=\"anchor\" href=\"#文件匹配\">#</a> 文件匹配</h4>\n<p>使用 <code>match</code>  指令，匹配对应需要测试的文件：</p>\n<p>匹配标题以 <code>foo</code> ：结尾</p>\n<pre><code>npx ava --match ='* foo'\n</code></pre>\n<p>匹配标题以 <code>foo</code> ：</p>\n<pre><code>npx ava --match ='foo *'\n</code></pre>\n<p>匹配标题包含 <code>foo</code> ：</p>\n<pre><code>npx ava --match ='* foo *'\n</code></pre>\n<p>匹配是完全相同  <code>foo</code> ：</p>\n<pre><code>npx ava --match ='foo'\n</code></pre>\n<p>匹配标题不包含 <code>foo</code> ：</p>\n<pre><code>npx ava --match ='！* foo *'\n</code></pre>\n<p>匹配以下 <code>foo</code>  结尾的标题 <code>bar</code> ：</p>\n<pre><code>npx ava --match ='foo * bar'\n</code></pre>\n<p>匹配 <code>foo</code>  以 <code>bar</code> ：开头或结尾的标题：</p>\n<pre><code>npx ava --match ='foo *' -  match ='* bar'\n</code></pre>\n<h4 id=\"关于reporter\"><a class=\"anchor\" href=\"#关于reporter\">#</a> 关于 reporter</h4>\n<p>默认情况下，AVA 使用最小的报告：</p>\n<p><a href=\"https://github.com/avajs/ava/blob/master/media/mini-reporter.gif\"><img data-src=\"assets/mini-reporter.gif\" alt=\"img\" /></a></p>\n<p>使用该 <code>--verbose</code>  标志启用详细的报告者。除非启用 TAP 报告，否则始终在 CI 环境中使用此选项。</p>\n<p><a href=\"https://github.com/avajs/ava/blob/master/media/verbose-reporter.png\"><img data-src=\"assets/verbose-reporter.png\" alt=\"img\" /></a></p>\n<p><strong>TAP 报告（推荐）</strong></p>\n<p>AVA 支持 TAP 格式，因此与任何 TAP 报告器兼容。使用该 <code>--tap</code>  标志启用 TAP 输出。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ npx ava <span class=\"token parameter variable\">--tap</span> <span class=\"token operator\">|</span> npx tap-nyan</pre></td></tr></table></figure><p><a href=\"https://github.com/avajs/ava/blob/master/media/tap-reporter.png\"><img data-src=\"assets/tap-reporter-20190709154342692.png\" alt=\"img\" /></a></p>\n<p>这里有一些格式：</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Njb3R0Y29yZ2FuL3RhcC1kb3Q=\">tap-dot</span> - Dotted output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Njb3R0Y29yZ2FuL3RhcC1zcGVj\">tap-spec</span> - Mocha-like spec reporter.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NhbHZpbm1ldGNhbGYvdGFwLW55YW4=\">tap-nyan</span> - Nyan cat.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2d1bW1lc3Nvbi90YXAtbWlu\">tap-min</span> - Minimal output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL25hbXVvbC90YXAtZGlmZmxldA==\">tap-difflet</span> - Minimal output with diffing.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F4cm9zcy90YXAtZGlmZg==\">tap-diff</span> - Human-friendly output with diffing.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2pvZXliYWtlci90YXAtc2ltcGxl\">tap-simple</span> - Simple output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N1YnN0YWNrL2ZhdWNldA==\">faucet</span> - Human-readable summarizer.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2lzYWFjcy90YXAtbW9jaGEtcmVwb3J0ZXI=\">tap-mocha-reporter</span> - Use any of the <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2lzYWFjcy90YXAtbW9jaGEtcmVwb3J0ZXIvdHJlZS9tYXN0ZXIvbGliL3JlcG9ydGVycw==\">Mocha reporters</span>.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3pvdWJpbi90YXAtc3VtbWFyeQ==\">tap-summary</span> - Summarized output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2NsdXgvdGFwLXBlc3NpbWlzdA==\">tap-pessimist</span> - Only shows failed tests.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Rvb2xuZXNzL3RhcC1wcmV0dGlmeQ==\">tap-prettify</span> - Nice readable output with diffing.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3N1YnN0YWNrL3RhcC1jb2xvcml6ZQ==\">tap-colorize</span> - Colorize the output while preserving machine-readability.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2p1bGlhbmdydWJlci90YXAtYmFpbA==\">tap-bail</span> - Bail out when the first test fails.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F4cm9zcy90YXAtbm90aWZ5\">tap-notify</span> - Notifier for macOS, Linux and Windows.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2d1bW1lc3Nvbi90YXAtanNvbg==\">tap-json</span> - JSON output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3lvdmFzeDIvYXZhLXRhcC1qc29u\">ava-tap-json</span> - JSON output with AVA compatibility.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FnaGFzc2VtaS90YXAteHVuaXQ=\">tap-xunit</span> - xUnit output.</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3Ntb2NrbGUvdGFwLXRlYW1jaXR5\">tap-teamcity</span> - Output for TeamCity.</li>\n</ul>\n<h4 id=\"快照功能\"><a class=\"anchor\" href=\"#快照功能\">#</a> 快照功能</h4>\n<p>ava 自动进行项目测试快照，如果文件放置在 <code>test</code>  或者 <code>tests</code>  目录，则快照会放置在 <code>snapshots</code>  目录。如果测试放置在 <code>__test__</code> 目录，则快照放置在 <code>__snapshots__</code> 目录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ava --update-snapshots</pre></td></tr></table></figure><p>可以指定一个固定位置，以便在 AVA 的 <code>package.json</code>  配置中存储快照文件：</p>\n<p><strong>package.json：</strong></p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t <span class=\"token string\">\"ava\"</span>：<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t <span class=\"token string\">\"snapshotDir\"</span>：<span class=\"token string\">\"自定义目录\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"设置超时\"><a class=\"anchor\" href=\"#设置超时\">#</a> 设置超时</h4>\n<p>AVA 中的超时行为与其他测试框架中的行为不同。AVA 在每次测试后重置计时器，如果在指定的超时内没有收到新的测试结果，则强制测试退出。这可用于处理停滞的测试。</p>\n<p><em>没有默认超时。</em></p>\n<p>您可以配置使用超时 <code>--timeout</code>  命令行选项，或配置文件中设置。它们可以以人类可读的方式设置：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 10 秒</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>npx ava <span class=\"token parameter variable\">--timeout</span> <span class=\"token operator\">=</span> 10s </pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 2 分钟</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>npx ava <span class=\"token parameter variable\">--timeout</span> <span class=\"token operator\">=</span> 2m </pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 100 毫秒</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>npx ava <span class=\"token parameter variable\">--timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span></pre></td></tr></table></figure><p>还可以为每个测试单独设置超时。每次进行断言时都会重置这些超时。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tt<span class=\"token punctuation\">.</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 100 milliseconds</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token comment\">// Write your assertions here</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"其他ava设置相关\"><a class=\"anchor\" href=\"#其他ava设置相关\">#</a> 其他 ava 设置相关</h3>\n<h4 id=\"eslint\"><a class=\"anchor\" href=\"#eslint\">#</a> ESLint</h4>\n<p>如果使用了 ESLint，请添加<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2VzbGludC1wbHVnaW4tYXZh\"> eslint-plugin-ava</span></p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tplugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t<span class=\"token string\">\"ava\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"异步相关\"><a class=\"anchor\" href=\"#异步相关\">#</a> 异步相关</h4>\n<p>如果异步操作使用 promises，则应返回 promise：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetches foo'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">return</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\tt<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>更好的是，使用 <code>async</code> /  <code>await</code> ：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetches foo'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">t</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tt<span class=\"token punctuation\">.</span><span class=\"token function\">is</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> <span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"测试环境帮手karma\"><a class=\"anchor\" href=\"#测试环境帮手karma\">#</a> 测试环境 &amp; 帮手 Karma</h2>\n<p>Karma 是一个基于 Node.js 的 JavaScript 测试执行过程管理工具（Test Runner）。该工具可用于测试所有主流 Web 浏览器，也可以集成到 CI（Continuous integration）工具，还可以和其他代码编辑器一起使用。</p>\n<p>Karma 会监控配置文件中所指定的每一个文件，每当文件发生改变，它都会向测试服务器发送信号，来通知所有的浏览器再次运行测试代码。此时，浏览器会重新加载源文件，并执行测试代码。其结果会传递回服务器，并以某种形式显示给开发者。</p>\n<p>访问浏览器执行结果，可通过以下的方式</p>\n<ul>\n<li>手工方式 - 通过浏览器</li>\n<li>自动方式 - 让 karma 来启动对应的浏览器</li>\n</ul>\n<h3 id=\"工作原理简介\"><a class=\"anchor\" href=\"#工作原理简介\">#</a> 工作原理简介</h3>\n<p><code>karma</code>  是一个典型的  <code>C/S</code>  程序，包含 client 和 server ，通讯方式基于  <code>Http</code>  ，通常情况下，客户端和服务端基本都运行在开发者本地机器上。</p>\n<p>一个服务端实例对应一个项目，假如想同时运行多个项目，得同时开启多个服务端实例。</p>\n<p><strong>Server</strong></p>\n<p><code>Server</code>  是框架的主要组成部分之一，它内部保存了所有的程序运行状态，比如 client 连接，当前运行的单测文件，根据这些数据状态，它提供了下面几个功能， 下图是 server 的结构</p>\n<p><img data-src=\"assets/TB13X9xLXXXXXXoaXXXDUoU9pXX-902-329.png\" alt=\"karma_server\" /></p>\n<ul>\n<li>监听文件</li>\n<li>与 client 进行通讯</li>\n<li>向开发者输出测试结果</li>\n<li>提供 client 端所需的资源文件</li>\n</ul>\n<p><strong>Client</strong></p>\n<p>client 是单测最终运行的地方，类似一个 web app ， 跟 server 端通讯利用  <code>socket.io</code> ， 执行单测在一个独立的  <code>iframe</code>  中。下面是它的结构图</p>\n<p><img data-src=\"assets/TB1jTKwLXXXXXX.aXXX0KhCSFXX-619-472.png\" alt=\"karma_impl_client\" /></p>\n<p>client 和 server 端通讯采用  <code>socket.io</code></p>\n<ul>\n<li>client 端会发送这些消息</li>\n</ul>\n<p><img data-src=\"assets/TB1XXuILXXXXXcAXFXX.hdJKpXX-918-179.png\" alt=\"karma_impl_client_message_c\" /></p>\n<ul>\n<li>server 端会发送这些消息</li>\n</ul>\n<p><img data-src=\"assets/TB1PvisLXXXXXcqaXXXEHlCNpXX-896-103.png\" alt=\"karma_impl_client_message_s\" /></p>\n<h3 id=\"安装karma\"><a class=\"anchor\" href=\"#安装karma\">#</a> 安装 Karma</h3>\n<p>对于 Nodejs 版本的要求：</p>\n<blockquote>\n<p>Karma currently works on Node.js <strong>6.x</strong>, <strong>8.x</strong>, and <strong>10.x</strong>. See <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLzQuMC9pbnRyby9mYXEuaHRtbA==\">FAQ</span> for more info.</p>\n</blockquote>\n<ol>\n<li>\n<p>全局安装</p>\n<pre><code>$npm install -g karma\n</code></pre>\n<p>安装 Karma 命令会到全局的  <code>node_modules</code>  目录下，我们可以在任何位置直接运行 karma 命令。</p>\n<pre><code>npm install -g karma-cli\n</code></pre>\n<p>此命令用来安装  <code>karma-cli</code> ，它会在当前目录下寻找 karma 的可执行文件。这样我们就可以在一个系统内运行多个版本的 Karma。</p>\n</li>\n<li>\n<p>本地安装</p>\n<pre><code>$ npm install karma --save-dev\n</code></pre>\n<p>安装 Karma 命令到当前  <code>node_modules</code>  目录下，此时，如果需要执行 karma 命令，就需要这样</p>\n<pre><code>./node_modules/.bin/karma\n\nnpx karma --version\n</code></pre>\n</li>\n</ol>\n<h3 id=\"配置karma\"><a class=\"anchor\" href=\"#配置karma\">#</a> 配置 Karma</h3>\n<p>karma 配置文件可以用 JavaScript，CoffeeScript 或 TypeScript 编写，并作为常规 Node.js 模块加载。</p>\n<p>除非作为参数提供，否则 Karma CLI 将在以下位置以该顺序 (从上至下) 查找配置文件</p>\n<ul>\n<li><code>./karma.conf.js</code></li>\n<li><code>./karma.conf.coffee</code></li>\n<li><code>./karma.conf.ts</code></li>\n<li><code>./.config/karma.conf.js</code></li>\n<li><code>./.config/karma.conf.coffee</code></li>\n<li><code>./.config/karma.conf.ts</code></li>\n</ul>\n<p>在配置文件中，配置代码通过设置 <code>module.exports</code>  指向一个接受一个参数的函数：配置对象。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// karma.conf.js</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token literal-property property\">basePath</span><span class=\"token operator\">:</span> <span class=\"token string\">'../..'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token literal-property property\">frameworks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'jasmine'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">//...</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre># karma<span class=\"token punctuation\">.</span>conf<span class=\"token punctuation\">.</span>coffee</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  config<span class=\"token punctuation\">.</span>set</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token literal-property property\">basePath</span><span class=\"token operator\">:</span> <span class=\"token string\">'../..'</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token literal-property property\">frameworks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'jasmine'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    # <span class=\"token operator\">...</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// karma.conf.ts</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token literal-property property\">basePath</span><span class=\"token operator\">:</span> <span class=\"token string\">'../..'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token literal-property property\">frameworks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'jasmine'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">//...</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>关于 typescript 的支持，需要使用到 <code>ts-node</code> ，配置 ts-node 以使用 <code>commonjs</code>  模块格</p>\n</blockquote>\n<p>配置文件中的基本的属性介绍：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9rYXJtYS1ydW5uZXIuZ2l0aHViLmlvLzQuMC9jb25maWcvY29uZmlndXJhdGlvbi1maWxlLmh0bWw=\">Overview</span></p>\n<p>使用 CLI 工具，快速创建配置</p>\n<p>开始配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>~/Downloads/Demo is 📦 v1.0.0 via ⬢ v10.16.0 </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>➜ npx karma init</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 如果在应用中用到了其它的测试框架，那就需要我们安装它们所对应的插件，并在配置文件中标注它们（详见 karma.conf.js 中的 plugins 项）</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Which testing framework <span class=\"token keyword\">do</span> you want to use ?</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Press tab to list possible options. Enter to move to the next question.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">></span> jasmine</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># mocha</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># qunit</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># nodeunit</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># nunit</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># Require.js 是异步加载规范（AMD）的实现。常被作为基础代码库，应用在了很多的项目与框架之中，例如 Dojo, AngularJs 等</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>Do you want to use Require.js ?</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>This will <span class=\"token function\">add</span> Require.js plugin.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Press tab to list possible options. Enter to move to the next question.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">></span> no</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># yes</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># 选择需要运行测试用例的浏览器。需要注意的就是，必须保证所对应的浏览器插件已经安装成功。</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>Do you want to capture any browsers automatically ?</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Press tab to list possible options. Enter empty string to move to the next question.</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token operator\">></span> Chrome</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># ChromeHeadless</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># ChromeCanary</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># Firefox</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># Safari</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># PhantomJS</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># Opera</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\"># IE</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># 选择测试用例所在的目录位置。Karma 支持通配符的方式配置文件或目录，例如 *.js, test/**/*.js 等。如果目录或文件使用相对位置，要清楚地是，此时的路径是相对于当前运行 karma 命令时所在的目录。</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>What is the location of your <span class=\"token builtin class-name\">source</span> and <span class=\"token builtin class-name\">test</span> files ?</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>You can use glob patterns, eg. <span class=\"token string\">\"js/*.js\"</span> or <span class=\"token string\">\"test/**/*Spec.js\"</span><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>Enter empty string to move to the next question.</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token operator\">></span> src/*js</pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\"># 目录中不包括的那些文件。</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>Should any of the files included by the previous patterns be excluded ?</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>You can use glob patterns, eg. <span class=\"token string\">\"**/*.swp\"</span><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>Enter empty string to move to the next question.</pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\"># 是否需要 Karma 自动监听文件？并且文件一旦被修改，就重新运行测试用例？</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>Do you want Karma to <span class=\"token function\">watch</span> all the files and run the tests on change ?</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>Press tab to list possible options.</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token function\">yes</span></pre></td></tr></table></figure><p>生成了一个 <code>karma.conf.js</code>  文件：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Karma configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Generated on Wed Jul 10 2019 22:46:32 GMT+0800 (GMT+08:00)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// base path that will be used to resolve all patterns (eg. files, exclude)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token literal-property property\">basePath</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// frameworks to use</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// available frameworks: https://npmjs.org/browse/keyword/karma-adapter</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token literal-property property\">frameworks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'mocha'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// list of files / patterns to load in the browser</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token string\">'src/*js'</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// list of files / patterns to exclude</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token literal-property property\">exclude</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">// preprocess matching files before serving them to the browser</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token literal-property property\">preprocessors</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">// test results reporter to use</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\">// possible values: 'dots', 'progress'</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token comment\">// available reporters: https://npmjs.org/browse/keyword/karma-reporter</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token literal-property property\">reporters</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'progress'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token comment\">// web server port</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> <span class=\"token number\">9876</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token comment\">// enable / disable colors in the output (reporters and logs)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token literal-property property\">colors</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token comment\">// level of logging</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token comment\">// possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token literal-property property\">logLevel</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token constant\">LOG_INFO</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token comment\">// enable / disable watching file and executing tests whenever any file changes</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token literal-property property\">autoWatch</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token comment\">// start these browsers</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token comment\">// available browser launchers: https://npmjs.org/browse/keyword/karma-launcher</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token literal-property property\">browsers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'Chrome'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token comment\">// Continuous Integration mode</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token comment\">// if true, Karma captures browsers, runs the tests and exits</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token literal-property property\">singleRun</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token comment\">// Concurrency level</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token comment\">// how many browser should be started simultaneous</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token literal-property property\">concurrency</span><span class=\"token operator\">:</span> <span class=\"token number\">Infinity</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"karma示例\"><a class=\"anchor\" href=\"#karma示例\">#</a> karma 示例</h3>\n<p>目标 ：</p>\n<ul>\n<li>babel 支持，ES6 语法支持</li>\n<li>mocha 与 chai 支持</li>\n<li>karma 与 chrome、webpack 对接</li>\n</ul>\n<p>说明：</p>\n<p>Karma 对 babel 支持的，一个可选项：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JhYmVsL2thcm1hLWJhYmVsLXByZXByb2Nlc3Nvcg==\">karma-babel-preprocessor</span>，但是：</p>\n<blockquote>\n<p>babel and karma-babel-preprocessor only convert ES6 modules to CommonJS/AMD/SystemJS/UMD**. If you choose CommonJS, you still need to resolve and concatenate CommonJS modules on your own**. We recommend <strong>karma-browserify + babelify</strong> or <strong>webpack + babel-loader</strong> in such cases.</p>\n</blockquote>\n<p>所以，我们选择了 webpack</p>\n<ol>\n<li>\n<p>安装依赖</p>\n<pre><code>npm install @babel/core @babel/preset-env chai mocha webpack webpack-cli babel-loader -D\n</code></pre>\n</li>\n<li>\n<p>安装 karma 的适配器</p>\n<pre><code>npm install karma-webpack karma-chrome-launcher karma-mocha karma-chai -D\n</code></pre>\n</li>\n<li>\n<p>配置 <code>karma.config.js</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Karma configuration</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// Generated on Thu Jul 11 2019 23:23:44 GMT+0800 (GMT+08:00)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  config<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// base path that will be used to resolve all patterns (eg. files, exclude)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token literal-property property\">basePath</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// frameworks to use</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// available frameworks: https://npmjs.org/browse/keyword/karma-adapter</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token literal-property property\">frameworks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'mocha'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// list of files / patterns to load in the browser</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token literal-property property\">files</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token string\">'src/**/*.js'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token string\">'test/**/*.js'</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre> </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// ....</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">// preprocess matching files before serving them to the browser</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">// available preprocessors: https://npmjs.org/browse/keyword/karma-preprocessor</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token literal-property property\">preprocessors</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token string-property property\">'src/**/*.js'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'webpack'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token string-property property\">'test/**/*.js'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'webpack'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token literal-property property\">webpack</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token literal-property property\">mode</span><span class=\"token operator\">:</span> <span class=\"token string\">\"none\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token literal-property property\">node</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token literal-property property\">fs</span><span class=\"token operator\">:</span> <span class=\"token string\">'empty'</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>          <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.js?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">\"babel-loader\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@babel/env\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre> </pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">// ....</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token string\">'karma-mocha'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token string\">'karma-chai'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>      <span class=\"token string\">'karma-chrome-launcher'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token string\">'karma-webpack'</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>书写测试用例 <code>test.js</code> ：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> describe <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mocha\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">&#123;</span> expect <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'chai'</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'first test'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello mocha and karma'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello mocha'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">.</span>be<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure></li>\n<li>\n<p>开始测试：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>npx karma start</pre></td></tr></table></figure><p>添加到 <code>package.json</code></p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"karma\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"karma start\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr></table></figure><p>然后使用， <code>npm run karma</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>➜ npx karma start</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ℹ ｢wdm｣: Hash: 9d2c943b68425fd58dd0</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Version: webpack <span class=\"token number\">4.35</span>.3</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Time: 53ms</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Built at: <span class=\"token number\">2019</span>-07-12 <span class=\"token number\">5</span>:07:49 PM</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ℹ ｢wdm｣: Compiled successfully.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ℹ ｢wdm｣: Compiling<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>⚠ ｢wdm｣: Hash: cca8316f4bd5855fc4de</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Version: webpack <span class=\"token number\">4.35</span>.3</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Time: 2414ms</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Built at: <span class=\"token number\">2019</span>-07-12 <span class=\"token number\">5</span>:07:52 PM</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>       Asset      Size  Chunks             Chunk Names</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>src/index.js  <span class=\"token number\">3.62</span> KiB       <span class=\"token number\">0</span>  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  src/index</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>test/test.js  <span class=\"token number\">1010</span> KiB       <span class=\"token number\">1</span>  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  test/test</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Entrypoint src/index <span class=\"token operator\">=</span> src/index.js</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Entrypoint test/test <span class=\"token operator\">=</span> test/test.js</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> ./src/index.js <span class=\"token number\">27</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> ./test/test.js <span class=\"token number\">223</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/browser-entry.js <span class=\"token number\">4.19</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> ./node_modules/process/browser.js <span class=\"token number\">4.96</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>webpack<span class=\"token punctuation\">)</span>/buildin/global.js <span class=\"token number\">878</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> ./node_modules/browser-stdout/index.js <span class=\"token number\">662</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> ./node_modules/stream-browserify/index.js <span class=\"token number\">3.53</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">36</span><span class=\"token punctuation\">]</span> ./node_modules/util/util.js <span class=\"token number\">19</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">38</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">21.8</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">39</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>webpack<span class=\"token punctuation\">)</span>/buildin/module.js <span class=\"token number\">552</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span> ./node_modules/escape-string-regexp/index.js <span class=\"token number\">230</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">41</span><span class=\"token punctuation\">]</span> path <span class=\"token punctuation\">(</span>ignored<span class=\"token punctuation\">)</span> <span class=\"token number\">15</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">42</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/lib/reporters/index.js <span class=\"token number\">945</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">105</span><span class=\"token punctuation\">]</span> ./node_modules/chai/index.js <span class=\"token number\">39</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">106</span><span class=\"token punctuation\">]</span> ./node_modules/chai/lib/chai.js <span class=\"token number\">1.22</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    + <span class=\"token number\">128</span> hidden modules</pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">217</span>:20-37</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"36\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"37\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">222</span>:24-70</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"41\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"42\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">266</span>:24-35</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"46\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"47\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">313</span>:35-48</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"51\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"52\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">329</span>:23-44</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"56\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"57\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>ℹ ｢wdm｣: Compiled with warnings.</pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:07:52.761:WARN <span class=\"token punctuation\">[</span>karma<span class=\"token punctuation\">]</span>: No captured browser, <span class=\"token function\">open</span> http://localhost:9876/</pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:07:52.770:INFO <span class=\"token punctuation\">[</span>karma-server<span class=\"token punctuation\">]</span>: Karma v4.1.0 server started at http://0.0.0.0:9876/</pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:07:52.770:INFO <span class=\"token punctuation\">[</span>launcher<span class=\"token punctuation\">]</span>: Launching browsers Chrome with concurrency unlimited</pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:07:52.773:INFO <span class=\"token punctuation\">[</span>launcher<span class=\"token punctuation\">]</span>: Starting browser Chrome</pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:07:54.135:INFO <span class=\"token punctuation\">[</span>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>: Connected on socket R9R31QB1GtR_kayNAAAA with <span class=\"token function\">id</span> <span class=\"token number\">55412577</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span> LOG: <span class=\"token string\">'hello karma'</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>LOG: <span class=\"token string\">'hello mocha'</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span>: Executed <span class=\"token number\">1</span> of <span class=\"token number\">1</span> SUCCESS <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> secs / <span class=\"token number\">0.001</span> secs</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>~/Downloads/karma-demo is 📦 v1.0.0 via ⬢ v10.16.0 </pre></td></tr><tr><td data-num=\"69\"></td><td><pre>➜ <span class=\"token function\">npm</span> run karma</pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token operator\">></span> karma-demo@1.0.0 karma /Users/itheima/Downloads/karma-demo</pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token operator\">></span> karma start</pre></td></tr><tr><td data-num=\"73\"></td><td><pre></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>ℹ ｢wdm｣: Hash: 9d2c943b68425fd58dd0</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>Version: webpack <span class=\"token number\">4.35</span>.3</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>Time: 48ms</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>Built at: <span class=\"token number\">2019</span>-07-12 <span class=\"token number\">5</span>:24:02 PM</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>ℹ ｢wdm｣: Compiled successfully.</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>ℹ ｢wdm｣: Compiling<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>⚠ ｢wdm｣: Hash: cca8316f4bd5855fc4de</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>Version: webpack <span class=\"token number\">4.35</span>.3</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>Time: 2307ms</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>Built at: <span class=\"token number\">2019</span>-07-12 <span class=\"token number\">5</span>:24:04 PM</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>       Asset      Size  Chunks             Chunk Names</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>src/index.js  <span class=\"token number\">3.62</span> KiB       <span class=\"token number\">0</span>  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  src/index</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>test/test.js  <span class=\"token number\">1010</span> KiB       <span class=\"token number\">1</span>  <span class=\"token punctuation\">[</span>emitted<span class=\"token punctuation\">]</span>  test/test</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>Entrypoint src/index <span class=\"token operator\">=</span> src/index.js</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>Entrypoint test/test <span class=\"token operator\">=</span> test/test.js</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> ./src/index.js <span class=\"token number\">27</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> ./test/test.js <span class=\"token number\">223</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/browser-entry.js <span class=\"token number\">4.19</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> ./node_modules/process/browser.js <span class=\"token number\">4.96</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>webpack<span class=\"token punctuation\">)</span>/buildin/global.js <span class=\"token number\">878</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span> ./node_modules/browser-stdout/index.js <span class=\"token number\">662</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>  <span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span> ./node_modules/stream-browserify/index.js <span class=\"token number\">3.53</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">36</span><span class=\"token punctuation\">]</span> ./node_modules/util/util.js <span class=\"token number\">19</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">38</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">21.8</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">39</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>webpack<span class=\"token punctuation\">)</span>/buildin/module.js <span class=\"token number\">552</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span> ./node_modules/escape-string-regexp/index.js <span class=\"token number\">230</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">41</span><span class=\"token punctuation\">]</span> path <span class=\"token punctuation\">(</span>ignored<span class=\"token punctuation\">)</span> <span class=\"token number\">15</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre> <span class=\"token punctuation\">[</span><span class=\"token number\">42</span><span class=\"token punctuation\">]</span> ./node_modules/mocha/lib/reporters/index.js <span class=\"token number\">945</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">105</span><span class=\"token punctuation\">]</span> ./node_modules/chai/index.js <span class=\"token number\">39</span> bytes <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">106</span><span class=\"token punctuation\">]</span> ./node_modules/chai/lib/chai.js <span class=\"token number\">1.22</span> KiB <span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">[</span>built<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    + <span class=\"token number\">128</span> hidden modules</pre></td></tr><tr><td data-num=\"105\"></td><td><pre></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">217</span>:20-37</pre></td></tr><tr><td data-num=\"107\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"108\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"109\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"110\"></td><td><pre></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">222</span>:24-70</pre></td></tr><tr><td data-num=\"112\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"113\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"114\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"115\"></td><td><pre></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">266</span>:24-35</pre></td></tr><tr><td data-num=\"117\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"118\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"119\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"120\"></td><td><pre></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">313</span>:35-48</pre></td></tr><tr><td data-num=\"122\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"123\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"124\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"125\"></td><td><pre></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>WARNING <span class=\"token keyword\">in</span> ./node_modules/mocha/lib/mocha.js <span class=\"token number\">329</span>:23-44</pre></td></tr><tr><td data-num=\"127\"></td><td><pre>Critical dependency: the request of a dependency is an expression</pre></td></tr><tr><td data-num=\"128\"></td><td><pre> @ ./node_modules/mocha/browser-entry.js</pre></td></tr><tr><td data-num=\"129\"></td><td><pre> @ ./test/test.js</pre></td></tr><tr><td data-num=\"130\"></td><td><pre>ℹ ｢wdm｣: Compiled with warnings.</pre></td></tr><tr><td data-num=\"131\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:24:04.905:WARN <span class=\"token punctuation\">[</span>karma<span class=\"token punctuation\">]</span>: No captured browser, <span class=\"token function\">open</span> http://localhost:9876/</pre></td></tr><tr><td data-num=\"132\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:24:04.914:INFO <span class=\"token punctuation\">[</span>karma-server<span class=\"token punctuation\">]</span>: Karma v4.1.0 server started at http://0.0.0.0:9876/</pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:24:04.914:INFO <span class=\"token punctuation\">[</span>launcher<span class=\"token punctuation\">]</span>: Launching browsers Chrome with concurrency unlimited</pre></td></tr><tr><td data-num=\"134\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:24:04.922:INFO <span class=\"token punctuation\">[</span>launcher<span class=\"token punctuation\">]</span>: Starting browser Chrome</pre></td></tr><tr><td data-num=\"135\"></td><td><pre><span class=\"token number\">12</span> 07 <span class=\"token number\">2019</span> <span class=\"token number\">17</span>:24:06.289:INFO <span class=\"token punctuation\">[</span>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>: Connected on socket EbCCSbQRPbxHbq3OAAAA with <span class=\"token function\">id</span> <span class=\"token number\">92342032</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span> LOG: <span class=\"token string\">'hello karma'</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>LOG: <span class=\"token string\">'hello mocha'</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span>: Executed <span class=\"token number\">1</span> of <span class=\"token number\">1</span> SUCCESS <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> secs / <span class=\"token number\">0.001</span> secs</pre></td></tr><tr><td data-num=\"140\"></td><td><pre>Chrome <span class=\"token number\">75.0</span>.3770 <span class=\"token punctuation\">(</span>Mac OS X <span class=\"token number\">10.14</span>.5<span class=\"token punctuation\">)</span>: Executed <span class=\"token number\">1</span> of <span class=\"token number\">1</span> SUCCESS <span class=\"token punctuation\">(</span><span class=\"token number\">0.006</span> secs / <span class=\"token number\">0.001</span> </pre></td></tr><tr><td data-num=\"141\"></td><td><pre>secs<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>TOTAL: <span class=\"token number\">1</span> SUCCESS</pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"ui测试利器nightmare\"><a class=\"anchor\" href=\"#ui测试利器nightmare\">#</a> UI 测试利器 Nightmare</h2>\n<p>Nightmare 是<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZWdtZW50LmNvbS8=\"> Segment</span> 的高级浏览器自动化库。</p>\n<p>目标是公开一些模仿用户操作（例如 <code>goto</code> ， <code>type</code>  和 <code>click</code> ）的简单方法，使用对每个脚本块感觉同步的 API，而不是深层嵌套的回调。它最初设计用于在没有 API 的站点之间自动执行任务，但最常用于 UI 测试和爬网。</p>\n<p>它使用<span class=\"exturl\" data-url=\"aHR0cDovL2VsZWN0cm9uLmF0b20uaW8v\"> Electron</span>，它与<span class=\"exturl\" data-url=\"aHR0cDovL3BoYW50b21qcy5vcmcv\"> PhantomJS</span> 类似，但大约<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUvaXNzdWVzLzQ4NCNpc3N1ZWNvbW1lbnQtMTg0NTE5NTkx\">快两倍</span>，更现代。</p>\n<h3 id=\"安装与起步\"><a class=\"anchor\" href=\"#安装与起步\">#</a> 安装与起步</h3>\n<ol>\n<li>\n<p>安装 <code>nightmare</code></p>\n</li>\n<li>\n<pre><code>// 初始化项目\nnpm init -y\n\nnpm install --save-dev nightmare\n\n</code></pre>\n</li>\n</ol>\n<p>npm install --save-dev mocha</p>\n<pre><code>\n2. 淘宝源加速\n\n</code></pre>\n<p>// 使用淘宝源加速 electron 的安装<br />\n export ELECTRON_MIRROR=&quot;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ucG0udGFvYmFvLm9yZy9taXJyb3JzL2VsZWN0cm9uLw==\">https://npm.taobao.org/mirrors/electron/</span>&quot;</p>\n<pre><code>\n3. 起步测试：\n\n```js\nconst Nightmare = require('nightmare')\nconst assert = require('assert')\n\ndescribe('Load a Page', function () &#123;\n  // Recommended: 5s locally, 10s to remote server, 30s from airplane ¯\\_(ツ)_/¯\n  this.timeout('30s')\n\n  let nightmare = null\n  beforeEach(() =&gt; &#123;\n    nightmare = new Nightmare()\n  &#125;)\n\n  describe('/ (Home Page)', () =&gt; &#123;\n    it('should load without error', done =&gt; &#123;\n      // your actual testing urls will likely be `http://localhost:port/path`\n      nightmare.goto('https://www.baidu.com')\n        .end()\n        .then(function (result) &#123;\n          done()\n        &#125;)\n        .catch(done)\n    &#125;)\n  &#125;)\n&#125;)\n</code></pre>\n<h3 id=\"nightmare配合mocha测试\"><a class=\"anchor\" href=\"#nightmare配合mocha测试\">#</a> nightmare 配合 mocha 测试</h3>\n<p>nightmare 可以进行网页的抓取，配合 mocha 进行页面的测试：</p>\n<p>安装 <code>mocha</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev mocha</pre></td></tr></table></figure><blockquote>\n<p>还可以安装一些断言库，如： <code>chai</code></p>\n</blockquote>\n<p>新建测试：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> Nightmare <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'nightmare'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> assert <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'assert'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Search nightmare'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token string\">'30s'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token keyword\">let</span> nightmare <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    nightmare <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Nightmare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should load with result nightmare'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">done</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">const</span> selector <span class=\"token operator\">=</span> <span class=\"token string\">'em'</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    nightmare<span class=\"token punctuation\">.</span><span class=\"token function\">goto</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.baidu.com'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#kw'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'nightmare'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#su'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token string\">'em'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">evaluate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">selector</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token comment\">// now we're executing inside the browser scope.</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token keyword\">return</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>innerText</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> selector<span class=\"token punctuation\">)</span> <span class=\"token comment\">// &lt;-- that's how you pass parameters from Node scope to browser scope</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      assert<span class=\"token punctuation\">.</span><span class=\"token function\">equal</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> <span class=\"token string\">'nightmare'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>将 mocha 作为测试脚本添加到您的   <code>package.json</code> ：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mocha\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"api介绍\"><a class=\"anchor\" href=\"#api介绍\">#</a> API 介绍</h3>\n<h4 id=\"nightmare的配置项\"><a class=\"anchor\" href=\"#nightmare的配置项\">#</a> nightmare 的配置项</h4>\n<pre><code>waitTimeout (default: 30s)\ngotoTimeout (default: 30s)\nloadTimeout (default: infinite)\nexecutionTimeout (default: 30s)\npaths\nswitches\nelectronPath\ndock\nopenDevTools\ntypeInterval (default: 100ms)\npollInterval (default: 250ms)\nmaxAuthRetries (default: 3)\ncertificateSubjectName\n.engineVersions()\n.useragent(useragent)\n.authentication(user, password)\n.authentication(user, password)\n.halt(error, done)\n</code></pre>\n<p>配置链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUjbmlnaHRtYXJlb3B0aW9ucw==\">https://github.com/segmentio/nightmare#nightmareoptions</span></p>\n<h4 id=\"页面交互相关\"><a class=\"anchor\" href=\"#页面交互相关\">#</a> 页面交互相关</h4>\n<pre><code>.back()\n.forward()\n.refresh()\n.click(selector)\n.mousedown(selector)\n.mouseup(selector)\n.mouseover(selector)\n.mouseout(selector)\n.type(selector[, text])\n.insert(selector[, text])\n.check(selector)\n.uncheck(selector)\n.select(selector, option)\n.scrollTo(top, left)\n.viewport(width, height)\n.inject(type, file)\n.evaluate(fn[, arg1, arg2,...])\n.wait(ms)\n.wait(selector)\n.wait(fn[, arg1, arg2,...])\n.header(header, value)\n</code></pre>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUjaW50ZXJhY3Qtd2l0aC10aGUtcGFnZQ==\">配置参考链接</span></p>\n<h4 id=\"页面提取\"><a class=\"anchor\" href=\"#页面提取\">#</a> 页面提取</h4>\n<pre><code>.exists(selector)\n.visible(selector)\n.on(event, callback)\n.once(event, callback)\n.removeListener(event, callback)\n.screenshot([path][, clip])\n.html(path, saveType)\n.pdf(path, options)\n.title()\n.url()\n.path()\n</code></pre>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlZ21lbnRpby9uaWdodG1hcmUjZXh0cmFjdC1mcm9tLXRoZS1wYWdl\">配置参考链接</span></p>\n<h2 id=\"补充学习\"><a class=\"anchor\" href=\"#补充学习\">#</a> 补充学习</h2>\n<h3 id=\"补充资料\"><a class=\"anchor\" href=\"#补充资料\">#</a> 补充资料</h3>\n<h4 id=\"软件测试的分类\"><a class=\"anchor\" href=\"#软件测试的分类\">#</a> 软件测试的分类</h4>\n<p><strong>第一部分：软件测试的分类</strong></p>\n<ul>\n<li>\n<p>按测试执行阶段划分</p>\n<p>单元测试、集成测试、系统测试、验收测试（正式验收测试、Alpha 测试、Beta 测试）</p>\n</li>\n<li>\n<p>按测试技术划分</p>\n<p>白盒测试、黑盒测试、灰盒测试</p>\n</li>\n<li>\n<p>被测试对象是否运行划分</p>\n<p>动态测试、静态测试（文档检查、代码走查、界面检查）</p>\n</li>\n<li>\n<p>按不同的测试手段划分</p>\n<p>手工测试、自动化测试</p>\n</li>\n<li>\n<p>按测试包含的内容划分</p>\n<p>功能测试、界面测试、安全测试、兼容性测试、易用性测试、性能测试、压力测试、负载测试、恢复测试</p>\n</li>\n<li>\n<p>其他测试</p>\n<p>冒烟测试、回归测试、探索性测试 / 自由测试（测试思维）</p>\n</li>\n</ul>\n<p><strong>第二部分：接下来对软件测试分类进行一个说明</strong></p>\n<p><img data-src=\"../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-889a2848a1b2a8eeccae000be23c247a_hd.jpg\" alt=\"img\" /><img data-src=\"../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-889a2848a1b2a8eeccae000be23c247a_hd.jpg\" alt=\"img\" /></p>\n<p><img data-src=\"../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-f831b8041976b50aad7c2425aada44e2_hd-1561454378198.jpg\" alt=\"img\" /><img data-src=\"../../5-2%20%E9%A1%B9%E7%9B%AE%E8%B4%A8%E9%87%8F%E7%9B%91%E6%B5%8B/resource/assets/v2-f831b8041976b50aad7c2425aada44e2_hd.jpg\" alt=\"img\" /></p>\n<p><strong>第三部分：测试工具</strong></p>\n<p>SVN，Git——&gt; 版本控制管理工具</p>\n<p>禅道 ——&gt;Bug 管理工具</p>\n<p>Fiddler——&gt; 抓包，定位问题你</p>\n<p>postman，jmeter，soapui——&gt; 接口测试</p>\n<p>Loadrunner，Jmeter——&gt; 性能，压力测试</p>\n<h4 id=\"2019年javascript测试概览\"><a class=\"anchor\" href=\"#2019年javascript测试概览\">#</a> 2019 年 Javascript 测试概览</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tZWRpdW0uY29tL3dlbGxkb25lLXNvZnR3YXJlL2FuLW92ZXJ2aWV3LW9mLWphdmFzY3JpcHQtdGVzdGluZy1pbi0yMDE5LTI2NGUxOTUxNGQwYQ==\">https://medium.com/welldone-software/an-overview-of-javascript-testing-in-2019-264e19514d0a</span></p>\n<p>这是一篇非常好的国外的博文，同时也是 2018 年 Javascript 测试概览的作者。这里有 2018 年的译文：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zMjcwMjQyMQ==\">展望 2018 年 JavaScript Testing</span></p>\n<p>在文中很好介绍到了测试类型，并举了大量的例子，非常全面。</p>\n<h4 id=\"什么是tdd\"><a class=\"anchor\" href=\"#什么是tdd\">#</a> 什么是 TDD？</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uaW0vcG9zdC81YzNlNzM4NzZmYjlhMDQ5ZDM3ZjVkYjE=\">测试驱动开发（TDD）总结 —— 原理篇</span></p>\n<p>TDD （Test Driven Development） 在不同的圈子、不同的角色的认知中可能会有不同的理解，有人可能会理解成 ATDD（Acceptance Test Driven Development），也有人可能会理解成 UTDD（Unit Test Driven Development），为了避免产生歧义，<strong>文章涉及到 TDD 专指 UTDD（Unit Test Driven Development），即 「单元测试驱动开发」</strong>。</p>\n<p>TDD 的目标</p>\n<blockquote>\n<p>Kent Beck 在他的著作《Test-Driven Development》一书中提到：“<strong>代码简洁可用</strong>这句言简意赅的话，正是 TDD 所追求的目标”。</p>\n</blockquote>\n<p><strong>对于如何保证 “代码简洁可用” 可以使用分而治之的方法，先达到 “可用” 目标，再追求 “简洁” 目标。</strong></p>\n<p><strong>可用：</strong> 保证代码通过自动化测试。</p>\n<p><strong>代码简洁：</strong> 在不同阶段人们对简洁的理解程度也不一样，不过遵循的原则差不多，例如 OOD 的 SOLID 原则，Kent Beck 的 Simple Design 原则等。</p>\n<p>虽然有很多因素妨碍我们得到整洁的代码，甚至可用的代码，无需征求太多意见，只需要采用 TDD 的开发方式来驱动出简洁可用的代码。</p>\n<h4 id=\"karma的前世今生\"><a class=\"anchor\" href=\"#karma的前世今生\">#</a> Karma 的前世今生</h4>\n<p>2016 年的文章，由淘宝前端团队书写：<span class=\"exturl\" data-url=\"aHR0cDovL3Rhb2Jhb2ZlZC5vcmcvYmxvZy8yMDE2LzAxLzA4L2thcm1hLW9yaWdpbi8=\">http://taobaofed.org/blog/2016/01/08/karma-origin/</span></p>\n<p>通篇介绍了 karma 的工作原理及实现原理，非常有价值的文章。</p>\n<h3 id=\"ava框架的配置文件\"><a class=\"anchor\" href=\"#ava框架的配置文件\">#</a> ava 框架的配置文件</h3>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token property\">\"ava\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\t<span class=\"token property\">\"files\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\t\t<span class=\"token string\">\"test/**/*\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t\t<span class=\"token string\">\"!test/exclude-files-in-this-directory\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\t\t<span class=\"token string\">\"!**/exclude-files-with-this-name.*\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\t<span class=\"token property\">\"helpers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\t\t<span class=\"token string\">\"**/helpers/**/*\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token property\">\"sources\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t\t<span class=\"token string\">\"src/**/*\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token string\">\"*oo\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t<span class=\"token string\">\"!foo\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token property\">\"cache\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token property\">\"concurrency\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token property\">\"failFast\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t<span class=\"token property\">\"failWithoutAssertions\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t<span class=\"token property\">\"environmentVariables\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t\t<span class=\"token property\">\"MY_ENVIRONMENT_VARIABLE\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"some value\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\t<span class=\"token property\">\"tap\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t<span class=\"token property\">\"verbose\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t<span class=\"token property\">\"compileEnhancements\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token property\">\"require\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t<span class=\"token string\">\"@babel/register\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t<span class=\"token property\">\"babel\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t<span class=\"token property\">\"extensions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"js\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"jsx\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t<span class=\"token property\">\"testOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\t\t<span class=\"token property\">\"babelrc\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li><code>files</code> ：用于选择测试文件的 glob 模式数组。带有下划线前缀的文件将被忽略。默认情况下，仅选择具有 <code>js</code>  扩展名的文件，即使该模式与其他文件匹配。指定 <code>extensions</code>  并 <code>babel.extensions</code>  允许其他文件扩展名</li>\n<li><code>helpers</code> ：用于选择帮助文件的 glob 模式数组。这里匹配的文件永远不会被视为测试。默认情况下，仅选择具有 <code>js</code>  扩展名的文件，即使该模式与其他文件匹配。指定 <code>extensions</code>  并 <code>babel.extensions</code>  允许其他文件扩展名</li>\n<li><code>sources</code> ：一组 glob 模式，用于匹配文件，这些文件在更改时会导致重新运行测试（在监视模式下）。有关详细信息，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YS9ibG9iL21hc3Rlci9kb2NzL3JlY2lwZXMvd2F0Y2gtbW9kZS5tZCNzb3VyY2UtZmlsZXMtYW5kLXRlc3QtZmlsZXM=\">请参阅</span></li>\n<li><code>match</code> ：通常在 <code>package.json</code>  配置中没用，但等同于在 CLI 上指定 <code>--match</code></li>\n<li><code>cache</code> ：缓存编译的测试和帮助文件 <code>node_modules/.cache/ava</code> 。如果 <code>false</code> ，文件缓存在临时目录中</li>\n<li><code>failFast</code> ：一旦测试失败，停止运行进一步的测试</li>\n<li><code>failWithoutAssertions</code> ：如果设置成 <code>false</code> ，那么如果没有运行断言，则测试失败</li>\n<li><code>environmentVariables</code> ：指定要供测试使用的环境变量。此处定义的环境变量会覆盖其中的环境变量 <code>process.env</code></li>\n<li><code>tap</code> ：设置成  <code>true</code> ，启用 TAP 报告</li>\n<li><code>verbose</code> ：设置成  <code>true</code> ，启用详细输出</li>\n<li><code>snapshotDir</code> ：指定用于存储快照文件的固定位置。如果快照最终位于错误的位置，请使用此选项</li>\n<li><code>compileEnhancements</code> ：设置成  <code>false</code> ，禁用了 <a href=\"https://github.com/avajs/ava/blob/master/docs/03-assertions.md#enhanced-assertion-messages\"> <code>power-assert</code> </a>，否则有助于提供更具描述性的错误消息， 并检测 <code>t.throws()</code>  断言的不当使用</li>\n<li><code>extensions</code> ：未使用 AVA 的 Babel 预设进行预编译的测试文件的扩展名。请注意，文件仍然会被编译为启用 <code>power-assert</code>  和其他功能，因此您可能还需要设置 <code>compileEnhancements</code>  为 <code>false</code>  文件是否为有效的 JavaScript。设置此 <code>&quot;js&quot;</code>  值会覆盖默认值，因此请确保在列表中包含该扩展名，只要它不包含在内 <code>babel.extensions</code></li>\n<li><code>require</code> ：在运行测试之前需要额外的模块。工作进程中需要模块</li>\n<li><code>babel</code> ：测试文件特定的 Babel 选项。有关详细信息，请参阅<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YS9ibG9iL21hc3Rlci9kb2NzL3JlY2lwZXMvYmFiZWwubWQjY29uZmlndXJpbmctYmFiZWw=\"> Babel 配置</span></li>\n<li><code>babel.extensions</code> ：将使用 AVA 的 Babel 预设进行预编译的测试文件的扩展。设置此选项会覆盖默认 <code>&quot;js&quot;</code>  值，因此请确保在列表中包含该扩展名。</li>\n<li><code>timeout</code> ：AVA 中的超时行为与其他测试框架中的行为不同。AVA 在每次测试后重置计时器，如果在指定的超时内没有收到新的测试结果，则强制测试退出。这可用于处理停滞的测试。请参阅我们的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2F2YWpzL2F2YS9ibG9iL21hc3Rlci9kb2NzLzA3LXRlc3QtdGltZW91dHMubWQ=\">超时文档</span>以获取更多选</li>\n</ul>\n<p>请注意，在 CLI 上提供文件会覆盖该 <code>files</code>  选项。</p>\n<h2 id=\"参考资料\"><a class=\"anchor\" href=\"#参考资料\">#</a> 参考资料</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC80NzAwOTY2NA==\">使用 Jest 测试 JavaScript (Mock 篇)</span></li>\n</ul>\n",
            "tags": [
                "自动化测试",
                "自动化测试"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/03/02/%E8%BD%AF%E4%BB%B6%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "url": "https://dmqweb.cn/2024/03/02/%E8%BD%AF%E4%BB%B6%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/",
            "title": "设计模式",
            "date_published": "2024-03-02T00:24:04.000Z",
            "content_html": "<h1 id=\"设计模式\"><a class=\"anchor\" href=\"#设计模式\">#</a> 设计模式</h1>\n<h2 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h2>\n<p>有一些重要的设计原则在开篇和大家分享下，这些原则将贯通全文：</p>\n<ul>\n<li>\n<p>面向接口编程，而不是面向实现。这个很重要，也是优雅的、可扩展的代码的第一步，这就不需要多说了吧。</p>\n</li>\n<li>\n<p>职责单一原则。每个类都应该只有一个单一的功能，并且该功能应该由这个类完全封装起来。</p>\n</li>\n<li>\n<p>对修改关闭，对扩展开放。对修改关闭是说，我们辛辛苦苦加班写出来的代码，该实现的功能和该修复的 bug 都完成了，别人可不能说改就改；对扩展开放就比较好理解了，也就是说在我们写好的代码基础上，很容易实现扩展。</p>\n</li>\n</ul>\n<p>创建型模式比较简单，但是会比较没有意思，结构型和行为型比较有意思</p>\n<p>每个代理模式的代码都必须自己手动完成一遍。</p>\n<h2 id=\"创建型模式\"><a class=\"anchor\" href=\"#创建型模式\">#</a> 创建型模式</h2>\n<p>创建型模式的作用就是创建对象，说到创建一个对象，最熟悉的就是 new 一个对象，然后 set 相关属性。但是，在很多场景下，我们需要给客户端提供更加友好的创建对象的方式，尤其是那种我们定义了类，但是需要提供给其他开发者用的时候。</p>\n<p>工厂模式分为简单工厂模式，工厂模式，抽象工厂模式</p>\n<p>在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。<strong>本质就是使用工厂方法代替 new 操作。</strong></p>\n<h3 id=\"简单工厂模式\"><a class=\"anchor\" href=\"#简单工厂模式\">#</a> 简单工厂模式</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Food</span> <span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"兰州拉面\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token class-name\">Food</span> noodle <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LanZhouNoodle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"兰州拉面\"</span><span class=\"token operator\">+</span>noodle<span class=\"token operator\">+</span><span class=\"token string\">\"出锅啦\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">return</span> noodle<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"黄焖鸡\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token class-name\">Food</span> chicken <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HuangMenChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"黄焖鸡\"</span><span class=\"token operator\">+</span> chicken <span class=\"token operator\">+</span><span class=\"token string\">\"出锅啦\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">return</span> chicken<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"不知道你做的什么哦~\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>其中，LanZhouNoodle 和 HuangMenChicken 都继承自 Food。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Cook</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token class-name\">Food</span> food <span class=\"token operator\">=</span> <span class=\"token class-name\">FoodFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"黄焖鸡\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">FoodFactory</span><span class=\"token punctuation\">.</span><span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jaja\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>简单地说，<strong>简单工厂模式通常就是这样，一个工厂类 XxxFactory，里面有一个静态方法，根据我们不同的参数，返回不同的派生自同一个父类（或实现同一接口）的实例对象。</strong></p>\n<blockquote>\n<p>我们强调<strong>职责单一</strong>原则，一个类只提供一种功能，FoodFactory 的功能就是只要负责生产各种 Food。</p>\n</blockquote>\n<p>在此例中可以看出，Cook 类在使用 FoodFactory 时就不需要 new 任何一个对象，这就是简单工厂模式的好处，封装了 new 的部分，做到的代码易用性。</p>\n<h3 id=\"工厂模式\"><a class=\"anchor\" href=\"#工厂模式\">#</a> 工厂模式</h3>\n<p>简单工厂模式很简单，如果它能满足我们的需要，我觉得就不要折腾了。之所以需要引入工厂模式，是因为我们往往需要使用两个或两个以上的工厂。</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">FoodFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Food</span> <span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChineseFoodFactory</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FoodFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Food</span> <span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ChineseFoodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ChineseFoodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AmericanFoodFactory</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FoodFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Food</span> <span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AmericanFoodA</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"B\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AmericanFoodB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>其中，ChineseFoodA、ChineseFoodB、AmericanFoodA、AmericanFoodB 都派生自 Food。</p>\n<p>客户端调用：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">APP</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token comment\">// 先选择一个具体的工厂</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">FoodFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ChineseFoodFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">// 由第一步的工厂产生具体的对象，不同的工厂造出不一样的对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token class-name\">Food</span> food <span class=\"token operator\">=</span> factory<span class=\"token punctuation\">.</span><span class=\"token function\">makeFood</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>虽然都是调用 makeFood (&quot;A&quot;) 制作 A 类食物，但是，不同的工厂生产出来的完全不一样。</p>\n<p>第一步，我们需要选取合适的工厂，然后第二步基本上和简单工厂一样。</p>\n<p><strong>核心在于，我们需要在第一步选好我们需要的工厂</strong>。比如，我们有 LogFactory 接口，实现类有 FileLogFactory 和 KafkaLogFactory，分别对应将日志写入文件和写入 Kafka 中，显然，我们客户端第一步就需要决定到底要实例化 FileLogFactory 还是 KafkaLogFactory，这将决定之后的所有的操作。</p>\n<h3 id=\"抽象工厂模式\"><a class=\"anchor\" href=\"#抽象工厂模式\">#</a> 抽象工厂模式</h3>\n<p>当涉及到<strong>产品族</strong>的时候，就需要引入抽象工厂模式了。 一个经典的例子是造一台电脑 。</p>\n<p>当涉及到这种产品族的问题的时候，就需要抽象工厂模式来支持了。我们不再定义 CPU 工厂、主板工厂、硬盘工厂、显示屏工厂等等，我们直接定义电脑工厂，每个电脑工厂负责生产所有的设备，这样能保证肯定不存在兼容问题。</p>\n<p>当然，抽象工厂的问题也是显而易见的，比如我们要加个显示器，就需要修改所有的工厂，给所有的工厂都加上制造显示器的方法。这有点违反了<strong>对修改关闭，对扩展开放</strong>这个设计原则。</p>\n<p>本节要介绍的抽象工厂模式将考虑多等级产品的生产，将同一个具体工厂所生产的位于不同等级的一组产品称为一个产品族，图 1 所示的是海尔工厂和 TCL 工厂所生产的电视机与空调对应的关系图。</p>\n<p><img data-src=\"%E8%BD%AF%E4%BB%B6%E6%A8%A1%E5%BC%8F%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B8%AD%E7%9A%84%E5%9B%BE%E7%89%87/3-1Q1141559151S.gif\" alt=\"3-1Q1141559151S\" /></p>\n<p>抽象工厂（AbstractFactory）模式的定义：是一种为访问类提供一个创建一组相关或相互依赖对象的接口，且访问类无须指定所要产品的具体类就能得到同族的不同等级的产品的模式结构。</p>\n<p>抽象工厂模式是工厂方法模式的升级版本，工厂方法模式只生产一个等级的产品，而抽象工厂模式可生产多个等级的产品。</p>\n<p>使用抽象工厂模式一般要满足以下条件。</p>\n<ul>\n<li>系统中有多个产品族，每个具体工厂创建同一族但属于不同等级结构的产品。</li>\n<li>系统一次只可能消费其中某一族产品，即同族的产品一起使用。</li>\n</ul>\n<p>抽象工厂模式除了具有工厂方法模式的优点外，其他主要优点如下。</p>\n<ul>\n<li>可以在类的内部对产品族中相关联的多等级产品共同管理，而不必专门引入多个新的类来进行管理。</li>\n<li>当增加一个新的产品族时不需要修改原代码，满足开闭原则。</li>\n</ul>\n<p>其缺点是：当产品族中需要增加一个新的产品时，所有的工厂类都需要进行修改。</p>\n<h3 id=\"单例模式\"><a class=\"anchor\" href=\"#单例模式\">#</a> 单例模式</h3>\n<p>简单点说，就是一个应用程序中，某个类的实例对象只有一个，你没有办法去 new，因为构造器是被 private 修饰的，一般通过 getInstance () 的方法来获取它们的实例。</p>\n<p>getInstance () 的返回值是一个对象的引用，并不是一个新的实例，所以不要错误的理解成多个对象。</p>\n<p><strong>特点</strong></p>\n<ul>\n<li>类构造器私有</li>\n<li>持有自己类型的属性</li>\n<li>对外提供获取实例的静态方法</li>\n</ul>\n<p><strong>饿汉式写法</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">private</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>弊端：因为类加载的时候就会创建对象，所以有的时候还不需要使用对象，就会创建对象，造成内存的浪费；</p>\n<p><strong>饱汉模式最容易出错：</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 首先，也是先堵死 new Singleton () 这条路</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 和饿汉模式相比，这边不需要先实例化出来，注意这里的 volatile，它是必须的</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">volatile</span> <span class=\"token class-name\">Singleton</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// 加锁</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token comment\">// 这一次判断也是必须的，不然会有并发问题</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                    instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>双重检查，指的是两次检查 instance 是否为 null。</p>\n<p>volatile 在这里是需要的，希望能引起读者的关注。</p>\n<p>很多人不知道怎么写，直接就在 getInstance () 方法签名上加上 synchronized，这就不多说了，性能太差。</p>\n</blockquote>\n<p>嵌套类最经典，以后大家就用它吧：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 主要是使用了 嵌套类可以访问外部类的静态属性和静态方法 的特性</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Holder</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Singleton</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">Holder</span><span class=\"token punctuation\">.</span>instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p>注意，很多人都会把这个<strong>嵌套类</strong>说成是<strong>静态内部类</strong>，严格地说，内部类和嵌套类是不一样的，它们能访问的外部类权限也是不一样的。</p>\n</blockquote>\n<p>最后，我们说一下枚举，枚举很特殊，它在类加载的时候会初始化里面的所有的实例，而且 JVM 保证了它们不会再被实例化，所以它天生就是单例的。</p>\n<p><strong>TODO:</strong></p>\n<p>建造者模式</p>\n<p>原型模式</p>\n<h2 id=\"结构型模式\"><a class=\"anchor\" href=\"#结构型模式\">#</a> 结构型模式</h2>\n<p>前面创建型模式介绍了创建对象的一些设计模式，这节介绍的结构型模式旨在通过改变代码结构来达到解耦的目的，使得我们的代码容易维护和扩展。</p>\n<h3 id=\"代理模式\"><a class=\"anchor\" href=\"#代理模式\">#</a> 代理模式</h3>\n<p>第一个要介绍的代理模式是最常使用的模式之一了，用一个代理来隐藏具体实现类的实现细节，通常还用于在真实的实现的前后添加一部分逻辑。</p>\n<p>既然说是<strong>代理</strong>，那就要对客户端隐藏真实实现，由代理来负责客户端的所有请求。当然，代理只是个代理，它不会完成实际的业务逻辑，而是一层皮而已，但是对于客户端来说，它必须表现得就是客户端需要的真实实现。</p>\n<p>理解<strong>代理</strong>这个词，这个模式其实就简单了。 下面上代码理解。 代理接口：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 要有一个代理接口让实现类和代理实现类来实现。</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">FoodService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Food</span> <span class=\"token function\">makeChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>被代理的实现类：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FoodService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Food</span> <span class=\"token function\">makeChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">Food</span> f <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Chicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        f<span class=\"token punctuation\">.</span><span class=\"token function\">setChicken</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1kg\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        f<span class=\"token punctuation\">.</span><span class=\"token function\">setSpicy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1g\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        f<span class=\"token punctuation\">.</span><span class=\"token function\">setSalt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"3g\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"鸡肉加好佐料了\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">return</span> f<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>被代理实现类就只需要做自己该做的事情就好了，不需要管别的。</p>\n<p>代理实现类：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FoodServiceProxy</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">FoodService</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 内部一定要有一个真实的实现类，当然也可以通过构造方法注入</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">private</span> <span class=\"token class-name\">FoodService</span> foodService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FoodServiceImpl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token annotation punctuation\">@Override</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Food</span> <span class=\"token function\">makeChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"开始制作鸡肉\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// 如果我们定义这句为核心代码的话，那么，核心代码是真实实现类做的，</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 代理只是在核心代码前后做些 “无足轻重” 的事情</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token class-name\">Food</span> food <span class=\"token operator\">=</span> foodService<span class=\"token punctuation\">.</span><span class=\"token function\">makeChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"鸡肉制作完成啦，加点胡椒粉\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        food<span class=\"token punctuation\">.</span><span class=\"token function\">addCondiment</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pepper\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"上锅咯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> food<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>客户端调用，注意，我们要用代理来实例化接口：</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 这里用代理类来实例化</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">FoodService</span> foodService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FoodServiceProxy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>foodService<span class=\"token punctuation\">.</span><span class=\"token function\">makeChicken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>所谓代理模式，<strong>就是对被代理方法包装或者叫增强， 在面向切面编程（AOP）中，其实就是动态代理的过程。比如 Spring 中，我们自己不定义代理类，但是 Spring 会帮我们动态来定义代理，然后把我们定义在 @Before、@After、@Around 中的代码逻辑动态添加到代理中。</strong></p>\n<p>待续。。。</p>\n<h2 id=\"行为型模式\"><a class=\"anchor\" href=\"#行为型模式\">#</a> 行为型模式</h2>\n<h3 id=\"模板模式\"><a class=\"anchor\" href=\"#模板模式\">#</a> 模板模式</h3>\n<p>在含有继承结构的代码中，模板方法模式是非常常用的。</p>\n<p><strong>父类定义了骨架（调用哪些方法及顺序），某些特定方法由子类实现</strong></p>\n<p>模板方法只负责定义第一步应该要做什么，第二步应该做什么，第三步应该做什么，至于怎么做，由子类来实现。</p>\n<p>好处：代码复用，减少重复代码。除了子类要实现的特定方法，其他方法及方法调用顺序都在父类中预先写好</p>\n<p>缺点： 每一个不同的实现都需要一个子类来实现，导致类个数增加，使系统更加庞大</p>\n<p><strong>模板模式的关键点：</strong></p>\n<p>1、使用抽象类定义模板类，并在其中定义所有的基本方法、模板方法，钩子方法，不限数量，以实现功能逻辑为主。其中基本方法使用 final 修饰，其中要调用基本方法和钩子方法，基本方法和钩子方法可以使用 protected 修饰，表明可被子类修改。</p>\n<p>2、定义实现抽象类的子类，重写其中的模板方法，甚至钩子方法，完善具体的逻辑。</p>\n<p>使用场景：</p>\n<p>1、在多个子类中拥有相同的方法，而且逻辑相同时，可以将这些方法抽出来放到一个模板抽象类中。</p>\n<p>2、程序主框架相同，细节不同的情况下，也可以使用模板方法。</p>\n<h4 id=\"架构方法介绍\"><a class=\"anchor\" href=\"#架构方法介绍\">#</a> 架构方法介绍</h4>\n<p>模板方法使得子类可以在不改变算法结构的情况下，重新定义算法中的某些步骤。其主要分为两大类：模版方法和基本方法，而基本方法又分为：抽象方法（Abstract Method），具体方法（Concrete Method），钩子方法（Hook Method）。</p>\n<p>四种方法的基本定义（前提：在抽象类中定义）：</p>\n<p>（1）抽象方法：由抽象类声明，由具体子类实现，并以 abstract 关键字进行标识。</p>\n<p>（2）具体方法：由抽象类声明并且实现，子类并不实现或者做覆盖操作。其实质就是普遍适用的方法，不需要子类来实现。</p>\n<p>（3）钩子方法：由抽象类声明并且实现，子类也可以选择加以扩展。通常抽象类会给出一个空的钩子方法，也就是没有实现的扩展。<strong>它和具体方法在代码上没有区别，不过是一种意识的区别</strong>；而它和抽象方法有时候也是没有区别的，就是在子类都需要将其实现的时候。而不同的是抽象方法必须实现，而钩子方法可以不实现。也就是说钩子方法为你在实现某一个抽象类的时候提供了可选项，<strong>相当于预先提供了一个默认配置。</strong></p>\n<p>（4）模板方法：定义了一个方法，其中定义了整个逻辑的基本骨架。</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> abstract <span class=\"token keyword\">class</span> <span class=\"token class-name\">AbstractTemplate</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 这就是模板方法</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">templateMethod</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 这个是重点</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 可以作为钩子方法</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">// 这是具体方法</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        System<span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"init 抽象层已经实现，子类也可以选择覆写\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// 这是抽象方法，留给子类实现</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">protected</span> abstract <span class=\"token keyword\">void</span> <span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token comment\">// 这是钩子方法，可定义一个默认操作，或者为空</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "设计模式",
                "设计模式"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/02/03/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/",
            "url": "https://dmqweb.cn/2024/02/03/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E4%B8%8E%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2/",
            "title": "持续集成与持续部署",
            "date_published": "2024-02-03T06:04:09.000Z",
            "content_html": "<h1 id=\"5-4-持续集成与持续部署\"><a class=\"anchor\" href=\"#5-4-持续集成与持续部署\">#</a> 5-4 持续集成与持续部署</h1>\n<h2 id=\"课程介绍\"><a class=\"anchor\" href=\"#课程介绍\">#</a> 课程介绍</h2>\n<p>那些大厂们，天天 DevOps、持续集成的？到底在讲些什么？这堂课来给你揭开持续集成与持续部署的面纱！！没有什么难的，盘它！</p>\n<p><strong>传统的开发过程中的坑：</strong></p>\n<ul>\n<li>BUG 总是在最后才发现</li>\n<li>越到项目后期，加班越严重</li>\n<li>交付无法保障</li>\n<li>变更频繁导致效率低下</li>\n<li>无效的等待多，用户满足度低</li>\n</ul>\n<p><img data-src=\"./assets/1460000014924499.png\" alt=\"img\" /></p>\n<p><strong>你有没有想过 / 用过？当你哪一天...</strong></p>\n<ul>\n<li>不用为开发 / 测试环境不一致而苦恼</li>\n<li>不用麻烦运维人员帮忙调试环境</li>\n<li>不用手动进行测试，模拟环境中进行自测</li>\n<li>不用手动发布、部署，自动化实现发布部署</li>\n<li>不用管开发 / 测试环境，只用专注代码的开发？</li>\n</ul>\n<p><strong>持续集成解决了什么问题？</strong></p>\n<ul>\n<li>提高软件质量</li>\n<li>效率迭代</li>\n<li>便捷部署</li>\n<li>快速交付、便于管理</li>\n</ul>\n<p><strong>课程的主要内容：</strong></p>\n<ul>\n<li>\n<p>什么是 CI/CD</p>\n</li>\n<li>\n<p>介绍 CI/CD 流程</p>\n</li>\n<li>\n<p>前端项目：结合 CI/CD 流程，实现快速迭代</p>\n</li>\n<li>\n<p>Docker 的使用，Jenkins+gitlab+nodejs 自动化项目</p>\n</li>\n<li>\n<p>持续集成工具介绍：Jenkins、Travis CI、Circle CI</p>\n</li>\n</ul>\n<p><strong>环境准备：</strong></p>\n<ul>\n<li>Linux 服务器 (Centos 7.6/Ubuntu 16.04LTS)</li>\n<li>VSCode + 插件 Dockerfile</li>\n<li>注册 github 账号</li>\n</ul>\n<h2 id=\"持续集成\"><a class=\"anchor\" href=\"#持续集成\">#</a> 持续集成</h2>\n<h3 id=\"核心概念\"><a class=\"anchor\" href=\"#核心概念\">#</a> 核心概念</h3>\n<p><strong>集成，就是一些孤立的事物或元素通过某种方式集中在一起，产生联系，从而构成一个有机整体的过程</strong>。知识经济的社会，集成已经成了很重要的一个名词。各行各业基本都会用到集成。比如汽车行业，那么复杂的一台跑车愣是通过一大堆零件组装起来。对于这些传统行业，它们在研发成功以后，可以通过流水线的方法批量生产进行集成。而在软件行业中，集成并不是一个简单的 “搬箱子” 的过程。因为软件工业是一个知识生产活动，其内在逻辑非常复杂，需求又很难一次性确定，完成的产品与最初的设计往往相差很远。敏捷宣言中就有一条是说响应变化重于遵循计划。而且由于软件行业的迅猛发展，软件变的越来越复杂，单靠个人是根本无法完成。大型软件为了重用及解耦，往往还需要分成好几个模块，这样集成就成了软件开发中不可或缺的一部分。</p>\n<p>持续，不言而喻，就是指<strong>长期的对项目代码进行集成。</strong></p>\n<h4 id=\"持续集成-2\"><a class=\"anchor\" href=\"#持续集成-2\">#</a> 持续集成</h4>\n<p>持续集成（英文：Continuous Integration，简称 CI）</p>\n<p>在软件工程中，持续集成是指将所有开发者工作副本每天多次合并到主干的做法。</p>\n<blockquote>\n<p>Grady Booch 在 1991 年的 Booch method 中首次命名并提出了 CI 的概念，尽管在当时他并不主张每天多次集成。而 XP（Extreme programming，极限编程）采用了 CI 的概念，并提倡每天不止一次集成。</p>\n<p>在《持续集成》一书中，对持续集成的定义如下： <code>持续集成</code> 是一种软件开发实践。在持续集成中，团队成员频繁集成他们的工作成果，一般每人每天至少集成一次，也可以多次。每次集成会经过自动构建 (包括自动测试) 的检验，以尽快发现集成错误。自从在团队中引入这样的实践之后， <code>Martin Fowler</code>  发现这种方法可以显著减少集成引起的问题，并可以加快团队合作软件开发的速度。</p>\n</blockquote>\n<p><img data-src=\"./assets/c5c8e6f40c7c133e22402c00bb7e1a25_hd.jpg\" alt=\"img\" /></p>\n<p>持续集成强调开发人员提交了新代码之后，立刻进行构建、（单元）测试。根据测试结果，我们可以确定新代码和原有代码能否正确地集成在一起。</p>\n<p>对于一天需要集成多少次数，并没有一个明确的定义。一般就是按照自己项目的实际需要来设置一定的频率，少则可能几次，多则可能达几十次。可以设置按照代码的变更来触发集成，或者设置一个固定时间周期来集成，也可以手工点击集成的按钮来 “一键集成”。</p>\n<h4 id=\"持续交付\"><a class=\"anchor\" href=\"#持续交付\">#</a> 持续交付</h4>\n<p>持续交付（英文：Continuous Delivery，简称 CD）</p>\n<p>完成 CI 中构建及单元测试和集成测试的自动化流程后，持续交付可自动将已验证的代码发布到存储库。为了实现高效的持续交付流程，务必要确保 CI 已内置于开发管道。持续交付的目标是拥有一个可随时部署到生产环境的代码库。</p>\n<p><img data-src=\"./assets/db7198e3c39e4656e18efcb4bd1b20b1_hd.jpg\" alt=\"img\" /></p>\n<p>在持续交付中，每个阶段（从代码更改的合并，到生产就绪型构建版本的交付）都涉及测试自动化和代码发布自动化。在流程结束时，运维团队可以快速、轻松地将应用部署到生产环境中。</p>\n<p>比如，我们完成单元测试后，可以把代码部署到连接数据库的 Staging 环境中更多的测试。如果代码没有问题，可以继续 <code>手动</code> 部署到生产环境中。</p>\n<h4 id=\"持续部署\"><a class=\"anchor\" href=\"#持续部署\">#</a> 持续部署</h4>\n<p>持续部署（英文：Continuous Deployment，简称 CD）</p>\n<p>对于一个成熟的 CI/CD 管道来说，最后的阶段是持续部署。作为持续交付 —— 自动将生产就绪型构建版本发布到代码存储库 —— 的延伸，持续部署可以自动将应用发布到生产环境。由于在生产之前的管道阶段没有手动门控，因此持续部署在很大程度上都得依赖精心设计的测试自动化。</p>\n<p><img data-src=\"./assets/f96f19e4d567aad5006d841963a86e41_hd.jpg\" alt=\"img\" /></p>\n<p>实际上，持续部署意味着开发人员对应用的更改在编写后的几分钟内就能生效（假设它通过了自动化测试）。这更加便于持续接收和整合用户反馈。总而言之，所有这些 CI/CD 的关联步骤都有助于降低应用的部署风险，因此更便于以小件的方式（而非一次性）发布对应用的更改。不过，由于还需要编写自动化测试以适应 CI/CD 管道中的各种测试和发布阶段，因此前期投资还是会很大。</p>\n<p>持续部署则是在持续交付的基础上，把部署到生产环境的过程 <code>自动化</code> 。</p>\n<h3 id=\"持续集成组成要素\"><a class=\"anchor\" href=\"#持续集成组成要素\">#</a> 持续集成组成要素</h3>\n<p><strong>一个最小化的持续集成系统需要包含以下几个要素：</strong></p>\n<ol>\n<li>** 版本管理系统：** 项目的源代码需要托管到适合的版本管理系统中，一般我们使用 git 作为版本控制库，版本管理软件可以使用 github、 <code>gitlab</code> 、stash 等。</li>\n<li>** 构建脚本 &amp; 工具：** 每个项目都需要有构建脚本来实现对整个项目的自动化构建。比如 Java 的项目就可以使用 gradle 作为构建工具。通过构建工具实现对编译、静态扫描、运行测试、样式检查、打包、发布等活动串起来，可以通过命令行自动执行。</li>\n<li>**CI 服务器：**CI 服务器可以检测项目中的代码变动，并及时的通过构建机器运行构建脚本，并将集成结果通过某种方式反馈给团队成员。</li>\n</ol>\n<h3 id=\"应用场景\"><a class=\"anchor\" href=\"#应用场景\">#</a> 应用场景</h3>\n<ul>\n<li>\n<p>打包平台</p>\n<p>常见的打包，Java 应用（Gradle/Maven）、Nodejs 前端应用 (npm/yarn)</p>\n<p>移动端打包：Android/iOS</p>\n</li>\n<li>\n<p>测试平台</p>\n<p>接口测试</p>\n<p>自动化测试 Robotium、Testlink</p>\n<p>单元测试 junit</p>\n<p>性能测试 Jmeter</p>\n</li>\n<li>\n<p>自动部署</p>\n<p>FTP</p>\n<p>Shell</p>\n<p>Tomcat/Dokcer</p>\n<p>Kubernetes/Rancher/Cluster</p>\n</li>\n<li>\n<p>持续集成</p>\n<p>Git: gitlab github gitee 等</p>\n<p>Jenkins/TravisCi/CircleCI</p>\n<p>Docker</p>\n</li>\n</ul>\n<h3 id=\"工作流\"><a class=\"anchor\" href=\"#工作流\">#</a> 工作流</h3>\n<h4 id=\"传统的工作流\"><a class=\"anchor\" href=\"#传统的工作流\">#</a> 传统的工作流</h4>\n<p>参与人员：开发、项目经理、测试</p>\n<p>主要流程：</p>\n<ul>\n<li>项目一开始是先划分好模块， <code>分配模块</code> 给相应的开发人员；</li>\n<li>开发人员 <code>开发好</code> 一个模块就进行 <code>单元测试</code> ；</li>\n<li>等所有的模块都开发完成之后，由项目经理对 <code>所有代码进行集成</code> ；</li>\n<li>集成后的项目由项目经理 <code>部署到测试服务器</code> 上，被交由测试人员进行集成测试；</li>\n<li>测试过程中出现 Bug 就提把问题 <code>记录</code> 进行  <code>Bug</code>  列表中；</li>\n<li><code>项目经理分配 Bug</code>  给相应的责任人进行修改；</li>\n<li>修改完成后，项目经理 <code>再次</code> 对项目进行集成，并 <code>部署</code> 到测试服务器上；</li>\n<li>测试人员在下一次的集成测试中进行 <code>回归测试</code> ；</li>\n<li>通过通过之后就 <code>部署到生产环境</code> 中；</li>\n<li>如果测试不通过，则重复上述 “分配 Bug -&gt; 修改 Bug -&gt; 集成代码 -&gt; 部署到测试服务器上 -&gt; 集成测试” 工作。</li>\n</ul>\n<blockquote>\n<p>这也是传统的瀑布式开发模型，请参考：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vLU9ZSy9hcmNoaXZlLzIwMTIvMTAvMDgvMjcxNDY2OS5odG1s\">软件开发模式对比 (瀑布、迭代、螺旋、敏捷)</span></p>\n</blockquote>\n<p>带来的问题：</p>\n<ol>\n<li>\n<p><strong>重复性劳动，无效的等待变多</strong></p>\n<p>重复的进行发布部署。</p>\n<p>流程上：有可能开发在等集成其他人的模块；测试人员在等待开发人员修复 Bug；产品经理在等待新版本上线好给客户做演示；项目经理在等待其他人提交代码。不管怎么样，等待意味低效。</p>\n<p>自动化部署工作可以解放了集成、测试、部署等重复性劳动，而且机器集成的频率明显可以比手工的高很多。</p>\n</li>\n<li>\n<p><strong>很晚才发现缺陷，并且难以修复</strong>。</p>\n<p>实践证明，缺陷发现的越晚，需要修复的时间和精力也就越大。从上一个可工作的软件到发现缺陷之间可能存在很多次提交，而要从这些提交中找出问题并修复的成本会很大，因为开发人员需要回忆每个提交的上下文来评估影响点。</p>\n</li>\n<li>\n<p><strong>低品质的软件，软件交付时机无法保障</strong></p>\n<p>由于集成时每次包含的代码很多，所以大家的关注点主要都是如何保证编译通过、自动化测试通过，而往往很容易忽略代码是否遵守了编码规范、是否包含有重复代码、是否有重构的空间等问题。而这些问题又反过来会影响今后的开发和集成，久而久之集成变得越来越困难，软件的质量可想而知。</p>\n</li>\n<li>\n<p><strong>项目缺少可见性</strong></p>\n<p>某些项目，程序会经常需要变更，特别是敏捷开发的实践者。由于产品经理在与客户交流过程中，往往实际的软件就是最好的原型，所以软件会被当作原型作为跟客户交流的工具。当然，客户最希望的当然是客户的想法能够马上反映到原型上，这会导致程序会经常被修改的。那么也就意味着 “分配 Bug -&gt; 修改 Bug -&gt; 集成代码 -&gt; 部署到测试服务器上 -&gt; 集成测试” 工作无形又爆增了。</p>\n</li>\n</ol>\n<h4 id=\"常见的工作流\"><a class=\"anchor\" href=\"#常见的工作流\">#</a> 常见的工作流</h4>\n<p><img data-src=\"./assets/DevOps.png\" alt=\"DevOps\" /></p>\n<p>该系统的各个组成部分是按如下顺序来发挥作用的：</p>\n<ol>\n<li>\n<p>开发者检入代码到源代码仓库。</p>\n</li>\n<li>\n<p>CI 系统会为每一个项目创建了一个单独的工作区。当预设或请求一次新的构建时，它将把源代码仓库的源码存放到对应的工作区。</p>\n</li>\n<li>\n<p>CI 系统会在对应的工作区内执行构建过程。</p>\n</li>\n<li>\n<p>配置如果存在）构建完成后，CI 系统会在一个新的构件中执行定义的一套测试。完成后触发通知 (Email,RSS 等等) 给相关的当事人。</p>\n</li>\n<li>\n<p>配置如果存在）如果构建成功，这个构件会被打包并转移到一个部署目标 (如应用服务器) 或存储为软件仓库中的一个新版本。软件仓库可以是 CI 系统的一部分，也可以是一个外部的仓库，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1KYXZhLWs4NGZ1aTI0Y2U0ZzI1ZWs4bG96aWN6MGFlaGtibGZzMTdpZTd2Yi5uZXQ=\">诸如一个文件服务器或者像 Java.net</span>、SourceForge 之类的网站。</p>\n</li>\n<li>\n<p>CI 系统通常会根据请求发起相应的操作，诸如即时构建、生成报告，或者检索一些构建好的构件。</p>\n</li>\n</ol>\n<blockquote>\n<p>“You build it, you run it”，这是 Amazon 一年可以完成 5000 万次部署，平均每个工程师每天部署超过 50 次的核心秘籍。</p>\n</blockquote>\n<h4 id=\"解决的问题\"><a class=\"anchor\" href=\"#解决的问题\">#</a> 解决的问题</h4>\n<ul>\n<li>\n<p>高效率</p>\n<p>高效率的发布，避免了重复性的劳动；</p>\n<p>更快的修复 BUG，更快的交付成果，减少了等待时间。</p>\n</li>\n<li>\n<p>高质量</p>\n<p>只有在完成集成测试、系统测试后，才能得到可用的软件，整个过程中只有最后时刻才能拿到可运行软件。集成活动不一定在一个标准的构建机器上生成，而是在某个开发人员的机器上构建的，那么可能存在在其他机器上无法运行的问题。</p>\n<p>人与机器的一个最大的区别是，在重复性动作上，人容易犯错，而机器犯错的几率几乎为零。所以，当我们搭建完成集成服务器后，以后的事就交给集成服务器来打理吧。</p>\n</li>\n<li>\n<p>高产出</p>\n<p>快速开发和上市一个新产品，并快速取得预期的投资回报是每个企业孜孜以求的目标。</p>\n<p>便捷的部署 + 项目的可预期，使得团队的开发变成了一种开心的事情。</p>\n<p>持续集成可以让你在任何时间发布可以部署的软件。在外界看来，这是持续集成最明显的好处，对客户来说，可以部署的软件产品是最实际的资产。利用持续集成，你可以经常对源代码进行一些小改动，并将这些改动和其他代码进行集成。</p>\n</li>\n</ul>\n<h4 id=\"常见问题\"><a class=\"anchor\" href=\"#常见问题\">#</a> 常见问题</h4>\n<ol>\n<li>\n<p>思维转变后，新技术抵触</p>\n<ul>\n<li>无法接受新事物：不管怎么样，求稳心态的人还是多。总是有人认为老的技术代表稳定，新的事物往往会带来问题。</li>\n<li>认为手工集成也没有多少工作量：不是所有的人都参与到了整个持续集成的环节，所以没有办法认识到问题全貌。</li>\n</ul>\n<p><strong>针对这个问题，可以通过设置一定的持续集成技术培训、宣讲得到改观</strong></p>\n</li>\n<li>\n<p>管理层的抵触</p>\n<ul>\n<li>培训持续集成需要投入资金啊，没钱。</li>\n<li>持续集成服务器要增加软硬件成本啊，没钱。</li>\n<li>开发人员领了那么高的工资，多干活多加班应该啊。</li>\n</ul>\n<p><strong>针对这一点，可以从开发人员的成本和持续集成的投入（软硬件）的成本上两者做下估算。</strong></p>\n<blockquote>\n<p>硬件参考：</p>\n<p>Jenkins 主服务器一般 2C4G，slave 服务器根据生产需要进行选购。</p>\n<p>git 服务器一般 2C4G (10 人团队)</p>\n<p>Docker 服务器 8C32G (Rancher + harbor)</p>\n</blockquote>\n</li>\n<li>\n<p>生产环境的复杂</p>\n<ul>\n<li>比如部署的生成环境是在政务外网，无法从互联网直接访问等。</li>\n<li>构建效率低下，任务多</li>\n</ul>\n<p>目前，这个是最麻烦的，还在研究中。初步设想是让政务外网开辟一个白名单，给持续集成服务器设置一个单独的通道。只是思路，未验证。</p>\n</li>\n</ol>\n<h4 id=\"最佳实践\"><a class=\"anchor\" href=\"#最佳实践\">#</a> 最佳实践</h4>\n<p>实施持续集成的开发人员可以尽早并经常提交。这允许他们尽早发现冲突。并且，如果存在任何问题，则使用较小的提交可以更轻松地对代码进行故障排除。每天或甚至更频繁地提交软件对于持续集成是必要的，但还不够。</p>\n<p>要成功使用持续集成，团队必须：</p>\n<ul>\n<li>\n<p>使测试成为开发过程中不可或缺的一部分。应该在创建代码时编写测试。</p>\n<p>公司成功持续整合所需的最重要因素是严格的测试文化。为了将新代码自信地集成到主线中，团队需要确信代码是健全的。这是通过测试来实现的，这应该定期进行。工程师应该在开发每个功能时编写测试。</p>\n</li>\n<li>\n<p>确保测试环境反映生产一致。</p>\n<p>为了支持您严格的测试文化，测试环境必须反映生产环境。否则，您无法保证您正在测试的内容将在生产中起作用。这意味着测试环境应使用相同版本的数据库，Web 服务器配置，工件等。</p>\n</li>\n<li>\n<p>使用编码最佳实践，例如结对编程。</p>\n<p>软件开发的另一个最佳实践是在编码期间进行配对。对于更复杂的功能，团队在编写单行代码之前讨论体系结构方法。在将任何代码合并到生产环境之前，其他开发人员始终会检查代码。这有助于确保使用编码最佳实践，代码不会与其他开发人员正在处理的现有代码或代码冲突，并且新功能是可扩展的。</p>\n<blockquote>\n<p><strong>Pair programming</strong> is an <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQWdpbGVfc29mdHdhcmVfZGV2ZWxvcG1lbnQ=\">agile software development</span> technique in which two <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29tcHV0ZXJfcHJvZ3JhbW1lcg==\">programmers</span> work together at one workstation. One, the <em>driver</em>, writes <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU291cmNlX2NvZGU=\">code</span> while the other, the <em>observer</em> or <em>navigator</em>,[<span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUGFpcl9wcm9ncmFtbWluZyNjaXRlX25vdGUtMQ==\">1]</span> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29kZV9yZXZpZXc=\">reviews</span> each line of code as it is typed in. The two programmers switch roles frequently.</p>\n<p>While reviewing, the observer also considers the &quot;strategic&quot; direction of the work, coming up with ideas for improvements and likely future problems to address. This is intended to free the driver to focus all of their attention on the &quot;tactical&quot; aspects of completing the current task, using the observer as a safety net and guide.</p>\n</blockquote>\n</li>\n<li>\n<p>自动化部署工作流程。</p>\n<p>最后，为确保整个软件开发流程快速高效，构建需要快速，部署工作流程应自动化。代码构建的每一分钟都浪费了一分钟。通过自动化部署工作流程，团队可以更快地将完成的代码生成。因为，毕竟，如果没有接触到客户，那么快速开发软件有什么意义呢？</p>\n</li>\n</ul>\n<h3 id=\"效率工具对比\"><a class=\"anchor\" href=\"#效率工具对比\">#</a> 效率工具对比</h3>\n<p>![img](/Users/Shared/Target/5-4 持续集成与持续部署 /resource/assets/CICD-resource.png)</p>\n<p><a href=\"#%E5%A4%8D%E6%9D%82%E7%9A%84DevOps%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7\">点击查看</a>效率工具</p>\n<p><strong>1. Jenkins</strong></p>\n<blockquote>\n<p>Jenkins，原名 Hudson，2011 年改为现在的名字，它 是一个开源的实现持续集成的软件工具。官方网站：<span class=\"exturl\" data-url=\"aHR0cDovL2plbmtpbnMtY2kub3JnLw==\">http://jenkins-ci.org/</span>。</p>\n<p>Jenkins 能实时<strong>监控集成中存在的错误</strong>，提供<strong>详细的日志文件和提醒</strong>功能，还能用图表的形式形象地展示<strong>项目构建的趋势和稳定性</strong>。</p>\n</blockquote>\n<p><strong>Jenkins 特点:</strong></p>\n<ul>\n<li><strong>易安装</strong>：Jenkins 是一个独立的基于 Java 的程序，随时可以运行，包含 Windows，Mac OS X 和其他类 Unix 操作系统的软件包。仅仅一个 java -jar jenkins.war，从官网下载该文件后，直接运行，无需额外的安装，更无需安装数据库；</li>\n<li><strong>易配置</strong>：提供友好的 GUI 配置界面；</li>\n<li><strong>变更支持</strong>：Jenkins 能从代码仓库（Subversion/CVS）中获取并产生代码更新列表并输出到编译输出信息中；</li>\n<li><strong>支持永久链接</strong>：用户是通过 web 来访问 Jenkins 的，而这些 web 页面的链接地址都是永久链接地址，因此，你可以在各种文档中直接使用该链接；</li>\n<li>** 集成 E-Mail/RSS/IM：** 当完成一次集成时，可通过这些工具实时告诉你集成结果（据我所知，构建一次集成需要花费一定时间，有了这个功能，你就可以在等待结果过程中，干别的事情）；</li>\n<li><strong>JUnit/TestNG 测试报告</strong>：也就是用以图表等形式提供详细的测试报表功能；</li>\n<li><strong>支持分布式构建</strong>：Jenkins 可以把<strong>集成构建等工作分发到多台计算机中完成</strong>；</li>\n<li><strong>文件指纹信息</strong>：Jenkins 会保存哪次集成构建产生了哪些 jars 文件，哪一次集成构建使用了哪个版本的 jars 文件等构建记录；</li>\n<li><strong>支持第三方插件</strong>：使得 Jenkins 变得越来越强大；凭借更新中心中的数百个插件，Jenkins 几乎集成了持续集成和持续交付工具链中的所有工具。</li>\n<li><strong>Rest API</strong> - 可以访问控制您获取的数据量，获取 / 更新 config.xml，删除作业，检索所有构建，获取 / 更新作业说明，执行构建，禁用 / 启用作业</li>\n</ul>\n<p><strong>Jenkins 优点：</strong></p>\n<ul>\n<li>价格（免费）</li>\n<li>定制</li>\n<li>插件系统</li>\n<li>完全控制系统</li>\n</ul>\n<p><strong>Jenkins 缺点：</strong></p>\n<ul>\n<li>需要专用服务器（或多个服务器）。这导致额外的费用。对于服务器本身，DevOps 等...</li>\n<li>配置 / 定制所需的时间</li>\n</ul>\n<p><strong>2. Travis CI</strong></p>\n<p><strong>Travis CI</strong> 是一个托管的持续集成服务，用于构建和测试在 GitHub 上托管的软件项目。</p>\n<blockquote>\n<p><strong>Travis CI</strong> is a hosted continuous integration service used to build and test software projects hosted at GitHub</p>\n</blockquote>\n<p><strong>Travis CI 的特点：</strong></p>\n<ul>\n<li>\n<p>基于云：TravisCI 是一个<strong>基于云</strong>的系统 - 不需要专用服务器，您无需管理它。</p>\n</li>\n<li>\n<p>支持 Docker 运行测试</p>\n</li>\n<li>\n<p>使用 YAML 文件进行配置</p>\n</li>\n<li>\n<p>可选择 Linux 和 Mac OSX 上同时运行测试</p>\n</li>\n<li>\n<p>开箱即用的支持的语言</p>\n<p>Android，C，C＃，C ++，Clojure，Crystal，D，Dart，Erlang，Elixir，F＃，Go，Groovy，Haskell，Haxe，Java，JavaScript（使用 Node.js），Julia，Objective-C，Perl，Perl6， PHP，Python，R，Ruby，Rust，Scala，Smalltalk，Visual Basic</p>\n</li>\n<li>\n<p><strong>支持多环境构建矩阵</strong>：如 Python 2.7 , 3.4, 3.5 +  Django 1.8, 1.9, 1.10</p>\n<p>构建矩阵是一种工具，可以使用不同版本的语言和包运行测试。您可以以不同的方式自定义它。例如，某些环境的失败可以触发通知但不会使所有构建失败（这对包的开发版本有帮助）</p>\n</li>\n</ul>\n<p><strong>Travis CI 优点：</strong></p>\n<ul>\n<li>开箱即用构建矩阵</li>\n<li>快速启动</li>\n<li>轻量级 YAML 配置</li>\n<li>开源项目的免费计划</li>\n<li>无需专用服务器</li>\n</ul>\n<p><strong>Travis CI 缺点：</strong></p>\n<ul>\n<li>与 CircleCI 相比，价格更高，没有免费的企业计划</li>\n<li>定制（对于某些你需要第三方的东西）</li>\n</ul>\n<p><strong>3. Circle CI</strong></p>\n<p>在 GitHub 或 Bitbucket 上的软件存储库被授权并作为项目添加到<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaXJjbGVjaS5jb20v\"> circleci.com 之后</span>，每个代码更改都会在干净的容器或 VM 中触发自动化测试。</p>\n<p>CircleCI 在 2017 年被 Forrester 评为持续集成领导者，并被命名为多个最佳 DevOps 工具列表。CircleCI 成立于 2011 年，总部位于旧金山，拥有全球性的远程员工队伍，由 Scale Venture Partners，DFJ，Baseline Ventures，Top Tier Capital，Industry Ventures，Heavybit 和 Harrison Metal Capital 提供风险投资。</p>\n<p><strong>Circle CI 的特点：</strong></p>\n<ul>\n<li><strong>云 &amp; 本地化</strong>：CircleCI 是一个<strong>基于云</strong>的系统 - 不需要专用服务器，您无需管理它。 但是，它还<strong>提供了一个本地解决方案</strong>，允许您在私有云或数据中心中运行它。</li>\n<li><strong>商业 &amp; 免费</strong>：即使是商业帐户，它也<strong>有免费计划</strong></li>\n<li><strong>Rest API</strong> - 您可以访问项目，构建和工件（artifacts）。构建的结果将是工件或工件组。 工件可以是已编译的应用程序或可执行文件（例如，android APK）或元数据（例如，关于测试 ` 成功的信息）</li>\n<li><strong>按需安装</strong>：CircleCI 缓存<strong>必要的安装</strong>（requirements installation）。 它会检查第三方依赖项，而不是持续安装所需的环境</li>\n<li><strong>SSH 模式</strong>：您可以触发<strong> SSH 模式</strong>访问容器并进行自己的调查（如果出现任何问题）</li>\n<li><strong>最小化配置</strong>：这是一个完整的开箱即用解决方案，需要<strong>最少的配置 \\ 调整</strong></li>\n</ul>\n<p><strong>CircleCI 优点：</strong></p>\n<ul>\n<li>快速启动</li>\n<li>CircleCI 有一个免费的企业项目计划</li>\n<li>这很容易，也很快开始</li>\n<li>轻量级，易读的 YAML 配置</li>\n<li>您不需要任何专用服务器来运行 CircleCI</li>\n</ul>\n<p><strong>CircleCI 缺点：</strong></p>\n<ul>\n<li>\n<p>CircleCI 仅支持 2 个版本的 Ubuntu 免费（12.04 和 14.04）和 MacOS 作为付费部分</p>\n</li>\n<li>\n<p>尽管 CircleCI 可以使用并运行所有语言，但 tt 仅支持 “开箱即用” 的以下编程语言：Go（Golang），Haskell，Java，PHP，Python，Ruby / Rails，Scala</p>\n</li>\n<li>\n<p>如果您想进行自定义，可能会出现一些问题：您可能需要一些第三方软件来进行这些调整</p>\n</li>\n<li>\n<p>此外，虽然作为基于云的系统是一方的优势，它也可以停止支持任何软件，你将无法阻止</p>\n</li>\n</ul>\n<p>总结一下：</p>\n<table>\n<thead>\n<tr>\n<th>分类</th>\n<th>Jenkins</th>\n<th>Travis CI</th>\n<th>Circle CI</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>本地部署</td>\n<td>支持</td>\n<td>不支持</td>\n<td>支持</td>\n</tr>\n<tr>\n<td>REST API</td>\n<td>支持</td>\n<td>支持</td>\n<td>支持</td>\n</tr>\n<tr>\n<td>配置</td>\n<td>复杂，高度可配置</td>\n<td>YAML 文件</td>\n<td>YAML 文件</td>\n</tr>\n<tr>\n<td>按需安装</td>\n<td>是</td>\n<td>否</td>\n<td>是</td>\n</tr>\n<tr>\n<td>跨平台支持</td>\n<td>是</td>\n<td>Linux + MacOS</td>\n<td>Linux + MacOS (付费)</td>\n</tr>\n<tr>\n<td>多服务器</td>\n<td>是</td>\n<td>按需</td>\n<td>否</td>\n</tr>\n<tr>\n<td>快速构建</td>\n<td>手动配置复杂</td>\n<td>快 (需要写配置文件)</td>\n<td>最快</td>\n</tr>\n<tr>\n<td>基本环境</td>\n<td>Java</td>\n<td>云环境</td>\n<td>云环境</td>\n</tr>\n<tr>\n<td>费用</td>\n<td>免费</td>\n<td>特定免费 (69$/c)</td>\n<td>特定免费 (50$/c)</td>\n</tr>\n</tbody>\n</table>\n<p>Travis CI 的价格（非常感人）：</p>\n<p><img data-src=\"./assets/image-20190611100501785.png\" alt=\"/images/image-20190611100501785\" /></p>\n<p>CirCle CI 的价格：</p>\n<p><img data-src=\"./assets/image-20190611100534676.png\" alt=\"/images/image-20190611100534676\" /></p>\n<p>其他的一些持续集成的工具：CruiseControl，TeamCity，Continuum 等</p>\n<ul>\n<li>AnthillPro：商业的构建管理服务器，提供 C 功能</li>\n<li>Bamboo：商业的 CI 服务器，对于开源项目免费</li>\n<li>Build Forge：多功能商业构建管理工具，特点：高性能、分布式构建</li>\n<li>Cruise Control：基于 java 实现的持续集成构建工具</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL0NydWlzZUNvbnRyb2wuTkVU\">CruiseControl.NET</span>：基于 C# 实现的持续集成构建工具</li>\n<li>Lunt build：开源的自动化构建工具</li>\n<li>Para Build：商业的自动化软件构建管理服务器</li>\n</ul>\n<h2 id=\"jenkins\"><a class=\"anchor\" href=\"#jenkins\">#</a> Jenkins</h2>\n<h3 id=\"使用简介\"><a class=\"anchor\" href=\"#使用简介\">#</a> 使用简介</h3>\n<p>Jenkins 是开源 CI&amp;CD 软件领导者， 提供超过 1000 个插件来支持构建、部署、自动化， 满足任何项目的需要。</p>\n<p><img data-src=\"./assets/image-20190611103941326.png\" alt=\"/images/image-20190611103941326\" /></p>\n<p>相关概念：</p>\n<ul>\n<li>\n<p>流水线：<strong>Jenkins Pipeline</strong>（或简称为 &quot;Pipeline&quot;）是一套插件，将持续交付的实现和实施集成到 Jenkins 中。</p>\n<p>Jenkins Pipeline 提供了一套可扩展的工具，用于将 “简单到复杂” 的交付流程实现为 “持续交付即代码”。Jenkins Pipeline 的定义通常被写入到一个文本文件（称为  <code>Jenkinsfile</code>  ）中，该文件可以被放入项目的源代码控制库中。</p>\n</li>\n<li>\n<p>节点：节点是一个机器，主要用于执行 jenkins 任务</p>\n</li>\n<li>\n<p>阶段：定义不同的执行任务，比如：构建、测试、发布 (部署)</p>\n</li>\n<li>\n<p>步骤：相当于告诉 Jenkins 现在要做些什么，比如 shell 命令。</p>\n</li>\n</ul>\n<p><img data-src=\"./assets/image-20190611163108298.png\" alt=\"/images/image-20190611163108298\" /></p>\n<p>Jenkins 的界面</p>\n<p><img data-src=\"./assets/image-20190611163727975.png\" alt=\"/images/image-20190611163727975\" /></p>\n<p>任务详情页面</p>\n<p><img data-src=\"./assets/image-20190611163855257.png\" alt=\"/images/image-20190611163855257\" /></p>\n<p>Jenkins 任务日志</p>\n<h3 id=\"安装方式\"><a class=\"anchor\" href=\"#安装方式\">#</a> 安装方式</h3>\n<ol>\n<li>\n<p>环境要求</p>\n<ul>\n<li>机器要求：\n<ul>\n<li>256 MB 内存，建议大于 512 MB</li>\n<li>10 GB 的硬盘空间（用于 Jenkins 和 Docker 镜像）</li>\n</ul>\n</li>\n<li>需要安装以下软件：\n<ul>\n<li>Java 8 (JRE 或者 JDK 都可以)</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS8=\">Docker</span> （导航到网站顶部的 Get Docker 链接以访问适合您平台的 Docker 下载）</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>常规安装</p>\n<ul>\n<li>\n<p>安装 JDK</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3JhY2xlLmNvbS90ZWNobmV0d29yay9qYXZhL2phdmFzZS9kb3dubG9hZHMvamRrOC1kb3dubG9hZHMtMjEzMzE1MS5odG1s\">官方地址</span></p>\n<p>下载对应的操作系统的 JDK，然后解压进行安装。以 Linux 为例：</p>\n<p>下载最新版本，上传到 Linux 服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 上传到 /opt/jdk8 目录下</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># tar 解压 JDK 安装包</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /opt/jdk8</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">tar</span> zxvf jdk-8u211-linux-x64.tar.gz <span class=\"token parameter variable\">-C</span> /opt/jdk8 --strip-components <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># vi /etc/profile</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JAVA_HOME</span><span class=\"token operator\">=</span>/opt/jdk8</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">JRE_HOME</span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;JAVA_HOME&#125;</span>/jre</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CLASSPATH</span><span class=\"token operator\">=</span>.:<span class=\"token variable\">$&#123;JAVA_HOME&#125;</span>/lib:<span class=\"token variable\">$&#123;JRE_HOME&#125;</span>/lib</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;JAVA_HOME&#125;</span>/bin:<span class=\"token environment constant\">$PATH</span></pre></td></tr></table></figure></li>\n<li>\n<p>安装 Jenkins</p>\n<p>下载 Jenkins 最新的 war 包：<span class=\"exturl\" data-url=\"aHR0cDovL21pcnJvcnMuamVua2lucy5pby93YXItc3RhYmxlL2xhdGVzdC9qZW5raW5zLndhcg==\">Latest</span></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /opt/jenkins <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> /opt/jenkins</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">wget</span> <span class=\"token parameter variable\">-O</span> /opt/jenkins/jenkins.war http://mirrors.jenkins.io/war-stable/latest/jenkins.war</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> jenkins.war <span class=\"token parameter variable\">--httpPort</span><span class=\"token operator\">=</span><span class=\"token number\">8080</span></pre></td></tr></table></figure><p>就嗯可以打开，http://localhost:8080 了</p>\n<p>注意一段这样的话：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>*************************************************************</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>*************************************************************</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>*************************************************************</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Jenkins initial setup is required. An admin user has been created and a password generated.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Please use the following password to proceed to installation:</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>63196690ae7d47c49506480ee0e1af4a</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>This may also be found at: /root/.jenkins/secrets/initialAdminPassword</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>*************************************************************</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*************************************************************</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>*************************************************************</pre></td></tr></table></figure><p>这里的 <code>63196690ae7d47c49506480ee0e1af4a</code>  就是初始的安装的管理员密码。</p>\n</li>\n</ul>\n</li>\n<li>\n<p>使用 Docker 安装</p>\n<ul>\n<li>\n<p>安装 Docker</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># From https://get.docker.com:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://get.docker.com <span class=\"token parameter variable\">-o</span> get-docker.sh</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sh</span> get-docker.sh</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#From https://test.docker.com:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://test.docker.com <span class=\"token parameter variable\">-o</span> test-docker.sh</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">sh</span> test-docker.sh</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># From the source repo (This will install latest from the test channel):</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">sh</span> install.sh</pre></td></tr></table></figure></li>\n<li>\n<p>配置 Docker 镜像加速，使用阿里云<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jci5jb25zb2xlLmFsaXl1bi5jb20vP3NwbT1hMmM0ZS4xMTE1Mzk0MC5ibG9nY29udDI5OTQxLjkuNTIwMjdlMjl3Mmp2OVA=\">容器加速服务</span></p>\n<p>左侧的加速器帮助页面就会显示为你独立分配的加速地址</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>例如：</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>公网Mirror：<span class=\"token punctuation\">[</span>系统分配前缀<span class=\"token punctuation\">]</span>.mirror.aliyuncs.com</pre></td></tr></table></figure><p>使用配置文件  <code>/etc/docker/daemon.json</code> （没有时新建该文件）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">\"registry-mirrors\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;your accelerate address>\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>重启 Docker Daemon 就可以了</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl restart <span class=\"token function\">docker</span></pre></td></tr></table></figure><p><code>docker ps</code>  查看容器运行状态</p>\n<p><code>docker logs 容器ID/容器名称</code>  查看管理员初始密码</p>\n</li>\n<li>\n<p>安装 Docker-compose.yml 文件 (可选)</p>\n<p><strong>安装方法：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#下载</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> https://github.com/docker/compose/releases/download/1.20.0/docker-compose-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-s</span><span class=\"token variable\">`</span></span>-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-m</span><span class=\"token variable\">`</span></span> <span class=\"token parameter variable\">-o</span> /usr/local/bin/docker-compose</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#安装</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">chmod</span> +x /usr/local/bin/docker-compose</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#查看版本</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">docker-compose</span> <span class=\"token parameter variable\">--version</span></pre></td></tr></table></figure></li>\n<li>\n<p>安装 Jenkins</p>\n<p><strong>版本选择：</strong></p>\n<p>Jenkins: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9yL2plbmtpbnMvamVua2lucy8=\">https://hub.docker.com/r/jenkins/jenkins/</span></p>\n<p>Jenkins with Blue Ocean: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9yL2plbmtpbnNjaS9ibHVlb2NlYW4=\">https://hub.docker.com/r/jenkinsci/blueocean</span></p>\n<blockquote>\n<p>Blue Ocean 重新思考 Jenkins 的用户体验，从头开始设计<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qZW5raW5zLmlvL3poL2RvYy9ib29rL3BpcGVsaW5lLw==\"> Jenkins Pipeline</span>, 但仍然与自由式作业兼容，Blue Ocean 减少了混乱而且进一步明确了团队中每个成员 Blue Ocean 的主要特性包括：</p>\n<ul>\n<li>持续交付 (CD) Pipeline 的 <strong>复杂可视化</strong> ，可以让您快速直观地理解管道状态。</li>\n<li><strong>Pipeline 编辑器</strong> - 引导用户通过直观的、可视化的过程来创建 Pipeline，从而使 Pipeline 的创建变得平易近人。</li>\n<li><strong>个性化</strong> 以适应团队中每个成员不同角色的需求。</li>\n<li>在需要干预和 / 或出现问题时 <strong>精确定位</strong> 。 Blue Ocean 展示 Pipeline 中需要关注的地方， 简化异常处理，提高生产力</li>\n<li><strong>本地集成分支和合并请求</strong>，在与 GitHub 和 Bitbucket 中的其他人协作编码时实现最大程度的开发人员生产力。****</li>\n</ul>\n</blockquote>\n<p><strong>安装命令：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Jenkins</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token parameter variable\">-itd</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token parameter variable\">-u</span> root <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8080</span>:8080 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> jenkins-data:/var/jenkins_home <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /usr/bin/docker:/usr/bin/docker <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token parameter variable\">--name</span> jenkins-master <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  jenkins/jenkins</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># Jenkins blueocean</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token parameter variable\">-itd</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token parameter variable\">-u</span> root <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8080</span>:8080 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> jenkins-data:/var/jenkins_home <span class=\"token punctuation\">\\</span> </pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token parameter variable\">-v</span> /usr/bin/docker:/usr/bin/docker <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token parameter variable\">--name</span> jenkins-master <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  jenkinsci/blueocean</pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>\n<p>配置 Jenkins 插件加速</p>\n<p>进入 jenkins 系统管理 -&gt; 插件管理中 -&gt; 高级选项卡 -&gt; 升级站点，使用清华源：</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/current/update-center.json</pre></td></tr></table></figure><p><img data-src=\"./assets/70.png\" alt=\"ç³»ç»ç®¡ç\" /></p>\n<p><img data-src=\"./assets/70-20190611152837311.png\" alt=\"æä»¶ç®¡ç\" /></p>\n<p>关于官方所有的镜像列表：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL21pcnJvcnMuamVua2lucy1jaS5vcmcvc3RhdHVzLmh0bWw=\">http://mirrors.jenkins-ci.org/status.html</span></p>\n</li>\n<li>\n<p>环境配置</p>\n<ul>\n<li>Jenkins 的 URL 路径</li>\n<li>全局工具的配置：Docker, JDK (JAVA)...</li>\n</ul>\n</li>\n<li>\n<p>用户权限配置</p>\n<ul>\n<li>矩阵权限的配置</li>\n<li>添加管理员用户所有的权限</li>\n<li>添加<span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLmplbmtpbnMtY2kub3JnL2Rpc3BsYXkvSkVOS0lOUy9BdXRob3JpemUrUHJvamVjdCtwbHVnaW4=\"> Authorize Project</span> 插件，并且在系统管理中进行配置。配置逻辑，就给用户当前项目的矩阵权限！</li>\n</ul>\n</li>\n<li>\n<p>与 gitlab 进行联接</p>\n<ul>\n<li>设置一个 SSH Key，方便 Jenkins 去拉取 Gitlab 中的项目</li>\n<li>GItlab 项目中去配置 SSH Key 的 Deploy 权限。 <code>Settings -&gt; Repository -&gt; Deploy keys -&gt; Public Deploy Keys</code></li>\n<li>Jenkins 添加 SSH 的私钥</li>\n</ul>\n<p>这样就完成了 Jenkins 可以访问 gitlab 的联接的过程。</p>\n<p>Jenkins 层面，需要去安装 Gitlab 相关插件。</p>\n</li>\n</ol>\n<h3 id=\"插件介绍\"><a class=\"anchor\" href=\"#插件介绍\">#</a> 插件介绍</h3>\n<ul>\n<li>\n<p>Publish over SSH</p>\n<p>这个是一个远程 Shell 工具，可以远程去执行一些 shell 命令</p>\n</li>\n<li>\n<p>HTTP Request Plugin</p>\n<p>跨平台调用，在构建前后可以通过该插件以 http 形式调用各种 api 接口实现和内部系统的联动</p>\n</li>\n<li>\n<p>Publish Over FTP</p>\n<p>用于远程使用 FTP 发布，比较合适于静态资源的发布。</p>\n<p><img data-src=\"./assets/20181225153134962.jpeg\" alt=\"img\" /></p>\n</li>\n<li>\n<p>Performance Plugin</p>\n</li>\n</ul>\n<p>​        该插件可以读取和解析测试框架输出的报告，并且在 Jenkins 上绘制性能和稳定性相关的图表。Performance Plugin 支持的测试框架有 JUnit、JMeter, Twitter 的 Lago 和 Taurus。下图是该插件输出的示例图：</p>\n<p><img data-src=\"./assets/3dee2f58ccdf7cf25fa86074c5485184a9f.jpg\" alt=\"img\" /></p>\n<p>​        <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wbHVnaW5zLmplbmtpbnMuaW8vcGVyZm9ybWFuY2U=\">https://plugins.jenkins.io/performance</span></p>\n<ul>\n<li>Gitlab Merge Request Builder Plugin</li>\n</ul>\n<p>​        Gitlab Merge Request Builder Plugin 可以方便的自动发起代码审查，它在创建 pull request 的时候，会自动带上关联任务的运行结果，以方便代码审查着确认改动的正确性。</p>\n<p>​        同时，这款插件还支持自动合并，既在代码审查通过后自动合并该 pull request 内容。</p>\n<p>​        <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RpbW9scy9qZW5raW5zLWdpdGxhYi1tZXJnZS1yZXF1ZXN0LWJ1aWxkZXItcGx1Z2lu\">https://github.com/timols/jenkins-gitlab-merge-request-builder-plugin</span></p>\n<ul>\n<li>JIRA Plugin</li>\n</ul>\n<p>​        JIRA Plugin 可以让 Jenkins 任务和 JIRA 集成起来，这样项目管理者可以通过 JIRA 了解项目进度，开发者也可以通过该插件直接更改 JIRA 上的 issue 状态。</p>\n<p>​        <span class=\"exturl\" data-url=\"aHR0cHM6Ly9wbHVnaW5zLmplbmtpbnMuaW8vamlyYQ==\">https://plugins.jenkins.io/jira</span></p>\n<ul>\n<li>Kubernetes Plugin</li>\n</ul>\n<p>​        和最近大热的容器编排框架 Kubernetes 集成当然不能落下了。另外，Jenkins 对执行机的管理一直比较弱，无法做到快速的扩容和缩容。Kubernetes Plugin 通过引入 Kubernetes 的容器编排能力，让 Jenkins 执行机运行在 Kubernetes 环境中。</p>\n<p>​        <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2plbmtpbnNjaS9rdWJlcm5ldGVzLXBsdWdpbg==\">https://github.com/jenkinsci/kubernetes-plugin</span></p>\n<ul>\n<li>Build Pipeline plugin</li>\n</ul>\n<p>​        对一个系统的持续集成会包含很多个方面，如果将它们都杂糅在一个 Jenkins 任务中，会提高排查成本，也不利于整个持续集成的运作。Build Pipeline plugin 可以让项目管理员针对系统持续集成步骤设置一系列关联的任务，任务之间可以设置不同的触发条件，以确认何时需要人工介入。该插件可以让整个持续集成流程变得非常直观：</p>\n<p><img data-src=\"https://oscimg.oschina.net/oscnet/abf7ec185c847b72cd61181562f940557a2.jpg\" alt=\"img\" /></p>\n<p>​        <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2plbmtpbnNjaS9idWlsZC1waXBlbGluZS1wbHVnaW4=\">https://github.com/jenkinsci/build-pipeline-plugin</span></p>\n<h3 id=\"配置自动化任务\"><a class=\"anchor\" href=\"#配置自动化任务\">#</a> 配置自动化任务</h3>\n<p>两种执行方法：</p>\n<ol>\n<li>配置自由风格的项目</li>\n<li>配置 Pipeline 使用 Jenkinsfile</li>\n</ol>\n<p>需要注意的地方</p>\n<ul>\n<li>\n<p>SSH 插件：</p>\n<p>SSH</p>\n<p>SSH Agent</p>\n<p>SSH Pipeline Steps</p>\n<p>Publish Over SSH</p>\n</li>\n<li>\n<p>git 相关插件：</p>\n<p>Gitlab</p>\n<p>Github</p>\n</li>\n<li>\n<p>管理员界面配置：</p>\n<p><code>Settings -&gt; network -&gt; Outbound requests</code></p>\n<p>Allow requests to the local network from hooks and services 进行勾选</p>\n</li>\n</ul>\n<p>其他的一些用法：</p>\n<ul>\n<li>使用 Jenkins 配合 Docker Hub，把前端代码打包成镜像，再远程部署</li>\n<li>Jenkins 配合自建 Docker 容器服务，把前端代码打包，使用 Kubernetes 进行发布。</li>\n<li>使用 Docker 进行远程发布 (远程服务器上有 Docker 服务，并且设置了远程连接)</li>\n</ul>\n<h2 id=\"travisci\"><a class=\"anchor\" href=\"#travisci\">#</a> TravisCI</h2>\n<h3 id=\"使用简介-2\"><a class=\"anchor\" href=\"#使用简介-2\">#</a> 使用简介</h3>\n<p>Travis CI 只支持 Github，不支持其他代码托管服务。这意味着，你必须满足以下条件，才能使用 Travis CI。</p>\n<blockquote>\n<ul>\n<li>拥有 GitHub 帐号</li>\n<li>该帐号下面有一个项目</li>\n<li>该项目里面有可运行的代码</li>\n<li>该项目还包含构建或测试脚本</li>\n</ul>\n</blockquote>\n<p>Travis 简单的使用步骤:</p>\n<ul>\n<li>github 授权及面板</li>\n<li>获取 github 的 Tokens</li>\n<li>配置项目.travis.yml\n<ul>\n<li>Node 项目</li>\n<li>Script 脚本</li>\n<li>部署到 github pages</li>\n<li>钩子用法</li>\n</ul>\n</li>\n<li>其他</li>\n</ul>\n<p><strong>github 授权及面板</strong></p>\n<p>首先，访问官方网站 <span class=\"exturl\" data-url=\"aHR0cHM6Ly90cmF2aXMtY2kub3JnLw==\">travis-ci.org</span>，点击右上角的个人头像，使用 Github 账户登入 Travis CI。</p>\n<p>会进入到授权页面，这里跟微博、QQ 是一回事，主要是读取你的用户信息。</p>\n<p><img data-src=\"./assets/image-20190612205411602.png\" alt=\"/images/image-20190612205411602\" /></p>\n<p>这里第二步在， <code>Dashboard</code>  这个选项卡中，点击 <code>Activate</code>  这个按钮</p>\n<p><img data-src=\"./assets/image-20190612212459194.png\" alt=\"/images/image-20190612212459194\" /></p>\n<p>完了之后，Dashboard 会列出所有 Github 中有 <code>.travis.yml</code>  配置文件的仓库：</p>\n<p><img data-src=\"./assets/image-20190612212731186.png\" alt=\"/images/image-20190612212731186\" /></p>\n<p>Travis 会列出 Github 上面你的所有仓库，以及你所属于的组织。此时，选择你需要 Travis 帮你构建的仓库，打开仓库旁边的开关。一旦激活了一个仓库，Travis 会监听这个仓库的所有变化。</p>\n<p><img data-src=\"./assets/image-20190612213022380.png\" alt=\"/images/image-20190612213022380\" /></p>\n<ul>\n<li>\n<p><code>Settings</code>  中用于配置项目的构建条件</p>\n<p><img data-src=\"./assets/image-20190612214434173.png\" alt=\"/images/image-20190612214434173\" /></p>\n</li>\n<li>\n<p><code>Requests</code>  可以查看构建记录</p>\n<p><img data-src=\"./assets/image-20190612214519926.png\" alt=\"/images/image-20190612214519926\" /></p>\n</li>\n<li>\n<p><code>Caches</code>  主要是缓存文件</p>\n</li>\n<li>\n<p><code>Trigger build</code>  手动触发构建</p>\n</li>\n</ul>\n<p><strong>获取 github 的 token</strong></p>\n<p>在 settings-&gt;Developer settings-&gt;Personal access tokens-&gt;Generate new token</p>\n<p><img data-src=\"./assets/image-20190612225000955.png\" alt=\"/images/image-20190612225000955\" /></p>\n<p><strong>配置项目的.travis.yml 文件</strong></p>\n<ul>\n<li>\n<p>设置项目语言</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">language</span><span class=\"token punctuation\">:</span> node_js</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">node_js</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10\"</span></pre></td></tr></table></figure></li>\n<li>\n<p>Script 脚本</p>\n<p>Travis 的运行流程很简单，任何项目都会经过两个阶段。</p>\n<blockquote>\n<ul>\n<li>install 阶段：安装依赖</li>\n<li>script 阶段：运行脚本</li>\n</ul>\n</blockquote>\n<p>配置文件：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># S: Build Lifecycle</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">install</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">-</span> yarn install</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>// 钩子方法</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 无其他依赖项所以执行 npm run build 构建就行了</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">-</span> npm run build</pre></td></tr></table></figure><p>如果不需要安装，即跳过安装阶段，就直接设为 <code>true</code> 。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token literal-property property\">install</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr></table></figure><p><code>script</code>  字段用来指定构建或测试脚本。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token literal-property property\">script</span><span class=\"token operator\">:</span> bundle exec thor build</pre></td></tr></table></figure><p>如果有多个脚本，可以写成下面的形式。</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token literal-property property\">script</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token operator\">-</span> command1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token operator\">-</span> command2</pre></td></tr></table></figure></li>\n<li>\n<p>部署到 github pages</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\"># 其他的一些配置项，可以参考：https://docs.travis-ci.com/user/deployment/pages/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span> pages</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">skip_cleanup</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">local_dir</span><span class=\"token punctuation\">:</span> dist/</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $GITHUB_TOKEN <span class=\"token comment\"># Set in the settings page of your repository, as a secure variable</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">keep_history</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> master</pre></td></tr></table></figure></li>\n<li>\n<p>钩子用法</p>\n<p>Travis 为上面这些阶段提供了 7 个钩子。</p>\n<ul>\n<li>before_install：install 阶段之前执行</li>\n<li>before_script：script 阶段之前执行</li>\n<li>after_failure：script 阶段失败时执行</li>\n<li>after_success：script 阶段成功时执行</li>\n<li>before_deploy：deploy 步骤之前执行</li>\n<li>after_deploy：deploy 步骤之后执行</li>\n<li>after_script：script 阶段之后执行</li>\n</ul>\n<p>完整的生命周期，从开始到结束是下面的流程。</p>\n<ol>\n<li>before_install</li>\n<li>install</li>\n<li>before_script</li>\n<li>script</li>\n<li>after<em>success or after</em>failure</li>\n<li>[OPTIONAL] before_deploy</li>\n<li>[OPTIONAL] deploy</li>\n<li>[OPTIONAL] after_deploy</li>\n<li>after_script</li>\n</ol>\n</li>\n</ul>\n<p>参考资料：</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vZG9tZW5pYy9lYzhiMGZjOGFiNDVmMzk0MDNkZA==\">Auto-deploying built products to gh-pages with Travis</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vbmNsZXRvbS5pby8yMDE2L3RyYXZpcy1zc2gtZGVwbG95Lw==\">SSH deploys with Travis CI</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTcvMTIvdHJhdmlzX2NpX3R1dG9yaWFsLmh0bWw=\">持续集成服务 Travis CI 教程</span></li>\n</ul>\n<h3 id=\"配置nodejs应用\"><a class=\"anchor\" href=\"#配置nodejs应用\">#</a> 配置 Node.js 应用</h3>\n<p>配置一个 Vue 实例并发布到 github pages</p>\n<p>.travis.yml 文件：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">language</span><span class=\"token punctuation\">:</span> node_js</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">node_js</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># Travis-CI Caching</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">directories</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">-</span> node_modules</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># S: Build Lifecycle</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">install</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">-</span> yarn install</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">before_script</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># 无其他依赖项所以执行 npm run build 构建就行了</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">-</span> npm run build</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token comment\"># 其他的一些配置项，可以参考：https://docs.travis-ci.com/user/deployment/pages/</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token key atrule\">provider</span><span class=\"token punctuation\">:</span> pages</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">skip_cleanup</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token key atrule\">local_dir</span><span class=\"token punctuation\">:</span> dist/</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $GITHUB_TOKEN <span class=\"token comment\"># Set in the settings page of your repository, as a secure variable</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token key atrule\">keep_history</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">branch</span><span class=\"token punctuation\">:</span> master</pre></td></tr></table></figure><h2 id=\"circleci\"><a class=\"anchor\" href=\"#circleci\">#</a> CircleCI</h2>\n<h3 id=\"使用简介-3\"><a class=\"anchor\" href=\"#使用简介-3\">#</a> 使用简介</h3>\n<ol>\n<li>\n<p>注册 CircleCI</p>\n<p>打开 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaXJjbGVjaS5jb20v\">CircleCI</span> 官方网站，使用您的 GitHub 帐户登录。</p>\n<p><img data-src=\"./assets/image-20190613093550553.png\" alt=\"/images/image-20190613093550553\" /></p>\n<p>进行授权：</p>\n<p><img data-src=\"./assets/image-20190613093732415.png\" alt=\"/images/image-20190613093732415\" /></p>\n</li>\n<li>\n<p>启动存储库</p>\n</li>\n</ol>\n<p>检查要在 CircleCI 上管理的存储库的开关按钮。</p>\n<p><img data-src=\"./assets/image-20190613094115350.png\" alt=\"/images/image-20190613094115350\" /></p>\n<ol start=\"3\">\n<li>\n<p>编写 config.yml</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">...</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">...</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">...</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t\t<span class=\"token punctuation\">...</span></pre></td></tr></table></figure><p>官方参考文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaXJjbGVjaS5jb20vZG9jcy8yLjAvY29uZmlndXJhdGlvbi1yZWZlcmVuY2UvI3ZlcnNpb24=\">https://circleci.com/docs/2.0/configuration-reference/#version</span></p>\n<p>来看一个完事版的配置</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">:</span><span class=\"token number\">14.04</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo<span class=\"token punctuation\">:</span>2.6.8</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>mongod<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>smallfiles<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">:</span>9.4.1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\"># some containers require setting environment variables</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>          <span class=\"token key atrule\">POSTGRES_USER</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis@sha256<span class=\"token punctuation\">:</span>54057dd7e125ca41afe526a877e8bd35ec2cdd33b9217e022ed37bdcf7d09673</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> rabbitmq<span class=\"token punctuation\">:</span>3.5.4</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token key atrule\">TEST_REPORTS</span><span class=\"token punctuation\">:</span> /tmp/test<span class=\"token punctuation\">-</span>reports</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> ~/my<span class=\"token punctuation\">-</span>project</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">-</span> checkout</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> echo 127.0.0.1 devhost <span class=\"token punctuation\">|</span> sudo tee <span class=\"token punctuation\">-</span>a /etc/hosts</pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token comment\"># Create Postgres users and database</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token comment\"># Note the YAML heredoc '|' for nicer formatting</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>          sudo -u root createuser -h localhost --superuser ubuntu &amp;&amp;</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>          sudo createdb -h localhost test_db</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">restore_cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>          <span class=\"token key atrule\">keys</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token punctuation\">-</span> v1<span class=\"token punctuation\">-</span>my<span class=\"token punctuation\">-</span>project<span class=\"token punctuation\">-</span>&lt;<span class=\"token tag\">!--swig</span>￼0<span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span><span class=\"token punctuation\">></span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            - v1-my-project-</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>          <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token key atrule\">SSH_TARGET</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"localhost\"</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token key atrule\">TEST_ENV</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"linux\"</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            set -xu</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            mkdir -p $&#123;TEST_REPORTS&#125;</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            run-tests.sh</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            cp out/tests/*.xml $&#123;TEST_REPORTS&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>          set -xu</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>          mkdir -p /tmp/artifacts</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>          create_jars.sh $&#123;CIRCLE_BUILD_NUM&#125;</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>          cp *.jar /tmp/artifacts</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">save_cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> v1<span class=\"token punctuation\">-</span>my<span class=\"token punctuation\">-</span>project<span class=\"token punctuation\">-</span>&lt;<span class=\"token tag\">!--swig</span>￼1<span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span><span class=\"token punctuation\">></span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>          paths:</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            - ~/.m2</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>      <span class=\"token comment\"># Save artifacts</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">store_artifacts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/artifacts</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>          <span class=\"token key atrule\">destination</span><span class=\"token punctuation\">:</span> build</pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>      <span class=\"token comment\"># Upload test results</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">store_test_results</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/test<span class=\"token punctuation\">-</span>reports</pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  <span class=\"token key atrule\">deploy-stage</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">:</span><span class=\"token number\">14.04</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> /tmp/my<span class=\"token punctuation\">-</span>project</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy if tests pass and branch is Staging</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> ansible<span class=\"token punctuation\">-</span>playbook site.yml <span class=\"token punctuation\">-</span>i staging</pre></td></tr><tr><td data-num=\"79\"></td><td><pre></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  <span class=\"token key atrule\">deploy-prod</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">:</span><span class=\"token number\">14.04</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token key atrule\">working_directory</span><span class=\"token punctuation\">:</span> /tmp/my<span class=\"token punctuation\">-</span>project</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy if tests pass and branch is Master</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> ansible<span class=\"token punctuation\">-</span>playbook site.yml <span class=\"token punctuation\">-</span>i production</pre></td></tr><tr><td data-num=\"88\"></td><td><pre></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token key atrule\">workflows</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token key atrule\">build-deploy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>    <span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>            <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>              <span class=\"token key atrule\">ignore</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                <span class=\"token punctuation\">-</span> develop</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                <span class=\"token punctuation\">-</span> /feature<span class=\"token punctuation\">-</span>.<span class=\"token important\">*/</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">deploy-stage</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>          <span class=\"token key atrule\">requires</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>            <span class=\"token punctuation\">-</span> build</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>            <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>              <span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span> staging</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">deploy-prod</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>          <span class=\"token key atrule\">requires</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>            <span class=\"token punctuation\">-</span> build</pre></td></tr><tr><td data-num=\"108\"></td><td><pre>          <span class=\"token key atrule\">filters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>            <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>              <span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span> master</pre></td></tr></table></figure></li>\n<li>\n<p>设置 / 查看任务</p>\n<p><img data-src=\"./assets/image-20190613093327981.png\" alt=\"/images/image-20190613093327981\" /></p>\n</li>\n</ol>\n<h3 id=\"配置nodejs应用-2\"><a class=\"anchor\" href=\"#配置nodejs应用-2\">#</a> 配置 Node.js 应用</h3>\n<p><code>.circleci/config.yml</code>  配置文件</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">docker</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> circleci/node<span class=\"token punctuation\">:</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">only</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">-</span> master</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">add_ssh_keys</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>          <span class=\"token key atrule\">fingerprints</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token string\">\"c5:20:8e:79:81:19:fd:c1:6c:c4:fb:41:58:92:9d:4f\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">-</span> checkout</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">restore_cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          <span class=\"token key atrule\">keys</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token comment\"># fallback to using the latest cache if no exact match is found</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">-</span> dependencies<span class=\"token punctuation\">-</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> yarn install</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">save_cache</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">-</span> node_modules</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> dependencies<span class=\"token punctuation\">-</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> build github pages</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> yarn build</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Prepare shell commands</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> chmod +x scripts/deploy.sh</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Run deploy scripts</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> ./scripts/deploy.sh</pre></td></tr></table></figure><p>这里以发布到 github page 为示例：</p>\n<p>deploy.sh 文件的内容：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token shebang important\">#!/bin/sh</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># ideas used from https://gist.github.com/motemen/8595451</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Based on https://github.com/eldarlabs/ghpages-deploy-script/blob/master/scripts/deploy-ghpages.sh</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># Used with their MIT license https://github.com/eldarlabs/ghpages-deploy-script/blob/master/LICENSE</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># abort the script if there is a non-zero error</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">set</span> <span class=\"token parameter variable\">-e</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># show where we are on the machine</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">pwd</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">remote</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">git</span> config remote.origin.url<span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'remote is: '</span><span class=\"token variable\">$remote</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># make a directory to put the gp-pages branch</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">mkdir</span> gh-pages-branch</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token builtin class-name\">cd</span> gh-pages-branch</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># now lets setup a new repo so we can update the gh-pages branch</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.email <span class=\"token string\">\"<span class=\"token variable\">$GH_EMAIL</span>\"</span> <span class=\"token operator\">></span> /dev/null <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">git</span> config <span class=\"token parameter variable\">--global</span> user.name <span class=\"token string\">\"<span class=\"token variable\">$GH_NAME</span>\"</span> <span class=\"token operator\">></span> /dev/null <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token function\">git</span> init</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">git</span> remote <span class=\"token function\">add</span> <span class=\"token parameter variable\">--fetch</span> origin <span class=\"token string\">\"<span class=\"token variable\">$remote</span>\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'email is: '</span><span class=\"token variable\">$GH_EMAIL</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'name is: '</span><span class=\"token variable\">$GH_NAME</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'sitesource is: '</span><span class=\"token variable\">$siteSource</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># switch into the the gh-pages branch</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token function\">git</span> rev-parse <span class=\"token parameter variable\">--verify</span> origin/gh-pages <span class=\"token operator\">></span> /dev/null <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token function\">git</span> checkout gh-pages</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\"># delete any old site as we are going to replace it</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token comment\"># Note: this explodes if there aren't any, so moving it here for now</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token function\">git</span> <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token function\">git</span> checkout <span class=\"token parameter variable\">--orphan</span> gh-pages</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\"># copy over or recompile the new site</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token function\">cp</span> <span class=\"token parameter variable\">-a</span> <span class=\"token string\">\"../<span class=\"token variable\">$&#123;siteSource&#125;</span>/.\"</span> <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token function\">ls</span> <span class=\"token parameter variable\">-la</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\"># stage any changes and new files</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token function\">git</span> <span class=\"token function\">add</span> <span class=\"token parameter variable\">-A</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\"># now commit, ignoring branch gh-pages doesn't seem to work, so trying skip</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token function\">git</span> commit --allow-empty <span class=\"token parameter variable\">-m</span> <span class=\"token string\">\"Deploy to GitHub pages [ci skip]\"</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\"># and push, but send any output to /dev/null to hide anything sensitive</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token function\">git</span> push <span class=\"token parameter variable\">--force</span> <span class=\"token parameter variable\">--quiet</span> origin gh-pages</pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\"># go back to where we started and remove the gh-pages git repo we made and used</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\"># for deployment</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token builtin class-name\">cd</span> <span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> gh-pages-branch</pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Finished Deployment!\"</span></pre></td></tr></table></figure><p>说明：</p>\n<p><strong>&gt;/dev/null 2&gt;&amp;1 的含义</strong></p>\n<p><strong>文件描述符</strong></p>\n<p>当执行 shell 命令时，会默认打开 3 个文件，每个文件有对应的文件描述符来方便我们使用：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">类型</th>\n<th style=\"text-align:left\">文件描述符</th>\n<th style=\"text-align:left\">默认情况</th>\n<th style=\"text-align:left\">对应文件句柄位置</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">标准输入（standard input）</td>\n<td style=\"text-align:left\">0</td>\n<td style=\"text-align:left\">从键盘获得输入</td>\n<td style=\"text-align:left\">/proc/slef/fd/0</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">标准输出（standard output）</td>\n<td style=\"text-align:left\">1</td>\n<td style=\"text-align:left\">输出到屏幕（即控制台）</td>\n<td style=\"text-align:left\">/proc/slef/fd/1</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">错误输出（error output）</td>\n<td style=\"text-align:left\">2</td>\n<td style=\"text-align:left\">输出到屏幕（即控制台）</td>\n<td style=\"text-align:left\">/proc/slef/fd/2</td>\n</tr>\n</tbody>\n</table>\n<p><code>&gt;</code>  代表重定向到哪里？</p>\n<p>例如： <code>echo &quot;123&quot; &gt; /home/123.txt</code> <br />\n <code>1</code>  表示 <code>stdout</code>  标准输出，系统默认值是 <code>1</code> ，所以 <code>&gt;/dev/null</code>  等同于 <code>1&gt;/dev/null</code> <br />\n <code>2</code>  表示 <code>stderr</code>  标准错误<br />\n <code>&amp;</code>  表示等同于的意思， <code>2&gt;&amp;1</code> ，表示 <code>2</code>  的输出重定向等同于 <code>1</code></p>\n<p>参考资料：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vdGlueXdhbi9wLzYwMjU0NjguaHRtbA==\">Shell 脚本 ———— /dev/null 2&gt;&amp;1 详解</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phY2t5ZWNoaW5hL2FydGljbGUvZGV0YWlscy81NDU4MjE0Ng==\">shell 中 &gt;/dev/null 2&gt;&amp;1</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l0aG9tZXIvYXJ0aWNsZS9kZXRhaWxzLzkyODgzNTM=\">Linux Shell 1&gt;/dev/null 2&gt;&amp;1 含义</span></p>\n<h2 id=\"扩展知识\"><a class=\"anchor\" href=\"#扩展知识\">#</a> 扩展知识</h2>\n<h3 id=\"自动化流程的发展趋势\"><a class=\"anchor\" href=\"#自动化流程的发展趋势\">#</a> 自动化流程的发展趋势</h3>\n<ol>\n<li>\n<p>集中化</p>\n<p>以集群为基础，服务采用 Saas 方式进行交付。所有折构建、测试、发布全集中进行管理。</p>\n</li>\n<li>\n<p>微服务 + 无服务的应用模式</p>\n<p>应用程序执行环境的管理被新的编程模型和平台取代后，团队的交付生产率得到了进一步的提升。一方面它免去了很多环境管理的工作，包括设备、网络、主机以及对应的软件和配置工作，使得软件运行时环境更加稳定。另一方面，它大大降低了团队采用 DevOps 的技术门槛。</p>\n<p>** 无服务器风格的架构（Serverless architecture）** 把 DevOps 技术在微服务领域的应用推向极致。当应用程序执行环境的管理被新的编程模型和平台取代后，团队的交付生产率得到了进一步的提升。一方面它免去了很多环境管理的工作，包括设备、网络、主机以及对应的软件和配置工作，使得软件运行时环境更加稳定。另一方面，它大大降低了团队采用 DevOps 的技术门槛。</p>\n<p>在微服务端到端交付流程上，Netflix 开源了自家的<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zcGlubmFrZXIuaW8v\"> Spinnaker</span>，Netflix 作为微服务实践的先锋，不断推出新的开源工具来弥补社区中微服务技术和最佳实践的缺失。而<span class=\"exturl\" data-url=\"aHR0cDovL3Byb2plY3RzLnNwcmluZy5pby9zcHJpbmctY2xvdWQv\"> Spring Cloud</span> 则为开发者提供了一系列工具，以便他们在所熟悉的 Spring 技术栈下使用这些服务协调技术 (coordination techniques)，如服务发现、负载均衡、熔断和健康检查。</p>\n</li>\n<li>\n<p>人工智能领域的应用</p>\n<p>DevOps 的最早实践来自于互联网企业的 Web 应用，相应的思想被引入企业级应用并促进了一系列工具的发展。在人工智能领域，<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGVuc29yZmxvdy5vcmcv\">TensorFlow</span> 就是这样一个例子，它可以有多种 DevOps 友好的安装和部署方式 ，例如采用 Docker 进行部署。</p>\n<p>随着 Python 在大数据、人工智能、区块链、微服务以及 Docker 中的发展，可以预见 Python 在日后的领域仍然会发挥重要的作用。</p>\n</li>\n<li>\n<p>安全推动 DevOps 的发展</p>\n<p>全是 DevOps 永远绕不开的话题，也往往是新技术在传统行业（例如金融和电信）应用中的最大阻碍。一方面，组织结构的转型迫使企业要打破原先的部门墙，这意味着很多原先的控制流程不再适用。另一方面，由于大量的 DevOps 技术来源于开源社区，缺乏强大技术实力的企业在应用相关技术时不免会有所担忧。</p>\n</li>\n<li>\n<p>Windows 平台下.net 的技术潜力巨大</p>\n<p>长期以来，Windows 和.NET 平台下的 DevOps 一直都是一个被低估的领域。一方面，社区缺乏对 Windows Server 平台的兴趣。另一方面，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb21tdW5pdHkuc3BpY2V3b3Jrcy5jb20vbmV0d29ya2luZy9hcnRpY2xlcy8yNDYyLXNlcnZlci12aXJ0dWFsaXphdGlvbi1hbmQtb3MtdHJlbmRz\">Windows Server 却有接近 90% 的市场占用率</span>，在 Web 服务器领域则有<span class=\"exturl\" data-url=\"aHR0cHM6Ly93M3RlY2hzLmNvbS90ZWNobm9sb2dpZXMvb3ZlcnZpZXcvb3BlcmF0aW5nX3N5c3RlbS9hbGw=\"> 33.5% 的市场占有率</span>。</p>\n</li>\n<li>\n<p>非功能性自动化测试工具逐渐完善</p>\n<p>自动化测试水平往往是衡量 DevOps 技术能力高低的重要指标，尤其是针对生产环境应用程序的非功能性自动化测试工具。一直以来，技术雷达都在尝试从不同的角度宣扬自动化测试的重要性，从软件的开发阶段延展到了整个应用生命周期甚至整体 IT 资产的管理上。</p>\n</li>\n</ol>\n<h3 id=\"复杂的devops相关工具\"><a class=\"anchor\" href=\"#复杂的devops相关工具\">#</a> 复杂的 DevOps 相关工具</h3>\n<p><img data-src=\"./assets/devops-hero-1-87966cfbc9c5713ae047551c7b22985c.png\" alt=\"DevOps\" /></p>\n<h3 id=\"jenkins的一些应用场景\"><a class=\"anchor\" href=\"#jenkins的一些应用场景\">#</a> Jenkins 的一些应用场景</h3>\n<p>打包平台：</p>\n<p>使用 Jenkins 搭建 iOS/Android</p>\n<p>测试平台：</p>\n<p>jenkins + python + selenium</p>\n<p>Jmeter+maven+Jenkins 构建云性能测试平台</p>\n<p>Jenkins+PMD 构建自动化静态代码检测</p>\n<p>使用 jenkins+Emma 统计</p>\n<p>客户端单元测试覆盖率</p>\n<p>Jenkins+Ant+Java+Junit+SVN 执行 junit 单元测试</p>\n<p>jenkins+ant+jmeter 搭建持续集成的接口测试平台</p>\n<p>自动部署：</p>\n<p>Jenkins+GitLab + 蒲公英 + FTP</p>\n<p>jenkins 结合 ansible 用 shell 实现自动化部署和回滚</p>\n<p>持续集成：</p>\n<p>Tomcat+Sonar 搭建持续集成环境</p>\n<p>Maven+Nexus+Jenkins+git/SVN</p>\n<h3 id=\"jenkins的docker-composeyml创建文件\"><a class=\"anchor\" href=\"#jenkins的docker-composeyml创建文件\">#</a> Jenkins 的 Docker-compose.yml 创建文件</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>version: <span class=\"token string\">'3'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>services:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  jenkins:</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    container_name: <span class=\"token string\">'jenkins'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    image: jenkins/jenkins</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    restart: always</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    user: jenkins:<span class=\"token operator\">&lt;</span>这里填Docker用户组的ID，见下面<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    ports:</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    - <span class=\"token string\">\"8080:8080\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    - <span class=\"token string\">\"50000:50000\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    volumes:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    - /home/jenkins/data:/var/jenkins_home</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    - /usr/bin/docker:/usr/bin/docker</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    - /var/run/docker.sock:/var/run/docker.sock</pre></td></tr></table></figure><p>上面的脚本使用注意：</p>\n<ol>\n<li>\n<p>创建本地 jenkins 数据目录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /home/jenkins</pre></td></tr></table></figure></li>\n<li>\n<p>查看 docker 用户组的 ID</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> /etc/group <span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token function\">docker</span></pre></td></tr></table></figure></li>\n<li>\n<p>执行 <code>docker-compose up -d</code></p>\n</li>\n</ol>\n<h3 id=\"gitlab的docker启动配置文件\"><a class=\"anchor\" href=\"#gitlab的docker启动配置文件\">#</a> gitlab 的 docker 启动配置文件</h3>\n<p>项目地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NhbWVlcnNibi9kb2NrZXItZ2l0bGFi\">https://github.com/sameersbn/docker-gitlab</span></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/redis<span class=\"token punctuation\">:</span>4.0.9<span class=\"token punctuation\">-</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>loglevel warning</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/redis<span class=\"token punctuation\">:</span>/var/lib/redis<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">postgresql</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/postgresql<span class=\"token punctuation\">:</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/postgresql<span class=\"token punctuation\">:</span>/var/lib/postgresql<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_USER=gitlab</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PASS=password</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_NAME=gitlabhq_production</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_EXTENSION=pg_trgm</pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">gitlab</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/gitlab<span class=\"token punctuation\">:</span>11.11.2</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">-</span> redis</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">-</span> postgresql</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10080:80\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10022:22\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/gitlab<span class=\"token punctuation\">:</span>/home/git/data<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">-</span> DEBUG=false</pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_ADAPTER=postgresql</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_HOST=postgresql</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PORT=5432</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_USER=gitlab</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PASS=password</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_NAME=gitlabhq_production</pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">-</span> REDIS_HOST=redis</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">-</span> REDIS_PORT=6379</pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">-</span> TZ=Asia/Kolkata</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_TIMEZONE=Kolkata</pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_HTTPS=false</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">-</span> SSL_SELF_SIGNED=false</pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token comment\"># 这里修改成服务器的 IP 或者域名</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_HOST=localhost</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_PORT=10080</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SSH_PORT=10022</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_RELATIVE_URL_ROOT=</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_DB_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_SECRET_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_OTP_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t\t<span class=\"token comment\"># 这里给一个长度大于 8 的密码</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_ROOT_PASSWORD=12345678</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_ROOT_EMAIL=itheima@itcast.cn</pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_NOTIFY_ON_BROKEN_BUILDS=true</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_NOTIFY_PUSHER=false</pre></td></tr><tr><td data-num=\"68\"></td><td><pre></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_EMAIL=notifications@example.com</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_EMAIL_REPLY_TO=noreply@example.com</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_INCOMING_EMAIL_ADDRESS=reply@example.com</pre></td></tr><tr><td data-num=\"72\"></td><td><pre></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_BACKUP_SCHEDULE=daily</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_BACKUP_TIME=01<span class=\"token punctuation\">:</span><span class=\"token number\">00</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_ENABLED=false</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_DOMAIN=www.example.com</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_HOST=smtp.gmail.com</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_PORT=587</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_USER=mailer@example.com</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_PASS=password</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_STARTTLS=true</pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token punctuation\">-</span> SMTP_AUTHENTICATION=login</pre></td></tr><tr><td data-num=\"84\"></td><td><pre></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_ENABLED=false</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_HOST=imap.gmail.com</pre></td></tr><tr><td data-num=\"87\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_PORT=993</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_USER=mailer@example.com</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_PASS=password</pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_SSL=true</pre></td></tr><tr><td data-num=\"91\"></td><td><pre>    <span class=\"token punctuation\">-</span> IMAP_STARTTLS=false</pre></td></tr><tr><td data-num=\"92\"></td><td><pre></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_ENABLED=false</pre></td></tr><tr><td data-num=\"94\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTO_SIGN_IN_WITH_PROVIDER=</pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_ALLOW_SSO=</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_BLOCK_AUTO_CREATED_USERS=true</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTO_LINK_LDAP_USER=false</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTO_LINK_SAML_USER=false</pre></td></tr><tr><td data-num=\"99\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_EXTERNAL_PROVIDERS=</pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_LABEL=cas3</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_SERVER=</pre></td></tr><tr><td data-num=\"103\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_DISABLE_SSL_VERIFICATION=false</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_LOGIN_URL=/cas/login</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_VALIDATE_URL=/cas/p3/serviceValidate</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CAS3_LOGOUT_URL=/cas/logout</pre></td></tr><tr><td data-num=\"107\"></td><td><pre></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GOOGLE_API_KEY=</pre></td></tr><tr><td data-num=\"109\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GOOGLE_APP_SECRET=</pre></td></tr><tr><td data-num=\"110\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GOOGLE_RESTRICT_DOMAIN=</pre></td></tr><tr><td data-num=\"111\"></td><td><pre></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_FACEBOOK_API_KEY=</pre></td></tr><tr><td data-num=\"113\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_FACEBOOK_APP_SECRET=</pre></td></tr><tr><td data-num=\"114\"></td><td><pre></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_TWITTER_API_KEY=</pre></td></tr><tr><td data-num=\"116\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_TWITTER_APP_SECRET=</pre></td></tr><tr><td data-num=\"117\"></td><td><pre></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITHUB_API_KEY=</pre></td></tr><tr><td data-num=\"119\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITHUB_APP_SECRET=</pre></td></tr><tr><td data-num=\"120\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITHUB_URL=</pre></td></tr><tr><td data-num=\"121\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITHUB_VERIFY_SSL=</pre></td></tr><tr><td data-num=\"122\"></td><td><pre></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITLAB_API_KEY=</pre></td></tr><tr><td data-num=\"124\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_GITLAB_APP_SECRET=</pre></td></tr><tr><td data-num=\"125\"></td><td><pre></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_BITBUCKET_API_KEY=</pre></td></tr><tr><td data-num=\"127\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_BITBUCKET_APP_SECRET=</pre></td></tr><tr><td data-num=\"128\"></td><td><pre></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ASSERTION_CONSUMER_SERVICE_URL=</pre></td></tr><tr><td data-num=\"130\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_IDP_CERT_FINGERPRINT=</pre></td></tr><tr><td data-num=\"131\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_IDP_SSO_TARGET_URL=</pre></td></tr><tr><td data-num=\"132\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ISSUER=</pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_LABEL=\"Our SAML Provider\"</pre></td></tr><tr><td data-num=\"134\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_NAME_IDENTIFIER_FORMAT=urn<span class=\"token punctuation\">:</span>oasis<span class=\"token punctuation\">:</span>names<span class=\"token punctuation\">:</span>tc<span class=\"token punctuation\">:</span>SAML<span class=\"token punctuation\">:</span>2.0<span class=\"token punctuation\">:</span>nameid<span class=\"token punctuation\">-</span>format<span class=\"token punctuation\">:</span>transient</pre></td></tr><tr><td data-num=\"135\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_GROUPS_ATTRIBUTE=</pre></td></tr><tr><td data-num=\"136\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_EXTERNAL_GROUPS=</pre></td></tr><tr><td data-num=\"137\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ATTRIBUTE_STATEMENTS_EMAIL=</pre></td></tr><tr><td data-num=\"138\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ATTRIBUTE_STATEMENTS_NAME=</pre></td></tr><tr><td data-num=\"139\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ATTRIBUTE_STATEMENTS_USERNAME=</pre></td></tr><tr><td data-num=\"140\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ATTRIBUTE_STATEMENTS_FIRST_NAME=</pre></td></tr><tr><td data-num=\"141\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_SAML_ATTRIBUTE_STATEMENTS_LAST_NAME=</pre></td></tr><tr><td data-num=\"142\"></td><td><pre></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CROWD_SERVER_URL=</pre></td></tr><tr><td data-num=\"144\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CROWD_APP_NAME=</pre></td></tr><tr><td data-num=\"145\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_CROWD_APP_PASSWORD=</pre></td></tr><tr><td data-num=\"146\"></td><td><pre></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTH0_CLIENT_ID=</pre></td></tr><tr><td data-num=\"148\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTH0_CLIENT_SECRET=</pre></td></tr><tr><td data-num=\"149\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AUTH0_DOMAIN=</pre></td></tr><tr><td data-num=\"150\"></td><td><pre></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AZURE_API_KEY=</pre></td></tr><tr><td data-num=\"152\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AZURE_API_SECRET=</pre></td></tr><tr><td data-num=\"153\"></td><td><pre>    <span class=\"token punctuation\">-</span> OAUTH_AZURE_TENANT_ID=</pre></td></tr></table></figure>",
            "tags": [
                "持续集成与部署",
                "持续集成",
                "持续部署"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/02/02/%E5%AE%B9%E5%99%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E6%93%8D%E4%BD%9C/",
            "url": "https://dmqweb.cn/2024/02/02/%E5%AE%B9%E5%99%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E6%93%8D%E4%BD%9C/",
            "title": "容器化运维操作",
            "date_published": "2024-02-02T06:24:04.000Z",
            "content_html": "<h1 id=\"5-6-容器化运维操作\"><a class=\"anchor\" href=\"#5-6-容器化运维操作\">#</a> 5-6 容器化运维操作</h1>\n<p>日趋复杂的运维开发环境，对虚拟服务器及应用服务的要求更加的多元化。我们需要更加容易扩展、性能优越、方便监控的管理服务，容器化应用、容器化运维应运而生。</p>\n<p><strong>【知己知彼】你将在学习本课程中学习到：</strong></p>\n<ol>\n<li>理解 / 安装 docker 容器技术</li>\n<li>秒级快速部署 mysql、nginx、tomcat 等服务</li>\n<li>使用容器技术发布 nodejs 应用</li>\n<li>…</li>\n</ol>\n<p><strong>【工欲善其事，必先利其器】你需要准备的环境（三选一）：</strong></p>\n<ul>\n<li>Linux 环境 (Centos 7 以上 / Debian 8 以上 / Ubuntu 16.04LTS 以上版本)</li>\n<li>Windows 64 位专业版 / 企业版 / 教育版 (Build 15063 以上)</li>\n<li>macOS Sierra 10.12 以上的版本</li>\n</ul>\n<blockquote>\n<p>如果，你有了上面的环境，就可以很快速的跟着我们的内容快速学习。</p>\n</blockquote>\n<h2 id=\"容器和docker\"><a class=\"anchor\" href=\"#容器和docker\">#</a> 容器和 Docker</h2>\n<h3 id=\"什么是容器化\"><a class=\"anchor\" href=\"#什么是容器化\">#</a> 什么是容器化？</h3>\n<p>容器化是将应用程序或服务、其依赖项及其配置（抽象化为部署清单文件）一起打包为容器映像的一种软件开发方法。</p>\n<p><img data-src=\"./assets/docker-containerized-appliction-blue-border_2.png\" alt=\"docker-containerized-appliction-blue-border_2\" /></p>\n<p>软件容器充当软件部署的标准单元，其中可以包含不同的代码和依赖项。 按照这种方式容器化软件，开发人员和 IT 专业人员只需进行极少修改或不修改，即可将其部署到不同的环境。</p>\n<p>容器化应用程序在容器主机上运行，而容器主机在 OS（Linux 或 Windows）上运行。因此，容器的占用比虚拟机 (VM) 映像小得多。</p>\n<p>容器化的特点：</p>\n<ul>\n<li>一致的运行环境</li>\n<li>可伸缩性</li>\n<li>更方便的移植</li>\n<li>隔离性</li>\n</ul>\n<h3 id=\"什么是docker\"><a class=\"anchor\" href=\"#什么是docker\">#</a> 什么是 Docker?</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21vYnkvbW9ieQ==\">Docker</span> 是用 GO 语言开发的应用容器引擎，基于容器化，沙箱机制的应用部署技术。可适用于自动化测试、打包，持续集成和发布应用程序等场景，包括阿里云，亚马逊在内的云计算服务商都采用了 docker 来打造 serverless 服务平台。它不仅仅可以部署项目，还可以用于数据库搭建，nginx 服务搭建，nodejs、php 等编程语言环境搭建。</p>\n<blockquote>\n<p>PS: docker 现已改名为 moby</p>\n</blockquote>\n<p>Docker 中的三个<strong>重要概念</strong>：</p>\n<ul>\n<li>\n<p>镜像 (image)：分片的（只读）文件系统，由 Dockerfile 创建</p>\n<p>独立、易扩展、更效率</p>\n</li>\n<li>\n<p>容器 (container)：由 Docker 进程创建和管理的：文件系统 +  系统资源 + 网络配置 + 日志管理</p>\n<p>docker 是 docker 镜像的运行环境，所以容器的概念就比较好理解了</p>\n</li>\n<li>\n<p>仓库 (registry)：用来远端存储 docker 镜像</p>\n<p>版本控制、变更管理、为持续集成与快速部署提供便利</p>\n</li>\n</ul>\n<h3 id=\"docker-vs-虚拟机\"><a class=\"anchor\" href=\"#docker-vs-虚拟机\">#</a> Docker vs 虚拟机</h3>\n<p><img data-src=\"./assets/docker-containerized-and-vm-transparent-bg.png\" alt=\"docker-containerized-and-vm-transparent-bg\" /></p>\n<ol>\n<li>容器是应用层的抽象，它将代码和依赖关系打包在一起。 多个容器可以在同一台机器上运行，并与其他容器共享操作系统内核，每个容器在用户空间中作为独立进程运行。 容器占用的空间比 VM 少（容器映像的大小通常为几十 MB），可以处理更多的应用程序，并且需要更少的 VM 和操作系统。</li>\n<li>虚拟机（VM）是物理硬件的抽象，将一台服务器转变为多台服务器。 管理程序允许多台 VM 在单台机器上运行。 每个 VM 都包含操作系统的完整副本，应用程序，必要的二进制文件和库 - 占用数十 GB。 虚拟机也可能很慢启动。</li>\n</ol>\n<p><strong>总结一下：</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特性</th>\n<th style=\"text-align:left\">容器</th>\n<th style=\"text-align:left\">虚拟机</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">启动</td>\n<td style=\"text-align:left\">秒级</td>\n<td style=\"text-align:left\">分钟级</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">硬盘使用</td>\n<td style=\"text-align:left\">一般为  <code>MB</code></td>\n<td style=\"text-align:left\">一般为  <code>GB</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">性能</td>\n<td style=\"text-align:left\">接近原生</td>\n<td style=\"text-align:left\">弱于</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">系统支持量</td>\n<td style=\"text-align:left\">单机支持上千个容器</td>\n<td style=\"text-align:left\">一般几十个</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">开发 / 环境定制</td>\n<td style=\"text-align:left\">方便 (命令行、面向对象式)</td>\n<td style=\"text-align:left\">进入虚拟机</td>\n</tr>\n</tbody>\n</table>\n<p><strong>相同点：</strong></p>\n<ol>\n<li>文件隔离 / 文件共享（沙箱）</li>\n<li>资源隔离</li>\n<li>网络隔离</li>\n<li>支持多种宿主环境（扩展）</li>\n<li>快照 / 镜像（版本控制 / 变更管理）</li>\n</ol>\n<p><strong>不同点：</strong></p>\n<ol>\n<li>不同的资源管理 / 依赖 // 释放（虚拟机占用更多的系统资源）</li>\n<li>不同的应用运行环境</li>\n<li>Docker 是写时复制</li>\n<li>不同的日志方式 (Docker 收集日志，而虚拟机需要在虚拟系统里面看日志)</li>\n<li>不同的交互方式 (Docker 偏 shell，虚拟机偏 GUI)</li>\n</ol>\n<h3 id=\"docker的工作原理重点\"><a class=\"anchor\" href=\"#docker的工作原理重点\">#</a> Docker 的工作原理 (重点)</h3>\n<p><img data-src=\"./assets/work.png\" alt=\"work\" /></p>\n<p>Docker 是容器化部署技术，它主要作用在于通过运行容器来实现应用部署，而容器基于镜像运行。</p>\n<p>简单地说，就是将你的项目和依赖包 (基础镜像) 打成一个带有启动指令的项目镜像，然后在服务器创建一个容器，让镜像在容器内运行，从而实现项目的部署。</p>\n<p>服务器就是容器的宿主机，docker 容器与宿主机之间是相互隔离的。</p>\n<p>Docker 的基础是 Linux 容器（LXC：Linux Containers）等技术。</p>\n<p><strong>一般情况下：</strong></p>\n<p>Linux (服务器) -&gt; tomcat 安装 -&gt; Java 依赖 -&gt; maven 依赖 -&gt; 放置在 /usr/lib 目录 -&gt; 配置 tomcat 端口 / 目录 -&gt; 运行 tomcat 中的 startup.sh 脚本 -&gt; 配置网络、防火墙等 (后续) -&gt; 服务启动</p>\n<p><strong>Docker：</strong></p>\n<p>使用基于 java 的 tomcat 镜像 -&gt; docker run -&gt; 指定端口 / 挂载 webapp 目录 -&gt; 服务启动</p>\n<p>这其中，发生了什么？</p>\n<ol>\n<li>\n<p>Docker 会自己拉取镜像，若本地已经存在该镜像，则不用到网上去拉取</p>\n</li>\n<li>\n<p>创建新的容器</p>\n</li>\n<li>\n<p>分配文件系统并且挂着一个可读写的层，任何修改容器的操作都会被记录在这个读写层上，你可以保存这些修改成新的镜像，也可以选择不保存，那么下次运行改镜像的时候所有修改操作都会被消除</p>\n</li>\n<li>\n<p>分配网络 \\ 桥接接口，创建一个允许容器与本地主机通信的网络接口</p>\n</li>\n<li>\n<p>设置 ip 地址，从池中寻找一个可用的 ip 地址附加到容器上，换句话说，localhost 并不能访问到容器</p>\n</li>\n<li>\n<p>运行你指定的程序</p>\n</li>\n<li>\n<p>捕获并且提供应用输出，包括输入、输出、报错信息</p>\n</li>\n</ol>\n<p>Docker 的价值：</p>\n<p>从应用架构角度：统一复杂的构建环境；</p>\n<p>从应用部署角度：解决依赖不同、构建麻烦的问题，结合自动化工具（如 jenkins）提高效率。</p>\n<p>从集群管理角度：规范的服务<strong>调度</strong>，<strong>服务发现</strong>，<strong>负载均衡</strong></p>\n<h2 id=\"常见的应用场景介绍\"><a class=\"anchor\" href=\"#常见的应用场景介绍\">#</a> 常见的应用场景介绍</h2>\n<p>Docker 提供了轻量级的虚拟化，相比于虚拟机，可以在同一台机器上创建更多数量的容器。它常见的应用场景：1. 快速部署；2. 隔离应用； 3. 提高开发效率； 4. 版本控制； 5. 简化配置，整合资源；</p>\n<h3 id=\"快速部署\"><a class=\"anchor\" href=\"#快速部署\">#</a> 快速部署</h3>\n<p>我们尝试着来部署一个 mysql：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> mysql-test <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token number\">123456</span> mysql</pre></td></tr></table></figure><p><img data-src=\"./assets/3.gif\" alt=\"3\" /></p>\n<p>同样的道理，我们来部署一个 nginx:</p>\n<p><img data-src=\"./assets/4.gif\" alt=\"4\" /></p>\n<p>注意：这里没有映射服务端口，所以在 <code>80</code>  端口是看不到 <code>index.html</code>  中的内容的。需要加入 <code>-p</code>  参数来映射端口！！</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> web <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8000</span>:80 <span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;your_dir&#125;</span>:/usr/share/nginx/html nginx</pre></td></tr></table></figure><h3 id=\"隔离应用\"><a class=\"anchor\" href=\"#隔离应用\">#</a> 隔离应用</h3>\n<p>我们可以同时跑两个 mysql，两个 nginx，指定不同的端口进行映射：</p>\n<p>把 <code>mysql-test1</code>  映射到 <code>8001</code>  端口，把 <code>mysql-test2</code>  映射到 <code>8002</code>  端口。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> mysql-test1 <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8001</span>:3306 <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token number\">123456</span> mysql</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> mysql-test2 <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8002</span>:3306 <span class=\"token parameter variable\">-e</span> <span class=\"token assign-left variable\">MYSQL_ROOT_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token number\">123456</span> mysql</pre></td></tr></table></figure><p>把 web1 映射到 8100 端口，把 web2 映射到 8200 端口。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> web1 <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8100</span>:80 <span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;your_dir&#125;</span>:/usr/share/nginx/html nginx</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> web2 <span class=\"token parameter variable\">-p</span> <span class=\"token number\">8200</span>:80 <span class=\"token parameter variable\">-v</span> <span class=\"token variable\">$&#123;your_dir&#125;</span>:/usr/share/nginx/html nginx</pre></td></tr></table></figure><h3 id=\"提高开发效率\"><a class=\"anchor\" href=\"#提高开发效率\">#</a> 提高开发效率</h3>\n<ol>\n<li>\n<p>一致的运行环境</p>\n<p>由于 Docker 确保了执行环境的一致性，使得应用的迁移更加容易。Docker 可以在很多平台上运行，无论是物理机、虚拟机、公有云、私有云，甚至是笔记本，其运行结果是一致的。因此用户可以很轻易的将在一个平台上运行的应用，迁移到另一个平台上，而不用担心运行环境的变化导致应用无法正常运行的情况。</p>\n</li>\n<li>\n<p>更快速的启动时间</p>\n</li>\n</ol>\n<p>传统的虚拟机技术启动应用服务往往需要数分钟，而 Docker 容器应用，由于直接运行于宿主内核，无需启动完整的操作系统，因此可以做到秒级、甚至毫秒级的启动时间。大大的节约了开发、测试、部署的时间。</p>\n<ol start=\"3\">\n<li>\n<p>更高效的复用系统资源</p>\n<p>由于容器不需要进行硬件虚拟以及运行完整操作系统等额外开销，Docker 对系统资源的利用率更高。无论是应用执行速度、内存损耗或者文件存储速度，都要比传统虚拟机技术更高效。因此，相比虚拟机技术，一个相同配置的主机，往往可以运行更多数量的应用。</p>\n</li>\n<li>\n<p>仓库 / 镜像机制</p>\n<p>使用仓库可以方便的在任何有 docker 进程的虚拟机 / 服务器 / 主机上运行 docker 应用，环境的统一，让它们的部署变的非常的简单。</p>\n</li>\n</ol>\n<h3 id=\"版本控制\"><a class=\"anchor\" href=\"#版本控制\">#</a> 版本控制</h3>\n<p>Docker 容器还可以像 git 仓库一样，可以让你提交变更到 Docker 镜像中并通过不同的版本来管理它们，来看看下面的例子：</p>\n<p>我们之前创建了一个 <code>mysql</code> ，现在，我们使用 <code>commit</code>  命令就可以给它做一个快照，打上一个 <code>tag</code> 。</p>\n<p><img data-src=\"./assets/5.gif\" alt=\"5\" /></p>\n<p>在后面的课程中，我们会详细的介绍<a href=\"#Docker%E5%B8%B8%E8%A7%81%E5%91%BD%E4%BB%A4(%E9%87%8D%E7%82%B9)\"> Docker 的常见命令</a></p>\n<h3 id=\"devops流程\"><a class=\"anchor\" href=\"#devops流程\">#</a> DevOps 流程</h3>\n<p>对开发和运维（<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvRGV2T3Bz\">DevOps</span>）人员来说，最希望的就是一次创建或配置，可以在任意地方正常运行。</p>\n<p>使用 Docker 可以通过定制应用镜像来实现持续集成、持续交付、部署。开发人员可以通过 <span class=\"exturl\" data-url=\"aHR0cHM6Ly95ZWFzeS5naXRib29rcy5pby9kb2NrZXJfcHJhY3RpY2UvaW1hZ2UvZG9ja2VyZmlsZQ==\">Dockerfile</span> 来进行镜像构建，并结合 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29udGludW91c19pbnRlZ3JhdGlvbg==\">持续集成 (Continuous Integration)</span> 系统进行集成测试，而运维人员则可以直接在生产环境中快速部署该镜像，甚至结合 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29udGludW91c19kZWxpdmVyeQ==\">持续部署 (Continuous Delivery/Deployment)</span> 系统进行自动部署。</p>\n<p>而且使用  <code>Dockerfile</code>  使镜像构建透明化，不仅仅开发团队可以理解应用运行环境，也方便运维团队理解应用运行所需条件，帮助更好的生产环境中部署该镜像。</p>\n<h2 id=\"使用docker\"><a class=\"anchor\" href=\"#使用docker\">#</a> 使用 Docker</h2>\n<h3 id=\"docker如何进行安装\"><a class=\"anchor\" href=\"#docker如何进行安装\">#</a> Docker 如何进行安装</h3>\n<h4 id=\"关于系统需求重点\"><a class=\"anchor\" href=\"#关于系统需求重点\">#</a> 关于系统需求 (重点)</h4>\n<ol>\n<li>平台类</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">操作系统</th>\n<th style=\"text-align:center\">x86_64</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZG9ja2VyLWZvci1tYWMvaW5zdGFsbC8=\">Docker Desktop for Mac (macOS)</span></td>\n<td style=\"text-align:center\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZG9ja2VyLWZvci13aW5kb3dzL2luc3RhbGwv\">Docker Desktop for Windows (Microsoft Windows 10)</span></td>\n<td style=\"text-align:center\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></td>\n</tr>\n</tbody>\n</table>\n<ol start=\"2\">\n<li>服务器</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">平台</th>\n<th style=\"text-align:left\">x86_64 / amd64</th>\n<th style=\"text-align:left\">ARM</th>\n<th style=\"text-align:left\">ARM64 / AARCH64</th>\n<th style=\"text-align:left\">IBM Power (ppc64le)</th>\n<th style=\"text-align:left\">IBM Z (s390x)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC9saW51eC9kb2NrZXItY2UvY2VudG9zLw==\">CentOS</span></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/centos/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/centos/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC9saW51eC9kb2NrZXItY2UvZGViaWFuLw==\">Debian</span></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/debian/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/debian/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/debian/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC9saW51eC9kb2NrZXItY2UvZmVkb3JhLw==\">Fedora</span></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/fedora/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/fedora/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\"></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vaW5zdGFsbC9saW51eC9kb2NrZXItY2UvdWJ1bnR1Lw==\">Ubuntu</span></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n<td style=\"text-align:left\"><a href=\"https://docs.docker.com/install/linux/docker-ce/ubuntu/\"><img data-src=\"https://docs.docker.com/install/images/green-check.svg\" alt=\"yes\" /></a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"linux重点\"><a class=\"anchor\" href=\"#linux重点\">#</a> Linux (重点)</h4>\n<p>对于中国用户：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://get.docker.com <span class=\"token operator\">|</span> <span class=\"token function\">bash</span> <span class=\"token parameter variable\">-s</span> <span class=\"token function\">docker</span> <span class=\"token parameter variable\">--mirror</span> Aliyun</pre></td></tr></table></figure><p>对于国外 vps：</p>\n<pre><code>curl -fsSL https://get.docker.com -o get-docker.sh\nsh get-docker.sh\n</code></pre>\n<blockquote>\n<p>脚本介绍：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9kb2NrZXItaW5zdGFsbA==\">https://github.com/docker/docker-install</span></p>\n</blockquote>\n<h4 id=\"windows\"><a class=\"anchor\" href=\"#windows\">#</a> Windows</h4>\n<p>安装 Docker 的系统需求：</p>\n<ul>\n<li>系统版本：Windows 10 64bit: Pro, Enterprise or Education (Build 15063 or later).</li>\n<li>在 BIOS 中开启了虚拟化（virtualization），正常情况下会默认开启，去系统管理中看看有没有 Hyper-v 被安装了。</li>\n<li>CPU 特性：SLAT-capable.</li>\n<li>4GB 以上的内存</li>\n</ul>\n<blockquote>\n<p>如果不满足上面的需求，则需要使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vdG9vbGJveC9vdmVydmlldy8=\"> Docker Toolbox</span>，相当于是运行了一个 virtualbox 的虚拟镜像。</p>\n</blockquote>\n<h4 id=\"macos\"><a class=\"anchor\" href=\"#macos\">#</a> MacOS</h4>\n<p><strong>方法一官方 <code>dmg</code> ：</strong></p>\n<p>官方下载地址：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9lZGl0aW9ucy9jb21tdW5pdHkvZG9ja2VyLWNlLWRlc2t0b3AtbWFj\">Docker Descktop for Mac</span></p>\n<p>对系统的要求：</p>\n<blockquote>\n<p>Requires Apple Mac OS Sierra 10.12 or above. Download <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vdG9vbGJveC9vdmVydmlldy8=\">Docker Toolbox</span> for previous OS versions.</p>\n</blockquote>\n<p>只要系统是 Mac OS Sierra 10.12 以上即可。</p>\n<p>下载完 <code>Docker.dmg</code>  安装包之后，双击即可以安装，可能需要系统管理员权限，输入密码即可。</p>\n<p>运行过后，小图标：</p>\n<p><img data-src=\"./assets/2.gif\" alt=\"2\" /></p>\n<p>安装完之后，在终端工具中，使用 <code>docker version</code>  来查看 Docker 版本。</p>\n<p><img data-src=\"./assets/docker-version.jpg\" alt=\"docker-version\" /></p>\n<p><strong>方法二 brew cask：</strong></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>brew update </pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>brew cask <span class=\"token function\">install</span> <span class=\"token function\">docker</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 删除的方法，还需要手动删除 Docker.app</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>brew cask uninstall <span class=\"token function\">docker</span></pre></td></tr></table></figure><p>上面的命令将会把 Docker 安装在 <code>Applications</code>  目录下。</p>\n<h3 id=\"docker国内加速\"><a class=\"anchor\" href=\"#docker国内加速\">#</a> Docker 国内加速</h3>\n<ol>\n<li>Docker 的 Toolbox 镜像站 (推荐)，主要是针对低版本的 windows 与 mac 用户：</li>\n</ol>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL21pcnJvcnMuYWxpeXVuLmNvbS9kb2NrZXItdG9vbGJveC8=\">http://mirrors.aliyun.com/docker-toolbox/</span></p>\n<ol start=\"2\">\n<li>Docker 镜像加速，主要是对 <code>docker pull</code>  拉取镜像操作进行网络加速优化：</li>\n</ol>\n<p>需要注册阿里云的账号，登录<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jci5jb25zb2xlLmFsaXl1bi5jb20v\">容器 Hub 服务</span>，在左侧的加速器帮助页面就会显示为你独立分配的加速地址。</p>\n<p><img data-src=\"./assets/image-20190524172015448.png\" alt=\"/images/image-20190524172015448\" /></p>\n<h3 id=\"第一个docker应用hello-world\"><a class=\"anchor\" href=\"#第一个docker应用hello-world\">#</a> 第一个 Docker 应用 hello world</h3>\n<ol>\n<li>\n<p>查看 docker 版本</p>\n</li>\n<li>\n<p>运行第一个 Docker 应用</p>\n<p>使用 <code>docker run</code>  命令</p>\n</li>\n<li>\n<p>查看容器运行状态</p>\n<p>使用 <code>docker ps</code>  命令来查看正在运行的容器的状态， <code>-a</code>  参数来查看所有的已经运行的容器 (无论是否停止)</p>\n</li>\n</ol>\n<p><img data-src=\"./assets/1.gif\" alt=\"1\" /></p>\n<h3 id=\"docker常见命令重点\"><a class=\"anchor\" href=\"#docker常见命令重点\">#</a> Docker 常见命令 (重点)</h3>\n<ul>\n<li>\n<p><strong>创建 <code>run</code> </strong>， <code>-p</code>  映射宿主机的端口给镜像服务使用， <code>-v</code>  挂载宿主机的文件目录到镜像里面去，-it 是提供交互式的终端工具， <code>-d</code>  是让镜像容器在后台去持续运行， <code>--name</code>  指定容器的名称，exec 可以进入到容器里面去：</p>\n<pre><code>docker exec -it &lt;container_name&gt; /bin/bash\n\ndocker exec -it &lt;container_name&gt; /bin/sh\n</code></pre>\n</li>\n<li>\n<p><strong>启动 <code>start</code>  / 停止 <code>stop</code>  / 重启 <code>restart</code>  / 删除已停止容器 <code>rm</code> </strong></p>\n</li>\n<li>\n<p><strong>登录仓库 <code>login</code>  / 拉取镜像 <code>pull</code>  / 推送 <code>push</code>  / 提交镜像 <code>commit</code>  / 给指定容器标签 <code>tag</code> </strong></p>\n<p>docker hub 上去注册我们的账号，才能使用 login</p>\n<p>使用 docker commit 来给运行中的容器打 tag:</p>\n<pre><code>docker commit &lt;container_id&gt; &lt;namespace&gt;/&lt;image_name&gt;:tag\n</code></pre>\n<pre><code>docker commit e12b80defe8c itcast/mysql\n</code></pre>\n<p>使用 <code>pull</code> / <code>push</code>  命令来推送本地的镜像到远程仓库</p>\n<pre><code>docker pull/push &lt;namespace&gt;/&lt;image_name&gt;:tag\n</code></pre>\n</li>\n<li>\n<p>查看所有本地镜像 <code>images</code>  / 删除本地镜像 <code>rmi</code></p>\n<p>删除镜像之前，要停止 <code>stop</code>  并且删除 <code>rm</code>  运行中的容器。</p>\n</li>\n<li>\n<p>查看容器服务打印的日志 <code>logs</code>  / 检阅容器 <code>inspect</code>  (更详细的容器信息，硬件 / 网络 / 版本等)/ 进入容器 <code>exec</code></p>\n</li>\n<li>\n<p>查看版本 <code>version</code> /docker 进程信息 <code>info</code></p>\n</li>\n<li>\n<p>查看命令帮助：</p>\n</li>\n</ul>\n<pre><code>docker &lt;run/pull&gt; --help\n</code></pre>\n<h2 id=\"扩展知识\"><a class=\"anchor\" href=\"#扩展知识\">#</a> 扩展知识</h2>\n<h3 id=\"制作docker镜像重点\"><a class=\"anchor\" href=\"#制作docker镜像重点\">#</a> 制作 Docker 镜像 (重点)</h3>\n<p>Dockerfile 是一个由一堆命令 + 参数构成的脚本，使用  <code>docker build</code>  即可执行脚本构建镜像，自动的去做一些事，主要用于进行持续集成。</p>\n<p>一般，Dockerfile 共包括四部分：</p>\n<ul>\n<li>基础镜像信息</li>\n<li>维护者信息</li>\n<li>镜像操作指令</li>\n<li>容器启动时执行指令</li>\n</ul>\n<p>当 Node.js 遇见 Docker，下面介绍 Docker 在前端中的应用：</p>\n<p>一个简单的 Koa 应用：</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> Koa <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'koa'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Koa</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// response</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ctx</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> <span class=\"token string\">'Hello Koa!!'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>app<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>Dockerfile 示例：</p>\n<figure class=\"highlight dockerfile\"><figcaption data-lang=\"Docker\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> node:10</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">LABEL</span> maintainer=itheima@itcast.cn</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 创建 app 目录</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /app</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 把 package.json，package-lock.json (npm@5+) 或 yarn.lock 复制到工作目录 (相对路径)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">COPY</span> [<span class=\"token string\">\"package.json\"</span>,<span class=\"token string\">\"*.lock\"</span>,<span class=\"token string\">\"./\"</span>]</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 打包 app 源码</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># 特别注意：要指定工作目录中的文件名</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">COPY</span> src ./src</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># 使用.dockerignore 文件，上面两个 COPY 合并成一个</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># COPY . .</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># 使用 Yarn 安装 app 依赖</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># 如果你需要构建生产环境下的代码，请使用：</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># --prod 参数</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> yarn --prod --registry=https://registry.npm.taobao.org</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># 对外暴露端口 -p 4000:3000</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 3000</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [ <span class=\"token string\">\"node\"</span>, <span class=\"token string\">\"src/index.js\"</span> ]</span></pre></td></tr></table></figure><p>使用 <code>docker build</code>  打包：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> <span class=\"token variable\">$&#123;your_name&#125;</span>/<span class=\"token variable\">$&#123;image_name&#125;</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$&#123;tag&#125;</span> <span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p>这里的 <code>your_name</code>  代表的是远程仓库中的用户名，或者仓库地址； <code>image_name</code>  为镜像名称， <code>tag</code>  是给镜像打的标签，用于版本控制。例如：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> itheima/node-demo:1.0 <span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p>打包过程：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">docker</span> build <span class=\"token parameter variable\">-t</span> itheima/node-demo:1.0 <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Sending build context to Docker daemon  <span class=\"token number\">17</span>.92kB</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Step <span class=\"token number\">1</span>/8 <span class=\"token builtin class-name\">:</span> FROM node:10</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> ---<span class=\"token operator\">></span> 5a401340b79f</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Step <span class=\"token number\">2</span>/8 <span class=\"token builtin class-name\">:</span> LABEL <span class=\"token assign-left variable\">maintainer</span><span class=\"token operator\">=</span>itheima@itcast.cn</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> ---<span class=\"token operator\">></span> dd01419f30d5</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Step <span class=\"token number\">3</span>/8 <span class=\"token builtin class-name\">:</span> WORKDIR /app</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> ---<span class=\"token operator\">></span> bb9a44851ec9</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Step <span class=\"token number\">4</span>/8 <span class=\"token builtin class-name\">:</span> COPY <span class=\"token builtin class-name\">.</span> <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"13\"></td><td><pre> ---<span class=\"token operator\">></span> b08ff37c5456</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>Step <span class=\"token number\">5</span>/8 <span class=\"token builtin class-name\">:</span> RUN <span class=\"token function\">ls</span> <span class=\"token parameter variable\">-la</span> /app</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> ---<span class=\"token operator\">></span> 4e0e57e807a1</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>Step <span class=\"token number\">6</span>/8 <span class=\"token builtin class-name\">:</span> RUN <span class=\"token function\">yarn</span> <span class=\"token parameter variable\">--prod</span> <span class=\"token parameter variable\">--registry</span><span class=\"token operator\">=</span>https://registry.npm.taobao.org</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"19\"></td><td><pre> ---<span class=\"token operator\">></span> 96ab842b4766</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>Step <span class=\"token number\">7</span>/8 <span class=\"token builtin class-name\">:</span> EXPOSE <span class=\"token number\">3000</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"22\"></td><td><pre> ---<span class=\"token operator\">></span> 505dda4e680f</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>Step <span class=\"token number\">8</span>/8 <span class=\"token builtin class-name\">:</span> CMD <span class=\"token punctuation\">[</span> <span class=\"token string\">\"node\"</span>, <span class=\"token string\">\"src/index.js\"</span> <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre> ---<span class=\"token operator\">></span> Using cache</pre></td></tr><tr><td data-num=\"25\"></td><td><pre> ---<span class=\"token operator\">></span> f60e25a577de</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>Successfully built f60e25a577de</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>Successfully tagged itheima/node-demo:1.0</pre></td></tr></table></figure><p><strong>回顾前面的知识：</strong></p>\n<p>如何使用？</p>\n<p>还记得 <code>docker run</code>  命令吗？</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> nodedemo <span class=\"token parameter variable\">-p</span> <span class=\"token number\">3000</span>:3000 itheima/node-demo:1.0</pre></td></tr></table></figure><p>然后使用 <code>docker ps</code>  来看运行状态</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">--name</span> nodedemo <span class=\"token parameter variable\">-p</span> <span class=\"token number\">3000</span>:3000 itheima/node-demo:1.0</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>c863da9afea1558593843233aec08989184d8dafbb0f8443830d1e523104ab00</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>$ <span class=\"token function\">docker</span> <span class=\"token function\">ps</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>CONTAINER ID        IMAGE                   COMMAND               CREATED             STATUS              PORTS                    NAMES</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>c863da9afea1        itheima/node-demo:1.0   <span class=\"token string\">\"node src/index.js\"</span>   <span class=\"token number\">2</span> seconds ago       Up <span class=\"token number\">1</span> second         <span class=\"token number\">0.0</span>.0.0:3000-<span class=\"token operator\">></span><span class=\"token number\">3000</span>/tcp   nodedemo</pre></td></tr></table></figure><h3 id=\"docker-compose介绍\"><a class=\"anchor\" href=\"#docker-compose介绍\">#</a> Docker-compose 介绍</h3>\n<p>通过 Docker-Compose 用户可以很容易地用一个配置文件定义一个多容器的应用，然后使用一条指令安装这个应用的所有依赖，完成构建。Docker-Compose 解决了容器与容器之间如何管理编排的问题。</p>\n<p><img data-src=\"./assets/docker-compose.png\" alt=\"docker-compose\" /></p>\n<p>Compose 中有两个重要的概念：</p>\n<ul>\n<li>服务 (service) ：一个应用的容器，实际上可以包括若干运行相同镜像的容器实例。</li>\n<li>项目 (project) ：由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。</li>\n</ul>\n<p>Docker Compose 是 Docker 的独立产品，因此需要安装 Docker 之后在单独安装 Docker Compose .</p>\n<p><strong>安装方法：</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#下载</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-L</span> https://github.com/docker/compose/releases/download/1.20.0/docker-compose-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-s</span><span class=\"token variable\">`</span></span>-<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-m</span><span class=\"token variable\">`</span></span> <span class=\"token parameter variable\">-o</span> /usr/local/bin/docker-compose</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#安装</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">chmod</span> +x /usr/local/bin/docker-compose</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#查看版本</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">docker-compose</span> <span class=\"token parameter variable\">--version</span></pre></td></tr></table></figure><p><strong>常见使用：</strong></p>\n<p>前面的例子，使用 <code>docker-compose</code>  改写：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">mysql</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">-</span>mysql</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8000:3306\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">-</span> MYSQL_ROOT_PASSWORD=123456</pre></td></tr></table></figure><p>在此文件的当前目录下，使用 <code>docker-compose up -d</code>  来执行。</p>\n<p>生命周期管理：</p>\n<p>创建： <code>run</code> / <code>up</code></p>\n<p>启动 / 停止 / 删除 / 重启： <code>start/stop/rm/restart</code></p>\n<p>检视 / 日志： <code>logs</code> / <code>ps</code></p>\n<p>看两个个复杂的应用：</p>\n<p>搭建本地 mongo + mongo-express 服务</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.1'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">mongo</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">MONGO_INITDB_ROOT_USERNAME</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">MONGO_INITDB_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">mongo-express</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo<span class=\"token punctuation\">-</span>express</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> 8081<span class=\"token punctuation\">:</span><span class=\"token number\">8081</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">ME_CONFIG_MONGODB_ADMINUSERNAME</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">ME_CONFIG_MONGODB_ADMINPASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123456</span></pre></td></tr></table></figure><p>给公司搭建一个 git 服务器吧？！</p>\n<p>项目地址: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NhbWVlcnNibi9kb2NrZXItZ2l0bGFi\">https://github.com/sameersbn/docker-gitlab</span></p>\n<p>推荐服务器配置：适用于 10 人的小团队～～～～</p>\n<p>2core</p>\n<p>2GB+2GB(swap)</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'2'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">redis</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/redis<span class=\"token punctuation\">:</span>4.0.9<span class=\"token punctuation\">-</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>loglevel warning</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/redis<span class=\"token punctuation\">:</span>/var/lib/redis<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">postgresql</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/postgresql<span class=\"token punctuation\">:</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/postgresql<span class=\"token punctuation\">:</span>/var/lib/postgresql<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_USER=gitlab</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PASS=password</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_NAME=gitlabhq_production</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_EXTENSION=pg_trgm</pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">gitlab</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sameersbn/gitlab<span class=\"token punctuation\">:</span>11.11.0</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">-</span> redis</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">-</span> postgresql</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10080:80\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"10022:22\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">-</span> /srv/docker/gitlab/gitlab<span class=\"token punctuation\">:</span>/home/git/data<span class=\"token punctuation\">:</span>Z</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">-</span> DEBUG=false</pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_ADAPTER=postgresql</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_HOST=postgresql</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PORT=5432</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_USER=gitlab</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_PASS=password</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">-</span> DB_NAME=gitlabhq_production</pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token punctuation\">-</span> REDIS_HOST=redis</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">-</span> REDIS_PORT=6379</pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token punctuation\">-</span> TZ=Asia/Kolkata</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_TIMEZONE=Kolkata</pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_HTTPS=false</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">-</span> SSL_SELF_SIGNED=false</pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_HOST=localhost</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_PORT=10080</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SSH_PORT=10022</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_RELATIVE_URL_ROOT=</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_DB_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_SECRET_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_SECRETS_OTP_KEY_BASE=long<span class=\"token punctuation\">-</span>and<span class=\"token punctuation\">-</span>random<span class=\"token punctuation\">-</span>alphanumeric<span class=\"token punctuation\">-</span>string</pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_ROOT_PASSWORD=123456</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token punctuation\">-</span> GITLAB_ROOT_EMAIL=itheima@itcast.cn</pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token punctuation\">...</span></pre></td></tr></table></figure><p>docker-compose 在前端里面的使用：</p>\n<p>Nodejs + mongodb + koa + vue 的应用组合：</p>\n<p>特别注意：</p>\n<p>视频中，我们使用 vue 是在局部安装的，所以使用 npx 命令在进行创建。</p>\n<p>vue 官网推荐大家进行全局安装:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> @vue/cli</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 然后使用</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>vue create myproject</pre></td></tr></table></figure><p>docker-compose.yml</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">web</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> web<span class=\"token punctuation\">:</span><span class=\"token number\">1.0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8080:80\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> server<span class=\"token punctuation\">:</span><span class=\"token number\">1.0</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3000:3000\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">-</span> mongodb</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">links</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">-</span> mongodb<span class=\"token punctuation\">:</span>db</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token key atrule\">mongodb</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token key atrule\">MONGO_INITDB_ROOT_USERNAME</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token key atrule\">MONGO_INITDB_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">123456</span></pre></td></tr></table></figure><p><code>depends_on</code>  决定了容器加载的先后顺序，这里 <code>mongdb</code> 、 <code>web</code>  先加载， <code>mongdb</code>  创建完成之后，再来创建 <code>server</code> 。</p>\n<h3 id=\"自学补充知识\"><a class=\"anchor\" href=\"#自学补充知识\">#</a> 自学补充知识</h3>\n<ol>\n<li>什么是 Kubernetes?</li>\n</ol>\n<p>Kubernetes, 中文意思是舵手或导航员，它是一个容器集群管理系统，主要职责是容器编排（Container Orchestration）—— 启动容器，自动化部署、扩展和管理容器应用，还有回收容器。</p>\n<p>文档: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL3poLw==\">https://kubernetes.io/zh/</span></p>\n<p>集群相关：<span class=\"exturl\" data-url=\"aHR0cDovL21lc29zLmFwYWNoZS5vcmcv\">Mesos</span>，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci9zd2FybQ==\">Docker Swarm</span></p>\n<ol start=\"2\">\n<li>简单的 DevOps 流程介绍：</li>\n</ol>\n<p><img data-src=\"./assets/devOps-8692746.jpeg\" alt=\"devOps\" /></p>\n<p>参考链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xMDcwNDY1\">从一张图看 Devops 全流程</span></p>\n<ol start=\"3\">\n<li>Docker 中的文件系统，深入理解原理：</li>\n</ol>\n<p><img data-src=\"./assets/%E4%B8%80%E5%9B%BE%E7%9C%8B%E5%B0%BDDocker%E5%AE%B9%E5%99%A8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F.png\" alt=\"一图看尽Docker容器文件系统\" /></p>\n<ol start=\"4\">\n<li>\n<p>Docker 的一般开发流程介绍：</p>\n<ul>\n<li>寻找基础镜像</li>\n<li>基于基础镜像编写 Dockerfile 脚本</li>\n<li>根据 Dockerfile 脚本创建项目镜像</li>\n<li>将创建的镜像推送到 docker 仓库 (根据自身需要，可做可不做)</li>\n<li>基于项目镜像创建并运行 docker 容器 (实现最终部署)</li>\n</ul>\n<p>这里面如果一扩展，就变成了自动化开发流程，比如：加入版本控制 git -&gt; 使用 webhook -&gt; jenkins 自动打包  -&gt; docker 自动构建 -&gt; 推送镜像 -&gt; 生产环境部署</p>\n</li>\n</ol>\n<h2 id=\"课程资源\"><a class=\"anchor\" href=\"#课程资源\">#</a> 课程资源</h2>\n<p>Docker for Mac【系统：10.12 以上】: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL21hYy9zdGFibGUvRG9ja2VyLmRtZw==\">https://download.docker.com/mac/stable/Docker.dmg</span></p>\n<p>Docker for Windows【系统：专业版及企业版】: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL3dpbi9zdGFibGUvRG9ja2VyJTIwZm9yJTIwV2luZG93cyUyMEluc3RhbGxlci5leGU=\">https://download.docker.com/win/stable/Docker for Windows Installer.exe</span></p>\n<p>Docker ToolBox for Mac【系统：10.10.3 以上】: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL21hYy9zdGFibGUvRG9ja2VyVG9vbGJveC5wa2c=\">https://download.docker.com/mac/stable/DockerToolbox.pkg</span></p>\n<p>Docker ToolBox for Windows【系统：windows7 以上】：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL3dpbi9zdGFibGUvRG9ja2VyVG9vbGJveC5leGU=\">https://download.docker.com/win/stable/DockerToolbox.exe</span></p>\n",
            "tags": [
                "容器化运维操作",
                "容器化运维操作"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/02/02/%E4%BD%BF%E7%94%A8Jenkins%E9%85%8D%E5%90%88github%20hook%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/",
            "url": "https://dmqweb.cn/2024/02/02/%E4%BD%BF%E7%94%A8Jenkins%E9%85%8D%E5%90%88github%20hook%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/",
            "title": "jenkins配合git hook持续集成",
            "date_published": "2024-02-02T06:04:04.000Z",
            "content_html": "<h2 id=\"环境\"><a class=\"anchor\" href=\"#环境\">#</a> 环境</h2>\n<ul>\n<li>Centos 7.4</li>\n<li>JDK 1.8</li>\n</ul>\n<h2 id=\"主要步骤\"><a class=\"anchor\" href=\"#主要步骤\">#</a> 主要步骤</h2>\n<p>以下包含相关所有的步骤，可根据现有环境进行跳过</p>\n<ol>\n<li>安装 JDK</li>\n<li>安装 Centos</li>\n<li>Jenkins 和 Github 配置</li>\n<li>配置任务</li>\n</ol>\n<h3 id=\"安装jdk\"><a class=\"anchor\" href=\"#安装jdk\">#</a> 安装 JDK</h3>\n<p>Jenkins 需要 JDK 才可以运行，我们首先安装 JDK</p>\n<h4 id=\"下载\"><a class=\"anchor\" href=\"#下载\">#</a> 下载</h4>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5vcmFjbGUuY29tL3RlY2huZXR3b3JrL2phdmEvamF2YXNlL2Rvd25sb2Fkcy9qZGs4LWRvd25sb2Fkcy0yMTMzMTUxLmh0bWw=\">下载链接查看地址</span></p>\n<p>首先点击 Accept License Agreement，选择 Linux 对应版本</p>\n<p><strong>注</strong>若想要直接获取下载链接，使用 wget 进行下载是不行的，我们可以先点击链接进行下载，然后在 chrome 中的下载任务中查看下载链接进行复制。</p>\n<pre><code>cd /usr/local/src\nwget `your download url`\n</code></pre>\n<h4 id=\"解压\"><a class=\"anchor\" href=\"#解压\">#</a> 解压</h4>\n<pre><code>tar -zxvf jdk-8u91-linux-x64.tar.gz\n</code></pre>\n<h4 id=\"环境变量\"><a class=\"anchor\" href=\"#环境变量\">#</a> 环境变量</h4>\n<p>将以下内容追加到 /etc/profile 末尾，替换你对应的解压路径</p>\n<pre><code>JAVA_HOME=/usr/local/tools/jdk1.8.0_144\n\nJRE_HOME=$JAVA_HOME/jre\n\nPATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin\n\nCLASSPATH=:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib/dt.jar\n\nexport JAVA_HOME JRE_HOME PATH CLASSPATH\n</code></pre>\n<h4 id=\"启用配置\"><a class=\"anchor\" href=\"#启用配置\">#</a> 启用配置</h4>\n<pre><code>source /etc/profile\n</code></pre>\n<h4 id=\"查看版本\"><a class=\"anchor\" href=\"#查看版本\">#</a> 查看版本</h4>\n<pre><code>java -version\n</code></pre>\n<h3 id=\"安装centos\"><a class=\"anchor\" href=\"#安装centos\">#</a> 安装 Centos</h3>\n<p>使用 yum 进行安装</p>\n<pre><code>#安装自动选择最快源的插件\n$ yum install yum-fastestmirror -y\n#添加Jenkins源:\n$ sudo wget -O /etc/yum.repos.d/jenkins.repo http://jenkins-ci.org/redhat/jenkins.repo\n$ sudo rpm --import http://pkg.jenkins-ci.org/redhat/jenkins-ci.org.key\n #安装jenkins\n$ yum install jenkins\n</code></pre>\n<h4 id=\"启动\"><a class=\"anchor\" href=\"#启动\">#</a> 启动</h4>\n<pre><code>service jenkins start\n</code></pre>\n<h4 id=\"更改端口\"><a class=\"anchor\" href=\"#更改端口\">#</a> 更改端口</h4>\n<pre><code>vim /etc/sysconfig/jenkins\nservice jenkins restart\n</code></pre>\n<h3 id=\"jenkins和github配置\"><a class=\"anchor\" href=\"#jenkins和github配置\">#</a> Jenkins 和 Github 配置</h3>\n<p>这里的配置就比较多了，主要是在 github 上生成 key, 然后在 Jenkins 与项目进行绑定即可</p>\n<h4 id=\"初始化jenkins\"><a class=\"anchor\" href=\"#初始化jenkins\">#</a> 初始化 Jenkins</h4>\n<p>这几步非常简单，按照提示进行即可</p>\n<ol>\n<li>访问你的 IP:8080</li>\n<li>cat /var/lib/jenkins/secrets/initialAdminPassword 把密码输入进去</li>\n<li>Install suggested plugins 进行安装</li>\n<li>设置账户密码</li>\n</ol>\n<h3 id=\"配置github-webhooks\"><a class=\"anchor\" href=\"#配置github-webhooks\">#</a> 配置 Github webhooks</h3>\n<h4 id=\"在对项目有写权限的用户上获取token\"><a class=\"anchor\" href=\"#在对项目有写权限的用户上获取token\">#</a> 在对项目有写权限的用户上获取 token</h4>\n<p>进入 github –&gt; setting –&gt; Personal Access Token –&gt; Generate new token</p>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-1.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-1.png\" alt=\"img\" /></a></p>\n<p>点击保存，获取 token, 并<strong>保存好你的 token</strong></p>\n<h4 id=\"设置webhooks\"><a class=\"anchor\" href=\"#设置webhooks\">#</a> 设置 webhooks</h4>\n<p>进入 GitHub 上指定的项目 –&gt; setting –&gt; WebHooks&amp;Services –&gt; add webhook –&gt; 输入刚刚部署 jenkins 的服务器的 IP</p>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-2.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-2.png\" alt=\"img\" /></a></p>\n<h3 id=\"配置jenkins的git-plugin\"><a class=\"anchor\" href=\"#配置jenkins的git-plugin\">#</a> 配置 Jenkins 的 Git Plugin</h3>\n<p>新版 Jenkins 在初始的时候已经默认安装了 Git Plugin 和相关依赖的 Plugin，我们不用在重复进行安装，直接配置即可</p>\n<p>系统管理 –&gt; 系统设置 –&gt; GitHub –&gt; Add GitHub Sever</p>\n<p>填写 API URL 为<span class=\"exturl\" data-url=\"aHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS8=\"> https://api.github.com</span></p>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-3.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-3.png\" alt=\"img\" /></a></p>\n<p>点击旁边的 Add 按钮，添加 Secret Text<br />\n<a href=\"http://callmedadaxin.github.io/images/jenkins-4.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-4.png\" alt=\"img\" /></a></p>\n<h3 id=\"配置任务\"><a class=\"anchor\" href=\"#配置任务\">#</a> 配置任务</h3>\n<h3 id=\"1新建\"><a class=\"anchor\" href=\"#1新建\">#</a> 1. 新建</h3>\n<p>回到主页 –&gt; 新建任务 –&gt; 新建一个自由风格的软件项目</p>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-5.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-5.png\" alt=\"img\" /></a></p>\n<h3 id=\"2配置源码管理\"><a class=\"anchor\" href=\"#2配置源码管理\">#</a> 2. 配置源码管理</h3>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-6.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-6.png\" alt=\"img\" /></a></p>\n<h3 id=\"3构建触发器构建环境\"><a class=\"anchor\" href=\"#3构建触发器构建环境\">#</a> 3. 构建触发器，构建环境</h3>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-7.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-7.png\" alt=\"img\" /></a></p>\n<h3 id=\"4编写你的构建脚本\"><a class=\"anchor\" href=\"#4编写你的构建脚本\">#</a> 4. 编写你的构建脚本</h3>\n<p><a href=\"http://callmedadaxin.github.io/images/jenkins-8.png\"><img data-src=\"http://callmedadaxin.github.io/images/jenkins-8.png\" alt=\"img\" /></a></p>\n<p>保存，应用</p>\n<h2 id=\"问题记录\"><a class=\"anchor\" href=\"#问题记录\">#</a> 问题记录</h2>\n<ul>\n<li>项目会自动 clone 在 /var/lib/jenkins/workspace/</li>\n<li>执行的全局脚本确定已经软链到 /usr/bin, 否则访问不到</li>\n</ul>\n",
            "tags": [
                "jenkins配合git hook持续集成",
                "jenkins",
                "github hook"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/02/02/serviceWorker/",
            "url": "https://dmqweb.cn/2024/02/02/serviceWorker/",
            "title": "serviceWorker",
            "date_published": "2024-02-02T04:24:04.000Z",
            "content_html": "<h2 id=\"serviceworkerhtml\"><a class=\"anchor\" href=\"#serviceworkerhtml\">#</a> serviceWorker.html</h2>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// 数据库</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>indexedDB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">//service worker</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">//service Worker 是后台运行的脚本，充当一个代理服务器，拦截用户发出的网络请求。还可以修改用户的请求或者直接向用户发出回应，使得用户可以在离线情况下使用网络应用。还可以在本地缓存资源文件，加快访问速度。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>             window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'load'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>             navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./service-worker.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./service-worker.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">'注册成功'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'注册失败'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">// 为了节省内存，当 service-Worker 不使用时是休眠的，他也不回保存数据，所以重新启动时，为了拿到数据需要将数据放在 IndexedDb 中</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// 服务端部署消息，监听代码</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span><span class=\"token parameter\">data</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>source<span class=\"token operator\">===</span><span class=\"token string\">'service-worker'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>msg<span class=\"token punctuation\">,</span><span class=\"token string\">'serviceWorker发送来的消息'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><h2 id=\"serviceworkerjs\"><a class=\"anchor\" href=\"#serviceworkerjs\">#</a> serviceWorker.js</h2>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//serviceWorker 是基于事件驱动的。</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//serviceWorker 安装事件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span><span class=\"token parameter\">event</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span><span class=\"token string\">'安装事件'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">'安装完成'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//serviceWorker 激活事件（当安装完成之后就开始激活）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'active'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">let</span> cacheWhiteList <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'product-v2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        caches<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cacheNames</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                cacheNames<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cacheName</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>cacheWhiteList<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//serviceWorker 与网页的通信</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'active'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        self<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span><span class=\"token function\">matchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">client</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token literal-property property\">msg</span><span class=\"token operator\">:</span><span class=\"token string\">\"Hello serviceWorker\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token literal-property property\">source</span><span class=\"token operator\">:</span><span class=\"token string\">\"serviceWorker\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "JS",
                "JS",
                "serviceWorker"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/01/11/webworker/",
            "url": "https://dmqweb.cn/2024/01/11/webworker/",
            "title": "webWorker",
            "date_published": "2024-01-11T04:24:04.000Z",
            "content_html": "<p>#引言<br />\n首先我们知道 JS 中是没有并行，并发等概念的，这是因为 JS 是一门单线程的语言，其中的异步执行也是利用事件循环机制进行的，并不是严格意义上的异步。由于 JS 单线程的特性，使得 JS 在执行时如果遇到大量的任务就会使得过程运行缓慢。主渲染线程的延迟明显，使得用户体验较差.</p>\n<p>#web-worker<br />\nweb-worker 的作用就是用来缓解这一问题的</p>\n<p>利用 web-worker, 我们可以利用浏览器新开辟一个进程，将需要大量执行的过程在这个进程中执行，然后将结果返回给我们的主进程即可.</p>\n<p>#使用示例<br />\n #worker.html<br />\n&lt;!DOCTYPE html&gt;<br />\n&lt;html lang=&quot;en&quot;&gt;<br />\n&lt;head&gt;<br />\n&lt;meta charset=&quot;UTF-8&quot;&gt;<br />\n&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;<br />\n&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;<br />\n&lt;title&gt;Document&lt;/title&gt;<br />\n&lt;style&gt;<br />\n.p{<br />\nline-break: unset;<br />\n}<br />\n&lt;/style&gt;<br />\n&lt;a id=&quot;link&quot;&gt;&lt;/a&gt;<br />\n&lt;p class=&quot;p&quot;&gt;<br />\n&lt;%= sjdfl =%&gt;<br />\n&lt;/p&gt;<br />\n&lt;/head&gt;<br />\n&lt;body&gt;<br />\n&lt;script&gt;<br />\nconst \\u4e2d\\u6587 = ' 这是转义之后的字符 ';<br />\n// 使用 webworker, 分担主线程的压力<br />\n //const worker = new Worker ()<br />\n// 创建一个 worker<br />\nconst worker = new Worker('./worker.js')<br />\nconsole.log(worker);<br />\nworker.postMessage('sdfj');<br />\nworker.postMessage({method:'echo',argus:[1,2,3,4]})<br />\n// 主线程关闭 worker<br />\nsetTimeout(()=&gt;{<br />\nworker.terminate()<br />\n// worker.postMessage('close')<br />\n},1000)<br />\nworker.addEventListener('message',(e)=&gt;{<br />\nconsole.log(e.data);<br />\n})<br />\n/**</p>\n<ul>\n<li>主线程监听 worker 错误<br />\n<em> /<br />\nworker.onerror=(e)=&gt;{<br />\nworker.terminate()<br />\n console.error ('worker 错误 ');<br />\n}<br />\n/</em>*</li>\n<li>直接转移数据的控制权<br />\n<em> /<br />\n// 创建 4 字节的缓冲区<br />\n let abfer = new ArrayBuffer (4);<br />\n// 创建 32 位整数数组作为视图，引用缓冲区<br />\n let tes = new Int32Array (abfer);<br />\nconsole.log(tes,'ArrayBuffer');<br />\nworker.postMessage (abfer,[abfer]); // 转交控制权，主线程不再存储<br />\n /</em>*</li>\n<li>模拟文件下载功能<br />\n<em> /<br />\nconst blob = new Blob ([' 文件下载 ']);<br />\nconst link = document.getElementById('link');<br />\nlink.href = window.URL.createObjectURL(blob);;<br />\nlink.download = ' 测试文件.txt';<br />\nsetTimeout(()=&gt;{<br />\n// link.click();<br />\n},2000)<br />\n/</em>*</li>\n<li>创建 worker 线程加载 js 文件</li>\n<li>！！必须指定 script 标签的 type 为浏览器不知道的类型<br />\n<em> /<br />\n// const blob1 = new Blob(document.getElementById('scriptDom').textContent);<br />\n// const url1 = new window.URL.createObjectURL(blob1);<br />\n// const worker2 = new Worker(url1);<br />\n/</em>*</li>\n<li>使用 worker 线程，完成轮询<br />\n */<br />\n// 创建 worker<br />\nfunction createWorker(f){<br />\nconst fnBlob = new Blob(['('+f.toString()+')()'])<br />\nconst fnUrl = window.URL.createObjectURL(fnBlob);<br />\nreturn new Worker(fnUrl);<br />\n}<br />\nconst fnWorker = createWorker((e)=&gt;{<br />\nlet cache;<br />\n// setInterval(()=&gt;{<br />\nfetch('/data').then(res=&gt;{<br />\nif(cache != res){<br />\nconsole.log (' 变化了 ');<br />\n}<br />\n})<br />\n// },1000)<br />\n});<br />\n&lt;/script&gt;<br />\n&lt;script id=&quot;scriptDom&quot; type=&quot;app/worker&quot;&gt;<br />\nconsole.log (' 我是被 woeker 加载的文件 ');<br />\n&lt;/script&gt;<br />\n&lt;/body&gt;<br />\n&lt;/html&gt;</li>\n</ul>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>IE=edge<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Document<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\"></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token selector\">.p</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token property\">line-break</span><span class=\"token punctuation\">:</span> unset<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>link<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>p<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      &lt;%= sjdfl =%></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">const</span> \\u4e2d\\u6587 <span class=\"token operator\">=</span> <span class=\"token string\">'这是转义之后的字符'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">// 使用 webworker, 分担主线程的压力</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// const worker = new Worker()</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">// 创建一个 worker</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">const</span> worker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./worker.js'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>worker<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sdfj'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">method</span><span class=\"token operator\">:</span><span class=\"token string\">'echo'</span><span class=\"token punctuation\">,</span><span class=\"token literal-property property\">argus</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">// 主线程关闭 worker</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function\">terminate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">// worker.postMessage('close')</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"37\"></td><td><pre> * 主线程监听 worker 错误</pre></td></tr><tr><td data-num=\"38\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onerror</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  worker<span class=\"token punctuation\">.</span><span class=\"token function\">terminate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'worker错误'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"44\"></td><td><pre> * 直接转移数据的控制权</pre></td></tr><tr><td data-num=\"45\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">// 创建 4 字节的缓冲区</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">let</span> abfer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayBuffer</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">// 创建 32 位整数数组作为视图，引用缓冲区</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token keyword\">let</span> tes <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Int32Array</span><span class=\"token punctuation\">(</span>abfer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>tes<span class=\"token punctuation\">,</span><span class=\"token string\">'ArrayBuffer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>worker<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span>abfer<span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>abfer<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 转交控制权，主线程不再存储</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"53\"></td><td><pre> * 模拟文件下载功能</pre></td></tr><tr><td data-num=\"54\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token keyword\">const</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'文件下载'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token keyword\">const</span> link <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'link'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>link<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>link<span class=\"token punctuation\">.</span>download <span class=\"token operator\">=</span> <span class=\"token string\">'测试文件.txt'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token comment\">// link.click();</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"63\"></td><td><pre> * 创建 worker 线程加载 js 文件</pre></td></tr><tr><td data-num=\"64\"></td><td><pre> * ！！必须指定 script 标签的 type 为浏览器不知道的类型</pre></td></tr><tr><td data-num=\"65\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token comment\">// const blob1 = new Blob(document.getElementById('scriptDom').textContent);</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\">// const url1 = new window.URL.createObjectURL(blob1);</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token comment\">// const worker2 = new Worker(url1);</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"70\"></td><td><pre> * 使用 worker 线程，完成轮询</pre></td></tr><tr><td data-num=\"71\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token comment\">// 创建 worker</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token keyword\">function</span> <span class=\"token function\">createWorker</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">f</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token keyword\">const</span> fnBlob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'('</span><span class=\"token operator\">+</span>f<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token string\">')()'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token keyword\">const</span> fnUrl <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>fnBlob<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Worker</span><span class=\"token punctuation\">(</span>fnUrl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token keyword\">const</span> fnWorker <span class=\"token operator\">=</span> <span class=\"token function\">createWorker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>  <span class=\"token keyword\">let</span> cache<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>  <span class=\"token comment\">// setInterval(()=>&#123;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/data'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>cache <span class=\"token operator\">!=</span> res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'变化了'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>  <span class=\"token comment\">// &#125;,1000)</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>  </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>scriptDom<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>app/worker<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\"></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'我是被woeker加载的文件'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>#worker.js</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 接受数据</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'message'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    self<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'我接受到了你的消息'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>data <span class=\"token operator\">===</span> <span class=\"token string\">'close'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        self<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">'听你的我关闭'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        self<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// self.addEventListener('close',(e)=>&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//     console.log (' 关闭 ');</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// &#125;)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">/**</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> * worker 内部加载脚本</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> * 只能加载，不能获取其中内容</pre></td></tr><tr><td data-num=\"17\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">importScripts</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./main.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>#serviceWorker.js</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//serviceWorker 是基于事件驱动的。</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//serviceWorker 安装事件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span><span class=\"token parameter\">event</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span><span class=\"token string\">'安装事件'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">'安装完成'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//serviceWorker 激活事件（当安装完成之后就开始激活）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'active'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">let</span> cacheWhiteList <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'product-v2'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        caches<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cacheNames</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                cacheNames<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cacheName</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>cacheWhiteList<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                        <span class=\"token keyword\">return</span> caches<span class=\"token punctuation\">.</span><span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>cacheName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">//serviceWorker 与网页的通信</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>self<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'active'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    event<span class=\"token punctuation\">.</span><span class=\"token function\">waitUntil</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        self<span class=\"token punctuation\">.</span>clients<span class=\"token punctuation\">.</span><span class=\"token function\">matchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">client</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            client<span class=\"token punctuation\">.</span><span class=\"token function\">postMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token literal-property property\">msg</span><span class=\"token operator\">:</span><span class=\"token string\">\"Hello serviceWorker\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token literal-property property\">source</span><span class=\"token operator\">:</span><span class=\"token string\">\"serviceWorker\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "JS",
                "JS",
                "webWorker"
            ]
        },
        {
            "id": "https://dmqweb.cn/2024/01/10/%E6%AD%A3%E5%88%99/",
            "url": "https://dmqweb.cn/2024/01/10/%E6%AD%A3%E5%88%99/",
            "title": "正则编写方式",
            "date_published": "2024-01-10T04:24:04.000Z",
            "content_html": "<h2 id=\"正则表达式\"><a class=\"anchor\" href=\"#正则表达式\">#</a> 正则表达式</h2>\n<blockquote>\n<p>regular expression : RegExp</p>\n<p>用来处理字符串的规则</p>\n<ul>\n<li>只能处理字符串</li>\n<li>它是一个规则：可以验证字符串是否符合某个规则 (test) ，也可以把字符串中符合规则的内容捕获到 (exec /match ...)</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"good good study, day day up! \"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=> 学正则就是用来制定规则 (是否包含数字)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> false</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>str <span class=\"token operator\">=</span> <span class=\"token string\">\"2022-08-05\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>[\"2019\",index:0,inputs:\"原始字符串\"]</span></pre></td></tr></table></figure><h2 id=\"编写正则表达式\"><a class=\"anchor\" href=\"#编写正则表达式\">#</a> <strong>编写正则表达式</strong></h2>\n<h3 id=\"创建方式有两种\"><a class=\"anchor\" href=\"#创建方式有两种\">#</a> 创建方式有两种</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 字面量创建方式 (两个斜杆之间包起来的，都是用来描述规则的元字符)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg1 <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//=> 构造函数模式创建  两个参数：元字符字符串，修饰符字符串</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> reg2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\d+\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>正则表达式由两部分组成</p>\n<ul>\n<li>元字符</li>\n<li>修饰符</li>\n</ul>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* 常用的元字符 */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=>1. 量词元字符：设置出现的次数</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">*</span>  零到多次</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">+</span>  一到多次</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">?</span>  零次或者一次</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span>n<span class=\"token punctuation\">&#125;</span>  <span class=\"token function\">出现n次</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">n需为<span class=\"token number\">0</span>或者正整数</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span>n<span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#125;</span>  出现n到多次</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span>n<span class=\"token punctuation\">,</span>m<span class=\"token punctuation\">&#125;</span>  <span class=\"token function\">出现n到m次</span> <span class=\"token punctuation\">(</span>包含n和m<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//=>2. 特殊元字符：单个或者组合在一起代表特殊的含义</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\\    <span class=\"token function\">转义字符</span><span class=\"token punctuation\">(</span>普通<span class=\"token operator\">-</span><span class=\"token operator\">></span>特殊<span class=\"token operator\">-</span><span class=\"token operator\">></span>普通<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">.</span>    除\\<span class=\"token function\">n</span> <span class=\"token punctuation\">(</span>换行符<span class=\"token punctuation\">)</span> 以外的任意字符</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">^</span>    以哪一个元字符作为开始</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>$    以哪一个元字符作为结束</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\\n   换行符</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\\d   <span class=\"token number\">0</span><span class=\"token operator\">~</span><span class=\"token number\">9</span>之间的数字</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\\<span class=\"token constant\">D</span>   非<span class=\"token number\">0</span><span class=\"token operator\">~</span><span class=\"token number\">9</span><span class=\"token function\">之间的数字</span> <span class=\"token punctuation\">(</span>大写和小写的意思是相反的<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\\w   数字、字母、下划线中的任意一个字符</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\\s   <span class=\"token function\">一个空白字符</span> <span class=\"token punctuation\">(</span>包含空格、制表符、换页符等<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\\t   <span class=\"token function\">一个制表符</span> <span class=\"token punctuation\">(</span>一个TAb键<span class=\"token operator\">:</span>四个空格<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\\b   匹配一个单词的边界</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>x<span class=\"token operator\">|</span>y  <span class=\"token function\">x或者y中的一个字符</span>  <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token operator\">|</span><span class=\"token number\">5</span><span class=\"token operator\">|</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>xyz<span class=\"token punctuation\">]</span> x或者y或者z中的一个字符  <span class=\"token punctuation\">[</span>adghve2375<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token operator\">^</span>xy<span class=\"token punctuation\">]</span> 除了x<span class=\"token operator\">/</span>y以外的任意字符</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span>a<span class=\"token operator\">-</span>z<span class=\"token punctuation\">]</span> 指定a<span class=\"token operator\">-</span>z这个范围中的任意字符  <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span>9a<span class=\"token operator\">-</span>zA<span class=\"token operator\">-</span><span class=\"token constant\">Z_</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span>或者a<span class=\"token operator\">-</span>z或者<span class=\"token constant\">A</span><span class=\"token operator\">-</span><span class=\"token constant\">Z</span>或者_中的一个字符<span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> \\w</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token operator\">^</span>a<span class=\"token operator\">-</span>z<span class=\"token punctuation\">]</span> 上一个取反<span class=\"token string\">\"非\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    <span class=\"token function\">正则中的分组符号</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token operator\">?</span><span class=\"token operator\">:</span><span class=\"token punctuation\">)</span>  <span class=\"token function\">只匹配不捕获</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token operator\">?</span><span class=\"token operator\">=</span><span class=\"token punctuation\">)</span>  <span class=\"token function\">正向预查</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token operator\">?</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>  负向预查</pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">//=>3. 普通元字符：代表本身含义</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token operator\">/</span>jiangbing<span class=\"token operator\">/</span> 此正则匹配的就是<span class=\"token string\">\"jiangbing\"</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* 正则表达式常用的修饰符: img*/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token parameter\">i</span> <span class=\"token operator\">=></span>ignoreCase  忽略单词大小写匹配</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token parameter\">m</span> <span class=\"token operator\">=></span>multiline   可以进行多行匹配</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token parameter\">g</span> <span class=\"token operator\">=></span>global      全局匹配</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *\t/A/.test('lalala'); //=>fasle</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> *\t/A/i.test('lalala'); //=>true</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> */</span></pre></td></tr></table></figure><h3 id=\"元字符详细解析\"><a class=\"anchor\" href=\"#元字符详细解析\">#</a> <strong>元字符详细解析</strong></h3>\n<p><code>^$</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\d</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jiangbing\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2022jiangbing\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jiangbing2022\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jiangbing\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2022jiangbing\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jiangbing2022\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=>^/$ 两个都不加：字符串中包含符合规则的内容即可</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//=^/$ 两个都加：字符串只能是和规则一致的内容</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\d+$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//=> 举个例子：验证手机号码 (11 位，第一个数字是 1 即可)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^1\\d&#123;10&#125;$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><code>\\</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=>. 不是小数点，是除 \\n 外的任意字符</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^2.3$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2.3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2@3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"23\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//=> 基于转义字符，让其只能代表小数点</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^2\\.3$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2.3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2@3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"\\\\d\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\d$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//=>\\d 代表 0-9 的数字</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"str\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\\\d$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">//=> 把特殊符号转换为普通的</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"str\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr></table></figure><p><code>x|y</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^18|29$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"18\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"29\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"129\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"189\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1829\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"829\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"182\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"82\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//--- 直接 x|y 会存在很乱的优先级问题，一般我们写的时候都伴随着小括号进行分组，因为小括号改变处理的优先级 => 小括号：分组</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(18|29)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"18\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"29\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"129\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"189\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//=> 只能是 18 或者 29 中的一个了</span></pre></td></tr></table></figure><p><code>[]</code></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//1. 中括号中出现的字符一般都代表本身的含义</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[@+]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"+\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@@\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@+\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[\\d]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\\d 在中括号中还是 0-9</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"9\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[\\\\d]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\\d 已经被 \\ 转义</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"d\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"9\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">//2. 中括号中不存在多位数</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[18]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"18\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[10-29]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>1 或者 0-2 或者 9</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"9\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"10\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr></table></figure><h3 id=\"常用的正则表达式\"><a class=\"anchor\" href=\"#常用的正则表达式\">#</a> <strong>常用的正则表达式</strong></h3>\n<p>1. 验证是否为有效数字</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> *\t规则分析</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *\t\t1. 可能出现 + - 号，也可能不出现  [+-]?</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *\t\t2. 一位 0-9 都可以，多位首位不能为 0  (\\d|([1-9]\\d+)</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *\t\t3. 小数点部分可能有可能没有，一旦有后面必须有小数点 + 数字  (\\.\\d+)?</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[+-]?(\\d|([1-9]\\d+))(\\.\\d+)?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2. 验证密码</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 数字、字母、下划线</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=>6~16 位</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> val <span class=\"token operator\">=</span> userPassInp<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\w&#123;6,16&#125;$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">let</span> flag <span class=\"token operator\">=</span> reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>function checkPass (val)&#123;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    if (val.length &lt;6 || val.length >16)&#123;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        alert (' 长度必须介于 6-16 位之间！');</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        retrun;</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    &#125;</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    let area = ['a','b'...'_']; //=> 包含数字、字母、下划线</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    for (let i=0;i&lt;val.length;i++)&#123;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        let char = val [i];</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        if (!area.includes (char))&#123;</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            alert (\"格式不正确\");</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            return;</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        &#125;</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    &#125;</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>&#125;</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>*/</span></pre></td></tr></table></figure><p>3. 验证真实姓名</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> *\t1. 验证汉字  /^[\\u4E00-\\u9FA5]$/</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *\t2. 名字长度 2~10 位</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *\t3. 可能有译名・汉字  (・[\\u4E00-\\u9FA5]&#123;2,10&#125;)&#123;0,2&#125;</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[\\u4E00-\\u9FA5]&#123;2,10&#125;(·[\\u4E00-\\u9FA5]&#123;2,10&#125;)&#123;0,2&#125;$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>4. 验证邮箱</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^\\w+((-\\w+)|(\\.\\w+))*@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//=> \\w+((-\\w+)|(\\.\\w+))*</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// 1. 开头是数字字母下划线 (1 到多位)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 2. 还可以是 \"- 数字字母下划线 或者。数字字母下划线\"，整体零到多次</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 邮箱的名字由 \"数字、字母、下划线、-、.\" 几部分组成，但是 -/. 不能连续出现也不能作为开始</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//=> @[A-Za-z0-9]+</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 1.@后面紧跟着：数字、字母 (1 - 多位)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//=> ((\\.|-)[A-Za-z0-9]+)*</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 1. 对 @后面名字的补充</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">// 多域名   .com.cn</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">// 企业域名  zxt@zhufeng-peixun-office.com</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">//=> \\.[A-Za-z0-9]+</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">// 1. @xxx.com/ @xxx.cn 这个匹配的是最后的域名 (.com/.cn/.org/.edu/.net/.vip...)</span></pre></td></tr></table></figure><p>5. 身份证号码</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"2\"></td><td><pre> *\t1. 一共 18 位</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> *\t2. 最后一位可能是 X</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *\t身份证前六位：省市县 130828</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *\t中间八位：年月日</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *\t最后四位:</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> *\t\t最后一位 => X 或者数字</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> *\t\t倒数第二位 => 偶数 女  奇数 男</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> *\t\t其余的是经过算法算出来的</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//let reg = /^\\d&#123;17&#125;(\\d|X)$/;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">//=> 小括号分组的第二个作用：分组捕获，不仅可以把大正则匹配的信息捕获到，还可以单独捕获到每个小分组的内容</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(\\d&#123;6&#125;)(\\d&#123;4&#125;)(\\d&#123;2&#125;)(\\d&#123;2&#125;)\\d&#123;2&#125;(\\d)(\\d|X)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"130828199012040617\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//=>['130828199012040617', '130828', '1990', '12', '04', '1', '7', index: 0, input: '130828199012040617', groups: undefined] 捕获结果是一个数组，包含每一个小分组单独获取的内容</span></pre></td></tr></table></figure><p><strong>正则两种创建方式的区别</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 构造函数因为传递的是字符串，\\ 需要写两个才代表斜杆</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\d+\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"g\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//=> 正则表达式中的部分内容是变量存储的值</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">// 1. 两个斜杆中间包起来的都是元字符 (如果正则中要包含某个变量的值，则不能使用字面量方式创建)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">let</span> type <span class=\"token operator\">=</span> <span class=\"token string\">'zhufeng'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^@\"+type+\"@$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@zhufeng@\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@\"\"\"typeeee\"@'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=true</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 2. 这种情况只能使用构造函数方式 (因为它传递的规则是字符串，只有这样才能进行字符拼接)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"^@\"</span><span class=\"token operator\">+</span>type<span class=\"token operator\">+</span><span class=\"token string\">\"@$\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@zhufeng@\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr></table></figure><hr />\n<h2 id=\"正则的捕获\"><a class=\"anchor\" href=\"#正则的捕获\">#</a> <strong>正则的捕获</strong></h2>\n<blockquote>\n<p>实现正则捕获的办法</p>\n<ul>\n<li>正则 RegExp.prototype 上的方法\n<ul>\n<li>exec</li>\n<li>test</li>\n</ul>\n</li>\n<li>字符串 String.prototype 上支持正则表达式处理的方法\n<ul>\n<li>replace</li>\n<li>match</li>\n<li>splite</li>\n<li>......</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"zhufeng2022yangfan2023qihang2024\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *\t基于 exec 实现正则的捕获</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *\t\t1. 捕获到的结果是 null 或者一个数组</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *\t\t\t数组第一项：本次捕获到的内容</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> *\t\t\t其余项：对应小分组本次单独捕获的内容</pre></td></tr><tr><td data-num=\"8\"></td><td><pre> *\t\t\tindex: 当前捕获内容在字符串中的起始索引</pre></td></tr><tr><td data-num=\"9\"></td><td><pre> *\t\t\tinput: 原始字符串</pre></td></tr><tr><td data-num=\"10\"></td><td><pre> *\t\t2. 每执行一次 exec，只能捕获到一个符合正则规则的，但是默认情况下，我们执行 100 遍，获取的结果永远都是第一个匹配到的，其余的捕获不到</pre></td></tr><tr><td data-num=\"11\"></td><td><pre> *\t\t=>\"正则捕获的懒惰性\": 默认只捕获第一个</pre></td></tr><tr><td data-num=\"12\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['2022', index: 7, input: 'zhufeng2022yangfan2023qihang2023']</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>//=> 实现正则捕获的前提是：当前正则要和字符串匹配，如果不匹配捕获的结果是 null</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>let reg = /^\\d+$/;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>console.log (reg.test (str)); //=>fasle</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>console.log (reg.exec (str)); //=>null</span></pre></td></tr></table></figure><h3 id=\"懒做性的解决办法\"><a class=\"anchor\" href=\"#懒做性的解决办法\">#</a> 懒做性的解决办法</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"zhufeng2022yangfan2023qihang2024\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *  reg.lastIndex: 当前正则下一次匹配的起始索引位置</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> *  懒惰性捕获的原因：默认情况下 lastIndex 的值不会被修改，每一次都是从字符串开始位置查找，所以找到的永远只是第一个</pre></td></tr><tr><td data-num=\"6\"></td><td><pre> *  解决办法：全局修饰符 g</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">/* console.log (reg.lastIndex); //=>0 下面匹配捕获是从 str 索引零的位置开始找</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   console.log (reg.exec (str));</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   console.log (reg.lastIndex); //=>0 第一次匹配捕获完成，lastIndex 没有改变，所以下一次 exec 依然是从字符串最开始找，找到的永远是第一个匹配到的 </pre></td></tr><tr><td data-num=\"11\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">/* reg = /\\d+/g;</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   console.log (reg.exec (str)); //=>[\"2022\"...]</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   console.log (reg.lastIndex); //=>11 设置全局匹配修饰符 g 后，第一次匹配完，lastIndex 会自己修改</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   console.log (reg.exec (str)); //=>[\"2023\"...]</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   console.log (reg.lastIndex); //=>22</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   console.log (reg.exec (str)); //=>[\"2024\"...]</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   console.log (reg.lastIndex); //=>32</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   console.log (reg.exec (str)); //=>null  当全部捕获后，再次捕获的结果是 null，但是 lastIndex 又回归了初始值零，再次捕获又从第一个开始了...</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   console.log (reg.lastIndex); //=>0</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   console.log (reg.exec (str)); //=>[\"2019\"...] </pre></td></tr><tr><td data-num=\"23\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">/* reg = /\\d+/g;</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   if (reg.test (str)) &#123;</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   \t\t//=> 验证一下：只有正则和字符串匹配我们再捕获</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        console.log (reg.lastIndex); //=>11  基于 test 匹配验证后，lastIndex 已经被修改为第一次匹配后的结果，所以下一次捕获不再从头开始</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        console.log (reg.exec (str)); //=>[\"2023\"...]</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    &#125; </pre></td></tr><tr><td data-num=\"31\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">//=> 需求：编写一个 execAll，执行一次可以把所有匹配的结果捕获到 (前提正则一定要设置全局修饰符 g)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token operator\">~</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">execAll</span><span class=\"token punctuation\">(</span>str <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token comment\">//=>str: 需要匹配的字符串</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token comment\">//=>this: RegExp 的实例 (当前操作的正则)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">//=> 进来后第一件事，是验证当前正则是否设置了 g，不设置则不能在进行循环捕获了，否则会导致死循环</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">//=>ary 存储最后所有捕获的信息   res 存储每一次捕获的内容</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">let</span> ary <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            res <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            <span class=\"token comment\">//=> 把每一次捕获的内容 res [0] 存放到数组中</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            ary<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token comment\">//=> 只要捕获的内容不为 null，则继续捕获下去</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            res <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">return</span> ary<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">:</span> ary<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>execAll <span class=\"token operator\">=</span> execAll<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">execAll</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">//=> 字符串中的 match 方法，可以在执行一次的情况下，捕获到所有匹配的数据 (前提：正则也得设置 g 才可以)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"正则的分组捕获\"><a class=\"anchor\" href=\"#正则的分组捕获\">#</a> 正则的分组捕获</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 身份证号码</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"130828199012040112\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(\\d&#123;6&#125;)(\\d&#123;4&#125;)(\\d&#123;2&#125;)(\\d&#123;2&#125;)\\d&#123;2&#125;(\\d)(?:\\d|X)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['130828199012040112', '130828', '1990', '12', '04', '1', index: 0, input: '130828199012040112']</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['130828199012040112', '130828', '1990', '12', '04', '1', index: 0, input: '130828199012040112']</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//=> 第一项：大正则匹配的结果</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//=> 其余项：每一个小分组单独匹配捕获的结果</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//=> 如果设置了分组 (改变优先级)，但是捕获的时候不需要单独捕获，可以基于？: 来处理</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 既要捕获到 &#123;数字&#125;，也想单独的把数字也获取到，例如：第一次找到 &#123;0&#125; 还需单独获取 0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"&#123;0&#125;年&#123;1&#125;月&#123;2&#125;日\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t//=> 不设置 g 只匹配一次，exec 和 match 获取的结果一致 (既有大正则匹配的信息，也有小分组匹配的信息)</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tlet reg = /\\&#123;(\\d+)\\&#125;/;</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tconsole.log (reg.exec (str)); //=>['&#123;0&#125;','0',...]</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tconsole.log (str.match (reg)); //=>['&#123;0&#125;','0',...]</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>*/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\&#123;(\\d+)\\&#125;</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">//console.log (str.match (reg)); //=> ['&#123;0&#125;', '&#123;1&#125;', '&#123;2&#125;']\t 多次匹配的情况下，match 只能把大正则匹配的内容获取到，小分组匹配的信息无法获取</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">let</span> aryBig <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    arySmall <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    res <span class=\"token operator\">=</span> reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>big<span class=\"token punctuation\">,</span>small<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    aryBig<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>big<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    arySmall<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>small<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    res <span class=\"token operator\">=</span> reg<span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>aryBig<span class=\"token punctuation\">,</span>arySmall<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['&#123;0&#125;', '&#123;1&#125;', '&#123;2&#125;'] (3) ['0', '1', '2']</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//=> 分组的第三个作用: \"分组引用\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"book\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"good\"、\"look\"、\"moon\"、\"foot\"...</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^[a-zA-Z]([a-zA-Z])\\1[a-zA-Z]$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> 分组引用就是通过 \"\\ 数字\" 让其代表和对应分组出现一模一样的内容</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"book\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"deep\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"some\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>false</span></pre></td></tr></table></figure><h3 id=\"正则捕获的贪婪性\"><a class=\"anchor\" href=\"#正则捕获的贪婪性\">#</a> 正则捕获的贪婪性</h3>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"珠峰2022@2023培训\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=> 正则捕获的贪婪性：默认情况下，正则捕获的时候，是按照当前正则所匹配的最长结果来获取的</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>[\"2019\",\"2022\"]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//=> 在量词元字符后面设置？: 取消捕获时候的贪婪性 (按照正则匹配的最短结果来获取) </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+?</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['2', '0', '2', '2', '2', '0', '2', '3']</span></pre></td></tr></table></figure><p><code>?\t问号在正则中的五大作用</code></p>\n<ul>\n<li>问号左边是非量词元字符：本身代表量词元字符，出现零到一次</li>\n<li>问号左边是量词元字符：取消捕获时候的贪婪性</li>\n<li>(?😃 只匹配不捕获</li>\n<li>(?=) 正向预查</li>\n<li>(?!) 负向预查</li>\n</ul>\n<h3 id=\"其他正则捕获的方法\"><a class=\"anchor\" href=\"#其他正则捕获的方法\">#</a> 其他正则捕获的方法</h3>\n<p>1.test 也能捕获 (本意是匹配)</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"&#123;0&#125;年&#123;1&#125;月&#123;2&#125;日\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\&#123;(\\d+)\\&#125;</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"0\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"1\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>true</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"2\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>fasle</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>RegExp<span class=\"token punctuation\">.</span>$1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"2\"\t存储的是上次捕获的结果</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">//=>RegExp.$1~RegExp.$9: 获取当前本次正则匹配后，第一个到第九个分组的信息</span></pre></td></tr></table></figure><p>2.replace 字符串中实现替换的方法 (一般都是伴随正则一起使用的)</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"zhufeng@2022|zhufeng@2023\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=> 把 \"zhufeng\" 替换成 \"珠峰\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 1. 不用正则，执行一次只能替换一个</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zhufeng\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"珠峰\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zhufeng\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"珠峰\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"珠峰 @2022 | 珠峰 @2023\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 2. 使用正则会简单点</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">zhufeng</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span><span class=\"token string\">\"珠峰\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"珠峰 @2022 | 珠峰 @2023\"</span></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"zhufeng@2022|zhufeng@2023\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=> 把 \"zhufeng\" 替换成 \"zhufengpeixun\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zhufeng\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"zhufengpeixun\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"zhufeng\"</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"zhufengpeixun\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"zhufengpeixunpeixun@2022|zhufeng@2023\" 每一次替换都是从字符串第一个位置开始找的 (类似于正则捕获的懒惰性)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//=> 基于正则 g 可以实现</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">zhufeng</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span><span class=\"token string\">\"zhufengpeixun\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"zhufengpeixun@2022|zhufengpeixun@2023\"</span></pre></td></tr></table></figure><p><strong>案例：把时间字符串进行处理</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> time <span class=\"token operator\">=</span> <span class=\"token string\">\"2022-08-09\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//=> 变为 \"2022 年 08 月 09 日\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">^(\\d&#123;4&#125;)-(\\d&#123;1,2&#125;)-(\\d&#123;1,2&#125;)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//=> 这样可以实现</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//time = time.replace (reg,\"$1 年 $2 月 $3 日\");</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//console.log (time); //=>\"2022 年 08 月 09 日\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//=> 还可以这样处理 [str].replace ([reg],[function])</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// 1. 首先拿 reg 和 time 进行匹配捕获，能匹配到几次就会把传递的函数执行几次 (而且是匹配一次就执行一次)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 2. 不仅把方法执行，而且 replace 还给方法传递了实参信息 (和 exec 捕获的内容一致的信息：大正则匹配的内容，小分组匹配的信息....)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 3. 在函数中我们返回的是啥，就把当前大正则匹配的内容替换成啥</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\ttime = time.replace (reg,(big,$1,$2,$3)=>&#123;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    \t//=> 这里的 $1~$3 是我们自己设置的变量</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    \tconsole.log (big,$1,$2,$3); //=>\"2022-08-09 2022 08 09\"</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t&#125;);</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>arg</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>arg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">let</span>  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>$1<span class=\"token punctuation\">,</span>$2<span class=\"token punctuation\">,</span>$3<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> arg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    $2<span class=\"token punctuation\">.</span>length<span class=\"token operator\">&lt;</span><span class=\"token number\">2</span> <span class=\"token operator\">?</span> $2<span class=\"token operator\">=</span><span class=\"token string\">\"0\"</span><span class=\"token operator\">+</span>$2 <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    $3<span class=\"token punctuation\">.</span>length<span class=\"token operator\">&lt;</span><span class=\"token number\">2</span> <span class=\"token operator\">?</span> $3<span class=\"token operator\">=</span><span class=\"token string\">\"0\"</span><span class=\"token operator\">+</span>$3 <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">return</span> $1<span class=\"token operator\">+</span><span class=\"token string\">\"年\"</span><span class=\"token operator\">+</span>$2<span class=\"token operator\">+</span><span class=\"token string\">\"月\"</span><span class=\"token operator\">+</span>$3<span class=\"token operator\">+</span><span class=\"token string\">\"日\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>单词首字母大写</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"good good study, day day up! \"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\b([a-zA-Z])[a-zA-Z]*\\b</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//=> 函数被执行了六次，每一次都把正则匹配信息传递给函数</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//=> 每一次 arg: ['good','g'] ['good','g'] ['good','g'] ['study','s']...</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>arg</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>content<span class=\"token punctuation\">,</span>$1<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> arg<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    $1 <span class=\"token operator\">=</span> $1<span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    content <span class=\"token operator\">=</span> content<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">return</span> $1 <span class=\"token operator\">+</span> content<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"Good Good Study, Day Day Up! \"</span></pre></td></tr></table></figure><p><strong>验证一个字符串中哪个字母出现的次数最多，多少次？</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">let</span> str <span class=\"token operator\">=</span> <span class=\"token string\">\"zhufengpeixunzhoulaoshi\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"4\"></td><td><pre> *\t去重思维</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span><span class=\"token parameter\">char</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        obj<span class=\"token punctuation\">[</span>char<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>str<span class=\"token punctuation\">,</span> <span class=\"token parameter\">char</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span> <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    obj<span class=\"token punctuation\">[</span>char<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">let</span> max <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> key <span class=\"token keyword\">in</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    item <span class=\"token operator\">></span> max <span class=\"token operator\">?</span> max <span class=\"token operator\">=</span> item <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> key <span class=\"token keyword\">in</span> obj<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> obj<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>item <span class=\"token operator\">===</span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">出现次数最多的字符是:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>res<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">，出现了</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>max<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">次</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> 出现次数最多的字符是:h,u，出现了 3 次</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"37\"></td><td><pre> *\t排序</pre></td></tr><tr><td data-num=\"38\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span><span class=\"token function\">localeCompare</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">//console.log(str); //=>\"aeefghhhiilnnoopsuuuxzz\"</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">([a-zA-Z])\\1+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token keyword\">let</span> ary <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['ee', 'hhh', 'ii', 'nn', 'oo', 'uuu', 'zz']</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>ary<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> b<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> a<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>ary<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>['hhh', 'uuu', 'ee', 'ii', 'nn', 'oo', 'zz']</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">let</span> max <span class=\"token operator\">=</span> ary<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>ary<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> ary<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">let</span> item <span class=\"token operator\">=</span> ary<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> max<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    res<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">出现次数最多的字符是:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>res<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">，出现了</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>max<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">次</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> 出现次数最多的字符是:h,u，出现了 3 次</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"57\"></td><td><pre> *\t正则</pre></td></tr><tr><td data-num=\"58\"></td><td><pre> */</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token keyword\">let</span> max <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    res <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    flag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>str <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> a<span class=\"token punctuation\">.</span><span class=\"token function\">localeCompare</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token comment\">// console.log(str); //=>\"aeefghhhiilnnoopsuuuxzz\"</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> str<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">--</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token keyword\">let</span> reg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"([a-zA-Z])\\\\1&#123;\"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"&#125;\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"g\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token comment\">// i=3  /([a-zA-Z])\\1&#123;2&#125;/  \"hhh\" \"uuu\"</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    str<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">content<span class=\"token punctuation\">,</span> $1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        res<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>$1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        max <span class=\"token operator\">=</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        flag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">出现次数最多的字符是:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>res<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">，出现了</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$&#123;</span>max<span class=\"token interpolation-punctuation punctuation\">&#125;</span></span><span class=\"token string\">次</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=> 出现次数最多的字符是:h,u，出现了 3 次</span></pre></td></tr></table></figure><p><strong>时间字符串格式化</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">~</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *  formatTime: 时间字符串的格式化处理</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">/* function formatTime () &#123;</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    \t// 1. 首先获取时间字符串中的年月日等信息</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        let timeAry = this.match (/\\d+/g);</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        //console.log (timeAry)//['2022', '8', '10', '16', '00', '43']</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        let template = \"&#123;0&#125; 年 &#123;1&#125; 月 &#123;2&#125; 日 &#123;3&#125; 时 &#123;4&#125; 分 &#123;5&#125; 秒\";</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        template = template.replace (/\\&#123;(\\d+)\\&#125;/g, (content, $1) => &#123;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        \t//=>content: 当前本次大正则匹配的信息   $1: 本次小分组单独匹配的信息</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        \t// 以 $1 的值作为索引，到 timeAry 中找到对应的时间 (如果没有则用 \"00\" 补)</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        \tlet time = timeAry [$1] || \"00\";</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        \ttime.length &lt; 2 ? time = \"0\" + time : null;</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            return time;</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        &#125;)</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        return template;</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    &#125;*/</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">//=> 简化版本</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>     *  formatTime: 时间字符串的格式化处理</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>     *  @params</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>     *      template: [string] 我们最后期望获取日期格式的模板</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>     *      模板规则: &#123;0&#125;-> 年  &#123;1~5&#125;-> 月日时分秒</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>     *  @return</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>     *      [string] 格式化后的时间字符串</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>     *  by 江冰 on 2022-8-10 16:33:43</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span>template <span class=\"token operator\">=</span> <span class=\"token string\">\"&#123;0&#125;年&#123;1&#125;月&#123;2&#125;日 &#123;3&#125;时&#123;4&#125;分&#123;5&#125;秒\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token keyword\">let</span> timeAry <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">return</span> template <span class=\"token operator\">=</span> template<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\&#123;(\\d+)\\&#125;</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> $1<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">let</span> time <span class=\"token operator\">=</span> timeAry<span class=\"token punctuation\">[</span>$1<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"00\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token keyword\">return</span> time<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span> <span class=\"token operator\">?</span> time <span class=\"token operator\">=</span> <span class=\"token string\">\"0\"</span> <span class=\"token operator\">+</span> time <span class=\"token operator\">:</span> time<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token comment\">/* 扩展到内置类 String.prototype 上 */</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token punctuation\">[</span><span class=\"token string\">\"formatTime\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">//=> 服务器获取的</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\">// \"2022-8-10 16:00:43\"</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\">// \"2022/8/10 16:00:43\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">// \"2022/8/10\"</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">//=> 想要转变为的格式</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">// \"08 月 10 日 16 时 00 分\"</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\">// \"2022 年 8 月 10 日\"</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\">// ...</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token keyword\">let</span> time <span class=\"token operator\">=</span> <span class=\"token string\">\"2022-8-10 16:00:43\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>2022 年 08 月 10 日 16 时 00 分 43 秒</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;0&#125;年&#123;1&#125;月&#123;2&#125;日\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>2022 年 08 月 10 日</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;1&#125;-&#123;2&#125; &#123;3&#125;:&#123;4&#125;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>08-10 16:00</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>time <span class=\"token operator\">=</span> <span class=\"token string\">\"2022/8/13\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>2022 年 08 月 13 日 00 时 00 分 00 秒</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;0&#125;年&#123;1&#125;月&#123;2&#125;日\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>2022 年 08 月 13 日</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>time<span class=\"token punctuation\">.</span><span class=\"token function\">formatTime</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&#123;1&#125;-&#123;2&#125; &#123;3&#125;:&#123;4&#125;\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>08-13 00:00</span></pre></td></tr></table></figure><p><em><strong>queryURLParams</strong></em></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">~</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *  queryURLParams: 获取 URl 地址问号和后面的参数信息 (可能也包含 HASH 值)</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     *  @params   </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     *  @return</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     *      [object] 把所有问号参数信息以键值对的方式存储起来并且返回</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     *  by 江冰 on 2022-8-10 16:33:43</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">function</span> <span class=\"token function\">queryURLParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">let</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">([^?=&amp;#]+)=([^?=&amp;#]+)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> $1<span class=\"token punctuation\">,</span> $2<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> obj<span class=\"token punctuation\">[</span>$1<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> $2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">#([^?=&amp;#]+)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> $1<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> obj<span class=\"token punctuation\">[</span><span class=\"token string\">'HASH'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> $1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">return</span> obj<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">/* 扩展到内置类 String.prototype 上 */</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">[</span><span class=\"token string\">\"queryURLParams\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">let</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://www.zhufengpeixun.cn/?lx=1&amp;from=wx#video\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">queryURLParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>&#123;lx: '1', from: 'wx', HASH: 'video'&#125;</span></pre></td></tr></table></figure><p><strong>千分符</strong></p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">~</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">/* </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>     *  millimeter: 实现大数字的千分符处理</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>     *  @params    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>     *  @return</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>     *      [string] 千分符后的字符串</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     *  by 江冰 on 2022-8-10 16:33:43</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>     */</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token keyword\">function</span> <span class=\"token function\">millimeter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\d&#123;1,3&#125;(?=(\\d&#123;3&#125;)+$)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">content</span> <span class=\"token operator\">=></span> content <span class=\"token operator\">+</span> <span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">/* 扩展到内置类 String.prototype 上 */</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">[</span><span class=\"token string\">\"millimeter\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">[</span>item<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">let</span> num <span class=\"token operator\">=</span> <span class=\"token string\">\"15628954\"</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"15,628,954\" 千分符</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">.</span><span class=\"token function\">millimeter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"15,628,954\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">// 把字符串倒过来</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>num <span class=\"token operator\">=</span> num<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> num<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">let</span> prev <span class=\"token operator\">=</span> num<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        next <span class=\"token operator\">=</span> num<span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    num <span class=\"token operator\">=</span> prev <span class=\"token operator\">+</span> <span class=\"token string\">\",\"</span> <span class=\"token operator\">+</span> next<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>num <span class=\"token operator\">=</span> num<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//=>\"15,628,954\"</span></pre></td></tr></table></figure><h1 id=\"常用的正则表达式-2\"><a class=\"anchor\" href=\"#常用的正则表达式-2\">#</a> 常用的正则表达式</h1>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">6</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">7</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">9</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">11</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">12</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">13</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">14</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">15</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">16</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">17</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">18</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">19</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">21</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">22</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">23</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token number\">24</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token number\">25</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">26</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token number\">27</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">28</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token number\">29</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">30</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token number\">31</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token number\">32</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token number\">33</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token number\">34</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token number\">35</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token number\">36</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token number\">37</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token number\">38</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token number\">39</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token number\">40</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token number\">41</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token number\">42</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token number\">43</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token number\">44</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token number\">45</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token number\">46</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token number\">47</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token number\">48</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token number\">49</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token number\">50</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token number\">51</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token number\">52</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token number\">53</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token number\">54</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token number\">55</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token number\">56</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token number\">57</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token number\">58</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token number\">59</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token number\">60</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token number\">61</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token comment\">// 正整数</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">^</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>$<span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token comment\">// 负整数</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">^</span><span class=\"token operator\">-</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>$<span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token comment\">// 正浮点数</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">^</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">|</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token operator\">|</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>$<span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\">// 负浮点数</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">^</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token operator\">|</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token operator\">|</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>$<span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token comment\">// 浮点数</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">^</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token operator\">?</span>\\d<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>\\<span class=\"token punctuation\">.</span>\\d<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span>$<span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token comment\">//email 地址</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">^</span><span class=\"token punctuation\">[</span>\\w<span class=\"token operator\">-</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span>\\w<span class=\"token operator\">-</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>@<span class=\"token punctuation\">[</span>\\w<span class=\"token operator\">-</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token punctuation\">(</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span>\\w<span class=\"token operator\">-</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span>$<span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token comment\">//url 地址</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">^</span><span class=\"token punctuation\">[</span>a<span class=\"token operator\">-</span>zA<span class=\"token operator\">-</span>z<span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(\\w+(-\\w+)*)(\\.(\\w+(-\\w+)*))*(\\?\\S*)?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>或：<span class=\"token operator\">^</span>http<span class=\"token operator\">:</span>\\<span class=\"token operator\">/</span>\\<span class=\"token operator\">/</span><span class=\"token punctuation\">[</span><span class=\"token constant\">A</span><span class=\"token operator\">-</span>Za<span class=\"token operator\">-</span>z0<span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">[</span><span class=\"token constant\">A</span><span class=\"token operator\">-</span>Za<span class=\"token operator\">-</span>z0<span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span><span class=\"token punctuation\">[</span>\\<span class=\"token operator\">/=</span>\\<span class=\"token operator\">?</span><span class=\"token operator\">%</span>\\<span class=\"token operator\">-</span><span class=\"token operator\">&amp;</span>_<span class=\"token operator\">~</span>`@<span class=\"token punctuation\">[</span>\\<span class=\"token punctuation\">]</span>\\'<span class=\"token operator\">:</span><span class=\"token operator\">+</span><span class=\"token operator\">!</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">^</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\\\"\\\"<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>$</pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token comment\">// 年 / 月 / 日（年 - 月 - 日、年。月。日）</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">^</span><span class=\"token punctuation\">(</span><span class=\"token number\">19</span><span class=\"token operator\">|</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\\d\\d<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.](0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token comment\">// 匹配中文字符</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token punctuation\">[</span>\\u4e00<span class=\"token operator\">-</span>\\u9fa5<span class=\"token punctuation\">]</span><span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token comment\">// 匹配帐号是否合法 (字母开头，允许 5-10 字节，允许字母数字下划线)</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">^</span><span class=\"token punctuation\">[</span>a<span class=\"token operator\">-</span>zA<span class=\"token operator\">-</span><span class=\"token constant\">Z</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>a<span class=\"token operator\">-</span>zA<span class=\"token operator\">-</span><span class=\"token constant\">Z0</span><span class=\"token operator\">-</span>9_<span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">9</span><span class=\"token punctuation\">&#125;</span>$<span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token comment\">// 匹配空白行的正则表达式</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token operator\">/</span>\\n\\s<span class=\"token operator\">*</span>\\r<span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token comment\">// 匹配中国邮政编码</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span>\\d<span class=\"token punctuation\">&#123;</span><span class=\"token number\">5</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token operator\">?</span><span class=\"token operator\">!</span>\\d<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token comment\">// 匹配身份证</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token operator\">/</span>\\d<span class=\"token punctuation\">&#123;</span><span class=\"token number\">15</span><span class=\"token punctuation\">&#125;</span><span class=\"token operator\">|</span>\\d<span class=\"token punctuation\">&#123;</span><span class=\"token number\">18</span><span class=\"token punctuation\">&#125;</span><span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token comment\">// 匹配国内电话号码</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token punctuation\">(</span>\\d<span class=\"token punctuation\">&#123;</span><span class=\"token number\">3</span><span class=\"token punctuation\">&#125;</span><span class=\"token operator\">-</span><span class=\"token operator\">|</span>\\d<span class=\"token punctuation\">&#123;</span><span class=\"token number\">4</span><span class=\"token punctuation\">&#125;</span><span class=\"token operator\">-</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>\\d<span class=\"token punctuation\">&#123;</span><span class=\"token number\">8</span><span class=\"token punctuation\">&#125;</span><span class=\"token operator\">|</span>\\d<span class=\"token punctuation\">&#123;</span><span class=\"token number\">7</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token comment\">// 匹配 IP 地址</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\\d<span class=\"token operator\">|</span><span class=\"token number\">25</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">|</span><span class=\"token punctuation\">[</span><span class=\"token number\">01</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?</span>\\d\\d<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">3</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span>\\d<span class=\"token operator\">|</span><span class=\"token number\">25</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">|</span><span class=\"token punctuation\">[</span><span class=\"token number\">01</span><span class=\"token punctuation\">]</span><span class=\"token operator\">?</span>\\d\\d<span class=\"token operator\">?</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre><span class=\"token comment\">// 匹配首尾空白字符的正则表达式</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre><span class=\"token operator\">/</span><span class=\"token operator\">^</span>\\s<span class=\"token operator\">*</span><span class=\"token operator\">|</span>\\s<span class=\"token operator\">*</span>$<span class=\"token operator\">/</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token comment\">// 匹配 HTML 标记的正则表达式</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token operator\">&lt;</span> <span class=\"token punctuation\">(</span>\\<span class=\"token constant\">S</span><span class=\"token operator\">*</span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">^</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token operator\">></span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span><span class=\"token operator\">?</span><span class=\"token operator\">|</span><span class=\"token operator\">&lt;</span> <span class=\"token punctuation\">.</span><span class=\"token operator\">*</span><span class=\"token operator\">?</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre><span class=\"token comment\">//sql 语句</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token operator\">^</span><span class=\"token punctuation\">(</span>select<span class=\"token operator\">|</span>drop<span class=\"token operator\">|</span><span class=\"token keyword\">delete</span><span class=\"token operator\">|</span>create<span class=\"token operator\">|</span>update<span class=\"token operator\">|</span>insert<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token operator\">*</span>$</pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token comment\">// 提取信息中的网络链接</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token punctuation\">(</span>h<span class=\"token operator\">|</span><span class=\"token constant\">H</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">|</span><span class=\"token constant\">R</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>e<span class=\"token operator\">|</span><span class=\"token constant\">E</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>f<span class=\"token operator\">|</span><span class=\"token constant\">F</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token string\">'|\")?(\\w|\\\\|\\/|\\.)+('</span><span class=\"token operator\">|</span>\"<span class=\"token operator\">|</span> <span class=\"token operator\">*</span><span class=\"token operator\">|</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token comment\">// 提取信息中的邮件地址</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>\\w<span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token operator\">+</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">]</span>\\w<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>@\\w<span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">]</span>\\w<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>\\<span class=\"token punctuation\">.</span>\\w<span class=\"token operator\">+</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">]</span>\\w<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token comment\">// 提取信息中的图片链接</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre><span class=\"token punctuation\">(</span>s<span class=\"token operator\">|</span><span class=\"token constant\">S</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">|</span><span class=\"token constant\">R</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>c<span class=\"token operator\">|</span><span class=\"token constant\">C</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*=</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token string\">'|\")?(\\w|\\\\|\\/|\\.)+('</span><span class=\"token operator\">|</span>\"<span class=\"token operator\">|</span> <span class=\"token operator\">*</span><span class=\"token operator\">|</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre><span class=\"token comment\">// 提取信息中的 IP 地址</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token punctuation\">(</span>\\d<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>\\d<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>\\d<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span>\\<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>\\d<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token comment\">// 取信息中的中国手机号码</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token number\">86</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">0</span><span class=\"token operator\">*</span><span class=\"token number\">13</span>\\d<span class=\"token punctuation\">&#123;</span><span class=\"token number\">9</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre><span class=\"token comment\">// 提取信息中的中国邮政编码</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">(</span>\\d<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">5</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre><span class=\"token comment\">// 提取信息中的浮点数（即小数）</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token operator\">?</span>\\d<span class=\"token operator\">*</span><span class=\"token punctuation\">)</span>\\<span class=\"token punctuation\">.</span><span class=\"token operator\">?</span>\\d<span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre><span class=\"token comment\">// 提取信息中的任何数字</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token operator\">?</span>\\d<span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>\\<span class=\"token punctuation\">.</span>\\d<span class=\"token operator\">+</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token comment\">// 电话区号</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token operator\">^</span><span class=\"token number\">0</span>\\d<span class=\"token punctuation\">&#123;</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">&#125;</span>$</pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token comment\">// 腾讯 QQ 号</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre><span class=\"token operator\">^</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>$</pre></td></tr><tr><td data-num=\"118\"></td><td><pre><span class=\"token comment\">// 帐号（字母开头，允许 5-16 字节，允许字母数字下划线）</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token operator\">^</span><span class=\"token punctuation\">[</span>a<span class=\"token operator\">-</span>zA<span class=\"token operator\">-</span><span class=\"token constant\">Z</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>a<span class=\"token operator\">-</span>zA<span class=\"token operator\">-</span><span class=\"token constant\">Z0</span><span class=\"token operator\">-</span>9_<span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#123;</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">15</span><span class=\"token punctuation\">&#125;</span>$</pre></td></tr><tr><td data-num=\"120\"></td><td><pre><span class=\"token comment\">// 中文、英文、数字及下划线</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre><span class=\"token operator\">^</span><span class=\"token punctuation\">[</span>\\u4e00<span class=\"token operator\">-</span>\\u9fa5_a<span class=\"token operator\">-</span>zA<span class=\"token operator\">-</span><span class=\"token constant\">Z0</span><span class=\"token operator\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span><span class=\"token operator\">+</span>$</pre></td></tr></table></figure>",
            "tags": [
                "正则表达式",
                "正则"
            ]
        }
    ]
}