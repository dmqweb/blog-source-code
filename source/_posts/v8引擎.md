---
title: v8引擎执行过程
tags: 
- v8引擎
- 底层原理
categories: v8引擎
date: 2024-05-21 18:36:10
---

# 

# v8引擎介绍

Blink内核用于解析HTML、DOM、CSS渲染、嵌入了v8引擎用于解析Javascript

V8是谷歌的开源高性能JavaScript和WebAssembly引擎，用C++编写。它被用于Chrome和Node.js等。**用于解析并执行JavaScript代码。**

# 执行过程

- 初始化运行环境
  - 堆栈空间
  - 全局执行上下文
  - 全局作用域
  - 事件循环系统
- 利用Scanner扫描器将输入的代码词法分析成tokens
  - 分析的结果就是一个个的tokens对象组成的数组
  - 分析的过程利用了有限自动状态机的概念
- 利用parser解析器将tokens转化为抽象语法树
  - 根据分析tokens构造出一种树形关系结构
  - **预解析**：在JS代码执行之前对代码进行可选的预处理，用于提高执行效率
  - **延迟解析**：只有代码执行到的部分才会去解析，节省了不必要的时间和开销，提高了JavaScript的执行效率，其中vite脚手架就是利用了这个优点（还有esbuild打包快的优势），提高了效率。
- 利用ignition解释器将AST（抽象语法树）转为字节码（不直接转为机器码？）
  - 字节码跨平台能力强
  - 字节码更快的加载和解析执行
  - 动态优化易操作
  - 代码安全性
- 利用TurboFan编译器将字节码转为CPU和ARM识别的机器码

# v8中的对象结构

### 常规属性和排序属性

- v8中的对象主要分为三个指针构成的，分别是：隐藏类、常规属性和排序属性。
- 对象的属性数字会从小到大排列，字符串会按照原创建顺序
- 对象中数字属性被称为排序属性，字符串属性被称为常规属性

### 快属性和慢属性

- JS对象很多属性是在原型链上进行查找，这样就会很慢，v8将部分常规属性（10个）直接存储到对象本身（对象内属性），以提高属性的查询效率。
- 快属性容量是10个。

### 封装、继承、多态

- 封装就是将抽象出来的数据和对数据的操作封装在一起，数据在内部被保护，程序其他部分只有通过成员才能对数据进行操作
- 继承：有原型链继承、寄生继承和call、apply借用法继承。
- 多态就是函数重载：同一个函数可以根据调用的情况（参数类型和数量等）来进行不同的操作。
