---
title: 数据库
date: 2023-12-2 12:24:4
categories:
- 数据库
tags:
- 数据库
---

# 数据库

## 一、什么是数据库

###### 数据库是用来组织存储和管理数据的仓库

## 二、常见的数据库

#### 1、（传统型、关系型、SQL数据库）

①MySQL数据库（目前使用最广泛，流行度最高的开源免费数据库）

②Oracle数据库（收费）

③SQL  Server数据库（收费）

#### 2、（新型、非关系型、NoSQL数据库）

④Mongodb 数据库 （一定程度上弥补了传统型数据库的缺陷）



## 三、MySQL数据库

### 1、介绍

#### （1）传统型数据库的数据组织结构

数据库（database）、数据表(table)、数据行(row）、字段(field)

#### （2）实际开发中 库、表、行、字段的关系

①一般每个项目都对应独立的数据库  ②不同数据要存储到不同的表中  ③存储信息由字段决定

#### （3）安装MySQL Server 和MySQLWorkbench软件

①MySQL Server:提供数据存储和服务的软件     ②MySQLWorkbench可视化管理MySQL

### 2、用MySQLWorkbench管理数据库

### （1）创建数据库、创建数据表、设置字段（MySQLWorkbench中）

##### 设置字段的唯一标识：

①PK      (Primary Key主键、唯一标识)   

②NN      (Not Null值不为空)   

③UQ      (Unique值唯一)   

④AI        (Auto Increment值自动增长)

⑤设置默认值

### （2）向数据库中写入数据

①右键table --> Select Rows - Limit 1000 (设置AI和默认值的字段不必完全填写)

### 3、用SQL管理数据库

#### （1）介绍SQL

①SQL是结构化查询语言，专门用来访问和处理数据库的编程语言，能够让我们以编程的形式，操作数据库里面的数据

②SQL是一门数据库编程语言，用SQL语言编写出的代码叫做SQL语句，SQL只能在关系型数据库中使用，非关系型（mongodb）不支持

③SQL能查询数据，插入数据，跟新数据，删除数据，创建数据库，在数据库中创建表，数据库中创建存储过程、视图等

#### （2）SQL语法（关键字大小写相同，<> 和 !=  都表示不等于）

①查询数据

`select   *  from  表名称                              //指定表中，查询所有数据`

`select   列名称1 , 名称2   from   表名称               //指定表中，查询指定列（字段） 的数据`

②数据表中插入新的数据行

`insert  into  表名 （列1  ,  列2.....） values  (值1  ,  值2 ,.......)      //指定表中，插入指定的数据`

③修改（更新）表中的数据

`update 表名称 set 列名称  =  新值 where 列名称 = 指定值   //指定表中，更新某一列的指定值为新值（不加where更新全部）`

`update  表名称  set  列名称  = 新值  ,  列名称2 = 新值   where   列名称 = 指定     //指定表中，更新指定一行中多列`

④删除表中数据

`delete  from  表名  where  列名称  =  指定值     //删除指定行数据`

⑤运算符

!=  和 <>表示不等于  、 and  相当于&& 、 or  相当于 ||

⑥order  by 子句（对结果集进行排序）

默认升序(  asc  )对记录进行排序，降序需要使用 desc  关键字 

`例如： select * from  表名称  order  by  status  desc       //降序`

`select * from  表名称  order  by  status  desc , id  asc     //多重排序（status降序，id升序）`

⑦count(*)      (统计查询结果的总数据条数)

`例如： select  count(*)  from  表名称  where  status  =  0     //统计表中status为0的数据条数`

⑧使用AS为列设置别名

`例如： select count(*) AS  total  from  users  where  status  =  0    //设置统计表中数据条数的列名为total`

### 4、在项目中操作MySQL

（1）、安装MySQL数据库的第三方模块(mysql)

`npm  install  mysql`

（2）、通过mysql模块配置并连接到MySQL数据库

`const  mysql  = require('mysql') ;         //导入mysql模块`

`const   db  =  mysql.createPool({          //建立与MySQL数据库的连接`

`host:'127.0.0.1'  , user:'root'  , password:'dmq0216'  , database:'mydb01'`

​                                                                                                                                      `//连接数据库ip，登录账号和密码、连接待操作的数据库`

`})`

（3）、通过mysql模块执行SQL语句

###### ①测试mysql模块能否正常工作

`db.query('select  1' ,(err,result)=>{         `

`if(err)  return  console.log(err.message)`

`console.log(result)`

`})`

###### ②查询users表中所有的数据  （执行select语句查询到的是数组）

`db.query('select * from users' ,(err,result)=>{         `

`if(err)  return  console.log(err.message)`

`console.log(result)`

`})`

###### ③插入数据    (  用（？，？）符进行占位  )

`const  user  =  { username:'Spider-Man' , password:'dmq0216' }`

`const  sqlStr 'insert  into  users  ( username , password ) values ( ? , ? )'`

`db.query(sqlStr , [user.username , user.password ] , (err , result) => {`

`if(err) return console.log(err.message)`

`if( result.affectedRows === 1 ){  console.log('插入数据成功'  )  }`

`})`

或  便捷方式：

`const  user  =  { username:'Spider-Man' , password:'dmq0216' }`

`const  sqlStr 'insert  into  users  set ?'`

`db.query(sqlStr , user , (err , result) => {`

`if(err) return console.log(err.message)`

`if( result.affectedRows === 1 ){  console.log('插入数据成功'  )  }`

`})`

###### ④更新数据     （使用？占位符）

`const  user  =  {id=6, username:'Spider-Man' , password:'dmq0216' }`

`const  sqlStr 'update users set username=? , password=? where id=?'`

`db.query(sqlStr , user.username , user.password , user.id, (err , result) => {`

`if(err) return console.log(err.message)`

`if( result.affectedRows === 1 ){  console.log('更新数据成功'  )  }`

`})`

或   便捷方式：

`const  user  =  {id=6 , username:'Spider-Man' , password:'dmq0216' }`

`const  sqlStr 'update users set ? where id=?'`

`db.query(sqlStr , [ user , user.id ], (err , result) => {`

`if(err) return console.log(err.message)`

`if( result.affectedRows === 1 ){  console.log('更新数据成功'  )  }`

`})`

###### ⑤删除数据  （ 推荐使用id ）

`const  sqlStr ' delete from users where id=? '`

`db.query(sqlStr , 6 , (err , result) => {`

`if(err) return console.log(err.message)`

`if( result.affectedRows === 1 ){  console.log('删除数据成功'  )  }`

`})`

标记删除   （为了考虑安全性：在表中设置类似于status的状态字段，标记当前数据是否被删除，实际上是update语句）

`db.query('update users set status=1 where id=?', 6 , (err , result) => {`

`if(err) return console.log(err.message)`

`if( result.affectedRows === 1 ){  console.log('删除数据成功'  )  }`

`})`

## 四、Mongodb数据库

### 1、使用Mongodb数据库

##### 【1】    MongDB学习原因以及优势：

（1）MongoDB是一个基于分布式文件存储的数据库，官方地址为http://www.mongodb.com/

（2）数据库是按照数据结构来组织、存储和管理数据的应用程序

数据库的主要作用就是管理数据，对数据进行增、删、改、查

（3）相比于纯文件管理数据，数据库管理数据的特点：①速度更快②扩展性更强③安全性更高·

（4法与javascript相似，容易上手

##### 【2】    MongoDB中三个重要概念

（1）   数据库（database）

（2）   集合（collection）

（3）   文档（document）

##### 【3】    MongoDB安装，与创建默认文件（ c：/data/db ）

##### 【4】    文件中打开cmd，输入命令mongod，启动数据库服务（端口号为27017）

##### 【5】    文件中新开cmd，输入命令mongo , 请求数据库服务，输入命令show dbs显示数据库信息

##### 【6】    配置文件环境变量，以方便全局使用

全局命令：mongo使用数据库、mongoose启动数据库服务

##### 【7】    数据库与集合命令

（1）   数据库命令：

show dbs              查看当前数据库下有哪些服务

use 库名             切换到指定的数据库下，没有则创建

db                 显示当前所在的数据库

use 库名 

switched to db 库名          转到那个数据库

db.dropDatabase()           删除当前数据库

（2）   集合命令

db.createCollection()           创建集合

show collections             显示当前数据库中的所在

db.集合名.drop()             删除某个集合

db.集合名.renameCollection(‘newName’)   重命名集合

（3）   文档命令

db.集合名.insert({文档对象})              插入文档

db.集合名.find({查询条件})               查询文档

db.集合名.update({查询条件}，{新的文档内容})     更新新的文档（属性全部更新）

db.集合名.update({name:’张三’},{$set:{age:19}})     更新文档（部分更新）

db.集合名.remove({查询条件})

##### 【8】    数据库操作的应用场景

（1）   新增：用户注册、发布视频、发布商品、发布评论等

（2）   删除：删除评论、删除商品、删除文章等

（3）   更新：更新个人信息、修改商品价格等

（4）   查询：商品列表、朋友圈列表等

### 2、Mongoose文档对象模型链接mongdb数据库

##### 【1】   介绍：mongoose文档对象模型库，官网：http://www.mongoosejs.net/

##### 【2】便使用代码操作mongodb数据库,避免手动敲代码进行数据库操作

##### 【2】   使用mongoose连接数据库：

 *//(**发送请求服务时必须确保数据库服务启动中**)*

*//1* *项目初始化* *npm init*

*//2* *安装* *`mongoose  npm i mongoose@6.8.0`*

*//3* *导入* *mongoose*

`const mongoose = require('mongoose');`

*//* *设置取消部分提示*

`mongoose.set('strictQuery', true);`

*//4* *连接* *mongodb**数据库服务*

`mongoose.connect('mongodb://127.0.0.1:27017/bilibili');`

*//        (**协议名称**://ip**地址**:**端口号**/**数据库名称**)*

*//5* *设置回调*

*//* *设置连接成功的回调*

`mongoose.connection.once('open', () =>{`

  *// 6* *创建文档的结构对象*

  *//* *设置集合中文档的属性以及属性值的类型*

  `let BookSchema =new mongoose.Schema({`

​    `name: String,`

​    `author: String,`

​    `price: Number,`

​    `ishot: Boolean`

  `});`

  *// 7* *创建模型对象*  *对文档操作的封装对象* *(mongoose.model('**集合名称**',**结构对象**))*

  let BookModel **=** mongoose**.**model('books', BookSchema);

  *// 8* *文档中新增内容*

  `BookModel.create({`

​    `name: '西游记',`

​    `author: '吴承恩',`

​    `price: 20,`

​    `ishot: true`

  `},((err, data) => {`

​    `if (err) {`

​      `console.log(err);`

​      `return;`

​    `} console.log(data);`

  `}))`

  *//* *关闭数据库连接**(**项目运行时不使用**)*

  `*// mongoose.disconnect();*`

  *// })*

});

*//**设置连接错误的回调*

`mongoose.connection.on('error', () => {`

  `console.log('连接失败');`

`});`

*//* *设置连接关闭的回调*

`mongoose.connection.on('close', () => {`

  `console.log('连接关闭');`

`});`

*//* *手动关闭**mongodb**的连接*

*// setTimeout(() => {*

*//   mongoose.disconnect();*

*// }, 2000);*

 

##### 【3】   mongoose字段类型（在new的mongoose.Schema和创建的mongoose.model.create中注册和写入）

（1）   String类型（字符串）

（2）   Number类型（数字）

（3）   Boolean类型（布尔值）

（4）   Array类型（数组，也可以用[ ]来标识）

（5）   Date类型（日期）

（6）   Buffer类型（Buffer对象）

（7）   Mixed类型（任意对象，需要使用mongoose.Schema.Types.Mixed指定）

（8）   Objectld类型（对象ID，需要使用mongoose.Schema.Types.Objected指定）

（9）   Decimal128类型（高精度数字，需要使用mongoose.Schema.Types.Decimal128指定）  

##### 【4】   字段值验证（对文档属性的值进行校验，校验通过的值才会被存入数据库，在创建文档结构对象中操作）

（1）   例如给数据库文档中的name属性添加字段

 name: {

​      type: String,

​      *//* *必填项*

​      required: true,

​      *//* *默认值*

​      default: '西游记',

​      *//* *枚举值* *,**设置后只能设置在枚举项内的值*

​      enum: ['言情', '城市', '志怪', '恐怖'],

​      *//* *唯一值* *,**设置为独一无二的值**(**在集合里面不能重复**)*

​      unique: true 

​    },

##### 【5】   mongoose删除文档数据

(1)  删除单条文档数据

 *// 9**删除单条文档*

  BookModel**.**deleteOne({ _id: '647ec30caecaf3c1f3724a84' }, ((**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('删除失败');

​      **return**;

​    } console**.**log(data);

  }))

（2）   批量删除文档数据

   *// 10**批量删除*

  BookModel**.**deleteMany({ ishot: true }, (**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('删除失败');

​      **return**;

​    } console**.**log(data);

  });

##### 【6】   更新文档数据

（1）  *// 11**更新单条文档数据*

  BookModel**.**updateOne({ name: '西游记' }, { price: 5 }, (**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('更新失败');

​      **return**;

​    } console**.**log(data);

  })

（3）   更新多条文档数据

  *// 12**更新多条文档数据*

  BookModel**.**updateMany({ name: '西游记' }, { ishot: false }, (**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('更新失败');

​      **return**;

​    } console**.**log(data);

  });

##### 【7】   mongoose读取文档

（1）   获取单条文档数据

   *// 13**读取文档*

  BookModel**.**findOne({ price: '5' }, (**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('读取失败');

​      **return**;

​    } console**.**log(data);

  });

（*）根据id获取单条数据

  *// 13**读取文档*

  BookModel**.**findOne({ '647f11344d39a14410f61725'}, (**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('读取失败');

​      **return**;

​    } console**.**log(data);

  });

 

（2）   获得多条文档数据

   *// 14**读取多条文档数据*

  BookModel**.**find({ name: '西游记' }, (**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('读取失败');

​      **return**;

​    } console**.**log(data);

  });

（*）不加条件时获取全部文档数据

##### 【8】   moogose条件控制

（1）   运算符：

\>使用 $gt

<使用 $gt

\>=使用 $gte

<=使用 $lte

!==使用 $ne

  *// 14**读取多条文档数据*

  BookModel**.**find({ name: '西游记' }, (**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('读取失败');

​      **return**;

​    } console**.**log(data);

  });

(2)  逻辑运算

 $or逻辑或的情况

db.students.find({$or:[{age:18},{age:24}]}) ;

 $and逻辑与的情况

db.students.find({$and:[{age:{$lt:20}},{age:{$gt:15}}]}) ;

BookModel**.**find({$or:[{author:'曹雪芹'},{author:'余华'}]}, (**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('读取失败');

​      **return**;

​    }

​    console**.**log(data);

  })

});

 

(3)  正则匹配（条件中可以使用js的正则语法，通过正则进行模糊查询）

普通正则表达式：

   BookModel**.**find({name:/三/}, (**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('读取失败');

​      **return**;

​    }

​    console**.**log(data);

  })

 使用变量的正则表达式

  BookModel**.**find({name:**new** RegExp('三')}, (**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('读取失败');

​      **return**;

​    }

​    console**.**log(data);

  })

##### 【9】   个性化读取

（1）   select做字段的筛选（0表示不要的字段，1表示要的字段）

   BookModel**.**find()**.**select({ name: 1, author:1 })**.**exec((**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('读取失败');

​      **return**;

​    } console**.**log(data);

  })

（2）   sort进行数据排序（1是升序，-1是倒序）

  BookModel**.**find()**.**sort({price:**-**1})**.**exec((**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('读取失败');

​      **return**;

​    } console**.**log(data);

  })

​    （3）limit进行数据截取，skip进行第几个数据开始取

 BookModel**.**skip(3)**.**limit(3)**.**exec((**err**, **data**) **=>** {

​    **if** (err) {

​      console**.**log('读取失败');

​      **return**;

​    } console**.**log(data);

  })

（*）注意多个属性之间可以复用

 BookModel**.**find()

​    **.**select({ name: 1, price: 1 })

​    **.**sort({ price: **-**1 })

​    **.**skip(3)

​    **.**limit(3)

​    **.**exec((**err**, **data**) **=>** {

​      **if** (err) {

​        console**.**log('读取失败');

​        **return**;

​      } console**.**log(data);

​    })

##### 【10】 mongoose模块化

一、代码模块化

（1）   db.js中创建模块

 module**.**exports **=** function (**success**, **error**) {

  *//3* *导入* *mongoose*

  const mongoose **=** require('mongoose');

  *//* *设置取消部分提示*

  mongoose**.**set('strictQuery', true);

  *//4* *连接* *mongodb**数据库服务*

  mongoose**.**connect('mongodb://127.0.0.1:27017/bilibili');

  *//        (**协议名称**://ip**地址**:**端口号**/**数据库名称**)*

  *//* *设置连接成功的回调*

  mongoose**.***connection***.**once('open', () **=>** {

​    success();

  });

  *//**设置连接错误的回调*

  mongoose**.***connection***.**on('error', () **=>** {

​    error();

  });

  *//* *设置连接关闭的回调*

  mongoose**.***connection***.**on('close', () **=>** {

​    console**.**log('连接关闭');

  });

}

（2）   BookModel中创建模块

 const mongoose **=** require('mongoose');

*// 6* *创建文档的结构对象*

*//* *设置集合中文档的属性以及属性值的类型*

let BookSchema **=** **new** mongoose**.**Schema({

  name: {

​    type: String,

​    *//* *必填项*

​    required: true,

​    *//* *默认值*

​    default: '西游记',

​    *//* *枚举值* *,**设置后只能设置在枚举项内的值*

​    *// enum: ['**言情**', '**城市**', '**志怪**', '**恐怖**'],*

​    *//* *唯一值* *,**设置为独一无二的值**(**在集合里面不能重复**)*

​    *// unique: true* 

  },

  author: String,

  price: Number,

  ishot: Boolean,

  tags: Array,

  pubtime: Date

});

*// 7* *创建模型对象*  *对文档操作的封装对象* *(mongoose.model('**集合名称**',**结构对象**))*

let BookModel **=** mongoose**.**model('books', BookSchema);

*//*  *暴露模型对象*

module**.**exports **=** BookModel;

（3）   index文件中引用模块

 *//* *导入**db**文件*

const db **=** require('./db/db');

*//* *导入**monfoose*

const mongoose **=** require('mongoose');

*//* *导入**BookModel*

const BookModel **=** require('./models/BookModel');

*//* *调用函数*

db(() **=>** {

  

   *// 8* *文档中新增内容*

   BookModel**.**create({

​     name: '西游记',

​     author: '吴承恩',

​     price: 20,

​     ishot: true

   },((**err**, **data**) **=>** {

​     **if** (err) {

​       console**.**log(err);

​       **return**;

​     } console**.**log(data);

   }))

}, () **=>** {

  console**.**log('连接失败');

});

 

二、配置文件模块化

（1）config.js中暴露模块

*//* *配置文件*

module**.**exports **=** {

  DBHOST: '127.0.0.1',

  DBPORT: 27017,

  DBNAME: 'bilibili'

}

（2）db.js中使用模块

   *//* *导入配置文件*

  const {DBHOST,DBPORT,DBNAME}**=**require('../config/config.js');

  *//4* *连接* *mongodb**数据库服务*

  mongoose**.**connect(`mongodb://${DBHOST}:${DBPORT}/${DBNAME}`);

##### 【11】 mongodb图形化工具（Robo3T和navicate）

(1)  作用：代替mongo命令进行操作数据库，便于操作

(2)  mongod数据库服务启动再去进行操作

(3)   

 